Build Targeted Prospect Lists: Find & Enrich Leads with Surfe to HubSpot

https://n8nworkflows.xyz/workflows/build-targeted-prospect-lists--find---enrich-leads-with-surfe-to-hubspot-7130


# Build Targeted Prospect Lists: Find & Enrich Leads with Surfe to HubSpot

### 1. Workflow Overview

This workflow automates the process of building targeted prospect lists by searching for Ideal Customer Profile (ICP) companies, extracting relevant people from these companies, enriching their contact information via Surfe’s API, and finally syncing the enriched leads into HubSpot CRM. It is designed for sales and marketing teams who want to efficiently find, enrich, and manage leads within specific industries and geographies.

The workflow consists of the following logical blocks:

- **1.1 Input Trigger:** Manual initiation of the workflow.
- **1.2 ICP Companies Search:** Queries Surfe API to find companies matching specific criteria.
- **1.3 Prepare Company Domains for People Search:** Formats the company domains to search for people.
- **1.4 People Search Within Companies:** Retrieves lists of people associated with the companies found.
- **1.5 Prepare Enrichment Request:** Structures a payload to request bulk enrichment of people data.
- **1.6 Bulk Enrichment API Call:** Sends the enrichment request to Surfe API.
- **1.7 Enrichment Status Polling:** Checks periodically until the enrichment process is complete.
- **1.8 Extract and Filter Enriched People:** Extracts detailed people data and filters contacts having both phone and email.
- **1.9 HubSpot Integration:** Creates or updates contacts in HubSpot with enriched data.
- **1.10 Completion Notification:** Sends an email notification when the enrichment and upload process is done.

---

### 2. Block-by-Block Analysis

#### 1.1 Input Trigger

- **Overview:** Starts the workflow manually.
- **Nodes Involved:** `When clicking ‘Execute workflow’`
- **Node Details:**
  - Type: Manual Trigger
  - Role: Entry point to manually start the entire process.
  - Config: No parameters, simple manual trigger.
  - Inputs: None
  - Outputs: Triggers `Search ICP Companies`
  - Edge cases: None (trigger must be clicked to start).

#### 1.2 ICP Companies Search

- **Overview:** Searches Surfe API for companies matching defined ICP filters (industry, size, country, revenue).
- **Nodes Involved:** `Search ICP Companies`
- **Node Details:**
  - Type: HTTP Request
  - Role: Query Surfe API to find companies.
  - Config:
    - Method: POST
    - URL: `https://api.surfe.com/v2/companies/search`
    - Body JSON:
      - Filters: industries = ["Software", "Apps", "SaaS"], employee count from 1 to 35, country = "FR", revenue = "1-10M"
      - Limit: 20 companies
    - Authentication: HTTP Bearer Token (genericCredentialType)
  - Inputs: Trigger node output
  - Outputs: Passes JSON response to `prepare JSON PAYLOAD WITH Company Domains`
  - Edge cases:
    - API errors, authentication failure, empty response, rate limits.

#### 1.3 Prepare Company Domains for People Search

- **Overview:** Formats the company domains from the companies search results to prepare for people search.
- **Nodes Involved:** `prepare JSON PAYLOAD WITH Company Domains`
- **Node Details:**
  - Type: Code
  - Role: Extracts company domains array and structures JSON payload for people search.
  - Code logic:
    - Reads `companyDomains` array from input JSON
    - Builds `{ companies: { domains: [...] }, limit: 20 }`
  - Inputs: Output of `Search ICP Companies`
  - Outputs: JSON payload for next node
  - Edge cases:
    - Missing or empty `companyDomains` array could cause invalid payload.

#### 1.4 People Search Within Companies

- **Overview:** Searches for people associated with the domains of companies found.
- **Nodes Involved:** `Search People in Companies`
- **Node Details:**
  - Type: HTTP Request
  - Role: Query Surfe API people search endpoint.
  - Config:
    - Method: POST
    - URL: `https://api.surfe.com/v2/people/search`
    - Body JSON: dynamic, directly from previous node output.
    - Authentication: HTTP Bearer Token
  - Inputs: JSON payload from prepare node
  - Outputs: People data to `Prepare JSON Payload Enrichment Request`
  - Edge cases:
    - Empty people list, API failure, timeout.

#### 1.5 Prepare Enrichment Request

- **Overview:** Prepares bulk enrichment request payload from the people list.
- **Nodes Involved:** `Prepare JSON Payload Enrichment Request`
- **Node Details:**
  - Type: Code
  - Role: Constructs JSON with people info and enrichment options.
  - Code logic:
    - Extracts array of people from `people` property in input JSON.
    - Maps each person to include firstName, lastName, companyName, companyDomain, linkedinUrl, and an externalID generated by concatenating firstName, lastName, and companyDomain (lowercase and sanitized).
    - Sets include options for `email` and `mobile` (phone), LinkedIn URL excluded.
    - Sets empty webhook URL in notificationOptions.
  - Inputs: People search response
  - Outputs: JSON ready for bulk enrichment API
  - Edge cases:
    - Empty people array, malformed person entries.

#### 1.6 Bulk Enrichment API Call

- **Overview:** Calls Surfe bulk enrichment API to enrich people data.
- **Nodes Involved:** `Surfe Bulk Enrichments API`
- **Node Details:**
  - Type: HTTP Request
  - Role: Send enrichment request to Surfe.
  - Config:
    - Method: POST
    - URL: `https://api.surfe.com/v2/people/enrich`
    - Body JSON: from previous node
    - Authentication: HTTP Bearer Token
  - Inputs: Enrichment request JSON
  - Outputs: Enrichment operation response, including `enrichmentID`
  - Edge cases:
    - API errors, authentication failure, rate limits.

#### 1.7 Enrichment Status Polling

- **Overview:** Polls Surfe API repeatedly to check if enrichment is complete.
- **Nodes Involved:** 
  - `Surfe check enrichement status`
  - `Is enrichment complete ?`
  - `Wait 3 secondes`
- **Node Details:**
  - `Surfe check enrichement status`
    - Type: HTTP Request
    - Role: GET enrichment status by `enrichmentID`
    - URL dynamic: `https://api.surfe.com/v2/people/enrich/{{ $json.enrichmentID }}`
    - Authentication: HTTP Bearer Token
    - Input: enrichmentID from previous node response
    - Output: status JSON with `status` field
  - `Is enrichment complete ?`
    - Type: IF
    - Role: Checks if status equals `COMPLETED`
    - Input: status from previous node
    - Outputs:
      - True: proceed to extract enriched people
      - False: wait 3 seconds then re-check status
  - `Wait 3 secondes`
    - Type: Wait
    - Role: Delay before retrying status check
    - Duration: 3 seconds
    - Output: loops back to `Surfe check enrichement status`
  - Edge cases:
    - Infinite loop if status never completes
    - API rate limits on polling
    - Network errors during polling

#### 1.8 Extract and Filter Enriched People

- **Overview:** Extracts enriched people details and filters those who have both phone and email.
- **Nodes Involved:** 
  - `Extract list of peoples from Surfe API response`
  - `Filter: phone AND email`
- **Node Details:**
  - `Extract list of peoples from Surfe API response`
    - Type: Code
    - Role: Maps raw people data to structured JSON fields:
      - id, firstName, lastName, email, phone, jobTitle, companyName, companyWebsite, linkedinUrl, country, status
    - Inputs: enrichment result JSON with `people` array
    - Outputs: array of individual person JSON objects
  - `Filter: phone AND email`
    - Type: Filter
    - Role: Filters people who have both non-empty `phone` and `email` fields
    - Inputs: people array JSON
    - Outputs: filtered people to HubSpot node
  - Edge cases:
    - Missing phone or email filters out contacts
    - Empty people list

#### 1.9 HubSpot Integration

- **Overview:** Creates or updates contacts in HubSpot using enriched data.
- **Nodes Involved:** `HubSpot: Create or Update`
- **Node Details:**
  - Type: HubSpot node
  - Role: Sync enriched contacts to HubSpot CRM.
  - Config:
    - Uses email as unique identifier
    - Updates fields: firstName, lastName, phoneNumber, jobTitle, companyName, websiteUrl (LinkedIn URL), country
    - Authentication: HubSpot app token credentials
  - Inputs: filtered people with phone and email
  - Outputs: triggers notification email node
  - Edge cases:
    - API errors, authentication failure
    - Duplicate contacts if email is not unique
    - Data mapping errors

#### 1.10 Completion Notification

- **Overview:** Sends an email notification when the enrichment and upload process finishes.
- **Nodes Involved:** `Gmail`
- **Node Details:**
  - Type: Gmail node (Send Email)
  - Role: Notifies user that ICP prospecting enrichment is done.
  - Config:
    - To: `<YOUR_EMAIL>` (must be replaced by user)
    - Subject: "Your ICP prospecting enrichment is done."
    - Message: Same as subject
    - Execute once per workflow run
    - Authentication: Gmail OAuth2
  - Inputs: From successful HubSpot node completion
  - Outputs: None
  - Edge cases:
    - Email sending failure
    - Missing or incorrect recipient email

---

### 3. Summary Table

| Node Name                             | Node Type           | Functional Role                           | Input Node(s)                   | Output Node(s)                   | Sticky Note                                                                                     |
|-------------------------------------|---------------------|-----------------------------------------|--------------------------------|---------------------------------|------------------------------------------------------------------------------------------------|
| When clicking ‘Execute workflow’    | Manual Trigger      | Starts workflow                         | None                           | Search ICP Companies             |                                                                                                |
| Search ICP Companies                 | HTTP Request        | Search for ICP companies via Surfe API | When clicking ‘Execute workflow’ | prepare JSON PAYLOAD WITH Company Domains |                                                                                                |
| prepare JSON PAYLOAD WITH Company Domains | Code                | Prepare company domains for people search | Search ICP Companies            | Search People in Companies       |                                                                                                |
| Search People in Companies           | HTTP Request        | Search for people in selected companies  | prepare JSON PAYLOAD WITH Company Domains | Prepare JSON Payload Enrichment Request |                                                                                                |
| Prepare JSON Payload Enrichment Request | Code                | Prepare bulk enrichment request payload  | Search People in Companies      | Surfe Bulk Enrichments API       |                                                                                                |
| Surfe Bulk Enrichments API           | HTTP Request        | Send bulk enrichment request to Surfe    | Prepare JSON Payload Enrichment Request | Surfe check enrichement status   |                                                                                                |
| Surfe check enrichement status       | HTTP Request        | Poll enrichment status from Surfe        | Surfe Bulk Enrichments API, Wait 3 secondes | Is enrichment complete ?          |                                                                                                |
| Is enrichment complete ?              | IF                  | Check if enrichment is completed          | Surfe check enrichement status | Extract list of peoples from Surfe API response, Wait 3 secondes |                                                                                                |
| Wait 3 secondes                      | Wait                 | Delay before polling enrichment status   | Is enrichment complete ? (false) | Surfe check enrichement status   |                                                                                                |
| Extract list of peoples from Surfe API response | Code                | Extract and structure enriched people data | Is enrichment complete ? (true) | Filter: phone AND email          |                                                                                                |
| Filter: phone AND email              | Filter               | Filter contacts having both phone & email | Extract list of peoples from Surfe API response | HubSpot: Create or Update        |                                                                                                |
| HubSpot: Create or Update            | HubSpot              | Create or update contacts in HubSpot     | Filter: phone AND email         | Gmail                           |                                                                                                |
| Gmail                              | Gmail                | Send notification email after process     | HubSpot: Create or Update       | None                           | Notify end of enrichment                                                                        |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Manual Trigger Node**
   - Name: `When clicking ‘Execute workflow’`
   - Type: Manual Trigger
   - No additional configuration

2. **Create HTTP Request Node for ICP Companies Search**
   - Name: `Search ICP Companies`
   - Method: POST
   - URL: `https://api.surfe.com/v2/companies/search`
   - Authentication: HTTP Bearer Token (genericCredentialType)
   - Body (JSON):
     ```json
     {
       "filters": {
         "industries": ["Software", "Apps", "SaaS"],
         "employeeCount": { "from": 1, "to": 35 },
         "countries": ["FR"],
         "revenues": ["1-10M"]
       },
       "limit": 20
     }
     ```
   - Connect output of Manual Trigger to this node.

3. **Create Code Node to Prepare Company Domains Payload**
   - Name: `prepare JSON PAYLOAD WITH Company Domains`
   - JavaScript:
     ```javascript
     const companies = $json.companyDomains || [];
     return {
       companies: { domains: companies },
       limit: 20
     };
     ```
   - Connect output of `Search ICP Companies` to this node.

4. **Create HTTP Request Node for People Search**
   - Name: `Search People in Companies`
   - Method: POST
   - URL: `https://api.surfe.com/v2/people/search`
   - Authentication: HTTP Bearer Token
   - Body: Use expression to set body from previous node JSON (`={{ $json }}`)
   - Connect output of `prepare JSON PAYLOAD WITH Company Domains` to this node.

5. **Create Code Node to Prepare Enrichment Request**
   - Name: `Prepare JSON Payload Enrichment Request`
   - JavaScript:
     ```javascript
     const people = $json.people || [];
     return [{
       json: {
         include: { email: true, linkedInUrl: false, mobile: true },
         notificationOptions: { webhookUrl: "" },
         people: people.map(person => ({
           firstName: person.firstName || "",
           lastName: person.lastName || "",
           companyName: person.companyName || "",
           companyDomain: person.companyDomain || "",
           linkedinUrl: person.linkedInUrl || "",
           externalID: `${person.firstName}_${person.lastName}_${person.companyDomain}`.toLowerCase().replace(/[^a-z0-9_]/g, '_')
         }))
       }
     }];
     ```
   - Connect output of `Search People in Companies` to this node.

6. **Create HTTP Request Node for Bulk Enrichment API**
   - Name: `Surfe Bulk Enrichments API`
   - Method: POST
   - URL: `https://api.surfe.com/v2/people/enrich`
   - Authentication: HTTP Bearer Token
   - Body: Use expression from previous node JSON (`={{ $json }}`)
   - Connect output of `Prepare JSON Payload Enrichment Request` to this node.

7. **Create HTTP Request Node for Enrichment Status Check**
   - Name: `Surfe check enrichement status`
   - Method: GET
   - URL expression: `=https://api.surfe.com/v2/people/enrich/{{ $json.enrichmentID }}`
   - Authentication: HTTP Bearer Token
   - Connect output of `Surfe Bulk Enrichments API` and also from Wait node (loop) to this node.

8. **Create IF Node to Check Enrichment Status**
   - Name: `Is enrichment complete ?`
   - Condition: Check if `{{$json.status}}` equals `COMPLETED` (case sensitive, strict)
   - Connect output of `Surfe check enrichement status` to this node.

9. **Create Wait Node to Delay 3 Seconds**
   - Name: `Wait 3 secondes`
   - Duration: 3 seconds
   - Connect false output of `Is enrichment complete ?` to this node.
   - Connect output of this node back to `Surfe check enrichement status` to form polling loop.

10. **Create Code Node to Extract People from Enrichment Response**
    - Name: `Extract list of peoples from Surfe API response`
    - JavaScript:
      ```javascript
      const people = $json.people || [];
      return people.map(person => ({
        json: {
          id: person.id || '',
          firstName: person.firstName || '',
          lastName: person.lastName || '',
          email: person.emails?.[0]?.email || '',
          phone: person.mobilePhones?.[0]?.mobilePhone || '',
          jobTitle: person.jobTitle || '',
          companyName: person.companyName || '',
          companyWebsite: person.companyDomain || '',
          linkedinUrl: person.linkedInUrl || '',
          country: person.country || '',
          status: person.status || ''
        }
      }));
      ```
    - Connect true output of `Is enrichment complete ?` to this node.

11. **Create Filter Node to Keep People with Phone and Email**
    - Name: `Filter: phone AND email`
    - Condition: Both `$json.phone` and `$json.email` are not empty strings.
    - Connect output of `Extract list of peoples from Surfe API response` to this node.

12. **Create HubSpot Node to Create or Update Contacts**
    - Name: `HubSpot: Create or Update`
    - Authentication: HubSpot App Token
    - Email field: `={{ $json.email }}`
    - Additional fields mapped:
      - firstName, lastName, phoneNumber, jobTitle, companyName, websiteUrl (set to linkedinUrl), country
    - Connect output of `Filter: phone AND email` to this node.

13. **Create Gmail Node to Send Notification**
    - Name: `Gmail`
    - Authentication: Gmail OAuth2
    - To: Replace `<YOUR_EMAIL>` with actual recipient email
    - Subject: "Your ICP prospecting enrichment is done."
    - Message: Same as subject
    - Execute once per workflow run
    - Connect output of `HubSpot: Create or Update` to this node.

---

### 5. General Notes & Resources

| Note Content                                                                                           | Context or Link                                              |
|------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
| Replace `<YOUR_EMAIL>` in Gmail node with the actual email address to receive notifications.          | Gmail node configuration                                      |
| Surfe API Bearer token authentication is required for all Surfe HTTP Request nodes.                   | Surfe API documentation                                      |
| HubSpot node requires App Token authentication configured in n8n credentials.                        | HubSpot API and n8n HubSpot node documentation               |
| Polling loop with 3-second wait ensures the enrichment process completes before extracting data.     | Avoids race conditions and incomplete data extraction         |
| Workflow limits company search to 20 companies and people enrichment to 20 for performance reasons.  | Limits can be adjusted in code and HTTP request node payloads |
| External ID generation ensures unique tracking for each person in enrichment requests (sanitized).   | Important for deduplication and tracking in Surfe enrichment  |

---

**Disclaimer:**  
The provided text is exclusively derived from an automation workflow created with n8n, a no-code integration and automation tool. The process strictly adheres to content policies and contains no illegal, offensive, or protected elements. All data handled is legal and public.