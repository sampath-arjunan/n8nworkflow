{"id":"eq7ckAHLtE4LXUmP","meta":{"instanceId":"14e4c77104722ab186539dfea5182e419aecc83d85963fe13f6de862c875ebfa","templateCredsSetupCompleted":true},"name":"WhatsApp AI Sales Agent using PDF Vector Store","tags":[],"nodes":[{"id":"b107e977-4676-4c2b-a963-ae8789c2a844","name":"WhatsApp Trigger","type":"n8n-nodes-base.whatsAppTrigger","position":[-592,416],"webhookId":"aaa71f03-f7af-4d18-8d9a-0afb86f1b554","parameters":{"options":{},"updates":["messages"]},"typeVersion":1},{"id":"adb4f300-568a-4c42-9a1a-c81fc1669457","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[-32,624],"parameters":{"model":"gpt-4o-2024-08-06","options":{}},"credentials":{"openAiApi":{"id":"fCkPwzC5wcyxcEF6","name":"OpenAi account 10"}},"typeVersion":1},{"id":"16291881-1e5b-47f8-8f78-04e3ca6df90d","name":"Window Buffer Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[128,624],"parameters":{"sessionKey":"=whatsapp-75-{{ $json.messages[0].from }}","sessionIdType":"customKey"},"typeVersion":1.2},{"id":"9142840a-efce-402b-a15e-f5a9e7beb4d2","name":"Vector Store Tool","type":"@n8n/n8n-nodes-langchain.toolVectorStore","position":[400,624],"parameters":{"name":"query_product_brochure","description":"Call this tool to query the product brochure. Valid for the year 2024."},"typeVersion":1},{"id":"8700a361-a3b5-43f6-ac52-cc2635234a32","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[224,992],"parameters":{"model":"text-embedding-3-small","options":{}},"credentials":{"openAiApi":{"id":"fCkPwzC5wcyxcEF6","name":"OpenAi account 10"}},"typeVersion":1},{"id":"87f041ee-d278-4fb6-89b9-13364bce4771","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[592,800],"parameters":{"model":"gpt-4o-2024-08-06","options":{}},"credentials":{"openAiApi":{"id":"fCkPwzC5wcyxcEF6","name":"OpenAi account 10"}},"typeVersion":1},{"id":"445dbb88-570b-4f5d-b022-a22682310d7b","name":"When clicking ‘Test workflow’","type":"n8n-nodes-base.manualTrigger","position":[-1952,464],"parameters":{},"typeVersion":1},{"id":"5e0e6f96-1afc-484d-bdf9-eac3049faa30","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[-1184,672],"parameters":{"model":"text-embedding-3-small","options":{}},"credentials":{"openAiApi":{"id":"fCkPwzC5wcyxcEF6","name":"OpenAi account 10"}},"typeVersion":1},{"id":"235f759c-20d2-4099-ae4f-3b459285e854","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","position":[-1040,672],"parameters":{"options":{},"jsonData":"={{ $('Extract from File').item.json.text }}","jsonMode":"expressionData"},"typeVersion":1},{"id":"6e81a5ef-0613-4809-b018-1f0f47729059","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","position":[-1040,800],"parameters":{"options":{},"chunkSize":2000,"chunkOverlap":{}},"typeVersion":1},{"id":"30afb32b-6df9-435c-a25a-1a9677b7f626","name":"Extract from File","type":"n8n-nodes-base.extractFromFile","position":[-1584,464],"parameters":{"options":{},"operation":"pdf"},"typeVersion":1},{"id":"65f26b76-8c9f-430c-9773-c2ddc8d5881a","name":"get Product Brochure","type":"n8n-nodes-base.httpRequest","position":[-1760,464],"parameters":{"url":"https://usa.yamaha.com/files/download/brochure/1/1474881/Yamaha-Powered-Loudspeakers-brochure-2024-en-web.pdf","options":{}},"typeVersion":4.2},{"id":"fc91fc1f-6eb2-48b5-98b4-9b705792a974","name":"Reply To User","type":"n8n-nodes-base.whatsApp","position":[784,400],"webhookId":"ee4faf4e-91b4-4ecc-b685-9013b9d9f2eb","parameters":{"textBody":"={{ $json.output }}","operation":"send","phoneNumberId":"477115632141067","additionalFields":{"previewUrl":false},"recipientPhoneNumber":"={{ $('WhatsApp Trigger').item.json.messages[0].from }}"},"typeVersion":1},{"id":"28d0a680-4e1b-4b67-b70f-d3dfc9bec1ee","name":"Reply To User1","type":"n8n-nodes-base.whatsApp","position":[-416,976],"webhookId":"996b34b9-caaa-48b2-8d1b-a3fe4392fa1a","parameters":{"textBody":"=I'm unable to process non-text messages. Please send only text messages. Thanks!","operation":"send","phoneNumberId":"477115632141067","additionalFields":{"previewUrl":false},"recipientPhoneNumber":"={{ $('WhatsApp Trigger').item.json.messages[0].from }}"},"typeVersion":1},{"id":"3172ee9d-63f5-4248-bfb6-30f857cc66b6","name":"Product Catalogue","type":"@n8n/n8n-nodes-langchain.vectorStoreInMemory","position":[224,800],"parameters":{"memoryKey":"whatsapp-75"},"typeVersion":1},{"id":"65e3119a-1d1d-4b66-a644-a5d19a3d0a88","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-1360,96],"parameters":{"color":7,"width":615,"height":859,"content":"## 2. Create Product Brochure Vector Store\n\nVector stores are powerful databases which serve the purpose of matching a user's questions to relevant parts of a document. By creating a vector store of our product catalog, we'll allow users to query using natural language.\n\nTo keep things simple, we'll use the **In-memory Vector Store** which comes built-in to n8n and doesn't require a separate service. For production deployments, I'd recommend replacing the in-memory vector store with either [Qdrant](https://qdrant.tech) or [Pinecone](https://pinecone.io)."},"typeVersion":1},{"id":"1c567b12-471c-4163-9fb0-856f12dbf757","name":"Create Product Catalogue","type":"@n8n/n8n-nodes-langchain.vectorStoreInMemory","position":[-1184,464],"parameters":{"mode":"insert","memoryKey":"whatsapp-75","clearStore":true},"typeVersion":1},{"id":"7bb06017-b82f-450f-9d26-ba68d855476a","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[-688,96],"parameters":{"color":7,"width":547,"height":532,"content":"## 3. Use the WhatsApp Trigger\n\nThe WhatsApp Trigger allows you to receive incoming WhatsApp messages from customers. It requires a bit of setup so remember to follow the documentation carefully! Once ready however, it's quite easy to build powerful workflows which are easily accessible to users.\n\nNote that WhatsApp can send many message types such as audio and video so in this demonstration, we'll filter them out and just accept the text messages."},"typeVersion":1},{"id":"6783810c-1359-4325-b6d5-2e54f9796e54","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[-688,832],"parameters":{"color":7,"width":546,"height":311,"content":"### 3a. Handle Unsupported Message Types\nFor non-text messages, we'll just reply with a simple message to inform the sender."},"typeVersion":1},{"id":"d2c49e49-b721-4fb0-8595-129db1337b2f","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[-96,96],"parameters":{"color":7,"width":795,"height":1041,"content":"## 4. Sales AI Agent Responds To Customers\n\nn8n's AI agents are powerful nodes which make it incredibly easy to use state-of-the-art AI in your workflows. Not only do they have the ability to remember conversations per individual customer but also tap into resources such as our product catalogue vector store to pull factual information and data for every question.\n\nIn this demonstration, we use an AI agent which is directed to help the user navigate the product brochure. A Chat memory subnode is attached to identify and keep track of the customer session. A Vector store tool is added to allow the Agent to tap into the product catalogue knowledgebase we built earlier."},"typeVersion":1},{"id":"c3fc9f2f-31cd-459d-8dbe-0fe032671269","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[736,96],"parameters":{"color":7,"width":367,"height":628,"content":"## 5. Repond to WhatsApp User\n\nThe WhatsApp node is the go-to if you want to interact with WhatsApp users. With this node, you can send text, images, audio and video messages as well as use your WhatsApp message templates.\n\nHere, we'll keep it simple by replying with a text message which is the output of the AI agent."},"typeVersion":1},{"id":"ea7a9bd5-7598-47f1-9cdd-63f22596e9bb","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[-3200,-768],"parameters":{"width":1105,"height":855,"content":"### How it works\n\nThis n8n workflow automates a WhatsApp-based AI Sales Agent that responds to customer inquiries using a product catalog stored in a vector database. Here’s how it works:\n\n1. **WhatsApp Trigger**: The workflow starts by capturing incoming WhatsApp messages using a webhook. This allows the system to receive customer queries via WhatsApp.\n\n2. **Product Brochure Extraction**: The product brochure (in PDF format) is downloaded using an HTTP request node. The contents are then extracted using the \"Extract from File\" node to build the knowledge base.\n\n3. **Vector Store Creation**: The extracted text from the brochure is uploaded into an in-memory vector store, creating a searchable database. This vector store can be replaced with external services like Qdrant or Pinecone for larger-scale setups.\n\n4. **AI Sales Agent Interaction**: Using OpenAI's language model, the AI Sales Agent responds to customer queries. The agent processes the input message, searches the vector store for relevant product information, and generates a response.\n\n5. **Message Filtering**: Non-text messages (e.g., images, audio) are filtered out, with the agent responding with a message stating it only supports text messages.\n\n6. **Customer Response**: Once the AI Sales Agent has processed the query, it sends the appropriate response back to the customer via WhatsApp.\n\n---\n\n### Setup\n\nTo set up this workflow, follow these steps:\n\n1. **Download Product Brochure**: Use the HTTP request node to download the product brochure and the \"Extract from File\" node to extract its text.\n\n2. **Configure WhatsApp Trigger**: Set up the WhatsApp webhook to receive incoming messages from customers.\n\n3. **Create Vector Store**: Upload the extracted text into an in-memory vector store, or replace it with a more scalable option like Qdrant or Pinecone.\n\n4. **Configure AI Sales Agent**: Set up the AI agent with a prompt tailored to your product catalog, ensuring it can access the vector store for product details.\n\n5. **Handle Non-text Messages**: Add a filter to handle non-text messages, ensuring that the system only processes text-based queries.\n\n6. **Activate the Workflow**: After completing the setup, activate the workflow to start receiving and responding to customer queries via WhatsApp. Ensure WhatsApp is properly connected to your server for seamless operation.\n"},"typeVersion":1},{"id":"9182bedf-7ef3-4b5c-afa2-aa5a301c2174","name":"Handle Message Types","type":"n8n-nodes-base.switch","position":[-384,416],"parameters":{"rules":{"values":[{"outputKey":"Supported","conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.messages[0].type }}","rightValue":"text"}]},"renameOutput":true},{"outputKey":"Not Supported","conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"89971d8c-a386-4e77-8f6c-f491a8e84cb6","operator":{"type":"string","operation":"notEquals"},"leftValue":"={{ $json.messages[0].type }}","rightValue":"text"}]},"renameOutput":true}]},"options":{}},"typeVersion":3.2},{"id":"9dbba1e7-c193-4bfa-ab3c-5f38b57875d1","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[-2032,688],"parameters":{"color":7,"width":633,"height":131,"content":"### You only have to run this part once!\nRun this step to populate our product catalogue vector. Run again if you want to update the vector store with a new version."},"typeVersion":1},{"id":"9699f468-1799-421c-ac28-e635d76a8d8c","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[-688,656],"parameters":{"color":7,"width":541,"height":155,"content":"### Activate your workflow to use!\nTo start using the WhatsApp chatbot, you'll need to activate the workflow. If you are self-hosting ensure WhatsApp is able to connect to your server."},"typeVersion":1},{"id":"46ffcee3-0e27-4767-9432-fc9ccc22a023","name":"AI Sales Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[-32,400],"parameters":{"text":"={{ $json.messages[0].text.body }}","options":{"systemMessage":"You are an assistant working for a company who sells Yamaha Powered Loudspeakers and helping the user navigate the product catalog for the year 2024. Your goal is not to facilitate a sale but if the user enquires, direct them to the appropriate website, url or contact information.\n\nDo your best to answer any questions factually. If you don't know the answer or unable to obtain the information from the datastore, then tell the user so."},"promptType":"define"},"typeVersion":1.6},{"id":"6e4fa268-bb66-44f1-b2b8-33106f77683f","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-2032,96],"parameters":{"color":7,"width":640,"height":563,"content":"## 1. Download Product Brochure PDF\n\nImport your marketing PDF document to build your vector store. This will be used as the knowledgebase by the Sales AI Agent.\n\nFor this demonstration, we'll use the HTTP request node to import the YAMAHA POWERED LOUDSPEAKERS 2024 brochure ([Source](https://usa.yamaha.com/files/download/brochure/1/1474881/Yamaha-Powered-Loudspeakers-brochure-2024-en-web.pdf)) and an Extract from File node to extract the text contents. "},"typeVersion":1}],"active":false,"pinData":{},"settings":{"executionOrder":"v1"},"versionId":"2e24dbca-3394-461c-b29f-2b77b1d04f1f","connections":{"AI Sales Agent":{"main":[[{"node":"Reply To User","type":"main","index":0}]]},"WhatsApp Trigger":{"main":[[{"node":"Handle Message Types","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Product Catalogue","type":"ai_embedding","index":0}]]},"Extract from File":{"main":[[{"node":"Create Product Catalogue","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Sales Agent","type":"ai_languageModel","index":0}]]},"Product Catalogue":{"ai_vectorStore":[[{"node":"Vector Store Tool","type":"ai_vectorStore","index":0}]]},"Vector Store Tool":{"ai_tool":[[{"node":"AI Sales Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Create Product Catalogue","type":"ai_embedding","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Vector Store Tool","type":"ai_languageModel","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Create Product Catalogue","type":"ai_document","index":0}]]},"Handle Message Types":{"main":[[{"node":"AI Sales Agent","type":"main","index":0}],[{"node":"Reply To User1","type":"main","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"AI Sales Agent","type":"ai_memory","index":0}]]},"get Product Brochure":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"When clicking ‘Test workflow’":{"main":[[{"node":"get Product Brochure","type":"main","index":0}]]}}}