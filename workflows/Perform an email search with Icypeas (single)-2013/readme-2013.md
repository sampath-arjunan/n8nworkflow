Perform an email search with Icypeas (single)

https://n8nworkflows.xyz/workflows/perform-an-email-search-with-icypeas--single--2013


# Perform an email search with Icypeas (single)

### 1. Workflow Overview

This workflow automates the process of performing an email search using the Icypeas service. Its primary use case is to find an email address associated with a given person by querying Icypeas via their API. The workflow is structured into three logical blocks:

- **1.1 Input Reception:** The workflow starts manually on user execution.
- **1.2 Authentication:** A Code node generates the necessary authentication signature using the user's Icypeas API credentials.
- **1.3 Email Search Execution:** An HTTP Request node performs a POST request to Icypeas API to search for an email address by providing the person’s firstname, lastname, and domain/company.

---

### 2. Block-by-Block Analysis

#### 2.1 Input Reception

- **Overview:**  
  This block initiates the workflow manually when the user clicks "Execute Workflow."

- **Nodes Involved:**  
  - `When clicking "Execute Workflow"`

- **Node Details:**  
  - **Node Name:** When clicking "Execute Workflow"  
  - **Type:** Manual Trigger  
  - **Technical Role:** Starts the workflow on manual execution.  
  - **Configuration:** Default manual trigger with no parameters.  
  - **Expressions/Variables:** None.  
  - **Input/Output Connections:**  
    - Output connected to `Authenticates to your Icypeas account`.  
  - **Version-Specific Requirements:** None.  
  - **Edge Cases / Failures:** User must manually trigger the workflow; no automation or event-based trigger available here.

---

#### 2.2 Authentication

- **Overview:**  
  This block authenticates the user to the Icypeas API by generating a timestamped HMAC-SHA1 signature required for API requests.

- **Nodes Involved:**  
  - `Authenticates to your Icypeas account`  
  - Associated Sticky Note: instructions for inserting API Key, API Secret, User ID and enabling crypto module for self-hosted users.

- **Node Details:**  
  - **Node Name:** Authenticates to your Icypeas account  
  - **Type:** Code Node (JavaScript)  
  - **Technical Role:** Creates API signature for authentication by combining HTTP method, path, and timestamp, hashed with the API secret. Injects API credentials and signature into workflow data for downstream use.  
  - **Configuration:**  
    - User must manually enter three credentials:
      - `API_KEY`  
      - `API_SECRET`  
      - `USER_ID`  
    - Code uses Node.js `crypto` module to generate HMAC-SHA1 signature.  
    - Constructs the full API URL and stores all relevant authentication data in output JSON under `json.api`.  
  - **Key Expressions/Variables:**  
    - `API_KEY`, `API_SECRET`, `USER_ID` are hardcoded strings to be replaced by the user.  
    - `timestamp` generated dynamically as ISO string.  
    - Signature generated by `genSignature` function.  
  - **Input/Output Connections:**  
    - Input from manual trigger.  
    - Output to `Run email search (single)`.  
  - **Version-Specific Requirements:**  
    - Requires n8n environment with Node.js crypto module enabled.  
    - For self-hosted users, enabling the "crypto" module in n8n settings is necessary.  
  - **Edge Cases / Failures:**  
    - Missing or incorrect API credentials will cause authentication failure.  
    - Crypto module not enabled will cause runtime errors.  
    - Timestamp synchronization issues could lead to rejected signatures.  
  - **Sub-Workflow:** None.

---

#### 2.3 Email Search Execution

- **Overview:**  
  This block performs the actual email search by sending a POST request to Icypeas API with the authenticated headers and user-provided search parameters (firstname, lastname, domain/company).

- **Nodes Involved:**  
  - `Run email search (single)`  
  - Associated Sticky Note: instructions for HTTP Header Auth credential setup and body parameters configuration.

- **Node Details:**  
  - **Node Name:** Run email search (single)  
  - **Type:** HTTP Request Node  
  - **Technical Role:** Sends a POST HTTP request to Icypeas API endpoint to perform the email search.  
  - **Configuration:**  
    - URL taken dynamically from the output of the authentication node (`{{$json.api.url}}`).  
    - HTTP Method: POST.  
    - Authentication: HTTP Header Authentication with a credential named “Header Auth account”.  
    - Header Parameters:  
      - `X-ROCK-TIMESTAMP`: dynamically set to the timestamp generated in the authentication node (`{{$json.api.timestamp}}`).  
      - `Authorization` header is set via the credential using an expression combining API key and signature: `{{ $json.api.key + ':' + $json.api.signature }}`.  
    - Body Parameters (JSON):  
      - `lastname`: `Landoin` (hardcoded example)  
      - `firstname`: `Pierre` (hardcoded example)  
      - `domainOrCompany`: `icypeas` (hardcoded example)  
  - **Key Expressions/Variables:**  
    - URL and headers dynamically injected from authentication node output.  
    - Authorization header set via credential expression.  
  - **Input/Output Connections:**  
    - Input from `Authenticates to your Icypeas account`.  
    - No downstream connected nodes (end of workflow).  
  - **Version-Specific Requirements:**  
    - Requires HTTP Request node version 4.1 for proper header auth support.  
    - Requires pre-created HTTP Header Auth credential configured as instructed.  
  - **Edge Cases / Failures:**  
    - Incorrect credentials or signature mismatch will lead to authentication failure.  
    - Network issues or API downtime may cause timeouts or errors.  
    - Hardcoded body parameters limit flexibility; user must edit node to change search inputs.  
  - **Sub-Workflow:** None.

---

### 3. Summary Table

| Node Name                      | Node Type           | Functional Role                      | Input Node(s)                   | Output Node(s)                   | Sticky Note                                                                                       |
|--------------------------------|---------------------|------------------------------------|--------------------------------|---------------------------------|-------------------------------------------------------------------------------------------------|
| When clicking "Execute Workflow" | Manual Trigger      | Starts the workflow manually       | -                              | Authenticates to your Icypeas account |                                                                                                 |
| Sticky Note                    | Sticky Note         | Provides overview and link to Icypeas | -                              | -                               | ## Perform an email search with Icypeas (single)\n\nThis workflow demonstrates how to perform an email search using Icypeas. Visit https://icypeas.com to create your account. |
| Sticky Note1                   | Sticky Note         | Instructions for inserting API credentials and enabling crypto module | -                              | -                               | ## Authenticates to your Icypeas account\n\nInstructions for inputting API Key, API Secret, User ID, and enabling crypto module on self-hosted n8n instances.               |
| Authenticates to your Icypeas account | Code                | Generates auth signature and prepares auth info | When clicking "Execute Workflow" | Run email search (single)        |                                                                                                 |
| Sticky Note2                   | Sticky Note         | Instructions for HTTP Request auth and body parameters | -                              | -                               | ## Performs an email search on your Icypeas account\n\nInstructions to configure HTTP Header Auth credentials and body parameters for the email search request.                 |
| Run email search (single)      | HTTP Request        | Performs POST request to search email | Authenticates to your Icypeas account | -                               |                                                                                                 |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Manual Trigger Node**  
   - Add a **Manual Trigger** node named `When clicking "Execute Workflow"`.  
   - No parameter changes needed.

2. **Create Code Node for Authentication**  
   - Add a **Code** node named `Authenticates to your Icypeas account`.  
   - Paste the following JavaScript code (adapted for your credentials):  
     ```javascript
     const BASE_URL = "https://app.icypeas.com";
     const PATH = "/api/domain-search";
     const METHOD = "POST";

     // Replace with your credentials
     const API_KEY = "PUT_API_KEY_HERE";
     const API_SECRET = "PUT_API_SECRET_HERE";
     const USER_ID = "PUT_USER_ID_HERE";

     const genSignature = (
         path,
         method,
         secret,
         timestamp = new Date().toISOString()
     ) => {
         const Crypto = require('crypto');
         const payload = `${method}${path}${timestamp}`.toLowerCase();
         const sign = Crypto.createHmac("sha1", secret).update(payload).digest("hex");
         return sign;
     };

     const fullPath = `${BASE_URL}${PATH}`;
     $input.first().json.api = {
       timestamp: new Date().toISOString(),
       secret: API_SECRET,
       key: API_KEY,
       userId: USER_ID,
       url: fullPath,
     };
     $input.first().json.api.signature = genSignature(PATH, METHOD, API_SECRET, $input.first().json.api.timestamp);
     return $input.first();
     ```  
   - Replace `PUT_API_KEY_HERE`, `PUT_API_SECRET_HERE`, and `PUT_USER_ID_HERE` with your actual Icypeas credentials.  
   - Ensure your n8n instance has the crypto module enabled (especially for self-hosted setups).

3. **Create HTTP Request Node for Email Search**  
   - Add an **HTTP Request** node named `Run email search (single)`.  
   - Set the following parameters:  
     - **URL:** `={{ $json.api.url }}` (expression that uses authentication node output)  
     - **Method:** POST  
     - **Authentication:** Select **HTTP Header Auth**.  
     - Create a new credential named e.g. `Header Auth account` with:  
       - Name: `Authorization`  
       - Value: Expression: `{{ $json.api.key + ':' + $json.api.signature }}`  
     - **Header Parameters:**  
       - Add header `X-ROCK-TIMESTAMP` with value `={{ $json.api.timestamp }}` (expression)  
     - **Body Parameters:** (Make sure to send as JSON)  
       - `lastname`: Enter the target person's lastname (e.g., `Landoin`)  
       - `firstname`: Enter the target person's firstname (e.g., `Pierre`)  
       - `domainOrCompany`: Enter the target domain or company (e.g., `icypeas`)  
   - Make sure to select **Send Body** and **Send Headers** options.

4. **Connect Nodes**  
   - Connect the output of `When clicking "Execute Workflow"` to the input of `Authenticates to your Icypeas account`.  
   - Connect the output of `Authenticates to your Icypeas account` to the input of `Run email search (single)`.

5. **Save and Execute**  
   - Save the workflow.  
   - Click "Execute Workflow" to test the email search.  
   - Inspect the output of the `Run email search (single)` node for results.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                                                                                                                                  | Context or Link                                                                                                                                             |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| This workflow requires an active Icypeas account. You can create an account and obtain your API Key, API Secret, and User ID at https://app.icypeas.com/bo/profile.                                                                                                                                                                                                                          | Icypeas Profile / API Credentials: https://app.icypeas.com/bo/profile                                                                                       |
| For self-hosted n8n instances, enabling the "crypto" module is necessary to run the authentication code node. This can be done in n8n Settings > General > Additional Node Packages > enable "crypto" > Save and restart n8n.                                                                                                                                                                | n8n Settings interface for enabling crypto module                                                                                                          |
| The API signature uses HMAC-SHA1 with a payload consisting of the HTTP method, path, and timestamp in lowercase. Accurate timestamps are critical to avoid authentication rejection.                                                                                                                                                                                                        | Icypeas API authentication mechanism                                                                                                                       |
| The HTTP Request node requires a custom HTTP Header Auth credential with the Authorization header set dynamically using the API key and generated signature concatenated by a colon.                                                                                                                                                                                                         | HTTP Header Auth credential configuration                                                                                                                  |
| Email search results can be reviewed directly on Icypeas at https://app.icypeas.com/bo/singlesearch?task=email-search after running the workflow.                                                                                                                                                                                                                                           | Icypeas single search UI: https://app.icypeas.com/bo/singlesearch?task=email-search                                                                         |

---

This comprehensive documentation describes the workflow’s logic, node configuration, and setup instructions, enabling users and automation tools to fully understand and reproduce the process for performing email searches with Icypeas.