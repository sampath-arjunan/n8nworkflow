{"id":"ZdMbuyTs5MXQpA1p","meta":{"instanceId":"14e4c77104722ab186539dfea5182e419aecc83d85963fe13f6de862c875ebfa","templateCredsSetupCompleted":true},"name":"CI Artifact Completeness Gate","tags":[],"nodes":[{"id":"9b94178b-9527-46bc-9e84-3673675c0951","name":"Verify Artifacts","type":"n8n-nodes-base.code","position":[1040,0],"parameters":{"jsCode":"\n\n// Let's use the simplest, most common way to get the data when running 'Once for All Items'\n// which is usually $json, or, more safely, $input.\n\nconst inputData = $input.all();\n\n// Step 1: Ensure we have an array of the file objects\nconst sentryFiles = Array.isArray(inputData) ? inputData : [];\n\n// Step 2: Handle empty or invalid input\n// Using standard JavaScript 'Array.isArray'\nif (sentryFiles.length === 0) {\n    return [{\n        json: { status: 'failure', description: 'No files returned from Sentry for analysis.' }\n    }];\n}\n\n// Step 3: Extract file names for easier checking\n// The map function can be executed directly on sentryFiles\n\nconst fileNames = sentryFiles.map(file => file.json.name);\n\n// Step 4: Check for dSYM (Priority Check)\nconst hasDSYM = fileNames.some(name => /\\.dSYM$/i.test(name));\n\n// Step 5: Check for ProGuard/Mapping (Fallback Check)\nconst hasProguard = fileNames.some(name => /proguard\\.txt$/i.test(name));\nconst hasMapping = fileNames.some(name => /mapping\\.txt$/i.test(name));\n\n// Step 6: Determine final status based on logic\nlet status, description;\n\n// Condition 1: dSYM exists (highest priority)\nif (hasDSYM) {\n    status = 'success';\n    description = 'Success: Valid dSYM artifact found.';\n} \n// Condition 2: dSYM does NOT exist, but BOTH ProGuard and Mapping exist\nelse if (hasProguard && hasMapping) {\n    status = 'success';\n    description = 'Success: dSYM not found, but ProGuard and Mapping.txt artifacts are complete.';\n} \n// Condition 3: Failure\nelse {\n    const missing = [];\n    if (!hasProguard) missing.push('proguard.txt');\n    if (!hasMapping) missing.push('mapping.txt');\n    \n    status = 'failure';\n    description = `Failure: Neither dSYM was found, nor was the complete set of ProGuard artifacts. Missing: ${missing.join(' and ')}`;\n}\n\n// Step 7: Return the final result\nreturn [{ json: { status, description } }];\n\n"},"typeVersion":2,"alwaysOutputData":false},{"id":"81aa32b4-3621-4a87-94bd-d7d997ae9879","name":"GithubPushTrigger","type":"n8n-nodes-base.githubTrigger","position":[-288,0],"webhookId":"18e18df2-708c-4497-966c-48181fdb800b","parameters":{"owner":{"__rl":true,"mode":"name","value":"repo_owner"},"events":["push"],"options":{"insecureSSL":false},"repository":{"__rl":true,"mode":"list","value":"repo_name","cachedResultUrl":"https://github.com/repo_owner/repo_name","cachedResultName":"repo_name"}},"credentials":{"githubApi":{"id":"vcwkEYebN1BqWFLe","name":"GitHub account 6"}},"typeVersion":1},{"id":"971f3b61-87b6-483d-974b-829917719e3b","name":"Check Sentry Artifacts Releases","type":"n8n-nodes-base.httpRequest","position":[-16,0],"parameters":{"url":"=https://sentry.io/api/0/projects/org_slug/proj_slug/releases/\n","options":{},"sendHeaders":true,"authentication":"predefinedCredentialType","headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer YOUR_TOKEN_HERE"}]},"nodeCredentialType":"sentryIoApi"},"typeVersion":4.3},{"id":"0ac8589e-fb9d-4c24-a161-10dce31874da","name":"Check Sentry Artifacts files","type":"n8n-nodes-base.httpRequest","position":[816,0],"parameters":{"url":"=https://sentry.io/api/0/projects/org_slug/proj_slug/releases/{{ $json.version }}/files/\n","options":{},"sendHeaders":true,"authentication":"predefinedCredentialType","headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer YOUR_TOKEN_HERE"}]},"nodeCredentialType":"sentryIoApi"},"typeVersion":4.3,"alwaysOutputData":false},{"id":"cbe6788f-1026-4a02-a841-7b2dabe861a5","name":"Update Status","type":"n8n-nodes-base.httpRequest","position":[2320,0],"parameters":{"url":"=https://api.github.com/repos/{{ $json.repoDetail.repoFullName }}/statuses/{{ $json.repoDetail.repoCommitSha }}","method":"POST","options":{},"sendBody":true,"authentication":"predefinedCredentialType","bodyParameters":{"parameters":[{"name":"state","value":"success"},{"name":"description","value":"Artifacts successfully verified."}]},"nodeCredentialType":"githubApi"},"credentials":{"githubApi":{"id":"vcwkEYebN1BqWFLe","name":"GitHub account 6"}},"typeVersion":4.2},{"id":"d9d95c07-078f-4015-ac47-d983486ee468","name":"Artifacts Validation and Get Repository Data","type":"n8n-nodes-base.code","position":[2016,0],"parameters":{"jsCode":"\n\n// Let's use the simplest, most common way to get the data when running 'Once for All Items'\n// which is usually $json, or, more safely, $input.\nconst repoCommitSha = $node[\"GithubPushTrigger\"].json[\"body\"][\"after\"];\nconst repoFullName = $node[\"GithubPushTrigger\"].json[\"body\"][\"repository\"][\"full_name\"];\nconst repoDetail = {repoFullName, repoCommitSha};\nconst inputData = $input.all();\n\n// Step 7: Return the final result\nif ($input.first().json.status === 'success') {\nreturn [{ json: { inputData, repoDetail } }];\n} else {\n  return []\n}\n\n"},"typeVersion":2,"alwaysOutputData":false},{"id":"0280557b-b520-4d7f-b887-8c4447660986","name":"Sticky Note10","type":"n8n-nodes-base.stickyNote","position":[-1280,-352],"parameters":{"width":544,"height":928,"content":"# How It Works\n### This workflow functions as a critical CI/CD Quality Gate, automatically verifying that all essential build artifacts are uploaded to Sentry before allowing code to be merged. The process is initiated by a Webhook or a GitHub Push event, which provides the specific release version and commit SHA. The workflow then uses HTTP Requests to query the Sentry API, retrieving a list of all files associated with that release. A Code node runs custom logic to verify completeness, checking for required files like dSYMs, ProGuard, or Mapping files using file name patterns. If verification succeeds, a final HTTP Request updates the commit status on GitHub to success, allowing the associated Pull Request to be merged.\n\n# Setup Steps\n## Add Trigger\nSet up a Webhook or a GitHub Trigger (for push events) to start the workflow.\n\n## Connect Accounts\nAdd credentials for both Sentry.io API and GitHub API.\n\n## Configure Requests\nUpdate the Sentry API URLs in the HTTP Request nodes with your organization and project slugs, ensuring they correctly interpolate the release version from the trigger.\n\n## Update GitHub Status\nConfigure the final HTTP Request node to post the verification status (success/failure) to your repository's commit status endpoint using the commit SHA."},"typeVersion":1},{"id":"6723f1d4-5de5-4aae-bf80-d71e1a9cb331","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[-512,-272],"parameters":{"color":7,"width":912,"height":576,"content":"## GithubPushTrigger & Check Sentry Artifacts Releases\nThe workflow begins with a GitHub Push Trigger (or Webhook) that starts the process upon a code push, capturing the vital commit_sha and repository details. Immediately, an HTTP Request node authenticates with the Sentry API to execute a GET request to the /releases/ endpoint. This step's purpose is to retrieve metadata for all existing Sentry releases within the project, which is necessary to locate and verify the files for the specific release associated with the triggering commit."},"typeVersion":1},{"id":"0c252ab9-2b89-4300-a53d-a9447d08dbd4","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[528,-272],"parameters":{"color":7,"width":976,"height":576,"content":"## Get Sentry Artifacts Files and  Verify\nThe Check Sentry Artifacts files node first executes an HTTP GET request using a dynamic URL (e.g., .../releases/{{ $json.version }}/files/) to retrieve the full array of uploaded artifact objects for the specific release from the Sentry API. This artifact list is then consumed by the Verify Artifacts Code node, which contains the core business logic to validate completeness. This node implements a priority check: the release is deemed a success if a dSYM file is present, OR as a fallback, if both proguard.txt and mapping.txt are found. The final output of this validation step is an object providing the resulting status ('success' or 'failure') and a corresponding descriptive message."},"typeVersion":1},{"id":"89ce57c9-0dde-43d2-84fb-e9847cd36b4f","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[1680,-272],"parameters":{"color":7,"width":1072,"height":576,"content":"## Validate Artifacts and Updae Status\nThe Check Sentry Artifacts files node retrieves the uploaded artifacts list, which is validated by the Verify Artifacts Code node (checking for a dSYM OR both proguard.txt and mapping.txt).\nThe Artifacts Validation node enforces the CI gate: if the check fails, the workflow stops, preventing the merge. If successful, it passes the Commit SHA to the final Update Status node. This node then sends a successful HTTP POST request to the GitHub Commit Statuses API, which displays a green checkmark on the commit, signaling that the artifact gate has been successfully passed."},"typeVersion":1}],"active":false,"pinData":{"GithubPushTrigger":[{"json":{"body":{"ref":"refs/heads/main","after":"b1b80a10f061313c0bf69c6202934a8610f2e3ce","before":"fd1aa707dc6096efcbe91683b7fd1352c8baaeb8","forced":false,"pusher":{"name":"repo_owner","email":"151736888+repo_owner@users.noreply.github.com"},"sender":{"id":151736888,"url":"https://api.github.com/users/repo_owner","type":"User","login":"repo_owner","node_id":"U_kgDOCQtSOA","html_url":"https://github.com/repo_owner","gists_url":"https://api.github.com/users/repo_owner/gists{/gist_id}","repos_url":"https://api.github.com/users/repo_owner/repos","avatar_url":"https://avatars.githubusercontent.com/u/151736888?v=4","events_url":"https://api.github.com/users/repo_owner/events{/privacy}","site_admin":false,"gravatar_id":"","starred_url":"https://api.github.com/users/repo_owner/starred{/owner}{/repo}","followers_url":"https://api.github.com/users/repo_owner/followers","following_url":"https://api.github.com/users/repo_owner/following{/other_user}","user_view_type":"public","organizations_url":"https://api.github.com/users/repo_owner/orgs","subscriptions_url":"https://api.github.com/users/repo_owner/subscriptions","received_events_url":"https://api.github.com/users/repo_owner/received_events"},"commits":[{"id":"b1b80a10f061313c0bf69c6202934a8610f2e3ce","url":"https://github.com/repo_owner/repo_name/commit/b1b80a10f061313c0bf69c6202934a8610f2e3ce","added":[],"author":{"date":"2025-12-10T17:47:05+05:30","name":"repo_owner","email":"repo_owner@example.com","username":"repo_owner"},"message":"added change 10 Dec, 1","removed":[],"tree_id":"af6aa1678954fee6e3da85c2a1bcdd509cc4f4de","distinct":true,"modified":["n8n_flow_app/.env.staging"],"committer":{"date":"2025-12-10T17:47:05+05:30","name":"repo_owner","email":"repo_owner@example.com","username":"repo_owner"},"timestamp":"2025-12-10T17:47:05+05:30"}],"compare":"https://github.com/repo_owner/repo_name/compare/fd1aa707dc60...b1b80a10f061","created":false,"deleted":false,"base_ref":null,"repository":{"id":1040155358,"url":"https://api.github.com/repos/repo_owner/repo_name","fork":false,"name":"repo_name","size":50,"forks":0,"owner":{"id":151736888,"url":"https://api.github.com/users/repo_owner","name":"repo_owner","type":"User","email":"151736888+repo_owner@users.noreply.github.com","login":"repo_owner","node_id":"U_kgDOCQtSOA","html_url":"https://github.com/repo_owner","gists_url":"https://api.github.com/users/repo_owner/gists{/gist_id}","repos_url":"https://api.github.com/users/repo_owner/repos","avatar_url":"https://avatars.githubusercontent.com/u/151736888?v=4","events_url":"https://api.github.com/users/repo_owner/events{/privacy}","site_admin":false,"gravatar_id":"","starred_url":"https://api.github.com/users/repo_owner/starred{/owner}{/repo}","followers_url":"https://api.github.com/users/repo_owner/followers","following_url":"https://api.github.com/users/repo_owner/following{/other_user}","user_view_type":"public","organizations_url":"https://api.github.com/users/repo_owner/orgs","subscriptions_url":"https://api.github.com/users/repo_owner/subscriptions","received_events_url":"https://api.github.com/users/repo_owner/received_events"},"topics":[],"git_url":"git://github.com/repo_owner/repo_name.git","license":null,"node_id":"R_kgDOPf-C3g","private":false,"ssh_url":"git@github.com:repo_owner/repo_name.git","svn_url":"https://github.com/repo_owner/repo_name","archived":false,"disabled":false,"has_wiki":true,"homepage":null,"html_url":"https://github.com/repo_owner/repo_name","keys_url":"https://api.github.com/repos/repo_owner/repo_name/keys{/key_id}","language":"Swift","tags_url":"https://api.github.com/repos/repo_owner/repo_name/tags","watchers":0,"blobs_url":"https://api.github.com/repos/repo_owner/repo_name/git/blobs{/sha}","clone_url":"https://github.com/repo_owner/repo_name.git","forks_url":"https://api.github.com/repos/repo_owner/repo_name/forks","full_name":"repo_owner/repo_name","has_pages":false,"hooks_url":"https://api.github.com/repos/repo_owner/repo_name/hooks","pulls_url":"https://api.github.com/repos/repo_owner/repo_name/pulls{/number}","pushed_at":1765369428,"teams_url":"https://api.github.com/repos/repo_owner/repo_name/teams","trees_url":"https://api.github.com/repos/repo_owner/repo_name/git/trees{/sha}","created_at":1755527836,"events_url":"https://api.github.com/repos/repo_owner/repo_name/events","has_issues":true,"issues_url":"https://api.github.com/repos/repo_owner/repo_name/issues{/number}","labels_url":"https://api.github.com/repos/repo_owner/repo_name/labels{/name}","merges_url":"https://api.github.com/repos/repo_owner/repo_name/merges","mirror_url":null,"stargazers":0,"updated_at":"2025-11-12T14:50:11Z","visibility":"public","archive_url":"https://api.github.com/repos/repo_owner/repo_name/{archive_format}{/ref}","commits_url":"https://api.github.com/repos/repo_owner/repo_name/commits{/sha}","compare_url":"https://api.github.com/repos/repo_owner/repo_name/compare/{base}...{head}","description":"n8n work flow ","forks_count":0,"is_template":false,"open_issues":1,"branches_url":"https://api.github.com/repos/repo_owner/repo_name/branches{/branch}","comments_url":"https://api.github.com/repos/repo_owner/repo_name/comments{/number}","contents_url":"https://api.github.com/repos/repo_owner/repo_name/contents/{+path}","git_refs_url":"https://api.github.com/repos/repo_owner/repo_name/git/refs{/sha}","git_tags_url":"https://api.github.com/repos/repo_owner/repo_name/git/tags{/sha}","has_projects":true,"releases_url":"https://api.github.com/repos/repo_owner/repo_name/releases{/id}","statuses_url":"https://api.github.com/repos/repo_owner/repo_name/statuses/{sha}","allow_forking":true,"assignees_url":"https://api.github.com/repos/repo_owner/repo_name/assignees{/user}","downloads_url":"https://api.github.com/repos/repo_owner/repo_name/downloads","has_downloads":true,"languages_url":"https://api.github.com/repos/repo_owner/repo_name/languages","master_branch":"main","default_branch":"main","milestones_url":"https://api.github.com/repos/repo_owner/repo_name/milestones{/number}","stargazers_url":"https://api.github.com/repos/repo_owner/repo_name/stargazers","watchers_count":0,"deployments_url":"https://api.github.com/repos/repo_owner/repo_name/deployments","git_commits_url":"https://api.github.com/repos/repo_owner/repo_name/git/commits{/sha}","has_discussions":false,"subscribers_url":"https://api.github.com/repos/repo_owner/repo_name/subscribers","contributors_url":"https://api.github.com/repos/repo_owner/repo_name/contributors","issue_events_url":"https://api.github.com/repos/repo_owner/repo_name/issues/events{/number}","stargazers_count":0,"subscription_url":"https://api.github.com/repos/repo_owner/repo_name/subscription","collaborators_url":"https://api.github.com/repos/repo_owner/repo_name/collaborators{/collaborator}","issue_comment_url":"https://api.github.com/repos/repo_owner/repo_name/issues/comments{/number}","notifications_url":"https://api.github.com/repos/repo_owner/repo_name/notifications{?since,all,participating}","open_issues_count":1,"web_commit_signoff_required":false},"head_commit":{"id":"b1b80a10f061313c0bf69c6202934a8610f2e3ce","url":"https://github.com/repo_owner/repo_name/commit/b1b80a10f061313c0bf69c6202934a8610f2e3ce","added":[],"author":{"date":"2025-12-10T17:47:05+05:30","name":"repo_owner","email":"repo_owner@example.com","username":"repo_owner"},"message":"added change 10 Dec, 1","removed":[],"tree_id":"af6aa1678954fee6e3da85c2a1bcdd509cc4f4de","distinct":true,"modified":["n8n_flow_app/.env.staging"],"committer":{"date":"2025-12-10T17:47:05+05:30","name":"repo_owner","email":"repo_owner@example.com","username":"repo_owner"},"timestamp":"2025-12-10T17:47:05+05:30"}},"query":{},"headers":{"host":"wliteck3.app.n8n.cloud","accept":"*/*","cf-ray":"9abcb73732dc5886-IAD","cdn-loop":"cloudflare; loops=1; subreqs=1","cf-ew-via":"15","cf-worker":"n8n.cloud","x-real-ip":"140.82.115.111","cf-visitor":"{\"scheme\":\"https\"}","user-agent":"GitHub-Hookshot/5c4e7bf","cf-ipcountry":"US","content-type":"application/json","x-is-trusted":"yes","content-length":"7246","x-github-event":"push","accept-encoding":"gzip, br","x-forwarded-for":"140.82.115.111, 104.23.211.141","cf-connecting-ip":"140.82.115.111","x-forwarded-host":"wliteck3.app.n8n.cloud","x-forwarded-port":"443","x-github-hook-id":"585564438","x-forwarded-proto":"https","x-github-delivery":"14b826e0-d5c3-11f0-8a63-3991810c9f79","x-forwarded-server":"traefik-prod-users-gwc-75-7cf7798779-76v6t","x-github-hook-installation-target-id":"1040155358","x-github-hook-installation-target-type":"repository"}}}]},"settings":{"executionOrder":"v1"},"versionId":"3d6c6712-905b-4cb6-95aa-81e287c0bfa5","connections":{"Verify Artifacts":{"main":[[{"node":"Artifacts Validation and Get Repository Data","type":"main","index":0}]]},"GithubPushTrigger":{"main":[[{"node":"Check Sentry Artifacts Releases","type":"main","index":0}]]},"Check Sentry Artifacts files":{"main":[[{"node":"Verify Artifacts","type":"main","index":0}]]},"Check Sentry Artifacts Releases":{"main":[[{"node":"Check Sentry Artifacts files","type":"main","index":0}]]},"Artifacts Validation and Get Repository Data":{"main":[[{"node":"Update Status","type":"main","index":0}]]}}}