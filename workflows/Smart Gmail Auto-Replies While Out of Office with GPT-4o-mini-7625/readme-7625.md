Smart Gmail Auto-Replies While Out of Office with GPT-4o-mini

https://n8nworkflows.xyz/workflows/smart-gmail-auto-replies-while-out-of-office-with-gpt-4o-mini-7625


# Smart Gmail Auto-Replies While Out of Office with GPT-4o-mini

### 1. Workflow Overview

This workflow automates Gmail auto-replies during an "Out of Office" (OOO) period using GPT-4o-mini language model. It targets users who want personalized, context-aware, and warm auto-responses without manual intervention while away. The workflow continuously monitors unread emails, evaluates if the sender should receive a reply based on content and sender type, and sends tailored responses generated by AI, including alternate contact information and return dates.

Logical blocks:

- **1.1 Schedule and Setup**: Defines when to run the workflow and sets OOO parameters.
- **1.2 OOO Status Check**: Determines if the current time is within the OOO window.
- **1.3 Email Fetching and Batching**: Retrieves unread emails and processes them individually.
- **1.4 Email Content Retrieval**: Obtains full content for each email.
- **1.5 AI-Powered Reply Generation**: Uses GPT-4o-mini to decide if a reply is needed and to generate the reply.
- **1.6 Decision and Sending**: Checks AI output and sends replies if appropriate.
- **1.7 Labeling**: Tags emails that received auto-replies for tracking.
- **1.8 Informational Notes**: Sticky notes provide usage instructions and configuration guidance.

---

### 2. Block-by-Block Analysis

#### 2.1 Schedule and Setup

**Overview:**  
This block defines when the workflow triggers and configures the Out of Office dates, timezone, and alternate contact details.

**Nodes Involved:**  
- Check Email on Schedule  
- Define OOO Dates and Contact  
- Sticky Note (OOO Dates and Contact Info)  

**Node Details:**  

- **Check Email on Schedule**  
  - Type: Schedule Trigger  
  - Role: Starts workflow at a regular interval (default: every minute) to check for new unread emails.  
  - Configuration: Interval set in minutes (adjustable).  
  - Inputs: None (trigger node).  
  - Outputs: Triggers next node.  
  - Edge Cases: Misconfiguration can cause excessive API calls or delayed checks.  

- **Define OOO Dates and Contact**  
  - Type: Set  
  - Role: Stores OOO start/end timestamps, timezone, and alternate contact info as workflow variables.  
  - Configuration:  
    - `ooo_start` and `ooo_end` in ISO 8601 format (e.g., "2025-08-19T07:00:00+02:00")  
    - `timezone` as a valid IANA timezone string (e.g., "Europe/Madrid")  
    - `alt_contact_name` and `alt_contact_email` for fallback contact.  
  - Inputs: Trigger from schedule node.  
  - Outputs: Passes variables downstream.  
  - Edge Cases: Incorrect date/time format or timezone can cause logic errors.  

- **Sticky Note** (OOO Dates and Contact Info)  
  - Provides instructions on setting OOO dates, timezone, and fallback contact info.  

---

#### 2.2 OOO Status Check

**Overview:**  
Determines if the current time falls within the configured OOO period to decide whether to proceed.

**Nodes Involved:**  
- Check If Currently OOO  

**Node Details:**  

- **Check If Currently OOO**  
  - Type: If  
  - Role: Compares current ISO timestamp to `ooo_start` and `ooo_end`.  
  - Configuration:  
    - Condition: Proceed only if now is after `ooo_start` AND before `ooo_end`.  
  - Inputs: Receives OOO parameters from previous node.  
  - Outputs:  
    - True branch: Proceed to fetch unread emails.  
    - False branch: Stops workflow (no output).  
  - Edge Cases: Timezone differences or clock skew may cause false positives/negatives.  

---

#### 2.3 Email Fetching and Batching

**Overview:**  
Fetches all unread emails from Gmail and splits them into batches for sequential processing.

**Nodes Involved:**  
- Get Unread Emails  
- Process Each Email  

**Node Details:**  

- **Get Unread Emails**  
  - Type: Gmail  
  - Role: Retrieves all unread emails from the inbox.  
  - Configuration:  
    - Operation: `getAll`  
    - Filter: `readStatus` set to `unread`  
  - Inputs: True branch from OOO check.  
  - Outputs: List of unread email metadata.  
  - Edge Cases: Gmail API rate limits, large inbox size, or connectivity failures.  

- **Process Each Email**  
  - Type: SplitInBatches  
  - Role: Processes emails one by one or in small batches to manage load.  
  - Configuration: Default batch size (can be adjusted).  
  - Inputs: List of unread emails.  
  - Outputs: Single email metadata per batch iteration.  
  - Edge Cases: Batch size too large may cause timeouts; too small may slow processing.  

---

#### 2.4 Email Content Retrieval

**Overview:**  
Fetches full content of each email by message ID to provide detailed input to AI.

**Nodes Involved:**  
- Fetch Email Content  

**Node Details:**  

- **Fetch Email Content**  
  - Type: Gmail  
  - Role: Retrieves full email details including headers and snippet using message ID.  
  - Configuration:  
    - Operation: `get`  
    - Message ID: taken from batch email metadata (`{{$json.id}}`)  
  - Inputs: Individual email from batching node.  
  - Outputs: Full JSON containing From header, Subject, snippet, and ID.  
  - Edge Cases: API failures, deleted emails between fetch and processing.  

---

#### 2.5 AI-Powered Reply Generation

**Overview:**  
Uses GPT-4o-mini language model to analyze email content and generate a personalized auto-reply if appropriate.

**Nodes Involved:**  
- AI Agent  
- OpenAI Chat Model  
- Structured Output Parser  

**Node Details:**  

- **AI Agent**  
  - Type: LangChain Agent  
  - Role: Constructs prompt with email details and OOO parameters, sends to AI for reply generation.  
  - Configuration Highlights:  
    - Prompt instructs assistant to output JSON only with fields: `should_reply`, `subject`, `body_html`, `id`.  
    - Inputs injected: sender info (`From`), email subject, snippet, OOO start/end, timezone, alternate contact.  
    - Language style: Spanish English, mirroring sender‚Äôs language if known.  
    - Decision logic embedded in prompt (e.g., detect newsletters, internal vs external sender, tone).  
    - Output limited to max 100 words, friendly and clear.  
  - Inputs: Full email JSON from Fetch Email Content.  
  - Outputs: Raw AI text response.  
  - Edge Cases: Prompt misunderstanding, AI downtime, malformed outputs.  

- **OpenAI Chat Model**  
  - Type: LangChain LM Chat OpenAI  
  - Role: Executes GPT-4o-mini model query with the prompt from AI Agent.  
  - Configuration: Model set to `gpt-4o-mini`.  
  - Inputs: Prompt from AI Agent.  
  - Outputs: AI model textual response.  
  - Edge Cases: API quota, rate limits, or network failures.  

- **Structured Output Parser**  
  - Type: LangChain Output Parser Structured  
  - Role: Parses AI text output into structured JSON matching expected schema.  
  - Configuration: JSON schema requiring `should_reply` (bool), `subject` (string), `body_html` (string), `id` (string).  
  - Inputs: AI model raw text.  
  - Outputs: Parsed JSON for downstream logic.  
  - Edge Cases: Parsing failures if AI output deviates from schema.  

---

#### 2.6 Decision and Sending

**Overview:**  
Checks AI‚Äôs decision whether to reply and sends the auto-reply email if needed.

**Nodes Involved:**  
- Decide If Reply Is Needed  
- Send AI-Powered Auto-Reply  

**Node Details:**  

- **Decide If Reply Is Needed**  
  - Type: If  
  - Role: Evaluates `should_reply` boolean from AI output.  
  - Configuration: Condition `should_reply == true`.  
  - Inputs: Parsed AI JSON.  
  - Outputs:  
    - True: Proceed to send reply.  
    - False: Skip sending.  
  - Edge Cases: Missing or malformed `should_reply` field.  

- **Send AI-Powered Auto-Reply**  
  - Type: Gmail  
  - Role: Sends reply email to original sender using Gmail reply operation.  
  - Configuration:  
    - Operation: `reply`  
    - Message body: uses `body_html` from AI output.  
    - Message ID: uses original message ID (`id` from AI output).  
  - Inputs: AI output from decision node.  
  - Outputs: Confirmation of sent email.  
  - Edge Cases: Gmail API errors, invalid reply message, email quota limits.  

---

#### 2.7 Labeling

**Overview:**  
Marks emails that have been auto-replied to by adding a Gmail label for tracking.

**Nodes Involved:**  
- Tag Replied Emails  
- Sticky Note (Label ID instructions)  

**Node Details:**  

- **Tag Replied Emails**  
  - Type: Gmail  
  - Role: Adds a Gmail label to replied emails to prevent duplicate replies and track workflow activity.  
  - Configuration:  
    - Operation: `addLabels`  
    - Label ID: placeholder `"Label_Replace_With_Your_Label_ID"` to be replaced by user‚Äôs actual Gmail label ID.  
    - Message ID: original email ID (`{{$json.id}}`).  
  - Inputs: Output from send reply node.  
  - Outputs: Confirmation of label addition.  
  - Edge Cases: Incorrect label ID, Gmail API rate limits.  

- **Sticky Note1** (Label ID instructions)  
  - Explains how to find or create Gmail label and replace the label ID in the node.  

---

#### 2.8 Informational Notes

**Overview:**  
Sticky notes provide user guidance on configuration and scheduling.

**Nodes Involved:**  
- Sticky Note (OOO Dates and Contact)  
- Sticky Note1 (Label ID instructions)  
- Sticky Note2 (Schedule adjustment instructions)  

**Node Details:**  

- **Sticky Note2** (Schedule adjustment instructions)  
  - Explains how to modify the Schedule Trigger node to adjust checking frequency.  

---

### 3. Summary Table

| Node Name                 | Node Type                         | Functional Role                              | Input Node(s)              | Output Node(s)             | Sticky Note                                                                                       |
|---------------------------|----------------------------------|----------------------------------------------|----------------------------|----------------------------|-------------------------------------------------------------------------------------------------|
| Check Email on Schedule    | Schedule Trigger                 | Starts the workflow on a timed interval      | -                          | Define OOO Dates and Contact | ### üîÅ Adjust how often the workflow runs ‚Ä¢ In the Schedule Trigger node, update the time interval to control how frequently it checks emails. |
| Define OOO Dates and Contact| Set                             | Sets OOO dates, timezone, and alternate contact | Check Email on Schedule     | Check If Currently OOO       | ### üóìÔ∏è Set your OOO dates and contact info - Set the values for ooo_start and ooo_end in ISO 8601 format (e.g., 2025-08-19T07:00:00+02:00) - Your local timezone (e.g., Europe/Madrid) - A fallback contact‚Äôs name and email |
| Check If Currently OOO     | If                              | Checks if current time is within OOO dates   | Define OOO Dates and Contact | Get Unread Emails           |                                                                                                 |
| Get Unread Emails          | Gmail                           | Retrieves all unread emails                   | Check If Currently OOO      | Process Each Email          |                                                                                                 |
| Process Each Email         | SplitInBatches                  | Processes emails one by one                    | Get Unread Emails           | Fetch Email Content         |                                                                                                 |
| Fetch Email Content        | Gmail                           | Retrieves full email content by ID            | Process Each Email          | AI Agent                   |                                                                                                 |
| AI Agent                  | LangChain Agent                 | Generates AI-based reply prompt                | Fetch Email Content         | Decide If Reply Is Needed    |                                                                                                 |
| OpenAI Chat Model          | LangChain LM Chat OpenAI        | Runs GPT-4o-mini model on prompt               | AI Agent                   | AI Agent                   |                                                                                                 |
| Structured Output Parser   | LangChain Output Parser Structured | Parses AI text into structured JSON            | OpenAI Chat Model           | AI Agent                   |                                                                                                 |
| Decide If Reply Is Needed  | If                              | Checks AI‚Äôs decision to reply                   | AI Agent                   | Send AI-Powered Auto-Reply  |                                                                                                 |
| Send AI-Powered Auto-Reply | Gmail                           | Sends the auto-reply email                      | Decide If Reply Is Needed   | Tag Replied Emails          |                                                                                                 |
| Tag Replied Emails         | Gmail                           | Adds label to replied emails                    | Send AI-Powered Auto-Reply  | Process Each Email          | ### üè∑Ô∏è Replace label ID with your own Gmail label ‚Ä¢ In this node, replace the current labelIds value with one from your Gmail account. ‚Ä¢ You can create a new label like ‚ÄúAuto-Replied‚Äù and copy its ID from Gmail settings. |

---

### 4. Reproducing the Workflow from Scratch

1. **Create a Schedule Trigger node** called "Check Email on Schedule":  
   - Set the interval to your preferred frequency (default every 1 minute).  
   - This will trigger the workflow regularly.

2. **Create a Set node** named "Define OOO Dates and Contact":  
   - Add string parameters:  
     - `ooo_start`: your OOO start date/time in ISO 8601 (e.g., `2025-08-19T07:00:00+02:00`).  
     - `ooo_end`: your OOO end date/time in ISO 8601 (e.g., `2025-08-27T18:00:00+02:00`).  
     - `timezone`: your local timezone (e.g., `Europe/Madrid`).  
     - `alt_contact_name`: name of alternate contact (e.g., "Your teammate").  
     - `alt_contact_email`: email of alternate contact (e.g., "teammate@example.com").  
   - Connect "Check Email on Schedule" ‚Üí "Define OOO Dates and Contact".

3. **Create an If node** named "Check If Currently OOO":  
   - Configure to check if current time is after `ooo_start` AND before `ooo_end`.  
   - Use expressions:  
     - Left: `{{$now.toISO()}}`, Operator: after, Right: `{{$json.ooo_start}}`  
     - Left: `{{$now.toISO()}}`, Operator: before, Right: `{{$json.ooo_end}}`  
   - Connect "Define OOO Dates and Contact" ‚Üí "Check If Currently OOO".

4. **Create a Gmail node** named "Get Unread Emails":  
   - Set operation to `getAll`.  
   - Filter: `readStatus` = `unread`.  
   - Connect the True branch of "Check If Currently OOO" ‚Üí "Get Unread Emails".

5. **Create a SplitInBatches node** called "Process Each Email":  
   - Default batch size is fine; adjust if needed.  
   - Connect "Get Unread Emails" ‚Üí "Process Each Email".

6. **Create a Gmail node** named "Fetch Email Content":  
   - Operation: `get`.  
   - Message ID: set to `{{$json.id}}` from batch data.  
   - Connect "Process Each Email" ‚Üí "Fetch Email Content".

7. **Add a LangChain Agent node** named "AI Agent":  
   - Configure prompt as per specification:  
     - Include sender, subject, snippet, OOO times, timezone, alternate contact info.  
     - Instruct the agent to produce JSON output with fields: `should_reply`, `subject`, `body_html`, `id`.  
     - Use style: Spanish English, friendly tone, max 100 words.  
     - Implement decision rules for newsletters, internal/external senders, etc.  
   - Connect "Fetch Email Content" ‚Üí "AI Agent".

8. **Add a LangChain LM Chat OpenAI node** named "OpenAI Chat Model":  
   - Set model to `gpt-4o-mini`.  
   - Connect "AI Agent" (ai_languageModel input) ‚Üí "OpenAI Chat Model".

9. **Add a LangChain Output Parser Structured node** named "Structured Output Parser":  
   - Define JSON schema requiring `should_reply` (boolean), `subject` (string), `body_html` (string), `id` (string).  
   - Connect "OpenAI Chat Model" (ai_outputParser input) ‚Üí "Structured Output Parser".

10. **Connect "Structured Output Parser" output back to "AI Agent" for processing parsed JSON** (as per workflow connections).

11. **Create an If node** named "Decide If Reply Is Needed":  
    - Condition: `should_reply` == true from AI output JSON.  
    - Connect "AI Agent" ‚Üí "Decide If Reply Is Needed".

12. **Create a Gmail node** named "Send AI-Powered Auto-Reply":  
    - Operation: `reply`.  
    - Message body: from `body_html` field in AI output.  
    - Message ID: from `id` in AI output.  
    - Connect True branch of "Decide If Reply Is Needed" ‚Üí "Send AI-Powered Auto-Reply".

13. **Create a Gmail node** named "Tag Replied Emails":  
    - Operation: `addLabels`.  
    - Label IDs: Replace placeholder with your Gmail label ID (e.g., for ‚ÄúAuto-Replied‚Äù).  
    - Message ID: original email ID (`{{$json.id}}`).  
    - Connect "Send AI-Powered Auto-Reply" ‚Üí "Tag Replied Emails".

14. **Connect "Tag Replied Emails" ‚Üí "Process Each Email"** to continue batch processing.

15. **Add Sticky Notes** for user guidance:  
    - OOO dates and contact info instructions near Set node.  
    - Label ID replacement instructions near labeling node.  
    - Schedule adjustment instructions near schedule trigger.

16. **Configure Gmail OAuth2 credentials** for all Gmail nodes:  
    - Ensure Gmail API access with relevant scopes (read emails, send emails, modify labels).

17. **Configure OpenAI credentials** for LangChain OpenAI node:  
    - Provide API key with access to GPT-4o-mini.

18. **Test workflow** by running it during and outside OOO dates to confirm behavior.

---

### 5. General Notes & Resources

| Note Content                                                                                                         | Context or Link                                                   |
|----------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
| Use ISO 8601 format for OOO start and end dates including timezone offset for accuracy.                              | Set node "Define OOO Dates and Contact"                          |
| Gmail label ID must be replaced with your own label ID from Gmail settings; consider creating an ‚ÄúAuto-Replied‚Äù label. | Tag Replied Emails node and Sticky Note1                         |
| Adjust schedule frequency to balance timely replies and API usage limits.                                            | Sticky Note2 and Schedule Trigger node                           |
| AI prompt enforces a friendly, warm tone avoiding corporate clich√©s and em dashes; max 100 words to keep replies concise. | AI Agent node prompt description                                 |
| Workflow respects sender language by mirroring it if clearly detected; otherwise uses Spanish English.               | AI Agent node prompt description                                 |
| Avoids replying to newsletters, bots, receipts, OTPs, calendar bots automatically by setting should_reply = false.  | AI Agent node prompt decision rules                              |
| Includes fallback contact information and return date clearly in replies to assist sender during absence.           | AI Agent node prompt personalization                             |

---

**Disclaimer:**  
The text provided originates solely from an automated workflow created with n8n, a workflow automation tool. This processing strictly complies with current content policies and contains no illegal, offensive, or protected content. All data handled is legal and public.