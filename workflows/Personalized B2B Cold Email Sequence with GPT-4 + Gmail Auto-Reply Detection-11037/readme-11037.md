Personalized B2B Cold Email Sequence with GPT-4 + Gmail Auto-Reply Detection

https://n8nworkflows.xyz/workflows/personalized-b2b-cold-email-sequence-with-gpt-4---gmail-auto-reply-detection-11037


# Personalized B2B Cold Email Sequence with GPT-4 + Gmail Auto-Reply Detection

---

### 1. Workflow Overview

This workflow automates a personalized B2B cold email sequence composed of three touchpoints, leveraging GPT-4 for AI-powered email personalization and Gmail for sending. It smartly schedules emails on optimal weekdays and times, detects replies in Gmail inbox in near real-time, updates a Google Sheet tracking database with statuses, and notifies a Slack channel about "hot" leads who replied. The core use case is automated, intelligent outbound sales prospecting with adaptive messaging and reply management.

The workflow is logically divided into:

- **1.1 Prospect Intake & Scheduling:** Triggered by new rows added to a Google Sheet listing prospects, calculates scheduled send times for the 3 emails considering weekday/time constraints and randomization to avoid spam flags.
- **1.2 Email 1 Generation & Sending:** Uses GPT-4 to generate a personalized, benefit-focused introductory cold email, sends it via Gmail, and updates tracking in Google Sheets.
- **1.3 Email 2 Follow-up Generation & Sending:** Scheduled after email 1, conditionally sends a follow-up with a new angle based on engagement signals, again generated by GPT-4 and sent through Gmail.
- **1.4 Email 3 Final Follow-up Generation & Sending:** Final touch email, respectful and low-pressure, generated by GPT-4, sent via Gmail, and tracked.
- **1.5 Reply Detection & Hot Lead Handling:** Continuously polls Gmail inbox for replies, matches replies to prospects, marks them as "hot" in Google Sheets, stops further emails to them, and sends Slack notifications.
- **1.6 Error Handling:** Captures workflow errors and sends Slack notifications for operational visibility.

---

### 2. Block-by-Block Analysis

#### 2.1 Prospect Intake & Smart Scheduling

**Overview:**  
Detects new prospects added to the Google Sheet, calculates scheduled send times for the 3 emails ensuring emails are sent only on Tuesday, Wednesday, or Thursday around 9 AM with randomized minute offsets. Updates the Google Sheet with these calculated send times.

**Nodes Involved:**  
- Google Sheets Trigger  
- Smart Time Planning (Code)  
- Update row in sheet  
- Entreprise Description (Set node)  
- Merge (combine)  

**Node Details:**

- **Google Sheets Trigger**  
  - Type: Trigger node for Google Sheets row additions  
  - Configured to poll every minute on the main prospect spreadsheet (gid=0)  
  - Input: New rows in Sheet  
  - Output: Prospect raw data for scheduling  
  - Failures: API auth errors, rate limits

- **Smart Time Planning (Code)**  
  - Type: Code node  
  - Calculates 3 email send times (J0, J+3, J+6 days approx), respecting allowed send days (Tue, Wed, Thu), start hour 9 AM, randomized minute offset (0‚Äì120 min) for spam prevention  
  - Ensures minimum 2 days between emails and future-dated sends  
  - Uses prospect email/id as seed for stable randomization  
  - Output: Original input + `email1_at`, `email2_at`, `email3_at` ISO timestamps  
  - Edge cases: No allowed day found (throws error), date parsing issues

- **Update row in sheet**  
  - Type: Google Sheets update  
  - Updates the original prospect row with calculated email scheduled send times  
  - Matches rows on Email column  
  - Output: Updated prospect record with schedule

- **Entreprise Description (Set node)**  
  - Sets static info about the sender company and product offer (e.g., companyName, senderName, Description of the companies or product)  
  - Output: Prospect data merged with sender info for AI prompts

- **Merge**  
  - Combines prospect data with company description for downstream AI agents  
  - Mode: Combine by position

---

#### 2.2 Email 1 Generation & Sending

**Overview:**  
Generates and sends the first cold email immediately upon prospect intake (scheduled by Wait node). Email is personalized by GPT-4 using prospect and sender data, then sent via Gmail. Updates Google Sheet with send timestamp and status.

**Nodes Involved:**  
- Wait Until Time planning Email 1  
- Agent : Email 1 (Langchain agent)  
- OpenAI Chat Model  
- Gmail Tool - Send Email 1  
- Mapping Output2 (Code)  
- Update Email 1 Send (Google Sheets update)  

**Node Details:**

- **Wait Until Time planning Email 1**  
  - Type: Wait node  
  - Waits until the scheduled `email1_at` time from Smart Time Planning  
  - Input: Prospect with schedule  
  - Output: Triggers email 1 generation only at scheduled time

- **Agent : Email 1**  
  - Type: Langchain agent node using OpenAI GPT-4.1-mini model  
  - Prompt includes detailed prospect profile, sender info, and sequence timing  
  - Task: Write an 80‚Äì120 word personalized B2B introductory cold email  
  - Calls the Gmail Tool node internally to send email  
  - Output: JSON with `to`, `subject`, `message_html` fields summarizing sent email  
  - Edge cases: Prompt failures, API timeouts, invalid prospect data

- **OpenAI Chat Model**  
  - Language model node linked as AI language model for the Agent node

- **Gmail Tool - Send Email 1**  
  - Type: Gmail API integration node  
  - Sends email using OAuth2 Gmail credentials  
  - Input: `to`, `subject`, `message_html` from Agent node  
  - Output: Confirmation of send  
  - Failures: OAuth token expiry, Gmail API limits, network errors

- **Mapping Output2 (Code)**  
  - Parses the raw JSON string output by Agent node to structured JSON to extract email summary fields  
  - Output: Clean JSON for Google Sheets update

- **Update Email 1 Send (Google Sheets update)**  
  - Updates the prospect row with `email1_Statut` set to "Sent at <timestamp>"  
  - Matches row by Email

---

#### 2.3 Email 2 Follow-up Generation & Sending

**Overview:**  
Waits for scheduled time for email 2, checks if the prospect is marked "hot" (replied), and only sends follow-up if not hot. Uses GPT-4 to craft a follow-up email with a new angle based on engagement. Sends email via Gmail and updates Google Sheets.

**Nodes Involved:**  
- Wait Until Time planning Email 2  
- Check Status Before Email 2 (Google Sheets read)  
- Check if Hot After Email 2 (IF node)  
- Agent IA : Follow (Langchain agent)  
- OpenAI Chat Model 2  
- Gmail Tool - Send Email 2  
- Mapping Output1 (Code)  
- Update Statut Email 2 (Google Sheets update)  

**Node Details:**

- **Wait Until Time planning Email 2**  
  - Waits until `email2_at` scheduled time  
  - Output: Triggers status check before sending email 2

- **Check Status Before Email 2**  
  - Reads prospect data from Google Sheet to get updated status fields  
  - Output: Latest status info for IF condition

- **Check if Hot After Email 2 (IF node)**  
  - Condition: Checks if `Statut Prospect` equals "hot"  
  - True branch: skips sending email 2 (connects to Merge1 downstream)  
  - False branch: continues to Agent IA : Follow for email generation

- **Agent IA : Follow**  
  - GPT-4 agent to generate personalized follow-up email 2 with new value or example  
  - Inputs include prospect, sender data, timing, email1 open status, and reply status  
  - Calls Gmail Tool - Send Email 2 internally  
  - Outputs JSON summary of sent email

- **OpenAI Chat Model 2**  
  - GPT-4 language model node linked for Agent IA : Follow

- **Gmail Tool - Send Email 2**  
  - Sends email 2 via Gmail OAuth2 credentials  
  - Input: `to`, `subject`, `message_html`

- **Mapping Output1 (Code)**  
  - Parses raw JSON output from Agent IA : Follow

- **Update Statut Email 2**  
  - Updates Google Sheet with `email2_Statut` = "Sent" and `email2_at` timestamp  
  - Matches row by Email

---

#### 2.4 Email 3 Final Follow-up Generation & Sending

**Overview:**  
Scheduled final email 3 waits its turn, checks prospect "hot" status to avoid sending unnecessary emails. GPT-4 crafts a respectful final follow-up email focusing on one concrete benefit and low-pressure CTA. Email is sent via Gmail and Google Sheet updated accordingly.

**Nodes Involved:**  
- Wait Until Time planning Email 3  
- Check Status Before Email 3 (Google Sheets read)  
- Check if Hot After Email (IF node)  
- Agent IA : final follow-up (Langchain agent)  
- OpenAI Chat Model 3  
- Gmail Tool - Send Email 3  
- Mapping Output  
- Final Update to Sheet (Google Sheets update)  

**Node Details:**

- **Wait Until Time planning Email 3**  
  - Waits until scheduled `email3_at`

- **Check Status Before Email 3**  
  - Reads prospect status from Google Sheet

- **Check if Hot After Email**  
  - IF node to check if `Statut Prospect` = "hot"  
  - True branch: skips sending email 3  
  - False branch: triggers Agent IA : final follow-up

- **Agent IA : final follow-up**  
  - GPT-4 agent to write final follow-up email with warm tone and light CTA  
  - Inputs include prospect, sender, previous email statuses, reply flags, and scheduling  
  - Calls Gmail Tool - Send Email 3 internally

- **OpenAI Chat Model 3**  
  - GPT-4 language model node linked for this agent

- **Gmail Tool - Send Email 3**  
  - Sends final email via Gmail

- **Mapping Output (Code)**  
  - Parses JSON output from agent node

- **Final Update to Sheet**  
  - Updates Google Sheet with `email3_Statut` = "Sent at <timestamp>"  
  - Matches by Email

---

#### 2.5 Reply Detection & Hot Lead Handling

**Overview:**  
Monitors Gmail inbox every minute for replies from prospects. When a reply is detected, marks the prospect as "hot" in Google Sheets to stop future emails, and sends a Slack notification to alert sales team.

**Nodes Involved:**  
- Gmail Reply Trigger  
- Mark Prospect as Hot (Google Sheets update)  
- Send a message (Slack notification)  
- Sticky Note (reply detection explanation)  

**Node Details:**

- **Gmail Reply Trigger**  
  - Polls Gmail Inbox every minute, filtered to label "INBOX"  
  - Input: Incoming emails (replies)  
  - Output: Parsed reply data to identify prospect email

- **Mark Prospect as Hot**  
  - Updates Google Sheet row matching reply email with `Statut Prospect` = "hot"  
  - Stops further emails to this prospect

- **Send a message (Slack)**  
  - Sends a Slack notification message to a specific channel notifying about hot lead reply  
  - OAuth2 Slack credentials

- **Sticky Note**  
  - Describes the reply detection logic and behavior for quick reference

---

#### 2.6 Error Handling

**Overview:**  
Captures any workflow errors and sends Slack notifications with detailed error context for monitoring and fast troubleshooting.

**Nodes Involved:**  
- Error Trigger  
- Send a message1 (Slack notification)  
- Sticky Note5 (error detector note)  

**Node Details:**

- **Error Trigger**  
  - Listens for any workflow errors

- **Send a message1**  
  - Sends Slack notification with error details: workflow name, error message, last executed node, execution URL

- **Sticky Note5**  
  - Notes that this block detects errors and sends Slack alerts

---

### 3. Summary Table

| Node Name                     | Node Type                      | Functional Role                         | Input Node(s)                  | Output Node(s)                | Sticky Note                                       |
|-------------------------------|--------------------------------|---------------------------------------|-------------------------------|------------------------------|--------------------------------------------------|
| Google Sheets Trigger          | googleSheetsTrigger            | Detect new prospect row               | ‚Äî                             | Smart Time Planning, Entreprise Description |                                                  |
| Smart Time Planning            | code                          | Calculate scheduled send times        | Google Sheets Trigger          | Update row in sheet           | # ‚è∞ SMART SCHEDULING ... see Sticky Note1        |
| Update row in sheet            | googleSheets                  | Update prospect with schedule          | Smart Time Planning            | Wait Until Time planning Email 1 |                                                  |
| Entreprise Description         | set                           | Set company and offer info             | Google Sheets Trigger          | Merge, Merge1, Merge2         | ## üî• Outreach config ‚Äì Company & offer           |
| Merge                         | merge                         | Combine prospect + company info        | Entreprise Description         | Agent : Email 1               |                                                  |
| Wait Until Time planning Email 1 | wait                       | Wait until email 1 scheduled time      | Update row in sheet            | Merge                         |                                                  |
| Agent : Email 1               | langchain agent               | Generate & send email 1 (intro)        | Merge                         | Mapping Output2               | # üìß EMAIL 1 - Introduction                        |
| OpenAI Chat Model             | langchain lmChatOpenAi        | GPT-4 model for Agent : Email 1        | ‚Äî                             | Agent : Email 1 (ai_languageModel) |                                                  |
| Gmail Tool - Send Email 1      | gmailTool                    | Send email 1 via Gmail                 | Agent : Email 1 (ai_tool)      | ‚Äî                            |                                                  |
| Mapping Output2               | code                          | Parse Agent email 1 output JSON        | Agent : Email 1                | Update Email 1 Send           |                                                  |
| Update Email 1 Send           | googleSheets                  | Update Google Sheet email 1 status     | Mapping Output2               | Wait Until Time planning Email 2 |                                                  |
| Wait Until Time planning Email 2 | wait                       | Wait until email 2 scheduled time      | Update Email 1 Send            | Check Status Before Email 2   |                                                  |
| Check Status Before Email 2   | googleSheets                  | Read prospect status before email 2    | Wait Until Time planning Email 2 | Check if Hot After Email 2   |                                                  |
| Check if Hot After Email 2    | if                            | Skip email 2 if prospect is hot        | Check Status Before Email 2    | Merge1 (false branch)         |                                                  |
| Agent IA : Follow             | langchain agent               | Generate & send email 2 (follow-up)    | Merge1                        | Mapping Output1               | # üìß EMAIL 2 - Follow-up                           |
| OpenAI Chat Model 2           | langchain lmChatOpenAi        | GPT-4 model for Agent IA : Follow       | ‚Äî                             | Agent IA : Follow (ai_languageModel) |                                                  |
| Gmail Tool - Send Email 2      | gmailTool                    | Send email 2 via Gmail                 | Agent IA : Follow (ai_tool)    | ‚Äî                            |                                                  |
| Mapping Output1               | code                          | Parse Agent email 2 output JSON        | Agent IA : Follow             | Update Statut Email 2         |                                                  |
| Update Statut Email 2         | googleSheets                  | Update Google Sheet email 2 status     | Mapping Output1               | Wait Until Time planning Email 3 |                                                  |
| Wait Until Time planning Email 3 | wait                       | Wait until email 3 scheduled time      | Update Statut Email 2          | Check Status Before Email 3   |                                                  |
| Check Status Before Email 3   | googleSheets                  | Read prospect status before email 3    | Wait Until Time planning Email 3 | Check if Hot After Email     |                                                  |
| Check if Hot After Email      | if                            | Skip email 3 if prospect is hot        | Check Status Before Email 3    | Merge2 (false branch)         |                                                  |
| Agent IA : final follow-up    | langchain agent               | Generate & send final email 3           | Merge2                        | Mapping Output                | # üìß EMAIL 3 - Final Touch                         |
| OpenAI Chat Model 3           | langchain lmChatOpenAi        | GPT-4 model for Agent IA : final follow-up | ‚Äî                       | Agent IA : final follow-up (ai_languageModel) |                                                  |
| Gmail Tool - Send Email 3      | gmailTool                    | Send email 3 via Gmail                 | Agent IA : final follow-up (ai_tool) | ‚Äî                          |                                                  |
| Mapping Output               | code                          | Parse Agent email 3 output JSON        | Agent IA : final follow-up    | Final Update to Sheet         |                                                  |
| Final Update to Sheet         | googleSheets                  | Update Google Sheet email 3 status     | Mapping Output               | ‚Äî                            |                                                  |
| Gmail Reply Trigger           | gmailTrigger                 | Monitor Gmail inbox for replies         | ‚Äî                             | Mark Prospect as Hot          | ## üîî REPLY DETECTION ... see Sticky Note          |
| Mark Prospect as Hot          | googleSheets                  | Mark prospect as hot in Sheet on reply | Gmail Reply Trigger           | Send a message                |                                                  |
| Send a message               | slack                        | Notify Slack channel of hot lead reply | Mark Prospect as Hot          | ‚Äî                            |                                                  |
| Error Trigger                | errorTrigger                 | Detect workflow errors                   | ‚Äî                             | Send a message1               | ## Error Detector ... see Sticky Note5             |
| Send a message1              | slack                        | Notify Slack channel on workflow errors | Error Trigger                | ‚Äî                            |                                                  |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Google Sheets Trigger:**
   - Type: Google Sheets Trigger  
   - Configure to trigger on new rows added to your prospect Google Sheet (gid=0)  
   - Poll interval: every minute  
   - Set OAuth2 credentials for Google Sheets

2. **Add Code Node "Smart Time Planning":**
   - Add JavaScript code to calculate 3 email send times (J0, J+3, J+6 approx)  
   - Enforce sending only Tue/Wed/Thu at ~9 AM with random minutes offset  
   - Use prospect Email or ID as seed for randomization  
   - Output the scheduled send datetime fields: `email1_at`, `email2_at`, `email3_at`

3. **Add Google Sheets Update "Update row in sheet":**
   - Update the prospect row with the scheduled send times  
   - Match rows on Email column  
   - Use your Google Sheets OAuth2 credentials

4. **Add Set Node "Entreprise Description":**
   - Define static fields for your company: `companyName`, `senderName`, and `Description of the companies or product`  
   - These values will be merged with prospect data for AI prompts

5. **Add Merge Node:**
   - Combine the output of "Smart Time Planning" and "Entreprise Description"  
   - Use combine mode "combineByPosition"

6. **Add Wait Node "Wait Until Time planning Email 1":**
   - Configure to wait until `email1_at` datetime from previous node  
   - Use webhook mode with correct expression referencing `email1_at`

7. **Add Langchain Agent Node "Agent : Email 1":**
   - Use GPT-4.1-mini model  
   - Provide prompt with prospect and company info, sequence timing  
   - Task: write personalized, benefit-oriented introductory cold email (80-120 words)  
   - Set to call "Gmail Tool - Send Email 1" internally  
   - Use OpenAI API credentials

8. **Add OpenAI Chat Model Node:**
   - Connect to the Agent node as AI language model  
   - Use same OpenAI API credentials

9. **Add Gmail Tool Node "Gmail Tool - Send Email 1":**
   - Configure OAuth2 Gmail credentials  
   - Map email fields (`to`, `subject`, `message_html`) from Agent output

10. **Add Code Node "Mapping Output2":**
    - Parse the raw JSON string from the Agent node output into structured JSON

11. **Add Google Sheets Update "Update Email 1 Send":**
    - Update the prospect row with email1 send status and timestamp  
    - Match by Email column

12. **Add Wait Node "Wait Until Time planning Email 2":**
    - Wait until scheduled `email2_at` datetime

13. **Add Google Sheets Read Node "Check Status Before Email 2":**
    - Retrieve prospect info including `Statut Prospect` before sending email 2

14. **Add IF Node "Check if Hot After Email 2":**
    - Condition: if `Statut Prospect` equals "hot"  
    - True branch: skip email 2 sending  
    - False branch: continue to email 2 generation

15. **Add Langchain Agent Node "Agent IA : Follow":**
    - GPT-4.1-mini model  
    - Prompt to generate follow-up email 2 based on prospect data, previous engagement, and timing  
    - Calls "Gmail Tool - Send Email 2" internally

16. **Add OpenAI Chat Model 2 Node:**
    - Connect to "Agent IA : Follow" as AI language model

17. **Add Gmail Tool Node "Gmail Tool - Send Email 2":**
    - Send email 2 using Gmail OAuth2 credentials

18. **Add Code Node "Mapping Output1":**
    - Parse agent output JSON for email 2

19. **Add Google Sheets Update "Update Statut Email 2":**
    - Update prospect row with email 2 send status and timestamp

20. **Add Wait Node "Wait Until Time planning Email 3":**
    - Wait until scheduled `email3_at`

21. **Add Google Sheets Read Node "Check Status Before Email 3":**
    - Retrieve prospect status before sending email 3

22. **Add IF Node "Check if Hot After Email":**
    - Condition: `Statut Prospect` equals "hot"  
    - True branch: skip email 3  
    - False branch: proceed to email 3 generation

23. **Add Langchain Agent Node "Agent IA : final follow-up":**
    - GPT-4.1-mini model  
    - Generate final follow-up email 3, warm and respectful tone  
    - Calls "Gmail Tool - Send Email 3" internally

24. **Add OpenAI Chat Model 3 Node:**
    - Connect to final follow-up agent node

25. **Add Gmail Tool Node "Gmail Tool - Send Email 3":**
    - Send final email 3 via Gmail OAuth2

26. **Add Code Node "Mapping Output":**
    - Parse final email JSON output

27. **Add Google Sheets Update "Final Update to Sheet":**
    - Update prospect row with email 3 send status and timestamp

28. **Add Gmail Trigger Node "Gmail Reply Trigger":**
    - Configure to poll Gmail inbox every minute for replies  
    - Use Gmail OAuth2 credentials

29. **Add Google Sheets Update "Mark Prospect as Hot":**
    - On detecting reply, update prospect status to "hot" to stop future emails

30. **Add Slack Node "Send a message":**
    - Send Slack notification to sales channel about hot lead reply  
    - Configure Slack OAuth2 credentials

31. **Add Error Trigger Node:**
    - Catch workflow errors globally

32. **Add Slack Node "Send a message1":**
    - Send Slack notification on errors with detailed info

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                              | Context or Link                                                                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
| Workflow automates 3-email cold outreach sequence with AI-personalization, smart scheduling, reply detection, and Slack alerts.                                                                                                         | Workflow overview                                                                                                 |
| Google Sheet template to copy: https://docs.google.com/spreadsheets/d/12BFUMijzPfAuYuIHvgyKAvXw5MF6cQUtOpZ2VEoe84g/copy                                                                                                                  | Setup instruction                                                                                                |
| Emails only sent Tuesday, Wednesday, Thursday around 9 AM with randomized minutes to reduce spam detection risks.                                                                                                                        | Smart Scheduling block (Sticky Note1)                                                                             |
| Email 1: Intro (80-120 words), Email 2: Follow-up (70-90 words), Email 3: Final touch (60-100 words). Tone adapts by company size, language auto-detected (FR/EN).                                                                        | Email content requirements (Sticky Notes 2,3,4)                                                                   |
| Reply detection stops sequence for replying prospects, updates prospect status to "hot", and sends Slack notification.                                                                                                                  | Reply Detection Sticky Note                                                                                       |
| Error notifications sent to Slack for immediate troubleshooting.                                                                                                                                                                         | Error Detector Sticky Note                                                                                        |
| Contact for support and customization: maxime@b2bleader.fr                                                                                                                                                                               | Support contact                                                                                                   |
| Blog and template page comments encouraged for community feedback.                                                                                                                                                                       | Support info                                                                                                      |

---

This document provides an exhaustive and precise reference for understanding, reproducing, and modifying the "Personalized B2B Cold Email Sequence with GPT-4 + Gmail Auto-Reply Detection" n8n workflow. It covers all nodes, logic flows, and integration details required for advanced users and AI agents.