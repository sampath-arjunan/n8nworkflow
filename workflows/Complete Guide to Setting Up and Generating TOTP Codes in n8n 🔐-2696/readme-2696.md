Complete Guide to Setting Up and Generating TOTP Codes in n8n üîê

https://n8nworkflows.xyz/workflows/complete-guide-to-setting-up-and-generating-totp-codes-in-n8n----2696


# Complete Guide to Setting Up and Generating TOTP Codes in n8n üîê

### 1. Workflow Overview

This workflow demonstrates how to generate Time-based One-Time Passwords (TOTP) within n8n, serving as a practical guide for users who want to implement two-factor authentication (2FA) code generation in their automation processes. It is designed for users who have already obtained a TOTP secret key (typically from scanning a QR code provided by services like OpenAI, Google, or GitHub) and want to generate valid TOTP codes programmatically.

The workflow is logically divided into two main blocks:

- **1.1 Manual Trigger Input:** Initiates the workflow manually, simulating a user action to generate a TOTP code on demand.
- **1.2 TOTP Code Generation:** Uses the configured TOTP credential (containing the secret key and label) to generate the current valid TOTP code and outputs it.

---

### 2. Block-by-Block Analysis

#### 1.1 Manual Trigger Input

- **Overview:**  
  This block provides a manual entry point to start the workflow. It allows the user to trigger the generation of a TOTP code on demand by clicking the "Test workflow" button in n8n.

- **Nodes Involved:**  
  - When clicking ‚ÄòTest workflow‚Äô

- **Node Details:**  

  - **Node Name:** When clicking ‚ÄòTest workflow‚Äô  
    - **Type and Technical Role:** Manual Trigger node; serves as the workflow entry point triggered by user interaction.  
    - **Configuration Choices:** Default manual trigger with no additional parameters.  
    - **Key Expressions or Variables:** None.  
    - **Input and Output Connections:** No input; output connects to the TOTP node.  
    - **Version-Specific Requirements:** Compatible with n8n version 0.150.0 and later (manual trigger node standard).  
    - **Edge Cases or Potential Failures:** None expected; manual trigger is straightforward.  
    - **Sub-workflow Reference:** None.

#### 1.2 TOTP Code Generation

- **Overview:**  
  This block generates the current TOTP code using the secret key stored in the TOTP credential. It outputs the token and the seconds remaining before the token expires, matching codes generated by authenticator apps.

- **Nodes Involved:**  
  - TOTP

- **Node Details:**  

  - **Node Name:** TOTP  
    - **Type and Technical Role:** TOTP node; generates a time-based one-time password using the configured credential.  
    - **Configuration Choices:**  
      - Uses a pre-configured TOTP credential named "TOTP account Mars55" which contains the secret key and label extracted from the QR code link.  
      - No additional options set in the node parameters.  
    - **Key Expressions or Variables:** None; uses credential data internally.  
    - **Input and Output Connections:** Input from manual trigger node; outputs JSON containing:  
      - `token`: The generated 6-digit TOTP code.  
      - `secondsRemaining`: Time in seconds before the token expires.  
    - **Version-Specific Requirements:** Requires n8n version supporting the TOTP node (introduced in n8n v0.150.0+).  
    - **Edge Cases or Potential Failures:**  
      - Credential misconfiguration or missing secret key will cause errors.  
      - Time synchronization issues on the host machine can cause invalid codes.  
      - Credential expiration or revocation is not handled automatically.  
    - **Sub-workflow Reference:** None.

---

### 3. Summary Table

| Node Name                 | Node Type             | Functional Role           | Input Node(s)               | Output Node(s) | Sticky Note                                                                                                  |
|---------------------------|-----------------------|--------------------------|-----------------------------|----------------|--------------------------------------------------------------------------------------------------------------|
| When clicking ‚ÄòTest workflow‚Äô | Manual Trigger        | Workflow entry point     | None                        | TOTP           |                                                                                                              |
| TOTP                      | TOTP                  | Generate TOTP code       | When clicking ‚ÄòTest workflow‚Äô | None           | Use this node with a properly configured TOTP Credential containing the secret key and label from the QR code.|

---

### 4. Reproducing the Workflow from Scratch

1. **Create a new workflow in n8n.**

2. **Add a Manual Trigger node:**  
   - Node Type: Manual Trigger  
   - Name it: `When clicking ‚ÄòTest workflow‚Äô`  
   - Leave default settings (no parameters needed).  
   - This node will serve as the manual start point for generating the TOTP code.

3. **Create a TOTP Credential in n8n:**  
   - Go to Credentials in n8n.  
   - Create a new credential of type **TOTP**.  
   - In the **Secret** field, enter the secret key extracted from your QR code link (e.g., `test-test-test`).  
   - In the **Label** field, enter the label in the format `ServiceName:username` (e.g., `OpenAI:amir676080@gmail.com`).  
   - Save the credential.

4. **Add a TOTP node:**  
   - Node Type: TOTP  
   - Name it: `TOTP`  
   - In the node parameters, select the TOTP credential you created in step 3.  
   - No additional options need to be configured.

5. **Connect the nodes:**  
   - Connect the output of `When clicking ‚ÄòTest workflow‚Äô` node to the input of the `TOTP` node.

6. **Save the workflow.**

7. **Test the workflow:**  
   - Click the "Execute Workflow" or "Test" button in n8n.  
   - The output will be a JSON object containing the current TOTP token and the seconds remaining before it expires, e.g.:  
     ```json
     [
       {
         "token": "720769",
         "secondsRemaining": 18
       }
     ]
     ```

---

### 5. General Notes & Resources

| Note Content                                                                                  | Context or Link                          |
|-----------------------------------------------------------------------------------------------|----------------------------------------|
| This workflow replicates the exact TOTP codes generated by popular authenticator apps like Google Authenticator or Authy. | Workflow description                    |
| For extracting the TOTP secret key from a QR code, online QR code decoding tools can be used. | Workflow description                    |
| Contact the author on Telegram for support or questions: https://t.me/amir676080               | Contact information in workflow notes  |
| Credential setup is critical: ensure the secret key and label exactly match the QR code data. | Step 2 in workflow description         |

---

This documentation provides a full understanding of the workflow‚Äôs structure, logic, and setup instructions, enabling users and automation agents to reproduce or modify the workflow confidently.