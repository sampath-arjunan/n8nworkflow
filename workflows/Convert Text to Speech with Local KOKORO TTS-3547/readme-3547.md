Convert Text to Speech with Local KOKORO TTS

https://n8nworkflows.xyz/workflows/convert-text-to-speech-with-local-kokoro-tts-3547


# Convert Text to Speech with Local KOKORO TTS

### 1. Workflow Overview

This workflow enables text-to-speech (TTS) conversion using the local **KOKORO TTS** engine by running a Python script through n8n’s *Execute Command* node. It is designed for self-hosted n8n instances where local execution of commands is possible. The workflow takes predefined text and voice parameters, runs the KOKORO TTS Python script to generate an MP3 audio file, and then reads the generated audio file for playback or further processing.

**Target Use Cases:**  
- Content creators such as video bloggers and TikTokers who want free, local TTS generation.  
- Developers building voice chatbots or audio narration tools without relying on paid cloud TTS services.  
- Users with limited hardware (no GPU) who want a lightweight, local TTS solution.

**Logical Blocks:**  
- **1.1 Input Preparation:** Define the text and voice parameters to be converted.  
- **1.2 TTS Execution:** Run the Python script that calls the local KOKORO TTS server to generate speech audio.  
- **1.3 Audio Retrieval:** Load the generated MP3 file for playback or downstream use.

---

### 2. Block-by-Block Analysis

#### 2.1 Input Preparation

- **Overview:**  
  This block sets up the input data for the TTS process, specifying the text to be spoken and the voice profile to use.

- **Nodes Involved:**  
  - Passing variables

- **Node Details:**  

  - **Passing variables**  
    - Type: Set node  
    - Role: Defines static JSON data containing the TTS input parameters.  
    - Configuration:  
      - Mode: Raw JSON  
      - JSON Output:  
        ```json
        {
          "voice": "af_sarah",
          "text": "Hello world!"
        }
        ```  
      - This sets the voice to "af_sarah" and the text to "Hello world!".  
    - Inputs: From the manual trigger node  
    - Outputs: To the Execute Command node  
    - Edge Cases / Failures:  
      - If the JSON is malformed, downstream nodes may fail.  
      - Static values mean no dynamic input; to customize, this node must be edited or replaced.  

#### 2.2 TTS Execution

- **Overview:**  
  This block runs the Python script that interacts with the local KOKORO TTS Gradio server to generate speech audio from the input text and voice.

- **Nodes Involved:**  
  - Run python script

- **Node Details:**  

  - **Run python script**  
    - Type: Execute Command node  
    - Role: Executes a local Python script with parameters passed from the previous node.  
    - Configuration:  
      - Command:  
        ```bash
        python C:\KOKORO\voicegen.py "{{ $json.text }}" "{{ $json.voice }}" 1
        ```  
      - The command runs the `voicegen.py` script located in `C:\KOKORO`, passing the text, voice, and a fixed speed parameter `1`.  
      - Uses n8n expression syntax to inject variables dynamically.  
    - Inputs: From Passing variables node  
    - Outputs: To Play sound node  
    - Version-specific: Requires n8n self-hosted instance with Execute Command node enabled.  
    - Edge Cases / Failures:  
      - Python must be installed and accessible via command line.  
      - The script path and KOKORO server must be correctly set up and running locally.  
      - If the Gradio server is not running on localhost:7860, the script will fail.  
      - Permissions issues may prevent file writing or moving.  
      - Command injection risk if inputs are not sanitized (not a concern here due to static inputs).  
    - Sub-workflow: None  

#### 2.3 Audio Retrieval

- **Overview:**  
  This block reads the generated MP3 audio file from the local filesystem so it can be played or used further in the workflow.

- **Nodes Involved:**  
  - Play sound

- **Node Details:**  

  - **Play sound**  
    - Type: Read Binary Files node  
    - Role: Reads the MP3 file generated by the Python script from the fixed output path.  
    - Configuration:  
      - File Selector: `D:/output.mp3` (must match the output path in the Python script)  
    - Inputs: From Run python script node  
    - Outputs: Binary data of the MP3 file for playback or further processing  
    - Edge Cases / Failures:  
      - If the file does not exist or is locked, the node will error.  
      - Path must be accessible by the n8n instance.  
      - File permissions must allow reading.  
    - Sub-workflow: None  

---

### 3. Summary Table

| Node Name          | Node Type             | Functional Role               | Input Node(s)          | Output Node(s)         | Sticky Note                                                                                   |
|--------------------|-----------------------|------------------------------|------------------------|------------------------|-----------------------------------------------------------------------------------------------|
| Start              | Manual Trigger        | Initiates the workflow        | —                      | Passing variables       |                                                                                               |
| Passing variables   | Set                   | Defines TTS input parameters  | Start                  | Run python script      |                                                                                               |
| Run python script   | Execute Command       | Runs local Python TTS script  | Passing variables       | Play sound             | *Execute Command* node only supported on self-hosted n8n instances.                           |
| Play sound         | Read Binary Files      | Loads generated MP3 audio     | Run python script       | —                      | Output MP3 path must match Python script output path (D:/output.mp3).                         |

---

### 4. Reproducing the Workflow from Scratch

1. **Create a new workflow in n8n.**

2. **Add a Manual Trigger node:**  
   - Name: `Start`  
   - Purpose: To manually trigger the workflow.

3. **Add a Set node:**  
   - Name: `Passing variables`  
   - Connect `Start` node output to this node input.  
   - Configure:  
     - Mode: Raw JSON  
     - JSON Content:  
       ```json
       {
         "voice": "af_sarah",
         "text": "Hello world!"
       }
       ```  
   - This node sets the text and voice parameters for TTS.

4. **Add an Execute Command node:**  
   - Name: `Run python script`  
   - Connect `Passing variables` node output to this node input.  
   - Configure:  
     - Command:  
       ```
       python C:\KOKORO\voicegen.py "{{ $json.text }}" "{{ $json.voice }}" 1
       ```  
     - This runs the Python script with the text, voice, and speed parameters.  
   - **Credential Setup:** None required, but ensure:  
     - Python is installed and accessible in system PATH.  
     - The `voicegen.py` script exists at `C:\KOKORO\voicegen.py`.  
     - The local KOKORO TTS Gradio server is running at `http://localhost:7860/`.  
   - Note: This node requires a self-hosted n8n instance with Execute Command enabled.

5. **Add a Read Binary Files node:**  
   - Name: `Play sound`  
   - Connect `Run python script` node output to this node input.  
   - Configure:  
     - File Selector: `D:/output.mp3` (must match the output path set in the Python script)  
   - This node reads the generated MP3 file for playback or further use.

6. **Save and activate the workflow.**

7. **Run the workflow manually via the `Start` node.**

---

### 5. General Notes & Resources

| Note Content                                                                                                  | Context or Link                                                                                     |
|---------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| The *Execute Command* node is only supported on self-hosted (local) instances of n8n.                         | Workflow disclaimer                                                                                |
| KOKORO TTS is a compact, high-quality TTS model that runs locally without GPU requirements.                    | Introduction                                                                                       |
| Python script `voicegen.py` connects to local Gradio server at `http://localhost:7860/` to generate speech.    | Step 1 instructions and script details                                                            |
| Output MP3 file is saved to `D:\output.mp3` by default; adjust paths in script and nodes as needed.           | Step 1 and Step 5                                                                                  |
| Detailed tutorial available: [https://blog.bswlife.site/2025/04/14/n8n-kokoro-tts-integration-setup/](https://blog.bswlife.site/2025/04/14/n8n-kokoro-tts-integration-setup/) | Additional setup and usage guide                                                                   |
| To customize voice or text, edit the JSON in the Set node or replace it with dynamic input nodes.             | Step 3 note                                                                                       |
| Ensure Python and required packages (`gradio_client`) are installed in the environment running the script.    | Prerequisite for the Python script to work                                                        |

---

This documentation fully describes the workflow structure, node configurations, and setup instructions to enable reproduction, modification, and troubleshooting of the local KOKORO TTS integration in n8n.