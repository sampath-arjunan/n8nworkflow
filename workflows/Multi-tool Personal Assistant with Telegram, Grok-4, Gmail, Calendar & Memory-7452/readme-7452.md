Multi-tool Personal Assistant with Telegram, Grok-4, Gmail, Calendar & Memory

https://n8nworkflows.xyz/workflows/multi-tool-personal-assistant-with-telegram--grok-4--gmail--calendar---memory-7452


# Multi-tool Personal Assistant with Telegram, Grok-4, Gmail, Calendar & Memory

---

### 1. Workflow Overview

This n8n workflow implements a **multi-tool personal AI assistant** that interacts primarily via Telegram and integrates multiple external services to provide rich, context-aware assistance. Its target use cases include managing user memories, scheduling and querying Google Calendar events, handling Gmail messages, searching the web, accessing Notion databases, and processing both text and voice inputs from Telegram. It leverages advanced AI models (xAI Grok-4 and OpenAI Whisper for transcription) and LangChain tools for memory and agent orchestration.

The workflow is logically structured into the following blocks:

- **1.1 Input Reception:** Handles incoming Telegram messages and distinguishes between text and voice inputs.
- **1.2 Voice Processing:** Downloads voice messages and transcribes audio into text.
- **1.3 Memory Management:** Retrieves, aggregates, and stores user memory data in Airtable and a LangChain memory buffer.
- **1.4 AI Agent Processing:** Uses LangChain’s AI agent to process user input, leveraging memories and external tools.
- **1.5 External Tool Integrations:** Provides interfaces to external services such as SerpAPI (web search), Google Calendar (event CRUD), Gmail (email retrieval), and Notion (database queries).
- **1.6 Response Delivery:** Sends the AI-generated response back to the user on Telegram.

---

### 2. Block-by-Block Analysis

#### 1.1 Input Reception

- **Overview:**  
  Listens to Telegram messages targeted to a specific Telegram bot and user, filtering messages by chat ID and message type (text or voice). Routes messages accordingly.

- **Nodes Involved:**  
  - Telegram Trigger  
  - Text vs Voice Router (If node)  
  - Get a file (for voice message download)

- **Node Details:**

  - **Telegram Trigger**  
    - Type: Telegram Trigger (Webhook-based event node)  
    - Config: Listens to Telegram updates of type "message" for a specific chat ID (`your_telegram_id`), downloads files automatically.  
    - Inputs: External Telegram messages  
    - Outputs: Raw Telegram message JSON  
    - Possible Failures: Unauthorized bot token, webhook misconfiguration, network issues.

  - **Text vs Voice Router (If node)**  
    - Type: Conditional router  
    - Config: Checks if `message.text` exists (text message) vs voice message presence.  
    - Inputs: Telegram Trigger output  
    - Outputs: Two branches — text and voice  
    - Edge Cases: Messages with neither text nor voice cause no further processing.

  - **Get a file**  
    - Type: Telegram node (file download)  
    - Config: Downloads the voice file using `voice.file_id` from Telegram message.  
    - Inputs: Voice message from Telegram Trigger (via If node)  
    - Possible Failures: File not found, Telegram API limits.

---

#### 1.2 Voice Processing

- **Overview:**  
  Transcribes voice recordings into text using OpenAI Whisper transcription model.

- **Nodes Involved:**  
  - Transcribe a recording

- **Node Details:**

  - **Transcribe a recording**  
    - Type: OpenAI Audio Transcription  
    - Config: Uses OpenAI API to transcribe audio files received from Telegram.  
    - Inputs: Voice file from "Get a file" node  
    - Outputs: Transcription text  
    - Failures: Audio file corruption, API rate limits, transcription errors.

---

#### 1.3 Memory Management

- **Overview:**  
  Retrieves stored user memories from Airtable, aggregates them, and maintains a LangChain memory buffer for contextual AI responses. It also saves new memories generated by the AI agent back into Airtable.

- **Nodes Involved:**  
  - Get memories (Airtable)  
  - Aggregate (aggregate Airtable records)  
  - Merge (combine memory data with current input)  
  - Simple Memory (LangChain memory buffer)  
  - Save Memory (write summarized memory back to Airtable)

- **Node Details:**

  - **Get memories**  
    - Type: Airtable search  
    - Config: Queries Airtable base `appSSdueQKZUG68Wu`, table `tbl59eqgFoXOJ9vv9`, filtered by User = 'your_name', sorted by Created date.  
    - Inputs: Triggered after message routing or transcription  
    - Outputs: List of memory records  
    - Failures: Airtable API limits, credential errors.

  - **Aggregate**  
    - Type: Aggregate node  
    - Config: Aggregates all memory fields "Memory" and "Created" into a single field "Memories"  
    - Inputs: Output of Get memories  
    - Outputs: Aggregated memories list

  - **Merge**  
    - Type: Merge node  
    - Config: Combines memory data with current input data for AI context  
    - Inputs: Aggregated memories and current message or transcription  
    - Outputs: Combined data for AI agent

  - **Simple Memory**  
    - Type: LangChain Memory Buffer Window  
    - Config: Uses Telegram chat ID as session key, maintains a 30-message context window  
    - Inputs: Combined data from Merge  
    - Outputs: Contextual memory for AI Agent  
    - Version: 1.3 (LangChain specific)  
    - Failures: Session key missing, memory overflow.

  - **Save Memory**  
    - Type: Airtable Tool (create record)  
    - Config: Saves summarized memory from AI into Airtable under User "Your_Name"  
    - Inputs: AI agent output (memory summary)  
    - Credentials: Airtable Personal Access Token  
    - Failures: Airtable write errors, malformed data.

---

#### 1.4 AI Agent Processing

- **Overview:**  
  Processes user input using a LangChain AI Agent that integrates multiple tools and memory. It incorporates a system prompt defining roles, rules, and tool usage, and dynamically injects recent memories.

- **Nodes Involved:**  
  - AI Agent  
  - xAI Grok Chat Model

- **Node Details:**

  - **AI Agent**  
    - Type: LangChain Agent node  
    - Config:  
      - Text input composed of concatenated current message (text or transcribed voice) and aggregated memories.  
      - System message defines the AI assistant personality, rules, tools available (Save Memory, SerpAPI, Google Calendar, Gmail, Notion), and instructions on memory usage.  
      - Prompt incorporates JSON string of recent memories.  
    - Inputs: Combined memory and message data  
    - Outputs: AI-generated response and commands to external tools  
    - Failures: Prompt formatting errors, API errors, tool invocation failures.

  - **xAI Grok Chat Model**  
    - Type: Language Model (xAI Grok-4)  
    - Config: Uses Grok-4-0709 model for chat completion  
    - Credentials: xAI API token  
    - Inputs: AI Agent node uses this as the language model backend  
    - Outputs: AI responses  
    - Failures: API rate limits, model availability.

---

#### 1.5 External Tool Integrations

- **Overview:**  
  Provides AI agent tools for external data and action: web search, calendar events management, Gmail message retrieval, and Notion database queries.

- **Nodes Involved:**  
  - Search Web with SerpAPI  
  - Get many events in Google Calendar  
  - Create an event in Google Calendar  
  - Update an event in Google Calendar  
  - Delete an event in Google Calendar  
  - Get many messages in Gmail  
  - Get a message in Gmail  
  - Get a database in Notion

- **Node Details:**

  - **Search Web with SerpAPI**  
    - Type: LangChain SerpAPI tool  
    - Config: Performs internet searches on demand  
    - Credentials: SerpAPI account token  
    - Failures: API quota, malformed queries.

  - **Google Calendar Tools (Get, Create, Update, Delete events)**  
    - Type: Google Calendar API integration nodes  
    - Config: Operations on user's calendar with OAuth2 credentials  
    - Parameters include eventId (sometimes from AI), time ranges, and event data  
    - Failures: Auth expiration, invalid event IDs, quota limits.

  - **Gmail Tools (Get many messages, Get a message)**  
    - Type: Gmail API nodes  
    - Config: Retrieve emails with options for simplification and message IDs provided by AI  
    - Failures: OAuth token expiry, API limits.

  - **Get a database in Notion**  
    - Type: Notion API node  
    - Config: Queries a specific Notion database  
    - Failures: Invalid database ID, API limits.

---

#### 1.6 Response Delivery

- **Overview:**  
  Sends the AI-generated text response back to the Telegram chat.

- **Nodes Involved:**  
  - Send a text message

- **Node Details:**

  - **Send a text message**  
    - Type: Telegram node for sending messages  
    - Config: Sends the AI response text to the original chat ID from which the message came  
    - Inputs: AI Agent output (field `output`)  
    - Failures: Telegram API errors, chat ID missing.

---

### 3. Summary Table

| Node Name                     | Node Type                              | Functional Role                             | Input Node(s)                      | Output Node(s)                  | Sticky Note                                                        |
|-------------------------------|--------------------------------------|--------------------------------------------|----------------------------------|--------------------------------|-------------------------------------------------------------------|
| Telegram Trigger              | Telegram Trigger                     | Receives Telegram messages                  | (Trigger)                        | If                            | ## Routing for Text vs Voice                                       |
| Text vs Voice Router (If)     | If                                  | Routes message to text or voice processing  | Telegram Trigger                | Merge, Get a file              | ## Routing for Text vs Voice                                       |
| Get a file                   | Telegram                             | Downloads voice file                         | Text vs Voice Router (voice)    | Transcribe a recording          | ## Routing for Text vs Voice                                       |
| Transcribe a recording        | OpenAI (Audio Transcription)         | Transcribes voice to text                    | Get a file                     | Merge, Get memories             | ## Model, Memory & Search                                          |
| Get memories                 | Airtable                            | Retrieves user memories                      | Merge (from If node)            | Aggregate                      | ## Model, Memory & Search                                          |
| Aggregate                   | Aggregate                          | Aggregates memory records                    | Get memories                   | Merge                         | ## Model, Memory & Search                                          |
| Merge                       | Merge                              | Combines message/transcription with memories| Text vs Voice Router, Aggregate | AI Agent                     | ## Model, Memory & Search                                          |
| Simple Memory               | LangChain Memory Buffer Window      | Maintains session memory context             | AI Agent                       | AI Agent                      | ## Model, Memory & Search                                          |
| Save Memory                 | Airtable Tool                       | Saves summarized memory back to Airtable    | AI Agent                       | AI Agent                      | ## External Tools                                                 |
| AI Agent                   | LangChain Agent                     | Central AI processing and tool orchestration | Merge, Simple Memory, Tools    | Send a text message           | ## Model, Memory & Search                                          |
| xAI Grok Chat Model          | LangChain Language Model (xAI)      | Language model backend for AI Agent          | AI Agent                       | AI Agent                      | ## Model, Memory & Search                                          |
| Search Web with SerpAPI       | LangChain Tool (SerpAPI)             | Provides internet search capability          | AI Agent                      | AI Agent                      | ## External Tools                                                 |
| Get many events in Google Calendar | Google Calendar Tool               | Fetches calendar events                       | AI Agent                      | AI Agent                      | ## External Tools                                                 |
| Create an event in Google Calendar | Google Calendar Tool               | Creates new calendar events                   | AI Agent                      | AI Agent                      | ## External Tools                                                 |
| Update an event in Google Calendar | Google Calendar Tool               | Updates existing calendar events              | AI Agent                      | AI Agent                      | ## External Tools                                                 |
| Delete an event in Google Calendar | Google Calendar Tool               | Deletes calendar events                        | AI Agent                      | AI Agent                      | ## External Tools                                                 |
| Get many messages in Gmail    | Gmail Tool                         | Retrieves multiple Gmail messages             | AI Agent                      | AI Agent                      | ## External Tools                                                 |
| Get a message in Gmail        | Gmail Tool                         | Retrieves a specific Gmail message            | AI Agent                      | AI Agent                      | ## External Tools                                                 |
| Get a database in Notion      | Notion Tool                       | Queries Notion database                        | AI Agent                      | AI Agent                      | ## External Tools                                                 |
| Send a text message           | Telegram                          | Sends AI response back to Telegram chat      | AI Agent                      | (End)                        |                                                                   |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Telegram Trigger node**  
   - Type: Telegram Trigger  
   - Parameters:  
     - Updates: message  
     - Chat IDs: your_telegram_id  
     - Download files: enabled  
   - Credentials: Your Telegram bot API token  
   - Connect output to "Text vs Voice Router (If)".

2. **Create If node ("Text vs Voice Router")**  
   - Condition: Check if `message.text` exists (string exists).  
   - True branch: text message  
   - False branch: voice message  
   - Connect True output to "Merge" node (to be created).  
   - Connect False output to "Get a file".

3. **Create "Get a file" node**  
   - Type: Telegram  
   - Parameters: File ID: `{{$json.message.voice.file_id}}`  
   - Credentials: Telegram bot  
   - Connect output to "Transcribe a recording".

4. **Create "Transcribe a recording" node**  
   - Type: OpenAI Audio Transcription  
   - Parameters: Operation: Transcribe audio  
   - Credentials: OpenAI API  
   - Connect output to "Merge" and "Get memories".

5. **Create "Get memories" node**  
   - Type: Airtable  
   - Parameters:  
     - Base: "appSSdueQKZUG68Wu"  
     - Table: "tbl59eqgFoXOJ9vv9"  
     - Filter formula: `{User} = 'your_name'`  
     - Sort by: Created field ascending  
   - Credentials: Airtable Personal Access Token  
   - Connect output to "Aggregate".

6. **Create "Aggregate" node**  
   - Parameters:  
     - Include fields: Memory, Created  
     - Aggregate all item data into field "Memories"  
   - Connect output to "Merge".

7. **Create "Merge" node**  
   - Parameters: Mode: Combine all  
   - Inputs:  
     - Text message branch from If node  
     - Transcribed voice branch from Transcribe node  
     - Aggregated memories from Aggregate node  
   - Connect output to "AI Agent".

8. **Create "Simple Memory" node**  
   - Type: LangChain Memory Buffer Window  
   - Parameters:  
     - Session Key: `={{ $('If').item.json.message.chat.id }}`  
     - Context window length: 30  
     - Session ID type: customKey  
   - Connect output to "AI Agent" (as AI memory input).

9. **Create "AI Agent" node**  
   - Type: LangChain Agent  
   - Parameters:  
     - Text input: Concatenate current message text (or transcription) plus aggregated memories JSON string  
     - System message: Includes role, rules, tool descriptions, and recent memories  
   - Connect to "xAI Grok Chat Model" (language model)  
   - Connect output to "Send a text message"  
   - Connect tool outputs to respective external nodes (SerpAPI, Gmail, Calendar, Notion).  
   - Connect output memory summary to "Save Memory".

10. **Create "xAI Grok Chat Model" node**  
    - Type: LangChain Language Model (xAI)  
    - Parameters: Model: grok-4-0709  
    - Credentials: xAI API token  
    - Connect input from "AI Agent" language model input.

11. **Create "Save Memory" node**  
    - Type: Airtable Tool (create record)  
    - Parameters:  
      - Base and Table same as "Get memories"  
      - Fields: User: "Your_Name", Memory: output from AI Agent (summary)  
    - Credentials: Airtable token  
    - Connect input from AI Agent tool output.

12. **Create External Tool nodes** and connect as tools to AI Agent:  
    - SerpAPI Search  
    - Google Calendar: Get many events, Create event, Update event, Delete event  
    - Gmail: Get many messages, Get a message  
    - Notion: Get a database  
    - Configure each with appropriate OAuth2 or API credentials.

13. **Create "Send a text message" node**  
    - Type: Telegram  
    - Parameters:  
      - Text: `={{ $json.output }}` from AI Agent  
      - Chat ID: `={{ $('Telegram Trigger').item.json.message.chat.id }}`  
    - Credentials: Telegram bot

14. **Connect the entire flow** as per the diagram: Telegram Trigger → If → (Text branch → Merge) & (Voice branch → Get File → Transcribe → Merge) → Get memories → Aggregate → Merge → Simple Memory → AI Agent → Send a text message.

---

### 5. General Notes & Resources

| Note Content                                                                                                                       | Context or Link                              |
|----------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
| Memory and AI model nodes are central to maintaining conversational context and enabling personalized responses.                 | Core LangChain Memory & Agent concepts       |
| Telegram voice messages are transcribed via OpenAI Whisper model, enabling voice interaction.                                      | OpenAI Whisper API documentation             |
| Airtable is used as persistent memory storage with "Your_Name" as user identifier; ensure credentials have write permissions.    | Airtable Personal Access Token usage          |
| SerpAPI provides web search capabilities linked to AI for up-to-date information retrieval.                                        | https://serpapi.com/                          |
| Google Calendar and Gmail nodes require OAuth2 credentials with appropriate scopes enabled.                                        | Google API Console and OAuth2 setup           |
| Notion node accesses specific databases; requires Notion integration tokens and proper database IDs.                              | Notion API documentation                       |
| System prompt in AI Agent defines multi-tool orchestration rules and memory management, critical for correct AI behavior.        | LangChain prompt engineering best practices   |
| Sticky notes in the workflow visually group nodes by function: Routing, Model/Memory/Search, External Tools.                      | Workflow documentation visual aids             |

---

**Disclaimer:**  
The provided text is exclusively derived from an automated workflow created with n8n, a tool for integration and automation. This processing strictly complies with current content policies and contains no illegal, offensive, or proprietary elements. All handled data is legal and public.

---