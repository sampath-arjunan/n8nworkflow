Build a Question-Answering AI Agent with Llama, RAG and Google Search

https://n8nworkflows.xyz/workflows/build-a-question-answering-ai-agent-with-llama--rag-and-google-search-5403


# Build a Question-Answering AI Agent with Llama, RAG and Google Search

### 1. Workflow Overview

This workflow implements a Question-Answering AI Agent leveraging Llama models, Retrieval-Augmented Generation (RAG), and Google Search capabilities. It is designed for two primary use cases:

- **1.1 Live Interaction Handling:** Receives questions from clients via the MCP (Multi-Channel Processor) Client, processes queries by retrieving relevant data from a vector database, and returns AI-generated answers.
- **1.2 RAG Ingestion Pipeline:** Processes document ingestion by accepting PDF files through a form, splitting the documents into chunks, embedding them, and storing the embeddings in a Qdrant vector database for later retrieval.

The workflow is divided into two logical blocks:

- **Block 1: MCP Server Interaction and Query Processing**  
  Handles incoming client requests, performs similarity search using Qdrant vector store with embeddings generated by Ollama embedding model, and returns results.

- **Block 2: RAG Document Ingestion Pipeline**  
  Allows uploading PDF files through a form, loads and splits documents, generates embeddings, and inserts them into the Qdrant vector store for semantic search.

---

### 2. Block-by-Block Analysis

#### Block 1: MCP Server Interaction and Query Processing

- **Overview:**  
  This block listens for incoming queries from MCP Clients, retrieves relevant documents from the Qdrant vector store using embeddings generated by Ollama embedding model, and serves as the main AI interaction layer.

- **Nodes Involved:**  
  - MCP Client  
  - MCP Client1  
  - MCP Server Trigger  
  - Qdrant Vector Store  
  - Embeddings Ollama  
  - Sticky Note (comment)

- **Node Details:**

  1. **MCP Client**  
     - *Type:* MCP Client Tool  
     - *Role:* Initiates communication with the MCP Server by sending questions or commands.  
     - *Configuration:* Uses MCP Client (STDIO) credentials for authentication. No explicit parameters set; serves as input trigger.  
     - *Connections:* Outputs to MCP Server Trigger node.  
     - *Potential Failures:* Authentication failure, communication timeouts, malformed requests.

  2. **MCP Client1**  
     - *Type:* MCP Client Tool  
     - *Role:* Variant of MCP Client configured to execute tools remotely, specifically set to "executeTool" operation with toolName parameter.  
     - *Configuration:* Uses same MCP Client (STDIO) credentials.  
     - *Connections:* Outputs to MCP Server Trigger node.  
     - *Potential Failures:* Same as MCP Client plus tool execution failures.

  3. **MCP Server Trigger**  
     - *Type:* LangChain MCP Trigger  
     - *Role:* Receives triggers from MCP Clients, acting as the server entry point to process incoming requests.  
     - *Configuration:* Webhook path set to a unique UUID string; version 2 of node type used.  
     - *Connections:* Receives input from both MCP Client nodes; outputs to Qdrant Vector Store.  
     - *Potential Failures:* Webhook connectivity issues, malformed input payloads, version compatibility.

  4. **Qdrant Vector Store**  
     - *Type:* LangChain Vector Store (Qdrant)  
     - *Role:* Retrieves relevant documents based on query embeddings from the vector store collection named "mcp_rag".  
     - *Configuration:* Mode set to "retrieve-as-tool" with an empty options object. Connected to a local Qdrant API instance via credentials.  
     - *Connections:* Inputs embedding vectors from Embeddings Ollama node; outputs results to MCP Server Trigger for further processing.  
     - *Potential Failures:* Connection failures to Qdrant API, empty or missing collections, query timeout.

  5. **Embeddings Ollama**  
     - *Type:* LangChain Embeddings Ollama  
     - *Role:* Generates embeddings for input text queries using the Ollama local embedding model "mxbai-embed-large:latest".  
     - *Configuration:* Model specified as "mxbai-embed-large:latest", using local Ollama API credentials.  
     - *Connections:* Outputs embeddings to Qdrant Vector Store node.  
     - *Potential Failures:* Model loading errors, API communication failures, invalid input data.

  6. **Sticky Note**  
     - *Content:* "## MCP Server\n**Will be triggered by the MCP Client**"  
     - *Role:* Visual annotation for user understanding; no functional role.

---

#### Block 2: RAG Document Ingestion Pipeline

- **Overview:**  
  Designed to upload PDF documents via a form, split the documents into manageable chunks, embed the textual content, and store embeddings in the Qdrant vector store. This pipeline is intended to be run only once or as needed to refresh the knowledge base.

- **Nodes Involved:**  
  - On form submission  
  - Qdrant Vector Store1  
  - Embeddings Ollama1  
  - Default Data Loader  
  - Recursive Character Text Splitter  
  - Sticky Note1 (comment)

- **Node Details:**

  1. **On form submission**  
     - *Type:* Form Trigger  
     - *Role:* Listens for PDF file uploads via a web form titled "Ingest PDF Files in semantic database".  
     - *Configuration:* Accepts file input of type ".pdf" only; webhook ID set for unique access.  
     - *Connections:* Outputs binary PDF file data to Qdrant Vector Store1.  
     - *Potential Failures:* File upload errors, unsupported file types, webhook connectivity.

  2. **Qdrant Vector Store1**  
     - *Type:* LangChain Vector Store (Qdrant)  
     - *Role:* Inserts new document embeddings into the "mcp_rag" collection.  
     - *Configuration:* Mode set to "insert" with empty options, connected to local Qdrant API credentials.  
     - *Connections:* Receives embeddings from Embeddings Ollama1 and document data from Default Data Loader.  
     - *Potential Failures:* Insert conflicts, API connectivity issues.

  3. **Embeddings Ollama1**  
     - *Type:* LangChain Embeddings Ollama  
     - *Role:* Generates embeddings from document chunks using the same embedding model "mxbai-embed-large:latest".  
     - *Configuration:* Uses local Ollama API credentials.  
     - *Connections:* Outputs embeddings to Qdrant Vector Store1.  
     - *Potential Failures:* Model or API errors, empty input data.

  4. **Default Data Loader**  
     - *Type:* LangChain Document Default Data Loader  
     - *Role:* Loads binary PDF data and prepares documents for splitting and embedding.  
     - *Configuration:* Data type set to binary, text splitting mode set to "custom".  
     - *Connections:* Outputs documents to Qdrant Vector Store1 for insertion.  
     - *Potential Failures:* Document parsing errors, unsupported formats.

  5. **Recursive Character Text Splitter**  
     - *Type:* LangChain Recursive Character Text Splitter  
     - *Role:* Splits loaded text documents into chunks of size 400 with overlap of 100 characters to optimize embedding.  
     - *Configuration:* Chunk size 400, chunk overlap 100, no additional options.  
     - *Connections:* Outputs chunks to Default Data Loader.  
     - *Potential Failures:* Incorrect splitting if documents are malformed or extremely short.

  6. **Sticky Note1**  
     - *Content:* "## RAG Ingestion Pipeline\n**Only run once to upload your documents**"  
     - *Role:* Visual annotation to indicate usage instructions; no functional role.

---

### 3. Summary Table

| Node Name                | Node Type                                     | Functional Role                         | Input Node(s)          | Output Node(s)         | Sticky Note                              |
|--------------------------|-----------------------------------------------|---------------------------------------|-----------------------|------------------------|-----------------------------------------|
| MCP Client               | MCP Client Tool                               | Client input trigger                   | —                     | MCP Server Trigger     |                                         |
| MCP Client1              | MCP Client Tool                               | Client input trigger with executeTool | —                     | MCP Server Trigger     |                                         |
| MCP Server Trigger       | LangChain MCP Trigger                         | Server trigger processing client queries | MCP Client, MCP Client1 | Qdrant Vector Store    | "## MCP Server\n**Will be triggered by the MCP Client**" |
| Qdrant Vector Store      | LangChain Vector Store (Qdrant)               | Retrieve relevant documents via embeddings | MCP Server Trigger, Embeddings Ollama | MCP Server Trigger    |                                         |
| Embeddings Ollama        | LangChain Embeddings Ollama                   | Generate embeddings for queries       | MCP Server Trigger     | Qdrant Vector Store    |                                         |
| Sticky Note              | Sticky Note                                   | Visual annotation                     | —                     | —                      | "## MCP Server\n**Will be triggered by the MCP Client**" |
| On form submission       | Form Trigger                                 | Upload PDF files via form              | —                     | Qdrant Vector Store1   |                                         |
| Qdrant Vector Store1     | LangChain Vector Store (Qdrant)               | Insert new document embeddings        | On form submission, Embeddings Ollama1, Default Data Loader | —                     |                                         |
| Embeddings Ollama1       | LangChain Embeddings Ollama                   | Generate embeddings for documents     | Default Data Loader    | Qdrant Vector Store1   |                                         |
| Default Data Loader      | LangChain Document Default Data Loader       | Load and prepare PDFs for splitting   | Recursive Character Text Splitter | Qdrant Vector Store1   |                                         |
| Recursive Character Text Splitter | LangChain Recursive Character Text Splitter | Split documents into chunks            | —                     | Default Data Loader    |                                         |
| Sticky Note1             | Sticky Note                                   | Visual annotation                     | —                     | —                      | "## RAG Ingestion Pipeline\n**Only run once to upload your documents**" |

---

### 4. Reproducing the Workflow from Scratch

1. **Create MCP Client Node**  
   - Type: MCP Client Tool  
   - Credentials: Assign MCP Client (STDIO) credentials  
   - No additional parameters  
   - Output: Connect to MCP Server Trigger node

2. **Create MCP Client1 Node**  
   - Type: MCP Client Tool  
   - Credentials: Same MCP Client (STDIO) credentials  
   - Parameters: Set `toolName` to "execute_tool", operation to "executeTool"  
   - Output: Connect to MCP Server Trigger node

3. **Create MCP Server Trigger Node**  
   - Type: LangChain MCP Trigger (version 2)  
   - Parameters: Set webhook path to unique UUID (e.g., "8d7910ab-f0db-4042-9da9-f580647a8a8e")  
   - Inputs: Connect input from both MCP Client and MCP Client1 nodes  
   - Output: Connect to Qdrant Vector Store node

4. **Create Embeddings Ollama Node**  
   - Type: LangChain Embeddings Ollama  
   - Credentials: Use local Ollama API credentials  
   - Parameters: Model set to "mxbai-embed-large:latest"  
   - Output: Connect to Qdrant Vector Store node

5. **Create Qdrant Vector Store Node**  
   - Type: LangChain Vector Store (Qdrant)  
   - Credentials: Connect to local Qdrant API database  
   - Parameters: Mode set to "retrieve-as-tool"  
   - Qdrant Collection: Set to "mcp_rag"  
   - Inputs: From Embeddings Ollama and MCP Server Trigger  
   - Output: Loop back to MCP Server Trigger to complete processing

6. **Create Sticky Note**  
   - Content: "## MCP Server\n**Will be triggered by the MCP Client**"  
   - Position near MCP Server Trigger and MCP Client nodes for clarity

---

7. **Create On Form Submission Node**  
   - Type: Form Trigger (version 2.2)  
   - Parameters: Form title "Ingest PDF Files in semantic database"  
   - Form Fields: Single file upload field accepting ".pdf" files only  
   - Output: Connect to Qdrant Vector Store1 node

8. **Create Qdrant Vector Store1 Node**  
   - Type: LangChain Vector Store (Qdrant)  
   - Credentials: Local Qdrant API database  
   - Parameters: Mode set to "insert"  
   - Collection: "mcp_rag"  
   - Inputs: From On form submission, Embeddings Ollama1, and Default Data Loader nodes

9. **Create Embeddings Ollama1 Node**  
   - Type: LangChain Embeddings Ollama  
   - Credentials: Local Ollama API credentials  
   - Parameters: Model "mxbai-embed-large:latest"  
   - Outputs: Connect to Qdrant Vector Store1 node

10. **Create Default Data Loader Node**  
    - Type: LangChain Document Default Data Loader  
    - Parameters: Data type "binary", text splitting mode "custom"  
    - Input: Connect from Recursive Character Text Splitter  
    - Output: Connect to Qdrant Vector Store1 node

11. **Create Recursive Character Text Splitter Node**  
    - Type: LangChain Recursive Character Text Splitter  
    - Parameters: Chunk size 400, chunk overlap 100  
    - Output: Connect to Default Data Loader node

12. **Create Sticky Note1**  
    - Content: "## RAG Ingestion Pipeline\n**Only run once to upload your documents**"  
    - Position near the ingestion nodes for user guidance

---

### 5. General Notes & Resources

| Note Content                                                    | Context or Link                                                                             |
|----------------------------------------------------------------|--------------------------------------------------------------------------------------------|
| The workflow uses local Ollama API service for embeddings and LLM support. Set up Ollama locally for optimal performance. | Ollama API documentation or local installation instructions (not included here)             |
| Qdrant vector store is used as the semantic database backend; ensure local or remote Qdrant API is accessible with correct credentials. | Qdrant official docs: https://qdrant.tech/documentation/                                   |
| MCP Client and Server nodes rely on standardized MCP protocol; credentials and webhook paths must be securely configured to avoid unauthorized access. | MCP protocol specification and security guidelines                                         |
| The RAG ingestion pipeline is intended to be run once or when updating the knowledge base; repeated runs may duplicate data if not handled carefully. | Best practices for vector store management and document versioning                         |
| Sticky notes provide user guidance within the workflow but do not affect execution. Review them to understand workflow structure visually. | —                                                                                          |

---

**Disclaimer:** The text provided originates exclusively from an automated workflow created with n8n, an integration and automation tool. This processing strictly adheres to current content policies and contains no illegal, offensive, or protected elements. All data handled is legal and public.