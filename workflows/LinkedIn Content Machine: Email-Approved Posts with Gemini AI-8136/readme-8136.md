LinkedIn Content Machine: Email-Approved Posts with Gemini AI

https://n8nworkflows.xyz/workflows/linkedin-content-machine--email-approved-posts-with-gemini-ai-8136


# LinkedIn Content Machine: Email-Approved Posts with Gemini AI

### 1. Workflow Overview

This workflow automates the process of generating, approving via email, and publishing LinkedIn posts tailored to a specific niche and audience using AI-powered content generation and email-based interaction. It facilitates a seamless content creation pipeline where post ideas and drafts are generated by Google Gemini AI, approved by replying to emails, and then published on LinkedIn. The entire process is logged and tracked in Google Sheets for accountability and auditing.

Logical blocks:

- **1.1 Manual Trigger & Input Setup:** Initiates the workflow manually and sets the niche and audience parameters.
- **1.2 AI Post Ideas Generation:** Uses AI to generate 10 LinkedIn post ideas, parses them, and sends them to the user via email.
- **1.3 Email Reply Handling & Post Idea Selection:** Listens for email replies containing the chosen idea number, extracts this selection, and retrieves the corresponding row from Google Sheets.
- **1.4 AI Draft Generation:** Generates 3 draft posts based on the selected idea, parses the drafts, updates the Google Sheet, and emails the drafts for approval.
- **1.5 Draft Selection & LinkedIn Posting:** Extracts the final selected draft from email reply, publishes it on LinkedIn, updates the Google Sheet, and sends a confirmation email.

---

### 2. Block-by-Block Analysis

---

#### 1.1 Manual Trigger & Input Setup

**Overview:**  
This block starts the workflow manually for testing or ad-hoc content creation. It defines the key input fields: niche and audience, which guide the AI content generation.

**Nodes Involved:**  
- When clicking ‘Execute workflow’ (Manual Trigger)  
- Edit Fields (Set Node)

**Node Details:**

- **When clicking ‘Execute workflow’**  
  - Type: Manual Trigger  
  - Role: Initiates the workflow on user demand.  
  - Configuration: Default, no parameters.  
  - Connections: Output to Edit Fields node.  
  - Edge Cases: None inherent; ensures manual start only.  

- **Edit Fields**  
  - Type: Set  
  - Role: Defines static input parameters for niche (“startup founders in SaaS”) and audience (“growth-focused professionals”).  
  - Configuration: Assigns two string fields: niche and audience.  
  - Expressions: Static strings set directly.  
  - Connections: Outputs to AI Agent node.  
  - Edge Cases: Hardcoded values; modification needed for dynamic input cases.  

---

#### 1.2 AI Post Ideas Generation

**Overview:**  
Generates 10 scroll-stopping LinkedIn post ideas in JSON format using the LangChain AI Agent backed by Google Gemini Chat Model. The output is cleaned, parsed, and an email body is constructed with a correlation ID for tracking.

**Nodes Involved:**  
- AI Agent (LangChain Agent)  
- Google Gemini Chat Model  
- Code (Parse AI Output)  
- Append row in sheet (Google Sheets)  
- Send a message (Gmail)

**Node Details:**

- **AI Agent**  
  - Type: LangChain Agent  
  - Role: Sends prompt to generate 10 post ideas based on niche and audience.  
  - Configuration: Prompt instructs strict JSON output with idea ids and titles; uses niche and audience from input.  
  - Expressions: Uses `{{$json.niche}}` and `{{$json.audience}}` for dynamic input.  
  - Input: From Edit Fields node.  
  - Output: JSON string with ideas.  
  - Version: 2.2.  
  - Edge Cases: AI may return malformed JSON; handled downstream.  

- **Google Gemini Chat Model**  
  - Type: LLM Chat Model (Google Gemini)  
  - Role: Backend AI engine powering the LangChain Agent.  
  - Configuration: Uses Google Palm API credentials.  
  - Input: From AI Agent node.  
  - Output: AI response.  
  - Edge Cases: API errors, rate limits, or invalid credentials cause failures.  

- **Code (Parse AI Output)**  
  - Type: Code (JavaScript)  
  - Role: Cleans AI output (removes markdown JSON fences), parses JSON, creates a correlation ID for tracking, and builds a formatted email body listing the 10 ideas.  
  - Key Expressions: Uses `$json` and `$input.first().json`; accesses previous node data via node references (e.g. `$('Edit Fields')`).  
  - Input: AI Agent output.  
  - Output: JSON object containing correlationId, ideas array, niche, audience, and an emailBody string.  
  - Edge Cases: Throws error if JSON parsing fails, essential for integrity.  

- **Append row in sheet**  
  - Type: Google Sheets Append Row  
  - Role: Logs the generated ideas, niche, audience, and correlationId with stage set to “ideas” in the Google Sheet for later tracking.  
  - Configuration: Defines columns and matches schema; writes to specific Google Sheet and sheet tab.  
  - Credentials: Google Sheets OAuth2.  
  - Input: Code node output.  
  - Output: Data for next step.  
  - Edge Cases: Google Sheets API errors or connectivity issues.  

- **Send a message**  
  - Type: Gmail Send  
  - Role: Sends an email to the user containing the 10 post ideas and instructions to reply with a number to draft posts.  
  - Configuration: Uses emailBody from Code node as message body; subject includes correlationId for tracking.  
  - Credentials: Gmail OAuth2.  
  - Input: Append row node output.  
  - Edge Cases: Email sending failures, invalid recipient address.  

---

#### 1.3 Email Reply Handling & Post Idea Selection

**Overview:**  
Listens for email replies containing a chosen post idea number and correlation ID, extracts those values, and retrieves the corresponding row from Google Sheets. Routes execution based on the current stage of the content lifecycle.

**Nodes Involved:**  
- Gmail Trigger  
- Code1 (Extract Reply)  
- Get row(s) in sheet (Google Sheets)  
- Switch

**Node Details:**

- **Gmail Trigger**  
  - Type: Gmail Trigger  
  - Role: Monitors inbox for replies matching filter: emails sent to user with subject containing “[CID:” and not categorized as promotions.  
  - Configuration: Runs every minute; filters by sender and subject query.  
  - Credentials: Gmail OAuth2.  
  - Edge Cases: Missed emails if polling fails; spam filtering may affect delivery.  

- **Code1 (Extract Reply)**  
  - Type: Code (JavaScript)  
  - Role: Extracts the first number from the email reply body and correlationId from the subject line; also optionally extracts sender info.  
  - Key Expressions: Regex parsing on snippet and subject fields.  
  - Output: Object with kind (“numberReply”), selectedNumber, correlationId, and sender info or error object if missing.  
  - Edge Cases: Missing or malformed CID or number leads to unknown kind return.  

- **Get row(s) in sheet**  
  - Type: Google Sheets Get Rows  
  - Role: Fetches the Google Sheet row matching the extracted correlationId to retrieve stored ideas, drafts, and status.  
  - Configuration: Filters on “correlationId ” column.  
  - Credentials: Google Sheets OAuth2.  
  - Edge Cases: No matching rows found; API errors.  

- **Switch**  
  - Type: Switch  
  - Role: Routes execution based on the “stage” field in the sheet row: “ideas”, “drafts”, or empty/unknown (end).  
  - Conditions:  
    - Stage = "ideas" → Drafts Path  
    - Stage = "drafts" → Publish Path  
    - Empty or unknown → END path (no further action)  
  - Edge Cases: Unrecognized or missing stage leads to no further processing.  

---

#### 1.4 AI Draft Generation

**Overview:**  
Generates 3 draft LinkedIn posts for the selected idea, parses the drafts, updates the Google Sheet with draft data and stage, and emails the drafts for review.

**Nodes Involved:**  
- Code2 (Match Selected Idea)  
- AI Agent1 (LangChain Agent)  
- Google Gemini Chat Model1  
- Code3 (Parse Drafts)  
- Update row in sheet (Google Sheets)  
- Send a message1 (Gmail)

**Node Details:**

- **Code2 (Match Selected Idea)**  
  - Type: Code (JavaScript)  
  - Role: Parses the stored ideas array and finds the idea matching the selected number; extracts topic and metadata.  
  - Input: Data from Get row(s) in sheet and Code1 nodes.  
  - Output: Correlation ID, selectedTopic, niche, audience.  
  - Edge Cases: Returns error if selected idea not found.  

- **AI Agent1**  
  - Type: LangChain Agent  
  - Role: Generates 3 LinkedIn post drafts (120–200 words each), tailored by topic, audience, niche, and tone.  
  - Configuration: Prompt defines strict JSON output with drafts array.  
  - Expressions: Uses dynamic fields for topic, audience, niche.  
  - Version: 2.2.  
  - Edge Cases: AI may return malformed JSON or no drafts; handled by downstream code.  

- **Google Gemini Chat Model1**  
  - Type: LLM Chat Model  
  - Role: Backend for AI Agent1, powered by Google Gemini with valid API credentials.  
  - Edge Cases: API failures or rate limits.  

- **Code3 (Parse Drafts)**  
  - Type: Code (JavaScript)  
  - Role: Parses AI drafts JSON, builds an email body listing drafts, and instructs to reply with draft number for publishing.  
  - Output: correlationId, selectedTopic, drafts array, emailBody string.  
  - Edge Cases: Throws error on JSON parse failure.  

- **Update row in sheet**  
  - Type: Google Sheets Update Row  
  - Role: Updates the same row identified by correlationId to set stage to "drafts" and store drafts JSON and selectedTopic.  
  - Credentials: Google Sheets OAuth2.  
  - Edge Cases: API errors; row not found.  

- **Send a message1 (Gmail)**  
  - Type: Gmail Send  
  - Role: Emails the 3 drafts to the user for review and selection.  
  - Configuration: Email body contains drafts and instructions, subject includes correlationId.  
  - Credentials: Gmail OAuth2.  
  - Edge Cases: Email sending errors.  

---

#### 1.5 Draft Selection & LinkedIn Posting

**Overview:**  
Extracts the chosen draft based on reply number, publishes it to LinkedIn as the organization’s post, updates the Google Sheet to mark the post as published with LinkedIn URN, and sends a confirmation email with a preview.

**Nodes Involved:**  
- Code4 (Match Selected Draft)  
- Create a post (LinkedIn)  
- Update row in sheet1 (Google Sheets)  
- Send a message2 (Gmail)

**Node Details:**

- **Code4 (Match Selected Draft)**  
  - Type: Code (JavaScript)  
  - Role: Parses stored drafts, finds the selected draft by number, and prepares final post text.  
  - Edge Cases: Returns error if draft not found or JSON parsing fails.  

- **Create a post (LinkedIn)**  
  - Type: LinkedIn Node  
  - Role: Publishes the final selected post to LinkedIn under the specified organization.  
  - Configuration: Post text from Code4; posts as organization with community management OAuth2 credentials; organization ID set.  
  - Credentials: LinkedIn Community Management OAuth2.  
  - Edge Cases: LinkedIn API errors, permission, or authentication issues.  

- **Update row in sheet1**  
  - Type: Google Sheets Update Row  
  - Role: Marks the sheet row stage as “Posted”, stores LinkedIn URN from post response.  
  - Credentials: Google Sheets OAuth2.  
  - Edge Cases: API errors.  

- **Send a message2 (Gmail)**  
  - Type: Gmail Send  
  - Role: Sends a final confirmation email to user with preview of the published post.  
  - Credentials: Gmail OAuth2.  
  - Edge Cases: Email sending failures.  

---

### 3. Summary Table

| Node Name               | Node Type                      | Functional Role                                   | Input Node(s)              | Output Node(s)           | Sticky Note                                                                                                    |
|-------------------------|--------------------------------|-------------------------------------------------|----------------------------|--------------------------|---------------------------------------------------------------------------------------------------------------|
| When clicking ‘Execute workflow’ | Manual Trigger                 | Starts workflow manually for testing             | -                          | Edit Fields              | ### 1. Manual Trigger  Runs workflow manually for testing or ad-hoc posting.                                 |
| Edit Fields             | Set                            | Defines niche & audience parameters               | When clicking ‘Execute workflow’ | AI Agent                 | ### 2. Edit Fields (Set Node)  Defines niche & audience for content generation.                               |
| AI Agent                | LangChain Agent                | Generates 10 LinkedIn post ideas                  | Edit Fields                | Code                     | ### 3. AI Agent (LangChain Agent)  Generates 10 post ideas in strict JSON format.                             |
| Google Gemini Chat Model| LLM Chat Model (Google Gemini) | LLM backend for AI Agent                          | AI Agent                   | AI Agent                 | ### 4. Google Gemini Chat Model  LLM backend for AI Agent. Requires Gemini API credentials.                   |
| Code                    | Code (JavaScript)              | Parses AI output JSON, creates correlationId, builds email body | AI Agent                   | Append row in sheet       | ### 5. Code (Parse AI Output)  Cleans JSON, generates correlationId, builds email body.                      |
| Append row in sheet     | Google Sheets Append Row       | Logs ideas with stage ‘ideas’                      | Code                       | Send a message           | ### 6. Append Row in Sheet (Google Sheets)  Logs generated ideas, stage set to *ideas*.                      |
| Send a message          | Gmail Send                    | Sends email with 10 post ideas                     | Append row in sheet        | -                        | ### 7. Send a Message (Gmail)  Emails you the ideas. You reply with a number.                                 |
| Gmail Trigger           | Gmail Trigger                 | Listens for email replies with CID in subject     | -                          | Code1                    | ### 8. Gmail Trigger  Listens for replies with `[CID: ...]`.                                                |
| Code1                   | Code (JavaScript)             | Extracts reply number & correlationId              | Gmail Trigger              | Get row(s) in sheet      | ### 9. Code1 (Extract Reply)  Parses reply to extract chosen number & correlationId.                         |
| Get row(s) in sheet     | Google Sheets Get Rows         | Fetches row by correlationId                        | Code1                      | Switch                   | ### 10. Get Row(s) in Sheet  Fetches stored row by correlationId.                                           |
| Switch                  | Switch                        | Routes flow based on stage: ideas → drafts → publish | Get row(s) in sheet        | Code2, Code4             | ### 11. Switch  Routes flow: **ideas → drafts → publish**.                                                  |
| Code2                   | Code (JavaScript)             | Matches selected idea, extracts topic              | Switch                     | AI Agent1                | ### 12. Code2 (Match Selected Idea)  Finds the chosen idea & extracts topic.                                |
| AI Agent1               | LangChain Agent               | Generates 3 LinkedIn post drafts                    | Code2                      | Code3                    | ### 13. AI Agent1 (Draft Generator)  Generates **3 drafts** (120–200 words each).                            |
| Google Gemini Chat Model1| LLM Chat Model                | LLM backend for AI Agent1                          | AI Agent1                  | AI Agent1                | ### 14. Google Gemini Chat Model1  Backend for AI Agent1.                                                   |
| Code3                   | Code (JavaScript)             | Parses drafts JSON, builds email body               | AI Agent1                  | Update row in sheet      | ### 15. Code3 (Parse Drafts)  Parses drafts JSON, builds email body.                                        |
| Update row in sheet     | Google Sheets Update Row       | Updates stage to ‘drafts’, saves drafts             | Code3                      | Send a message1          | ### 16. Update Row in Sheet  Updates stage to *drafts*, logs drafts JSON.                                   |
| Send a message1         | Gmail Send                    | Emails 3 drafts for approval                         | Update row in sheet        | -                        | ### 17. Send a Message1 (Gmail)  Emails you the 3 drafts for approval.                                       |
| Code4                   | Code (JavaScript)             | Extracts selected draft from drafts JSON             | Switch                     | Create a post            | ### 18. Code4 (Match Selected Draft)  Extracts final draft based on reply number.                            |
| Create a post           | LinkedIn                      | Publishes final post on LinkedIn                     | Code4                      | Update row in sheet1     | ### 19. Create a Post (LinkedIn)  Publishes final post to LinkedIn.                                         |
| Update row in sheet1    | Google Sheets Update Row       | Updates stage to ‘Posted’ and stores LinkedIn URN   | Create a post              | Send a message2          | ### 20. Update Row in Sheet1  Updates sheet stage to *Posted* with LinkedIn URN.                            |
| Send a message2         | Gmail Send                    | Sends final confirmation email with preview          | Update row in sheet1       | -                        | ### 21. Send a Message2 (Gmail)  Sends final confirmation email with preview.                               |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Manual Trigger Node**  
   - Type: Manual Trigger  
   - Purpose: Start workflow manually.  

2. **Create Set Node "Edit Fields"**  
   - Type: Set  
   - Add fields:  
     - `niche` (string) = "startup founders in SaaS"  
     - `audience` (string) = "growth-focused professionals"  
   - Connect Manual Trigger → Edit Fields  

3. **Create LangChain Agent Node "AI Agent"**  
   - Type: LangChain Agent  
   - Prompt:  
     ```
     You are a content strategist for LinkedIn.
     Given a niche and audience, return 10 scroll-stopping post ideas as compact titles.
     Output STRICT JSON:
     {
       "ideas": [
         {"id": 1, "title": "..."},
         ...
         {"id": 10, "title": "..."}
       ]
     }
     Niche: {{$json.niche}}
     Audience: {{$json.audience}}
     ```
   - Prompt Type: Define  
   - Connect Edit Fields → AI Agent  

4. **Create Google Gemini Chat Model Node**  
   - Type: LLM Chat Model (Google Gemini)  
   - Credentials: Google Palm API account  
   - Connect AI Agent’s `ai_languageModel` input → Google Gemini Chat Model  

5. **Create Code Node "Code"**  
   - Type: Code  
   - JavaScript:  
     - Remove markdown JSON fences from AI output  
     - Parse JSON safely, throw error if invalid  
     - Create unique `correlationId` with timestamp + random string  
     - Build email body listing 10 ideas with instructions  
     - Return JSON with correlationId, ideas, niche, audience, emailBody  
   - Connect AI Agent → Code  

6. **Create Google Sheets Append Row Node**  
   - Operation: Append  
   - Document & Sheet: Your Google Sheet and sheet name (e.g., "Sheet1")  
   - Map fields: ideas, niche, audience, correlationId, stage = "ideas"  
   - Credentials: Google Sheets OAuth2  
   - Connect Code → Append row in sheet  

7. **Create Gmail Send Node "Send a message"**  
   - Send To: Your email address  
   - Subject: `Your 10 LinkedIn Ideas [CID: {{ $json['correlationId '] }}]`  
   - Message: Use `emailBody` from Code node  
   - Credentials: Gmail OAuth2  
   - Connect Append row in sheet → Send a message  

8. **Create Gmail Trigger Node**  
   - Filter: Emails to you with subject containing "[CID:" from your email  
   - Poll every minute  
   - Credentials: Gmail OAuth2  

9. **Create Code Node "Code1"**  
   - Extract first number from reply text and correlationId from subject line  
   - Return object with kind, selectedNumber, correlationId, from  
   - Connect Gmail Trigger → Code1  

10. **Create Google Sheets Get Rows Node "Get row(s) in sheet"**  
    - Filter: lookupValue = `{{$json.correlationId}}` in column "correlationId "  
    - Credentials: Google Sheets OAuth2  
    - Connect Code1 → Get row(s) in sheet  

11. **Create Switch Node**  
    - Condition based on `$json.stage` field:  
      - If "ideas" → output "Drafts Path"  
      - If "drafts" → output "Publish Path"  
      - Else → "END"  
    - Connect Get row(s) in sheet → Switch  

12. **Create Code Node "Code2" (Drafts Path)**  
    - Parse ideas JSON, find idea matching selectedNumber  
    - Return correlationId, selectedTopic, niche, audience  
    - Connect Switch (Drafts Path) → Code2  

13. **Create LangChain Agent "AI Agent1"**  
    - Prompt:  
      ```
      Create 3 LinkedIn post drafts about the topic below, tailored to the audience.
      Length: 120–200 words each, plain text. Avoid emojis unless natural.
      Output strict JSON:
      {
        "drafts": [
          {"id": 1, "text": "..."},
          {"id": 2, "text": "..."},
          {"id": 3, "text": "..."}
        ]
      }
      Topic: {{$json.selectedTopic}}
      Audience: {{$json.audience}}
      Niche: {{$json.niche}}
      Tone: insightful, practical, founder-friendly
      ```
    - Connect Code2 → AI Agent1  

14. **Create Google Gemini Chat Model Node "Google Gemini Chat Model1"**  
    - Credentials: Google Palm API account  
    - Connect AI Agent1’s `ai_languageModel` input → Google Gemini Chat Model1  

15. **Create Code Node "Code3"**  
    - Parse draft JSON output  
    - Build email listing 3 drafts  
    - Add reply instruction to pick draft 1, 2, or 3  
    - Return correlationId, selectedTopic, drafts, emailBody  
    - Connect AI Agent1 → Code3  

16. **Create Google Sheets Update Row Node "Update row in sheet"**  
    - Update row where correlationId matches  
    - Set stage = "drafts", update drafts and selectedTopic columns  
    - Credentials: Google Sheets OAuth2  
    - Connect Code3 → Update row in sheet  

17. **Create Gmail Send Node "Send a message1"**  
    - Send 3 drafts email with instructions  
    - Subject includes correlationId  
    - Credentials: Gmail OAuth2  
    - Connect Update row in sheet → Send a message1  

18. **Create Code Node "Code4" (Publish Path)**  
    - Parse drafts JSON from sheet  
    - Find draft matching reply number  
    - Return correlationId, selectedTopic, finalPost text  
    - Connect Switch (Publish Path) → Code4  

19. **Create LinkedIn Node "Create a post"**  
    - Post text from Code4 finalPost  
    - Post as organization; set organization ID  
    - Credentials: LinkedIn Community Management OAuth2  
    - Connect Code4 → Create a post  

20. **Create Google Sheets Update Row Node "Update row in sheet1"**  
    - Update row with stage = "Posted" and linkedinUrn from LinkedIn response  
    - Credentials: Google Sheets OAuth2  
    - Connect Create a post → Update row in sheet1  

21. **Create Gmail Send Node "Send a message2"**  
    - Send confirmation email with preview of published post  
    - Subject includes correlationId  
    - Credentials: Gmail OAuth2  
    - Connect Update row in sheet1 → Send a message2  

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                  | Context or Link                                                                                           |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| Turn a simple email workflow into a **LinkedIn content machine**. Generate post ideas, draft full posts, and auto-publish to LinkedIn — all controlled by replying to emails.                                                                 | Workflow purpose summary; see sticky note at workflow start                                              |
| Automate LinkedIn posting using AI + Email approvals. Includes 10 ideas, 3 drafts per idea, email-based approvals, Google Sheets tracking, and auto-posting.                                                                                   | Workflow highlights                                                                                       |
| Apps used: Google Gemini (AI generation), Gmail (email approvals), Google Sheets (logging), LinkedIn API (posting).                                                                                                                         | Integration summary                                                                                       |
| Best for startup founders, agencies managing clients, solopreneurs, and creators seeking consistent LinkedIn posting.                                                                                                                        | Target users                                                                                             |
| Workflow design avoids dashboards; all interactions via email replies with numbered selections.                                                                                                                                               | UX highlight                                                                                            |
| Google Gemini API usage requires valid Google Palm API credentials.                                                                                                                                                                           | Credential requirement                                                                                   |
| Gmail OAuth2 credentials must have proper scopes to send and receive emails programmatically.                                                                                                                                                  | Credential detail                                                                                        |
| LinkedIn Community Management OAuth2 credentials must permit posting as organization.                                                                                                                                                         | Credential detail                                                                                        |
| Google Sheets OAuth2 credentials must allow read/write access to the specific spreadsheet used for logging.                                                                                                                                   | Credential detail                                                                                        |
| Polling frequency for Gmail Trigger is set to every minute to minimize reply latency.                                                                                                                                                         | Polling setting                                                                                          |
| Error handling includes JSON parsing failures, missing correlation IDs, and invalid user replies, throwing errors or terminating flow gracefully.                                                                                             | Robustness note                                                                                          |
| All emails include correlationId in subject for traceability and linking replies to specific content generation sessions.                                                                                                                    | Traceability best practice                                                                                |
| Mermaid diagram in sticky notes outlines workflow flow and logic visually for reference.                                                                                                                                                      | Additional documentation                                                                                 |

---

**Disclaimer:**  
The provided text is exclusively derived from an automated workflow created with n8n, a powerful integration and automation tool. This process strictly adheres to content policies and contains no illegal, offensive, or protected elements. All data processed is legal and public.