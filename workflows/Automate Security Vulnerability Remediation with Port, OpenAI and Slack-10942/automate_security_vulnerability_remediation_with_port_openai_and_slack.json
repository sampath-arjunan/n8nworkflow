{"id":"cOTjUL76icKaTe69","meta":{"instanceId":"be7665cef51b13547e586e0f385e42416ebee48719c71d7dc7c03dbdf41fc246","templateCredsSetupCompleted":true},"name":"Remediate security vulnerabilities with Port","tags":[],"nodes":[{"id":"21562ea1-75f7-4cc8-8a3d-3e751e6bbfb3","name":"Webhook Trigger","type":"n8n-nodes-base.webhook","position":[-1056,144],"webhookId":"67326f7b-22c3-46c0-9f9f-805fc1401647","parameters":{"path":"security/vulnerability_detected","options":{},"httpMethod":"POST"},"typeVersion":1,"webhookDescription":"Triggered when a new vulnerability is detected"},{"id":"ff37cc72-793b-466a-9dea-0cea1b2f6d44","name":"OpenAI Remediation Plan","type":"n8n-nodes-base.openAi","position":[-224,144],"parameters":{"model":"gpt-4o-mini","prompt":{"messages":[{"content":"=You are a cybersecurity assistant. Given the following vulnerability details, summarize the issue, assess impact, and generate a clear remediation plan.\n\nVulnerability:{{ $('Webhook Trigger').item.json.body.vulnerability_id }}\nDescription: {{ $('Webhook Trigger').item.json.body.description }}\nSeverity: {{ $('Webhook Trigger').item.json.body.severity }}\n\nContext: {{ $json.result.message }}\n\nYour response must be a single valid JSON object only, without any code block formatting, markdown, explanations, or extra text.  \nDo not include ```json or ``` or any surrounding characters â€” just raw JSON.\n\nRequired output schema:\n{\n  \"summary\": \"\",\n  \"impact\": \"\",\n  \"remediation_plan\": \"\",\n  \"is_fixable\": boolean true or false\n}"}]},"options":{},"resource":"chat","requestOptions":{}},"credentials":{"openAiApi":{"id":"9kESCajK5wWZQKcJ","name":"OpenAi account"}},"typeVersion":1},{"id":"6bb104ec-02bb-4b9b-ad23-c31289731db1","name":"Send Slack Message","type":"n8n-nodes-base.slack","position":[864,160],"parameters":{"text":"={{ \n`ðŸš¨ *Vulnerability Alert*\n\n*ID:* ${$('Webhook Trigger').item.json.body.vulnerability_id}\n*Severity:* ${$('Webhook Trigger').item.json.body.severity}\n*Summary:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().summary}\n*Impact:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().impact}\n*Remediation Plan:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().remediation_plan}\n\n_Workflow: AI-Assisted Remediation_`\n}}\n","channel":"={{ $('Process Port AI Response').item.json.result.message.parseJson().slack_channel || \"<DEFAULT_SLACK_CHANNEL>\" }}","attachments":[],"otherOptions":{}},"credentials":{"slackApi":{"id":"WbMbgVb4paOjFSiI","name":"Slack account"}},"typeVersion":1},{"id":"d559968e-197f-4bd9-8b05-2ab07fcc9369","name":"Is Fixable?","type":"n8n-nodes-base.if","position":[16,144],"parameters":{"conditions":{"boolean":[{"value1":"={{ $json.message.content.parseJson().is_fixable }}","value2":"={{ true }}"}]}},"typeVersion":1},{"id":"44b5afc2-7ced-429e-b8fd-f63b2fd3ea23","name":"Trigger Claude Code","type":"n8n-nodes-base.httpRequest","position":[384,-80],"parameters":{"url":"https://api.getport.io/v1/actions/run_claude_code_demo/runs","method":"POST","options":{},"jsonBody":"={{ {\n  properties: {\n    service: $('Process Port AI Response').item.json.result.message.parseJson().affected_service || \"<OWNER/REPO>\",\n    prompt: \"Generate a code fix for the security vulnerability based on the AI-provided summary \" + $json.message.content.parseJson().summary + \".\\n\\nHere is the information about the security vulnerability remediation plan:\\n\" + $json.message.content.parseJson().remediation_plan + \"\\n\\nAfter generating the code, open a PR with a description summarizing what was fixed and why.\"\n  }\n} }}","sendBody":true,"specifyBody":"json","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth"},"credentials":{"httpBearerAuth":{"id":"7pOcRXtO7xDHoZKF","name":"Bearer YOUR_TOKEN_HERE account"}},"typeVersion":4.3},{"id":"142a25fe-6149-4e0f-8783-b0fc00dfecaa","name":"Get Context From Port","type":"CUSTOM.portIo","position":[-752,144],"parameters":{"model":"gpt-5","labels":"{\n    \"source\": \"n8n-workflow\",\n    \"use_case\": \"vulnerability-context-enrichment\"\n  }","prompt":"=You are an assistant that provides contextual enrichment for vulnerabilities using the Port catalog as a knowledge base. A new security vulnerability has been detected.\nVulnerability Details:\n- Identifier:{{ $('Webhook Trigger').item.json.body.vulnerability_id }}\n- Description:{{ $('Webhook Trigger').item.json.body.description }}\n- Severity:{{ $('Webhook Trigger').item.json.body.severity }}\n\nUsing the Port catalog (which stores data about services, components, environments, owners, and relationships), return relevant contextual information that will help downstream AI agents or security teams understand how this vulnerability relates to other entities. Specifically, retrieve:\n1. The affected service or repo linked to this vulnerability\n2. Ownership or responsible team(s)\n3. Communication channels such as Slack channel name\n4. Related environments or deployment targets\n5. Dependencies or linked entities in the Port catalog (for example, linked repositories, cloud resources, or microservices)\n6. Any additional metadata that can help prioritize or triage this vulnerability.\n\n  Format the response as structured JSON with the following keys: `identifier`, `title`, `affected_service`, `slack_channel`, `owners`, `environments`, `dependencies`, and `notes`.","agentIdentifier":"context_retriever_agent"},"credentials":{"portIoApi":{"id":"vphYNYaTZimXT7su","name":"Port.io account"}},"typeVersion":1},{"id":"3292b239-93c4-411d-81ab-5f08a90e3abd","name":"Process Port AI Response","type":"CUSTOM.portIo","position":[-480,144],"parameters":{"operation":"getInvocation","invocationId":"={{ $json.invocationIdentifier }}"},"credentials":{"portIoApi":{"id":"vphYNYaTZimXT7su","name":"Port.io account"}},"typeVersion":1},{"id":"a6395fa9-8f7c-41c8-9c71-3be023650b81","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-1696,-256],"parameters":{"width":528,"height":672,"content":"## Remediate security vulnerabilities with Port\n\nThis workflow automatically enriches security vulnerability alerts with organizational context from Port and routes them to the appropriate teams or AI agents for remediation.\n\n### How it works\n- n8n receives a new vulnerability from your security scanner (e.g., Snyk) via webhook\n- The workflow calls Port's context lake to enrich the alert with service, ownership, environment, and dependency data.\n- With this context, the workflow either sends targeted Slack notifications to the owning team or triggers an AI remediation flow to propose and apply a fix.\n\n### Setup steps\n- [ ] Sign up with a free account on port.io.\n- [ ] Create the [required AI agent](https://docs.port.io/guides/all/remediate-vulnerability-with-n8n-and-port/) in Port.\n- [ ] Configure credentials in n8n for Port, Slack, and OpenAI/Claude.\n- [ ] Trigger the webhook with a sample vulnerability to verify context retrieval, Slack notifications, and AI remediation."},"typeVersion":1},{"id":"fdb8967a-7289-4c29-9e30-840d130b0194","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-800,-272],"parameters":{"color":6,"width":448,"height":688,"content":"## Port Context Lake\n\nPortâ€™s context lake to enrich the alert with service, ownership, environment, and dependency data"},"typeVersion":1},{"id":"bd2a3ebb-2330-4e5e-a09f-ca58336e0a2d","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[192,-256],"parameters":{"color":3,"width":464,"height":656,"content":"## Setup Claude in Port\n\n- Ensure you have completed the setup in Port's [Trigger Claude Guide](https://docs.port.io/guides/all/trigger-claude-code-from-port/)\n\n - Replace **<OWNER/REPO>** with your default infrastructure repository if no repository or service is linked to the vulnerability in Port."},"typeVersion":1},{"id":"82335639-b2c9-4fe5-8f9f-90f50c7ae0d6","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[720,-256],"parameters":{"color":5,"width":416,"height":656,"content":"## Slack Channel Replacement\n\nReplace **<DEFAULT_SLACK_CHANNEL>** with the Slack channel where you want notifications sent if Port cannot find a specific channel for the vulnerability."},"typeVersion":1}],"active":false,"pinData":{},"settings":{"executionOrder":"v1"},"versionId":"85061504-a01b-4d5d-a5c2-7bb87bdd32b5","connections":{"Is Fixable?":{"main":[[{"node":"Trigger Claude Code","type":"main","index":0}],[{"node":"Send Slack Message","type":"main","index":0}]]},"Webhook Trigger":{"main":[[{"node":"Get Context From Port","type":"main","index":0}]]},"Trigger Claude Code":{"main":[[{"node":"Send Slack Message","type":"main","index":0}]]},"Get Context From Port":{"main":[[{"node":"Process Port AI Response","type":"main","index":0}]]},"OpenAI Remediation Plan":{"main":[[{"node":"Is Fixable?","type":"main","index":0}]]},"Process Port AI Response":{"main":[[{"node":"OpenAI Remediation Plan","type":"main","index":0}]]}}}