Monitor Customer Churn Indicators with Bright Data MCP and OpenAI

https://n8nworkflows.xyz/workflows/monitor-customer-churn-indicators-with-bright-data-mcp-and-openai-5965


# Monitor Customer Churn Indicators with Bright Data MCP and OpenAI

---

### 1. Workflow Overview

This workflow automates the monitoring of customer churn indicators by scraping user login data from an admin dashboard, calculating inactivity durations, and sending re-engagement emails to inactive users.

It is structured into three logical blocks:

- **1.1 Trigger & Dashboard Input:** Automates workflow execution on a scheduled basis and sets the source of user data (admin dashboard URL).

- **1.2 AI-Powered Scraping & Date Transformation:** Uses AI agents and Bright Data MCP to scrape and parse user data, then converts last login dates into numeric inactivity durations.

- **1.3 Smart Notification Logic:** Evaluates inactivity thresholds and conditionally sends personalized re-engagement emails to users inactive for 30 or more days.

---

### 2. Block-by-Block Analysis

#### 1.1 Trigger & Dashboard Input

- **Overview:**  
This block initiates the workflow daily and sets the URL of the admin dashboard spreadsheet that contains user data for scraping.

- **Nodes Involved:**  
  - Daily Check Trigger  
  - Set Admin Dashboard URL  

- **Node Details:**  

  - **Daily Check Trigger**  
    - *Type:* Schedule Trigger  
    - *Role:* Automatically triggers the workflow once daily at 9:00 AM.  
    - *Configuration:* Set to trigger at hour 9 every day (UTC by default).  
    - *Connections:* Outputs to Set Admin Dashboard URL.  
    - *Edge cases:* Timezone mismatches, trigger failures if n8n is paused or offline.  

  - **Set Admin Dashboard URL**  
    - *Type:* Set  
    - *Role:* Defines the URL string of the Google Sheets admin dashboard where user data resides.  
    - *Configuration:* Static assignment of the URL `https://docs.google.com/spreadsheets/d/1SuilmbqeTypIigl3PGeJYzsQt8pKNjil/edit?gid=1026450716#gid=1026450716` to the field `database`.  
    - *Connections:* Inputs from Daily Check Trigger; outputs to Scrape User Data (AI Agent).  
    - *Edge cases:* Invalid or inaccessible URL will cause scraping failures downstream.

---

#### 1.2 AI-Powered Scraping & Date Transformation

- **Overview:**  
This block scrapes user data from the specified dashboard URL using an AI agent combined with a Bright Data MCP Client proxy, parses and formats the data, and converts last login dates into the number of inactive days via OpenAI.

- **Nodes Involved:**  
  - Scrape User Data (AI Agent)  
  - Bright Data MCP Client  
  - OpenAI Chat Model  
  - Structured Output Parser  
  - Auto-fixing Output Parser  
  - Format User Login Data (Code)  
  - Convert Date to Days Since Login (OpenAI)  
  - Convert Days to Integer (Set)  

- **Node Details:**  

  - **Scrape User Data (AI Agent)**  
    - *Type:* Langchain AI Agent  
    - *Role:* Executes an AI-driven scraping task to extract user data from the provided Google Sheets URL.  
    - *Configuration:* Prompt instructs to scrape the dashboard URL (passed as a variable). Uses Bright Data MCP Client as the scraping proxy tool.  
    - *Connections:* Receives `database` URL from Set Admin Dashboard URL; calls Bright Data MCP Client as AI tool; outputs raw scraped data to Format User Login Data and OpenAI Chat Model.  
    - *Edge cases:* Scraping failures, proxy authentication failures, malformed data, or rate limits from Bright Data MCP or Google Sheets API.  

  - **Bright Data MCP Client**  
    - *Type:* MCP Client Tool (Bright Data proxy)  
    - *Role:* Acts as the proxy and execution engine for scraping requests initiated by the AI agent.  
    - *Configuration:* Executes `scrape_as_markdown` tool with parameters automatically generated by AI.  
    - *Connections:* Invoked by Scrape User Data (AI Agent).  
    - *Credential:* Requires MCP Client API credentials.  
    - *Edge cases:* Authentication errors, proxy connection failures, request timeouts.  

  - **OpenAI Chat Model**  
    - *Type:* Langchain LM Chat OpenAI  
    - *Role:* Used to parse and interpret AI responses within the scraping workflow.  
    - *Configuration:* Model set to `gpt-4o-mini`.  
    - *Connections:* Receives outputs from Scrape User Data (AI Agent).  
    - *Credential:* OpenAI API key required.  
    - *Edge cases:* API rate limits, network errors, unexpected output format.  

  - **Structured Output Parser**  
    - *Type:* Langchain Structured Output Parser  
    - *Role:* Parses scraped JSON-like output into structured data using predefined JSON schema example with user fields: name, email, last_login, plan.  
    - *Configuration:* Uses a JSON schema example of 10 user entries with sample data for validation.  
    - *Connections:* Parses output from OpenAI Chat Model. Outputs parsed data to Auto-fixing Output Parser.  
    - *Edge cases:* Parsing errors if scraped data deviates from schema.  

  - **Auto-fixing Output Parser**  
    - *Type:* Langchain Output Parser Autofixing  
    - *Role:* Attempts to automatically correct output parsing errors, improving data reliability.  
    - *Connections:* Inputs from Structured Output Parser; outputs to Scrape User Data (AI Agent) node for final data preparation.  
    - *Edge cases:* May fail if data is severely malformed.  

  - **Format User Login Data**  
    - *Type:* Code (JavaScript)  
    - *Role:* Transforms the array of user data into separate n8n items, extracting key fields: name, email, last_login, and plan.  
    - *Configuration:* JS code maps each user object into an individual item with fields.  
    - *Connections:* Inputs from Scrape User Data (AI Agent); outputs to Convert Date to Days Since Login.  
    - *Edge cases:* Empty or missing fields in user data could produce undefined values.  

  - **Convert Date to Days Since Login**  
    - *Type:* Langchain OpenAI (Chat)  
    - *Role:* Converts last login dates into the number of days since that date until today.  
    - *Configuration:* Custom prompt instructs GPT-4o-mini to calculate days between given date (YYYY-MM-DD) and current date, replying only with the number.  
    - *Connections:* Inputs user last_login field from Format User Login Data; outputs to Convert Days to Integer.  
    - *Credential:* OpenAI API key required.  
    - *Edge cases:* Date format errors, API failures, timezone issues causing inaccurate day counts.  

  - **Convert Days to Integer**  
    - *Type:* Set  
    - *Role:* Converts the OpenAI string response into a numeric value for comparison.  
    - *Configuration:* Sets `message.content` as a number type from the OpenAI output string.  
    - *Connections:* Inputs from Convert Date to Days Since Login; outputs to Check Inactive Threshold.  
    - *Edge cases:* Conversion failures if OpenAI response is malformed or contains unexpected text.

---

#### 1.3 Smart Notification Logic

- **Overview:**  
This block checks if a user's inactivity exceeds 30 days and, if so, sends a re-engagement email via Gmail. Otherwise, it performs no action.

- **Nodes Involved:**  
  - Check Inactive Threshold (>=30 days) (If Node)  
  - Send Re-engagement Email (Gmail)  
  - Do Nothing (User Active) (NoOp)  

- **Node Details:**  

  - **Check Inactive Threshold (>=30 days)**  
    - *Type:* If  
    - *Role:* Compares the days since last login against threshold (30 days).  
    - *Configuration:* Condition checks if `message.content` (days inactive) is greater than or equal to 30.  
    - *Connections:* Inputs from Convert Days to Integer; outputs True branch to Send Re-engagement Email, False branch to Do Nothing.  
    - *Edge cases:* Missing or invalid numeric input could cause logic failure or misrouting.  

  - **Send Re-engagement Email**  
    - *Type:* Gmail  
    - *Role:* Sends a plain-text email to inactive users encouraging them to return.  
    - *Configuration:*  
      - Recipient email dynamically set from `Format User Login Data` node's item JSON email field.  
      - Subject: "We are missing you, we have an offer for you"  
      - Message body: Friendly re-engagement text encouraging user return.  
    - *Credential:* Gmail OAuth2 credentials required.  
    - *Connections:* True output from If node.  
    - *Edge cases:* Gmail API rate limits, authentication errors, invalid email addresses.  

  - **Do Nothing (User Active)**  
    - *Type:* No Operation  
    - *Role:* Placeholder node for users active within threshold; effectively ends processing.  
    - *Connections:* False output from If node.  
    - *Edge cases:* None; safe fallback.

---

### 3. Summary Table

| Node Name                    | Node Type                         | Functional Role                              | Input Node(s)               | Output Node(s)                  | Sticky Note                                                                                 |
|------------------------------|----------------------------------|----------------------------------------------|-----------------------------|-------------------------------|---------------------------------------------------------------------------------------------|
| Daily Check Trigger           | Schedule Trigger                 | Initiates workflow daily trigger              |                             | Set Admin Dashboard URL         | Section 1: Trigger & Dashboard Input - Schedule trigger runs workflow automatically daily.  |
| Set Admin Dashboard URL       | Set                             | Defines admin dashboard URL                    | Daily Check Trigger          | Scrape User Data (AI Agent)    | Section 1: Trigger & Dashboard Input - Contains URL of user data dashboard.                 |
| Scrape User Data (AI Agent)   | Langchain AI Agent              | Scrapes user data via AI & Bright Data proxy | Set Admin Dashboard URL      | Format User Login Data, OpenAI Chat Model | Section 2: AI-Powered Scraping & Date Transformation - Uses AI agent + MCP Client to scrape user data. |
| Bright Data MCP Client        | MCP Client Tool                 | Proxy client for scraping                      | Scrape User Data (AI Agent)  |                              | Section 2: AI-Powered Scraping & Date Transformation - Bright Data proxy client.            |
| OpenAI Chat Model             | Langchain LM Chat OpenAI        | Parses AI responses                            | Scrape User Data (AI Agent)  | Structured Output Parser        | Section 2: AI-Powered Scraping & Date Transformation - OpenAI model for parsing.            |
| Structured Output Parser      | Langchain Structured Output Parser | Validates and structures scraped data         | OpenAI Chat Model            | Auto-fixing Output Parser       | Section 2: AI-Powered Scraping & Date Transformation - Enforces JSON schema on data.       |
| Auto-fixing Output Parser     | Langchain Output Parser Autofixing | Automatically corrects parsing errors          | Structured Output Parser     | Scrape User Data (AI Agent)     | Section 2: AI-Powered Scraping & Date Transformation - Auto-fixes parsing errors.           |
| Format User Login Data        | Code (JavaScript)               | Formats scraped user data into individual items | Scrape User Data (AI Agent)  | Convert Date to Days Since Login | Section 2: AI-Powered Scraping & Date Transformation - Formats user data for next steps.   |
| Convert Date to Days Since Login | Langchain OpenAI (Chat)          | Converts last login date to days inactive      | Format User Login Data       | Convert Days to Integer         | Section 2: AI-Powered Scraping & Date Transformation - Converts date strings to numeric days. |
| Convert Days to Integer       | Set                             | Converts OpenAI string output to integer       | Convert Date to Days Since Login | Check Inactive Threshold (>=30 days) | Section 2: AI-Powered Scraping & Date Transformation - Ensures numeric data type.           |
| Check Inactive Threshold (>=30 days) | If                             | Checks if inactivity >= 30 days                | Convert Days to Integer       | Send Re-engagement Email (True), Do Nothing (False) | Section 3: Smart Notification Logic - Decision node on inactivity threshold.                |
| Send Re-engagement Email      | Gmail                           | Sends re-engagement email to inactive users   | Check Inactive Threshold (True) |                               | Section 3: Smart Notification Logic - Email sent to users inactive >= 30 days.              |
| Do Nothing (User Active)      | No Operation                    | Ends workflow path for active users            | Check Inactive Threshold (False) |                               | Section 3: Smart Notification Logic - No action for active users.                          |
| Sticky Note                  | Sticky Note                     | Provides section explanations and tips         |                             |                               | Multiple sticky notes provide detailed explanations for each section and workflow overview.|

---

### 4. Reproducing the Workflow from Scratch

1. **Create "Daily Check Trigger" node**  
   - Type: Schedule Trigger  
   - Set to trigger once daily at 9:00 AM (hour 9).  

2. **Create "Set Admin Dashboard URL" node**  
   - Type: Set  
   - Add a string field named `database` with value:  
     `https://docs.google.com/spreadsheets/d/1SuilmbqeTypIigl3PGeJYzsQt8pKNjil/edit?gid=1026450716#gid=1026450716`  
   - Connect output of "Daily Check Trigger" to this node.  

3. **Create "Bright Data MCP Client" node**  
   - Type: MCP Client Tool  
   - Tool Name: `scrape_as_markdown`  
   - Operation: `executeTool`  
   - Leave tool parameters empty (will be set dynamically by AI Agent)  
   - Configure MCP Client API credentials (Bright Data MCP account).  

4. **Create "OpenAI Chat Model" node** (for scraping parsing)  
   - Type: Langchain LM Chat OpenAI  
   - Model: `gpt-4o-mini`  
   - Configure OpenAI API credentials.  

5. **Create "Structured Output Parser" node**  
   - Type: Langchain Structured Output Parser  
   - Paste the JSON schema example with user fields (name, email, last_login, plan) as per the provided sample data.  

6. **Create "Auto-fixing Output Parser" node**  
   - Type: Langchain Output Parser Autofixing  
   - No special configuration needed.  

7. **Create "Scrape User Data (AI Agent)" node**  
   - Type: Langchain AI Agent  
   - Prompt: `scrape the database URL below and extract the data. URL: {{ $json.database }}`  
   - Set to use "Bright Data MCP Client" as tool for scraping.  
   - Connect input from "Set Admin Dashboard URL" node.  
   - Connect AI language model input to "OpenAI Chat Model" node.  
   - Connect AI output parser to "Auto-fixing Output Parser" node.  

8. **Connect "Auto-fixing Output Parser" output back to "Scrape User Data (AI Agent)" node's main output**  
   - This sets up the data flow with auto-fixing parsing.  

9. **Create "Format User Login Data" node**  
   - Type: Code (JavaScript)  
   - Code:  
     ```javascript
     const users = items[0].json.output;
     const output = users.map(user => {
       return { json: { name: user.name, email: user.email, last_login: user.last_login, plan: user.plan } };
     });
     return output;
     ```  
   - Connect input from "Scrape User Data (AI Agent)".  

10. **Create "Convert Date to Days Since Login" node**  
    - Type: Langchain OpenAI (Chat)  
    - Model: `gpt-4o-mini`  
    - Message prompt:  
      ```
      I will provide you with a last login date in YYYY-MM-DD format.

      Please calculate the number of days between that date and today, and respond only with:

      <number_of_days>

      For example, if the last login date is 2024-06-01, and today is 2024-07-01, then reply:

      30

      Here is the last login date: {{ $json.last_login }}
      ```  
    - Configure OpenAI API credentials.  
    - Connect input from "Format User Login Data".  

11. **Create "Convert Days to Integer" node**  
    - Type: Set  
    - Add field `message.content` with type number, value expression: `={{ $json.message.content }}`  
    - Connect input from "Convert Date to Days Since Login".  

12. **Create "Check Inactive Threshold (>=30 days)" node**  
    - Type: If  
    - Condition: Check if `message.content` >= 30  
    - Connect input from "Convert Days to Integer".  

13. **Create "Send Re-engagement Email" node**  
    - Type: Gmail  
    - Send To: `={{ $('Format User Login Data').item.json.email }}`  
    - Subject: "We are missing you, we have an offer for you"  
    - Message (text):  
      ```
      We are missing you.

      You haven't visited our application for a while. So we just wanted to reach out in case there are some problems.

      We would like you to come back.

      Kind regards,
      Team [company name]
      ```  
    - Configure Gmail OAuth2 credentials.  
    - Connect True output of If node to this node.  

14. **Create "Do Nothing (User Active)" node**  
    - Type: No Operation  
    - Connect False output of If node to this node.  

---

### 5. General Notes & Resources

| Note Content                                                                                                           | Context or Link                                                                                   |
|------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|
| This workflow automates inactive user detection and re-engagement email sending, ideal for SaaS customer retention.    | Workflow purpose                                                                                  |
| Bright Data MCP proxy access is essential for scraping; ensure valid subscription and API credentials are set up.      | Bright Data MCP Client node                                                                      |
| OpenAI GPT-4o-mini model is used for natural language parsing and date calculations; API keys required.                 | OpenAI Chat Model nodes                                                                          |
| Gmail OAuth2 credentials must have sending permissions for the email node to work correctly.                            | Gmail node                                                                                       |
| For workflow assistance, contact: Yaron@nofluff.online; YouTube: https://www.youtube.com/@YaronBeen/videos             | Contact and support information                                                                 |
| Bright Data affiliate link for subscription: https://get.brightdata.com/1tndi4600b25                                     | Affiliate link in sticky note                                                                    |
| The workflow requires reliable internet connection and uninterrupted n8n execution for daily scheduled runs.           | Operational advice                                                                              |
| Customize email content and dashboard URL per your company branding and data source.                                    | Customization guidance                                                                           |

---

disclaimer Le texte fourni provient exclusivement d’un workflow automatisé réalisé avec n8n, un outil d’intégration et d’automatisation. Ce traitement respecte strictement les politiques de contenu en vigueur et ne contient aucun élément illégal, offensant ou protégé. Toutes les données manipulées sont légales et publiques.

---