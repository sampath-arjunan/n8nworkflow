{"id":"2u7GX5RTicgSyIM3","meta":{"instanceId":"66e13aec947801e3f08d27a590fb0e07109805e23a7eabde7c0647150db10195"},"name":"AI-Powered Allergy Check & Menu Assistant for School Lu","tags":[],"nodes":[{"id":"ca85e0eb-d8f4-4c23-b42a-3bfee9834f4d","name":"Manual Trigger (The Initiator)","type":"n8n-nodes-base.manualTrigger","position":[-1616,648],"parameters":{},"typeVersion":1},{"id":"03755995-56d6-4897-97b5-8d0e1ada73a5","name":"OpenRouter Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","position":[-448,848],"parameters":{"options":{}},"typeVersion":1},{"id":"06428ef3-ffa4-46a0-bf59-430426312ffb","name":"OpenRouter Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","position":[-448,1264],"parameters":{"options":{}},"typeVersion":1},{"id":"897c4bf4-71f8-4b82-a4ba-5c1e0b747bce","name":"Read Student Allergy List","type":"n8n-nodes-base.googleSheets","position":[-1392,688],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"list","value":1576014901,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/1h5BXRUDxQeUhnWRaVgFR1at2FasFU1R0E5Di0-7yhNQ/edit#gid=1576014901","cachedResultName":"ai_studio_code (1) ã®ã‚³ãƒ”ãƒ¼"},"documentId":{"__rl":true,"mode":"list","value":"1h5BXRUDxQeUhnWRaVgFR1at2FasFU1R0E5Di0-7yhNQ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1h5BXRUDxQeUhnWRaVgFR1at2FasFU1R0E5Di0-7yhNQ/edit?usp=drivesdk","cachedResultName":"å…¨æ ¡ç”Ÿå¾’ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒªã‚¹ãƒˆ (students_allergies)"}},"credentials":{"googleSheetsOAuth2Api":{"id":"RT8oGifNPqBBXfLg","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"5485c8c2-ad5f-48e6-9484-1438571d5dab","name":"Read Monthly Menu","type":"n8n-nodes-base.googleSheets","position":[-1392,500],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"list","value":1040457327,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/13ggQPDMSEzq0rHvzc5IM60DiRIbn1ji9thgnJlX79WY/edit#gid=1040457327","cachedResultName":"ai_studio_code (2)"},"documentId":{"__rl":true,"mode":"list","value":"13ggQPDMSEzq0rHvzc5IM60DiRIbn1ji9thgnJlX79WY","cachedResultUrl":"https://docs.google.com/spreadsheets/d/13ggQPDMSEzq0rHvzc5IM60DiRIbn1ji9thgnJlX79WY/edit?usp=drivesdk","cachedResultName":"æ¥æœˆã®çŒ®ç«‹æ¡ˆï¼ˆãƒ¬ã‚·ãƒ”ãƒªã‚¹ãƒˆï¼‰ (menu_recipes)"}},"credentials":{"googleSheetsOAuth2Api":{"id":"RT8oGifNPqBBXfLg","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"e3978d4b-f78e-4c34-be1d-e89052fe0d67","name":"Read Teacher List","type":"n8n-nodes-base.googleSheets","position":[-1392,884],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"list","value":438399172,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/11F3ijE2_N0KnRV3Ft2_LRjLVaCu8xC8bv5iCFikff9E/edit#gid=438399172","cachedResultName":"ai_studio_code (3)"},"documentId":{"__rl":true,"mode":"list","value":"11F3ijE2_N0KnRV3Ft2_LRjLVaCu8xC8bv5iCFikff9E","cachedResultUrl":"https://docs.google.com/spreadsheets/d/11F3ijE2_N0KnRV3Ft2_LRjLVaCu8xC8bv5iCFikff9E/edit?usp=drivesdk","cachedResultName":"ã‚¯ãƒ©ã‚¹æ‹…ä»»æƒ…å ±ãƒªã‚¹ãƒˆ (class_teachers_list)"}},"credentials":{"googleSheetsOAuth2Api":{"id":"RT8oGifNPqBBXfLg","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"dde50cbc-95e5-47ab-a319-ed29ecce6f69","name":"Format Menu Data","type":"n8n-nodes-base.code","position":[-1168,500],"parameters":{"jsCode":"return { \"menus\": $input.all() };"},"typeVersion":2},{"id":"f7a6b2d5-5f97-4fdd-ba58-4ced5d0def7c","name":"Format Student Data","type":"n8n-nodes-base.code","position":[-1168,692],"parameters":{"jsCode":"return { \"students\": $input.all() };"},"typeVersion":2},{"id":"e9af4e6a-2fac-424b-b7ae-23c93ccadabf","name":"Format Teacher Data","type":"n8n-nodes-base.code","position":[-1168,884],"parameters":{"jsCode":"return { \"teachers\": $input.all() };"},"typeVersion":2},{"id":"7872f468-51ae-4a3e-9fe6-235c19e17db0","name":"Merge All Data","type":"n8n-nodes-base.merge","position":[-944,640],"parameters":{"numberInputs":3},"typeVersion":3.2},{"id":"afddd6ca-dee4-4ef5-a0cf-9e34b27e5d74","name":"Check for Allergy Match","type":"n8n-nodes-base.if","position":[-720,648],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"id-1","operator":{"type":"number","operation":"gt"},"leftValue":"={{ $json.length }}","rightValue":0}]}},"typeVersion":2.2},{"id":"e5587710-ae91-40ef-ba09-b96e0b9845ff","name":"Compose Basic Alert Message","type":"n8n-nodes-base.set","position":[-432,352],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id-1","name":"teacher_email","type":"string","value":"={{ $json.teacherEmail }}"},{"id":"id-2","name":"subject","type":"string","value":"=Allergy Alert for {{ $json.className }}"},{"id":"id-3","name":"message","type":"string","value":"=Dear Teacher,\n\nThis is an automated allergy alert for your class {{ $json.className }}.\n\nStudent: {{ $json.studentName }}\nDate: {{ $json.date }}\nMenu Item: {{ $json.menuName }}\nAllergen: {{ $json.allergen }}\n\nPlease ensure appropriate precautions are taken.\n\nBest regards,\nSchool Nutrition Department"}]},"includeOtherFields":true},"typeVersion":3.4},{"id":"002d7618-fe04-418d-9059-bba13e2efa3d","name":"Send Basic Slack Alert","type":"n8n-nodes-base.slack","position":[-224,352],"webhookId":"52074a78-8566-42e9-b54f-1bc8b4890159","parameters":{"text":"=ã€çµ¦é£Ÿã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è­¦å‘Šã€‘{{ $json.teacherName }}å…ˆç”Ÿã€ã”ç¢ºèªãã ã•ã„ã€‚","user":{"__rl":true,"mode":"list","value":"U09RNMU4BL0","cachedResultName":"chinatsu.y.natty"},"select":"user","otherOptions":{},"authentication":"oAuth2"},"credentials":{"slackOAuth2Api":{"id":"RWF938uw1j6rNuhN","name":"Slack account"}},"typeVersion":2.3},{"id":"c267e1a2-e5da-48b9-bc66-e34a880489d0","name":"Log Alert to Google Drive","type":"n8n-nodes-base.googleDrive","position":[-16,352],"parameters":{"content":"=ã€çµ¦é£Ÿã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼é€šçŸ¥ãƒ­ã‚°ã€‘\né€šçŸ¥æ—¥æ™‚: {{ $now.toFormat('yyyy-MM-dd HH:mm:ss') }}\n\nâ– å¯¾è±¡ç”Ÿå¾’\nã‚¯ãƒ©ã‚¹: {{ $json.className }}\næ°å: {{ $json.studentName }}\n\nâ– å¯¾è±¡çŒ®ç«‹\næ—¥ä»˜: {{ $json.date }}\nçŒ®ç«‹: {{ $json.menuName }}\nåŸå› ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³: {{ $json.allergen }}\n\nâ– é€šçŸ¥å…ˆ\næ‹…å½“: {{ $json.teacherName }} å…ˆç”Ÿ\n\nä¸Šè¨˜å†…å®¹ã«ã¦Slacké€šçŸ¥ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚","driveId":{"__rl":true,"mode":"list","value":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive","cachedResultName":"My Drive"},"options":{},"folderId":{"__rl":true,"mode":"list","value":"1kxKA9fSLJS14l2JARjCR2Fxk3QdMk3tU","cachedResultUrl":"https://drive.google.com/drive/folders/1kxKA9fSLJS14l2JARjCR2Fxk3QdMk3tU","cachedResultName":"School Lunch Allergy Check & Notification System, \"The Ironclad Guardian\""},"operation":"createFromText"},"credentials":{"googleDriveOAuth2Api":{"id":"JYHidz5ve75qy9ZB","name":"Google Drive account"}},"typeVersion":3},{"id":"21b4dc25-517e-40fc-aa54-d3874c8d7ae4","name":"Generate AI Alert Message","type":"@n8n/n8n-nodes-langchain.agent","position":[-448,624],"parameters":{"options":{"systemMessage":"ã‚ãªãŸã¯ã€å­¦æ ¡çµ¦é£Ÿã®å®‰å…¨ç®¡ç†ã‚’æ‹…ã†ã€çµŒé¨“è±Šå¯Œã§è²¬ä»»æ„Ÿã®å¼·ã„ãƒ™ãƒ†ãƒ©ãƒ³æ „é¤Šå£«ã§ã™ã€‚\n\nä»¥ä¸‹ã®æƒ…å ±ã«åŸºã¥ãã€èª¿ç†å ´ã®ã‚¹ã‚¿ãƒƒãƒ•ã¨æ‹…ä»»ã®å…ˆç”Ÿã«å‘ã‘ãŸã€ç°¡æ½”ã‹ã¤çš„ç¢ºãªSlackã®è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’**JSONå½¢å¼**ã§ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\n\n# å…¥åŠ›æƒ…å ±\nãƒ»ç”Ÿå¾’å: {{ $json.studentName }}\nãƒ»çŒ®ç«‹: {{ $json.menuName }}\nãƒ»åŸå› ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³: {{ $json.allergen }}\nãƒ»ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®æ·±åˆ»åº¦: {{ $json.severity }}\n\n# å‡ºåŠ›å½¢å¼ (JSON)\nå¿…ãšä»¥ä¸‹ã®JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚\n```json\n{\n  \"title\": \"ï¼ˆã“ã“ã«çŠ¶æ³ã«å¿œã˜ãŸä»¶åï¼‰\",\n  \"body\": \"ï¼ˆã“ã“ã«çŠ¶æ³ã«å¿œã˜ãŸæœ¬æ–‡ï¼‰\"\n}"}},"typeVersion":3},{"id":"60fc9d82-ac1d-4300-ae19-d6b14eb9b646","name":"Send AI Slack Alert","type":"n8n-nodes-base.slack","position":[-80,624],"webhookId":"1e5c81ab-cf09-4a58-b6c0-c07a532d3ea0","parameters":{"text":"={{ $('Generate AI Alert Message').item.json.severity === 'é«˜' ? 'ğŸš¨ã€æœ€é‡è¦è­¦å‘Šã€‘' : 'ã€è¦ç¢ºèªã€‘' }} {{ $('Generate AI Alert Message').item.json.teacherName }}å…ˆç”Ÿã€è‡³æ€¥ã”ç¢ºèªãã ã•ã„ã€‚","user":{"__rl":true,"mode":"list","value":"U09RNMU4BL0","cachedResultName":"chinatsu.y.natty"},"select":"user","otherOptions":{},"authentication":"oAuth2"},"credentials":{"slackOAuth2Api":{"id":"RWF938uw1j6rNuhN","name":"Slack account"}},"typeVersion":2.3},{"id":"ae83d231-e553-466e-98cd-2653f645a6f2","name":"Generate AI Menu Report","type":"@n8n/n8n-nodes-langchain.agent","position":[-448,1040],"parameters":{"options":{"systemMessage":"---\n\n### ã€æ‹¡å¼µæ¡ˆâ‘¡ï¼šæœªæ¥ã‚’èª­ã‚€ã€ŒçŒ®ç«‹ææ¡ˆãƒ«ãƒ¼ãƒˆã€ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€‘\n\n**ç›®çš„:** æ „é¤Šå£«ã•ã‚“ãŒçŒ®ç«‹ã‚’ä½œã‚‹æ®µéšã§ã€AIè³¢è€…ãŒç›¸è«‡ç›¸æ‰‹ã¨ãªã‚Šã€æ”¹å–„æ¡ˆã‚’ææ¡ˆã™ã‚‹ã€‚\n**é…ç½®ã™ã‚‹å ´æ‰€:** æ–°ã—ãä½œã‚‹ã€ŒçŒ®ç«‹ç›¸è«‡ãƒ«ãƒ¼ãƒˆã€ã®ã€Google Sheetsä¿‚ã®å¾Œã€‚\n\n**`AI Agent`ãƒãƒ¼ãƒ‰ã«ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æˆã‘ã‚‹ã®ã˜ã‚ƒï¼**\n\n```text\nã‚ãªãŸã¯ã€æ•°ç™¾äººã®ç”Ÿå¾’ã®å¥åº·ã€æ „é¤Šãƒãƒ©ãƒ³ã‚¹ã€ãã—ã¦èª¿ç†å ´ã®æ¥­å‹™åŠ¹ç‡ã®ã™ã¹ã¦ã‚’è€ƒæ…®ã§ãã‚‹ã€æ¥µã‚ã¦å„ªç§€ãªå­¦æ ¡æ „é¤Šå£«ã§ã™ã€‚\n\næ·»ä»˜ã•ã‚ŒãŸ2ã¤ã®æƒ…å ±ï¼ˆæ¥æœˆã®ã€ŒçŒ®ç«‹æ¡ˆã€ã¨ã€Œå…¨æ ¡ç”Ÿå¾’ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒªã‚¹ãƒˆã€ï¼‰ã‚’æ·±ãåˆ†æã—ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªè¦–ç‚¹ã‹ã‚‰**çŒ®ç«‹ã®æ”¹å–„ææ¡ˆãƒ¬ãƒãƒ¼ãƒˆ**ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\n# åˆ†æå¯¾è±¡ãƒ‡ãƒ¼ã‚¿\nãƒ»çŒ®ç«‹æ¡ˆ: `{{ JSON.stringify($items('çŒ®ç«‹æ¡ˆã‚’èª­ã‚€ä¿‚').map(item => item.json)) }}`\nãƒ»å…¨æ ¡ç”Ÿå¾’ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒªã‚¹ãƒˆ: `{{ JSON.stringify($items('å…¨æ ¡ç”Ÿå¾’ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒªã‚¹ãƒˆã‚’èª­ã‚€ä¿‚').map(item => item.json)) }}`\n\n# å®Ÿè¡Œã™ã¹ãã‚¿ã‚¹ã‚¯\n1. **ãƒªã‚¹ã‚¯åˆ†æ:** çŒ®ç«‹æ¡ˆã®å„æ—¥ã«ãŠã„ã¦ã€ä»£æ›¿é£Ÿã‚’å¿…è¦ã¨ã™ã‚‹ç”Ÿå¾’ã®æ•°ã‚’ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³åˆ¥ã«é›†è¨ˆã—ã¦ãã ã•ã„ã€‚\n2. **é«˜ãƒªã‚¹ã‚¯æ—¥ã®ç‰¹å®š:** ä¸Šè¨˜ã®åˆ†æã«åŸºã¥ãã€ç‰¹ã«ä»£æ›¿é£Ÿã®æº–å‚™ãŒè¤‡é›‘ã«ãªã‚‹ã€ã‚ã‚‹ã„ã¯äººæ•°ãŒå¤šããªã‚‹ã€Œé«˜ãƒªã‚¹ã‚¯æ—¥ã€ã‚’æœ€å¤§3æ—¥ç‰¹å®šã—ã¦ãã ã•ã„ã€‚\n3. **ä»£æ›¿æ¡ˆã®ææ¡ˆ:** ç‰¹å®šã—ãŸå„ã€Œé«˜ãƒªã‚¹ã‚¯æ—¥ã€ã«ã¤ã„ã¦ã€åŸå› ã¨ãªã£ã¦ã„ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä»£æ›¿æ¡ˆã‚’2ã¤ãšã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚ææ¡ˆã«ã¯ä»¥ä¸‹ã®è¦ç´ ã‚’å¿…ãšå«ã‚ã¦ãã ã•ã„ã€‚\n    - ä»£æ›¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼å\n    - ãã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã™ã‚‹ã“ã¨ã§ã€ä»£æ›¿é£ŸãŒå¿…è¦ã«ãªã‚‹ç”Ÿå¾’æ•°ãŒä½•äººã«æ¸›ã‚‹ã‹ã®äºˆæ¸¬\n    - ææ¡ˆç†ç”±ï¼ˆä¾‹ï¼šèª¿ç†å·¥ç¨‹ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹ã€æ—¬ã®é£Ÿæã‚’ä½¿ãˆã‚‹ã€æ „é¤Šä¾¡ãŒé«˜ã„ãªã©ï¼‰\n4. **ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼:** å…¨ã¦ã®åˆ†æçµæœã‚’ã€ç§ãŒã™ãã«è¡Œå‹•ã«ç§»ã›ã‚‹ã‚ˆã†ã«ã€ä»¥ä¸‹ã®Markdownå½¢å¼ã§ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚\n\n# å‡ºåŠ›å½¢å¼ (Markdown)\n```markdown\n## çŒ®ç«‹æ”¹å–„ææ¡ˆãƒ¬ãƒãƒ¼ãƒˆ\n\næ „é¤Šå£«æ§˜\n\næ¥æœˆã®çŒ®ç«‹æ¡ˆã‚’åˆ†æã—ã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã®è² æ‹…ã‚’è»½æ¸›ã™ã‚‹ãŸã‚ã®æ”¹å–„æ¡ˆã‚’ã”ææ¡ˆã—ã¾ã™ã€‚\n\n### â–  åˆ†æã‚µãƒãƒªãƒ¼\nï¼ˆã“ã“ã«ã€å…¨ä½“çš„ãªå‚¾å‘ã‚„ç‰¹ã«æ³¨æ„ã™ã¹ãç‚¹ã®è¦ç´„ã‚’è¨˜è¿°ï¼‰\n\n---\n\n### â–  ç‰¹ã«é…æ…®ãŒå¿…è¦ãªæ—¥ï¼ˆé«˜ãƒªã‚¹ã‚¯æ—¥ï¼‰\n\n**1. ï¼ˆæ—¥ä»˜ï¼‰**\n   - **è©²å½“ãƒ¡ãƒ‹ãƒ¥ãƒ¼:** ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼åï¼‰\n   - **å½±éŸ¿äººæ•°:** ï¼ˆäººæ•°ï¼‰äººï¼ˆå†…è¨³ï¼šåµ Xäºº, ä¹³ Yäºº...ï¼‰\n\n**2. ï¼ˆæ—¥ä»˜ï¼‰**\n   - ï¼ˆåŒæ§˜ã«è¨˜è¿°ï¼‰\n\n**3. ï¼ˆæ—¥ä»˜ï¼‰**\n   - ï¼ˆåŒæ§˜ã«è¨˜è¿°ï¼‰\n\n---\n\n### â–  å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ\n\n#### **ææ¡ˆï¼‘ï¼š ï¼ˆé«˜ãƒªã‚¹ã‚¯æ—¥ã®æ—¥ä»˜ï¼‰ã®ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼åï¼‰ã«ã¤ã„ã¦**\n\n*   **ä»£æ›¿æ¡ˆA:** ï¼ˆä»£æ›¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼åAï¼‰\n    *   **åŠ¹æœäºˆæ¸¬:** ä»£æ›¿é£ŸãŒå¿…è¦ãªç”Ÿå¾’ãŒ **ï¼ˆäººæ•°ï¼‰äºº â†’ ï¼ˆäººæ•°ï¼‰äºº** ã«æ¸›å°‘ã—ã¾ã™ã€‚\n    *   **ææ¡ˆç†ç”±:** ï¼ˆç†ç”±ã‚’è¨˜è¿°ï¼‰\n\n*   **ä»£æ›¿æ¡ˆB:** ï¼ˆä»£æ›¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼åBï¼‰\n    *   **åŠ¹æœäºˆæ¸¬:** ä»£æ›¿é£ŸãŒå¿…è¦ãªç”Ÿå¾’ãŒ **ï¼ˆäººæ•°ï¼‰äºº â†’ ï¼ˆäººæ•°ï¼‰äºº** ã«æ¸›å°‘ã—ã¾ã™ã€‚\n    *   **ææ¡ˆç†ç”±:** ï¼ˆç†ç”±ã‚’è¨˜è¿°ï¼‰\n\nï¼ˆä»–ã®é«˜ãƒªã‚¹ã‚¯æ—¥ã«ã¤ã„ã¦ã‚‚ã€åŒæ§˜ã«ææ¡ˆã‚’è¨˜è¿°ï¼‰\n\nã”ç¢ºèªã®ã»ã©ã€ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"}},"typeVersion":3},{"id":"cb8e057e-1b12-474c-9f0a-48abc54562d6","name":"Send AI Menu Report to Slack","type":"n8n-nodes-base.slack","position":[-80,1040],"webhookId":"b2c6e940-bd9c-4d3d-9c27-68813541f4b5","parameters":{"text":"ã€çŒ®ç«‹æ”¹å–„ãƒ¬ãƒãƒ¼ãƒˆã€‘AIè³¢è€…ã®åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸã€‚","user":{"__rl":true,"mode":"list","value":"U09RNMU4BL0","cachedResultName":"chinatsu.y.natty"},"select":"user","otherOptions":{},"authentication":"oAuth2"},"credentials":{"slackOAuth2Api":{"id":"RWF938uw1j6rNuhN","name":"Slack account"}},"typeVersion":2.3},{"id":"43b7e354-e940-43ad-81d6-10abfd5d44cf","name":"On Workflow Error","type":"n8n-nodes-base.errorTrigger","position":[-1616,1216],"parameters":{},"typeVersion":1},{"id":"a17b4798-6832-48a6-928a-120f03c2ca7e","name":"Send Error Alert to Slack","type":"n8n-nodes-base.slack","position":[-1392,1216],"webhookId":"52074a78-8566-42e9-b54f-1bc8b4890159","parameters":{"text":"=ğŸš¨ã€ç·Šæ€¥ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã€‘ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€Œé‰„å£ã®å®ˆã‚Šã€ã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸï¼\n\næ „é¤Šå£«æ§˜\n\nè‡ªå‹•ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒã‚§ãƒƒã‚¯ã®é€”ä¸­ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸã€‚\nãŠæ‰‹æ•°ã§ã™ãŒã€è‡³æ€¥n8nã®ç”»é¢ã‚’ã”ç¢ºèªãã ã•ã„ã€‚\n\n---\nâ–¼ ã‚¨ãƒ©ãƒ¼è©³ç´° â–¼\n---\nã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãƒãƒ¼ãƒ‰:\n{{ $json.error.node.name }}\n\nã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:\n{{ $json.error.message }}\n\nç™ºç”Ÿæ™‚åˆ»:\n{{ $now.toFormat('yyyy-MM-dd HH:mm:ss') }}\n\nâ–¼ å®Ÿè¡Œæƒ…å ± â–¼\nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å: {{ $json.workflow.name }}\nå®Ÿè¡ŒID:\n{{ $json.execution.id }}\n---","user":{"__rl":true,"mode":"list","value":"U09RNMU4BL0","cachedResultName":"chinatsu.y.natty"},"select":"user","otherOptions":{},"authentication":"oAuth2"},"credentials":{"slackOAuth2Api":{"id":"RWF938uw1j6rNuhN","name":"Slack account"}},"typeVersion":2.3},{"id":"62a73064-e95e-4163-bba7-a3bab56abef0","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[-976,496],"parameters":{"color":7,"width":400,"height":352,"content":"## ğŸ§  Logic & Matching\nCombines the datasets and checks if any student has an allergy to the scheduled menu ingredients. Matches flow to the alert branches."},"typeVersion":1},{"id":"2b8dc11a-9ee5-4442-9205-c25570d20c8c","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[-1680,368],"parameters":{"color":7,"width":688,"height":672,"content":"## ğŸ“¥ Data Ingestion & Formatting\nReads Menu, Student, and Teacher data from Google Sheets and formats them for processing.\n*Note: Update the Sheet nodes with your specific file IDs.*"},"typeVersion":1},{"id":"2758e4c4-c46b-4f82-afa2-2974f0ac9f0c","name":"Sticky Note10","type":"n8n-nodes-base.stickyNote","position":[-528,192],"parameters":{"color":7,"width":736,"height":336,"content":"## ğŸ“¨ Standard Notification & Logging\nSends a template-based warning to the teacher and logs the incident details to Google Drive for audit records."},"typeVersion":1},{"id":"05d94da2-3b67-422f-9596-60e18df9ffbd","name":"Sticky Note13","type":"n8n-nodes-base.stickyNote","position":[-528,544],"parameters":{"color":7,"width":736,"height":880,"content":"## ğŸ¤– AI Agents (Alerts & Reports)\nUses an LLM to generate context-aware warnings for teachers and a strategic menu improvement report for the nutritionist."},"typeVersion":1},{"id":"1ed6f02f-7cab-4ed7-9499-cd782d07c9bf","name":"Sticky Note18","type":"n8n-nodes-base.stickyNote","position":[-1680,1104],"parameters":{"color":7,"width":544,"height":288,"content":"## ğŸ›¡ï¸ Error Handling\nCaptures any workflow failures and instantly notifies the admin via Slack to ensure system reliability."},"typeVersion":1},{"id":"5e5cb2f9-c83c-41a0-9508-7073801edf07","name":"Sticky Note20","type":"n8n-nodes-base.stickyNote","position":[-2160,400],"parameters":{"width":304,"height":688,"content":"## ğŸ± School Lunch Allergy Assistant\nThis workflow automates allergy checks for school lunches. It cross-references menu items with student allergy records to prevent accidents and suggests safer menu alternatives using AI.\n\n### Key Features\n*   **Auto-Detection:** Matches daily menus against student allergies.\n*   **Dual Alerts:** Sends basic and AI-enhanced warnings to teachers via Slack.\n*   **AI Menu Analysis:** Generates a proactive report for nutritionists to reduce high-risk days.\n*   **Audit Log:** Saves all alerts to Google Drive.\n\n### Setup Guide\n1.  **Credentials:** Configure Google (Sheets/Drive) and Slack accounts.\n2.  **Google Sheets:** Update the `Read` nodes with your specific Sheet IDs for Menus, Allergies, and Teachers.\n3.  **Slack:** Select the target User/Channel in all Slack nodes.\n4.  **Google Drive:** Select the destination folder in the `Log Alert` node."},"typeVersion":1}],"active":false,"pinData":{},"settings":{"executionOrder":"v1"},"versionId":"fe5d09c5-65ee-473c-8cc4-fbd4b11cc958","connections":{"Merge All Data":{"main":[[{"node":"Check for Allergy Match","type":"main","index":0}]]},"Format Menu Data":{"main":[[{"node":"Merge All Data","type":"main","index":0}]]},"On Workflow Error":{"main":[[{"node":"Send Error Alert to Slack","type":"main","index":0}]]},"Read Monthly Menu":{"main":[[{"node":"Format Menu Data","type":"main","index":0}]]},"Read Teacher List":{"main":[[{"node":"Format Teacher Data","type":"main","index":0}]]},"Format Student Data":{"main":[[{"node":"Merge All Data","type":"main","index":1}]]},"Format Teacher Data":{"main":[[{"node":"Merge All Data","type":"main","index":2}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Generate AI Alert Message","type":"ai_languageModel","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"Generate AI Menu Report","type":"ai_languageModel","index":0}]]},"Send Basic Slack Alert":{"main":[[{"node":"Log Alert to Google Drive","type":"main","index":0}]]},"Check for Allergy Match":{"main":[[{"node":"Compose Basic Alert Message","type":"main","index":0},{"node":"Generate AI Alert Message","type":"main","index":0},{"node":"Generate AI Menu Report","type":"main","index":0}]]},"Generate AI Menu Report":{"main":[[{"node":"Send AI Menu Report to Slack","type":"main","index":0}]]},"Generate AI Alert Message":{"main":[[{"node":"Send AI Slack Alert","type":"main","index":0}]]},"Read Student Allergy List":{"main":[[{"node":"Format Student Data","type":"main","index":0}]]},"Compose Basic Alert Message":{"main":[[{"node":"Send Basic Slack Alert","type":"main","index":0}]]},"Manual Trigger (The Initiator)":{"main":[[{"node":"Read Student Allergy List","type":"main","index":0},{"node":"Read Monthly Menu","type":"main","index":0},{"node":"Read Teacher List","type":"main","index":0}]]}}}