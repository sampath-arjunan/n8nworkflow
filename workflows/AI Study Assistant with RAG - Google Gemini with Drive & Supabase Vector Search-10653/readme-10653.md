AI Study Assistant with RAG - Google Gemini with Drive & Supabase Vector Search

https://n8nworkflows.xyz/workflows/ai-study-assistant-with-rag---google-gemini-with-drive---supabase-vector-search-10653


# AI Study Assistant with RAG - Google Gemini with Drive & Supabase Vector Search

### 1. Workflow Overview

This workflow implements an **AI Study Assistant** using Retrieval-Augmented Generation (RAG) with Google Gemini and Supabase vector search for document semantic retrieval. Its purpose is to enable users to interact conversationally with their personal study materials stored in Google Drive, automatically ingesting files into a vector database and answering queries based on those documents.

**Target Use Cases:**

- Conversational study assistant that answers questions from user-uploaded documents.
- Automatic ingestion and embedding of Google Drive folder contents for semantic search.
- Persistent chat memory for conversational context.
- Support for natural language queries and mathematical computations.

**Logical Blocks:**

- **1.1 Chat Input Reception and AI Agent Orchestration:** Receives chat messages, triggers AI agent, routes queries to memory, search, or tools.
- **1.2 Vector Search and Embeddings:** Handles semantic search using Supabase vector store and embeddings generated by Google Gemini.
- **1.3 Drive Folder Processing Sub-Workflow:** Parses Drive folder links, lists and downloads files, extracts text, embeds content, and stores embeddings.
- **1.4 Chat Memory Management:** Stores and retrieves conversation history using Postgres chat memory.
- **1.5 Tool Integration:** Calculator and file ingestion tools to support agent capabilities.

---

### 2. Block-by-Block Analysis

#### 1.1 Chat Input Reception and AI Agent Orchestration

**Overview:**  
This block listens for incoming chat messages, sends them to the core AI agent which orchestrates responses by querying the vector store, memory, and tools, including automatic Drive link ingestion.

**Nodes Involved:**  
- When chat message received  
- Study Agent  
- Google Gemini Chat Model  
- Supabase Vector Store  
- Calculator  
- Postgres Chat Memory

**Node Details:**

- **When chat message received**  
  - Type: Chat Trigger  
  - Role: Entry point listening for incoming user chat messages via webhook.  
  - Config: Public webhook, no auth.  
  - Outputs to: Study Agent  
  - Edge cases: Missing input or malformed chat messages.

- **Study Agent**  
  - Type: LangChain Agent  
  - Role: Core orchestrator AI agent processing chat input, managing tools and memory.  
  - Config: Receives `chatInput` from webhook; system message defines behavior as a friendly study assistant that automatically handles Drive links (detecting Drive URLs, triggering ingestion workflow), conducts vector searches, maintains conversation context, and uses Google Gemini 2.5 Pro model for responses.  
  - Inputs: Chat messages  
  - Outputs: AI-generated responses  
  - Tools integrated: Calculator, Supabase Vector Store, Drive Folder ingestion workflow  
  - Edge cases: Failure to detect Drive URLs, API timeouts from Gemini or vector store.

- **Google Gemini Chat Model**  
  - Type: Language Model (Google Gemini)  
  - Role: Generates conversational AI responses using Gemini-2.5-Pro model.  
  - Config: Model name set to `models/gemini-2.5-pro`.  
  - Inputs: Prompt from Study Agent  
  - Outputs: AI responses  
  - Edge cases: API quota limits, network errors.

- **Supabase Vector Store**  
  - Type: Vector Store Tool  
  - Role: Retrieves relevant documents from vector database to answer queries.  
  - Config: Retrieval mode as a tool with table `documents`, semantic search with 768-dim embeddings.  
  - Inputs: Query text from Study Agent  
  - Outputs: Retrieved documents for AI to use  
  - Edge cases: Connection errors, empty results.

- **Calculator**  
  - Type: Tool Calculator  
  - Role: Performs math calculations requested during chat.  
  - Inputs: Calculation requests from Study Agent  
  - Outputs: Computed results  
  - Edge cases: Invalid math expressions.

- **Postgres Chat Memory**  
  - Type: Memory Management (Postgres)  
  - Role: Persists conversational context using session key (`sessionId` from chat).  
  - Config: Context window length 10 messages, uses custom session key.  
  - Inputs: Chat messages and AI responses  
  - Outputs: Context for Study Agent  
  - Edge cases: Database connection failure.

---

#### 1.2 Vector Search and Embeddings

**Overview:**  
This block covers embedding generation from text and vector search retrieval in Supabase.

**Nodes Involved:**  
- Embeddings Google Gemini  
- Supabase Vector Store

**Node Details:**

- **Embeddings Google Gemini**  
  - Type: Embeddings Generator  
  - Role: Converts text into 768-dimensional vector embeddings using Google Gemini API.  
  - Config: Uses Google Palm API credentials (Gemini) with default parameters.  
  - Inputs: Text documents or queries  
  - Outputs: Embeddings for indexing or search  
  - Edge cases: API request failures, text length limits.

- **Supabase Vector Store**  
  - See description above in Block 1.1.

---

#### 1.3 Drive Folder Processing Sub-Workflow

**Overview:**  
Triggered when a Google Drive folder or file link is detected in chat. This sub-workflow extracts folder/file IDs, lists files, downloads and converts them to text, generates embeddings, and inserts vector data into Supabase for RAG.

**Nodes Involved:**  
- When Executed by Another Workflow  
- Code in JavaScript  
- Execute a SQL query  
- Search files and folders (Google Drive)  
- Loop Over Items  
- Download File (Google Drive)  
- Embeddings Google Gemini4  
- Insert into Supabase Vectorstore  
- Default Data Loader2

**Node Details:**

- **When Executed by Another Workflow**  
  - Type: Execute Workflow Trigger  
  - Role: Entry point for this sub-workflow when invoked by the AI agent.  
  - Inputs: JSON with `Drive_Folder_link` URL.  
  - Outputs: To Code in JavaScript node.

- **Code in JavaScript**  
  - Type: Code Node (JS)  
  - Role: Extracts Google Drive folder or file ID from URL using regex.  
  - Key logic: Matches `/folders/` or `/file/d/` patterns to extract ID.  
  - Outputs: JSON with `folderId` and `driveId`.  
  - Edge cases: Invalid or malformed Drive URLs.

- **Execute a SQL query**  
  - Type: Postgres Node  
  - Role: Initializes Supabase Postgres database for vector storage.  
  - Config: Drops existing `documents` table, creates with `pgvector` extension, defines `match_documents` function for similarity search.  
  - Edge cases: Data loss warning due to DROP TABLE, SQL permission errors.

- **Search files and folders**  
  - Type: Google Drive API Node  
  - Role: Lists all files and folders inside the specified Drive folder ID.  
  - Inputs: Folder ID from Code in JavaScript node.  
  - Outputs: List of file metadata to Loop Over Items node.  
  - Edge cases: Permission errors, empty folder.

- **Loop Over Items**  
  - Type: SplitInBatches  
  - Role: Iterates over each file in folder for processing.  
  - Outputs: Downloads each file.

- **Download File**  
  - Type: Google Drive API Node  
  - Role: Downloads each file, converting Google Docs to plaintext.  
  - Config: Conversion option set for Google Docs to `text/plain`.  
  - Outputs: Binary file content.  
  - Edge cases: Unsupported file types, download failures.

- **Default Data Loader2**  
  - Type: Document Data Loader  
  - Role: Extracts and formats text from binary files for embedding.  
  - Inputs: Binary file content.  
  - Outputs: Text ready for embedding.

- **Embeddings Google Gemini4**  
  - Type: Embeddings Generator  
  - Role: Generates vector embeddings for each document chunk.  
  - Inputs: Text from Data Loader.  
  - Outputs: Embeddings for insertion.

- **Insert into Supabase Vectorstore**  
  - Type: Vector Store Insert  
  - Role: Inserts documents and embeddings into Supabase `documents` table for semantic search.  
  - Config: Uses `match_documents` query for future retrieval.  
  - Edge cases: DB connection issues, duplicate data.

---

#### 1.4 Chat Memory Management

**Overview:**  
Manages persistent chat history to provide context for AI responses.

**Nodes Involved:**  
- Postgres Chat Memory (also linked to Study Agent in 1.1)

**Node Details:**  
- See description in Block 1.1.

---

#### 1.5 Tool Integration - Calculator and Drive Folder Uploader

**Overview:**  
Supports AI agent with math calculation and automated Drive folder ingestion.

**Nodes Involved:**  
- Calculator  
- Folder all file to vector (calls Drive to Supabase sub-workflow)

**Node Details:**

- **Calculator**  
  - See description in Block 1.1.

- **Folder all file to vector**  
  - Type: Tool Workflow  
  - Role: Invokes the Drive folder processing sub-workflow to ingest files from shared Drive links.  
  - Input: `Drive_Folder_link` string extracted from chat.  
  - Outputs: Triggers indexing and embedding insertion.  
  - Edge cases: Workflow ID must remain valid; input Drive links must be correct.

---

### 3. Summary Table

| Node Name                   | Node Type                                 | Functional Role                                            | Input Node(s)                          | Output Node(s)                      | Sticky Note                                                                                     |
|-----------------------------|-------------------------------------------|------------------------------------------------------------|--------------------------------------|------------------------------------|------------------------------------------------------------------------------------------------|
| When chat message received  | Chat Trigger                              | Receives chat input                                         | -                                    | Study Agent                       |                                                                                                |
| Study Agent                 | LangChain Agent                          | Core AI orchestrator handling chat, tools, memory          | When chat message received, Calculator, Supabase Vector Store, Folder all file to vector | Google Gemini Chat Model           | **AI Agent (Core)** - Orchestrates all tools and memory. Handles Drive links, searches documents, maintains context, and responds naturally using Gemini 2.5 Pro. |
| Google Gemini Chat Model    | Language Model (Google Gemini)            | Generates AI responses based on prompts                     | Study Agent                          | Study Agent                       |                                                                                                |
| Supabase Vector Store       | Vector Store Tool                         | Retrieves relevant documents via semantic search           | Embeddings Google Gemini, Study Agent | Study Agent                       | **Document Search Tool** - Retrieves relevant information from uploaded study materials using semantic similarity search with 768-dim embeddings.              |
| Calculator                 | Tool Calculator                           | Performs math operations                                    | Study Agent                         | Study Agent                       |                                                                                                |
| Postgres Chat Memory       | Memory Management (Postgres)               | Stores and retrieves chat conversation context              | Study Agent                         | Study Agent                       |                                                                                                |
| Folder all file to vector  | Tool Workflow                            | Starts Drive folder ingestion sub-workflow                  | Study Agent                         | Study Agent                       | **Drive Uploader Tool** - When user shares a Drive link in chat, automatically triggers the indexing workflow to add files to vector store.                   |
| When Executed by Another Workflow | Execute Workflow Trigger               | Entry for Drive folder ingestion sub-workflow               | -                                   | Code in JavaScript                | **Trigger Node** - Starts workflow when called from another n8n workflow. Accepts Drive folder URL as input.                                               |
| Code in JavaScript          | Code Node (JavaScript)                    | Extracts folder/file ID from Drive URL                       | When Executed by Another Workflow    | Execute a SQL query               | **Extract Folder ID** - Parses Google Drive URL using regex to extract folder/file ID for API calls.                                                       |
| Execute a SQL query         | Postgres Node                            | Initializes Supabase vector database and search function    | Code in JavaScript                   | Search files and folders          | **Initialize Database** - Creates Supabase vector table with pgvector extension and match_documents search function. ‚ö†Ô∏è Drops existing table!               |
| Search files and folders    | Google Drive API Node                     | Lists files/folders inside Drive folder                      | Execute a SQL query                  | Loop Over Items                  | **List Drive Files** - Retrieves all files from the specified Google Drive folder using extracted folder ID.                                                |
| Loop Over Items             | SplitInBatches                          | Iterates over files for processing                           | Search files and folders             | Download File                   |                                                                                                |
| Download File               | Google Drive API Node                     | Downloads each file, converts Google Docs to plaintext      | Loop Over Items                     | Insert into Supabase Vectorstore | **List Drive Files** - Retrieves all files from the specified Google Drive folder using extracted folder ID.                                                |
| Default Data Loader2        | Document Data Loader                     | Extracts text from downloaded files                          | Download File                      | Insert into Supabase Vectorstore | **Store Embeddings** - Generates 768-dim vectors via Gemini and inserts documents into Supabase for semantic search. **AI Embeddings** - Converts text to 768-dimensional vectors using Google Gemini text-embedding-004 model. **Document Loader** - Extracts and formats text from binary files for the embedding generator. |
| Embeddings Google Gemini4   | Embeddings Generator (Google Gemini)     | Generates vector embeddings from text                        | Default Data Loader2                | Insert into Supabase Vectorstore |                                                                                                |
| Insert into Supabase Vectorstore | Vector Store Insert                    | Inserts embeddings and documents into Supabase vector DB    | Embeddings Google Gemini4, Download File | Loop Over Items                  |                                                                                                |
| Sticky Note                 | Sticky Note                              | Documentation and overview                                  | -                                   | -                                | # ü§ñ AI Study Assistant (RAG Chat) Purpose and flow overview.                                   |
| Sticky Note1                | Sticky Note                              | AI Agent core explanation                                   | -                                   | -                                | **AI Agent (Core)** - Orchestrates all tools and memory. Handles Drive links, searches documents, maintains context, and responds naturally using Gemini 2.5 Pro. |
| Sticky Note2                | Sticky Note                              | Document search tool explanation                            | -                                   | -                                | **Document Search Tool** - Retrieves relevant information from uploaded study materials using semantic similarity search with 768-dim embeddings.              |
| Sticky Note3                | Sticky Note                              | Drive uploader tool explanation                             | -                                   | -                                | **Drive Uploader Tool** - When user shares a Drive link in chat, automatically triggers the indexing workflow to add files to vector store.                   |
| Sticky Note4                | Sticky Note                              | List Drive files explanation                                | -                                   | -                                | **List Drive Files** - Retrieves all files from the specified Google Drive folder using extracted folder ID.                                                |
| Sticky Note5                | Sticky Note                              | List Drive files explanation (duplicate)                   | -                                   | -                                | **List Drive Files** - Retrieves all files from the specified Google Drive folder using extracted folder ID.                                                |
| Sticky Note6                | Sticky Note                              | Embeddings and document storage explanation                | -                                   | -                                | **Store Embeddings** - Generates 768-dim vectors via Gemini and inserts documents into Supabase for semantic search. **AI Embeddings** - Converts text to 768-dimensional vectors using Google Gemini text-embedding-004 model. **Document Loader** - Extracts and formats text from binary files for the embedding generator. |
| Sticky Note7                | Sticky Note                              | Drive to Supabase vector store sub-workflow overview       | -                                   | -                                | # üìÅ Drive to Supabase Vector Store for Study RAG - detailed flow and requirements.                 |
| Sticky Note8                | Sticky Note                              | Trigger node explanation                                   | -                                   | -                                | **Trigger Node** - Starts workflow when called from another n8n workflow. Accepts Drive folder URL as input.                                               |
| Sticky Note9                | Sticky Note                              | Extract folder ID explanation                              | -                                   | -                                | **Extract Folder ID** - Parses Google Drive URL using regex to extract folder/file ID for API calls.                                                       |
| Sticky Note10               | Sticky Note                              | Database initialization explanation                        | -                                   | -                                | **Initialize Database** - Creates Supabase vector table with pgvector extension and match_documents search function. ‚ö†Ô∏è Drops existing table!               |

---

### 4. Reproducing the Workflow from Scratch

1. **Create a Webhook Trigger Node: "When chat message received"**  
   - Type: LangChain Chat Trigger  
   - Configure as public webhook (no authentication)  
   - This node will receive user chat messages.

2. **Add "Study Agent" Node**  
   - Type: LangChain Agent  
   - Input: Connect from "When chat message received"  
   - Set `text` parameter to `{{$json.chatInput}}`  
   - Configure system message with detailed assistant instructions (see 2.1) to handle Drive links, vector search, conversation context, and friendly responses.  
   - Add integrated tools: Calculator, Supabase Vector Store, and Drive folder ingestion workflow as tools.  
   - Use Google Gemini Chat Model as language model.

3. **Add "Google Gemini Chat Model" Node**  
   - Type: LangChain LM Chat Google Gemini  
   - Model name: `models/gemini-2.5-pro`  
   - Credential: Google Palm API with Gemini key  
   - Connect output to Study Agent for language model input.

4. **Add "Supabase Vector Store" Node**  
   - Type: LangChain Vector Store Supabase  
   - Mode: Retrieve-as-tool  
   - Table: `documents`  
   - Credential: Supabase account credentials  
   - Connect output to Study Agent AI tool input.

5. **Add "Calculator" Node**  
   - Type: LangChain Tool Calculator  
   - Connect output to Study Agent AI tool input.

6. **Add "Postgres Chat Memory" Node**  
   - Type: LangChain Memory Postgres Chat  
   - Session key: `={{ $json.sessionId }}`  
   - Context window length: 10  
   - Credential: Postgres account  
   - Connect output to Study Agent AI memory input.

7. **Add "Folder all file to vector" Node**  
   - Type: Tool Workflow  
   - Workflow ID: The ID of the Drive to Supabase ingestion sub-workflow (see below)  
   - Input schema: string parameter `Drive_Folder_link`  
   - Connect output to Study Agent AI tool input.

---

**Drive Folder Processing Sub-Workflow:**

8. **Create a new workflow triggered by "When Executed by Another Workflow" Node**  
   - Input JSON: expects `{"Drive_Folder_link": "https://drive.google.com/drive/folders/..."}`

9. **Add "Code in JavaScript" Node**  
   - Extract folder or file ID from Drive URL using regex matching `/folders/` and `/file/d/`  
   - Outputs JSON with `folderId` and `driveId`.

10. **Add "Execute a SQL query" Node**  
    - Connect from Code node  
    - Query: Drops and recreates `documents` table with `pgvector` extension and search function `match_documents`  
    - Credential: Postgres account

11. **Add "Search files and folders" Node**  
    - Type: Google Drive API Node (fileFolder resource)  
    - Filter folderId: `={{ $('Code in JavaScript').item.json.folderId }}`  
    - Credential: Google Drive OAuth2  
    - Connect output to Loop Over Items node.

12. **Add "Loop Over Items" Node**  
    - Type: SplitInBatches  
    - Connect output to Download File node.

13. **Add "Download File" Node**  
    - Type: Google Drive API Node (download operation)  
    - File ID: `={{ $json.id }}`  
    - Conversion: Google Docs to `text/plain`  
    - Credential: Google Drive OAuth2  
    - Connect output to Default Data Loader2.

14. **Add "Default Data Loader2" Node**  
    - Type: Document Default Data Loader  
    - Data Type: Binary  
    - Connect output to Embeddings Google Gemini4.

15. **Add "Embeddings Google Gemini4" Node**  
    - Type: LangChain Embeddings Google Gemini  
    - Credential: Google Palm API (Gemini key)  
    - Connect output to Insert into Supabase Vectorstore.

16. **Add "Insert into Supabase Vectorstore" Node**  
    - Type: LangChain Vector Store Supabase (Insert mode)  
    - Table: `documents`  
    - Credential: Supabase account  
    - Connect output back to Loop Over Items to continue batch processing.

---

### 5. General Notes & Resources

| Note Content                                                                                                  | Context or Link                                                                                         |
|---------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| AI Study Assistant (RAG Chat) enables natural conversation with uploaded study materials, auto Drive processing | Sticky Note content in workflow overview section                                                     |
| Drive folder ingestion sub-workflow requires Google Drive OAuth2 credentials and Supabase + Postgres accounts | Sticky Note7                                                                                          |
| Database initialization drops existing `documents` table, exercise caution when running                       | Sticky Note10                                                                                         |
| Use Google Gemini 2.5 Pro model for chat; Google Gemini text-embedding-004 for embeddings                      | Node configuration details                                                                            |
| Semantic search uses 768-dimensional embeddings stored in Supabase vector column with pgvector extension       | SQL query in Execute a SQL query node                                                                |
| Workflow links and IDs should be carefully preserved when importing/exporting workflows                        | Folder all file to vector node and sub-workflow invocation                                           |

---

**Disclaimer:**  
This document strictly describes an n8n workflow automating an AI Study Assistant using Google Gemini and Supabase vector search. It complies with current content policies and handles only public and legal data sources.