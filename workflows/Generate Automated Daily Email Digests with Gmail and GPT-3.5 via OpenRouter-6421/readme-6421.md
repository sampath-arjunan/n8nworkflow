Generate Automated Daily Email Digests with Gmail and GPT-3.5 via OpenRouter

https://n8nworkflows.xyz/workflows/generate-automated-daily-email-digests-with-gmail-and-gpt-3-5-via-openrouter-6421


# Generate Automated Daily Email Digests with Gmail and GPT-3.5 via OpenRouter

### 1. Workflow Overview

This workflow automates the generation and sending of a daily email digest summarizing emails received in the last 24 hours via Gmail. It is designed to provide professionals, managers, or anyone interested with a concise summary of important email content, key topics, action items, and deadlines extracted using AI (GPT-3.5 via OpenRouter). The digest is generated and sent automatically every day at a scheduled time.

**Logical Blocks:**

- **1.1 Schedule Trigger:** Initiates the workflow daily at 7 AM.
- **1.2 Date Calculation & Query Generation:** Computes yesterday’s date and constructs a Gmail search query to fetch emails from the last 24 hours.
- **1.3 Email Retrieval:** Uses the Gmail API to fetch all emails matching the constructed query.
- **1.4 Data Aggregation:** Consolidates key email fields (From, To, Subject, snippet, CC) from the retrieved emails.
- **1.5 AI Processing & Summarization:** Uses LangChain with OpenRouter’s GPT-3.5 model to analyze aggregated email data, extracting key topics, action items, deadlines, and generating a clear summary.
- **1.6 Email Sending:** Sends the summarized digest back to the recipient via Gmail.

---

### 2. Block-by-Block Analysis

#### 2.1 Schedule Trigger

- **Overview:** Automatically triggers the workflow every day at 7 AM to start the email digest generation.
- **Nodes Involved:** Schedule Trigger
- **Node Details:**
  - **Type:** Schedule Trigger
  - **Role:** Initiates workflow at specified time.
  - **Configuration:** Set to trigger at hour 7 (7:00 AM daily).
  - **Inputs:** None (trigger node).
  - **Outputs:** Connected to "Fetch Yeasterday's Date" node.
  - **Version:** 1.2
  - **Edge cases:** Workflow won't run if n8n instance is offline or if scheduling service fails.

#### 2.2 Date Calculation & Query Generation

- **Overview:** Calculates the date for “yesterday” and constructs a Gmail search query string to retrieve emails received after that date.
- **Nodes Involved:** Fetch Yeasterday's Date
- **Node Details:**
  - **Type:** Code node (JavaScript)
  - **Role:** Generates search query string using yesterday’s date and a placeholder for user email.
  - **Configuration:** 
    - JavaScript code sets date to yesterday, formats as YYYY/MM/DD.
    - Constructs query string in format: `<Your Email ID> after:YYYY/MM/DD`
    - Output JSON contains `searchQuery` for use by Gmail node.
  - **Key Expressions:** None beyond code output.
  - **Inputs:** From Schedule Trigger.
  - **Outputs:** To "Fetch Email Which is Unread".
  - **Version:** 2
  - **Edge cases:** If system date/time is incorrect, query may be off; user must replace `<Your Email ID>` with actual email address, or query will fail or return no results.

#### 2.3 Email Retrieval

- **Overview:** Retrieves all emails from Gmail matching the search query generated by the previous node.
- **Nodes Involved:** Fetch Email Which is Unread
- **Node Details:**
  - **Type:** Gmail node
  - **Role:** Retrieves emails via Gmail API based on query.
  - **Configuration:**
    - Operation: `getAll` to fetch all matching messages.
    - Filter query: Dynamic expression `={{ $json.searchQuery }}` from code node.
    - Return all results enabled.
  - **Inputs:** From "Fetch Yeasterday's Date".
  - **Outputs:** To "Aggregate".
  - **Version:** 2.1
  - **Edge cases:** 
    - Gmail API rate limits or quota issues.
    - OAuth2 authentication failure or expired token.
    - Query returns no emails, resulting in empty dataset downstream.
    - Network or API timeout errors.

#### 2.4 Data Aggregation

- **Overview:** Aggregates and consolidates relevant fields from all fetched emails into a single data structure for AI processing.
- **Nodes Involved:** Aggregate
- **Node Details:**
  - **Type:** Aggregate node
  - **Role:** Combines all email items into one aggregated output.
  - **Configuration:**
    - Aggregate all item data into a single object.
    - Includes specified fields only: `id, From, To, Subject, snippet, CC`.
    - Binaries excluded.
  - **Inputs:** From "Fetch Email Which is Unread".
  - **Outputs:** To "Summary" node.
  - **Version:** 1
  - **Edge cases:**
    - If no emails fetched, aggregation output may be empty or null.
    - Malformed or missing fields in emails could cause incomplete aggregation.

#### 2.5 AI Processing & Summarization

- **Overview:** Uses LangChain’s AI Agent connected to OpenRouter GPT-3.5 to analyze aggregated email data and produce a structured summary highlighting key points, action items, deadlines, and follow-ups.
- **Nodes Involved:** Summary, OpenRouter Chat Model
- **Node Details:**

  - **Summary Node:**
    - **Type:** LangChain Agent node
    - **Role:** Processes text input with AI prompt, generates digest summary.
    - **Configuration:**
      - Input text: `={{ $json.data }}` (aggregated email data).
      - System message prompt: Detailed instructions for extracting key details, organizing output, clarity rules, and example output format.
      - Prompt type: `define` (fixed prompt).
    - Inputs: From "Aggregate".
    - Outputs: To "Send A email of Summary".
    - Version: 2
    - Edge cases:
      - AI model errors or timeouts.
      - Poor input data quality leading to incomplete or inaccurate summaries.
      - Rate limits or API key issues with OpenRouter.
  
  - **OpenRouter Chat Model Node:**
    - **Type:** LangChain OpenRouter Chat Model node
    - **Role:** AI language model provider node for GPT-3.5.
    - Configuration:
      - Model: `openai/gpt-3.5-turbo`.
      - No additional options specified.
    - Inputs: Connected as AI language model for "Summary" node.
    - Outputs: To "Summary" node (provides AI responses).
    - Version: 1
    - Edge cases:
      - Credential misconfiguration.
      - API key invalid or expired.
      - Network failures.

#### 2.6 Email Sending

- **Overview:** Sends the AI-generated summary digest as an email to the intended recipient.
- **Nodes Involved:** Send A email of Summary
- **Node Details:**
  - **Type:** Gmail node
  - **Role:** Sends email via Gmail API.
  - **Configuration:**
    - SendTo: Dynamic expression `={{ $('Aggregate').item.json.data[1].To }}`, extracting recipient from aggregated data.
    - Message body: Dynamic expression `={{ $json.output }}` containing AI summary.
    - Subject: Static text "Summary Of Emails Last 24 Hours".
    - Email type: text.
    - Option to disable attribution appended.
  - Inputs: From "Summary".
  - Outputs: None (end node).
  - Version: 2.1
  - Edge cases:
    - Incorrect recipient extraction may send to wrong address or fail.
    - Gmail API failures or permission issues.
    - Sending limits exceeded.
    - Empty or malformed message body.

---

### 3. Summary Table

| Node Name                 | Node Type                               | Functional Role                    | Input Node(s)               | Output Node(s)               | Sticky Note                                                                                                                           |
|---------------------------|----------------------------------------|----------------------------------|-----------------------------|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| Schedule Trigger           | Schedule Trigger                       | Initiates daily workflow          | None                        | Fetch Yeasterday's Date       | See sticky note for overall workflow overview and setup instructions.                                                                  |
| Fetch Yeasterday's Date    | Code                                  | Generates Gmail search query      | Schedule Trigger             | Fetch Email Which is Unread  | See sticky note for overall workflow overview and setup instructions.                                                                  |
| Fetch Email Which is Unread| Gmail                                 | Retrieves emails from Gmail       | Fetch Yeasterday's Date      | Aggregate                   | See sticky note for overall workflow overview and setup instructions.                                                                  |
| Aggregate                 | Aggregate                             | Aggregates email fields           | Fetch Email Which is Unread  | Summary                     | See sticky note for overall workflow overview and setup instructions.                                                                  |
| Summary                   | LangChain Agent                       | AI analyzes and summarizes emails | Aggregate                   | Send A email of Summary      | See sticky note for overall workflow overview and setup instructions.                                                                  |
| OpenRouter Chat Model     | LangChain OpenRouter Chat Model      | Provides GPT-3.5 AI model         | Connected as AI model to Summary | Summary                 | See sticky note for overall workflow overview and setup instructions.                                                                  |
| Send A email of Summary   | Gmail                                | Sends summary email               | Summary                     | None                        | See sticky note for overall workflow overview and setup instructions.                                                                  |
| Sticky Note               | Sticky Note                          | Documentation and overview        | None                        | None                        | ## Daily Email Digest - Workflow Overview<br>This workflow automates sending a daily summary email digest based on Gmail messages matching a specific query.<br><br>## How it works:<br>- Schedule Trigger fires every day at 7 AM to start the workflow automatically.<br>- The Code node generates a Gmail search query for emails from the last 24 hours for a specified email address.<br>- Get many messages node queries Gmail using this search string and retrieves all matching emails.<br>- Aggregate node consolidates email data, extracting fields like From, To, Subject, snippet, and CC.<br>- AI Agent powered by LangChain & OpenRouter analyzes aggregated email data to:<br>- Extract key topics, action items, and deadlines<br>- Summarize critical info clearly and concisely<br>- The summarized digest is sent via Gmail’s Send a message node to the recipient.<br><br>## Ideal for:<br>- Professionals wanting quick daily email summaries<br>- Managers tracking team or client communications<br>- Anyone who wants to stay updated without reading all emails<br>- Automating email triage and follow-ups<br><br>## What you need:<br>- n8n instance with internet access<br>- Gmail account with OAuth2 credentials configured in n8n<br>- OpenRouter API key connected to LangChain nodes<br>- Update the email address in the Code node to target your inbox<br><br>## Notes:<br>- Customize the AI Agent prompt to change summary style or details<br>- Ensure proper permissions/scopes granted to Gmail API for reading and sending emails<br>- Set the schedule trigger time to your preferred daily digest time |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Schedule Trigger Node**
   - Type: Schedule Trigger
   - Set to trigger at 7:00 AM daily (triggerAtHour = 7).
   - No credentials needed.
   - Connect output to "Fetch Yeasterday's Date".

2. **Create Code Node to Calculate Yesterday’s Date and Generate Query**
   - Type: Code (JavaScript)
   - Insert code:
     ```js
     const yesterday = new Date();
     yesterday.setDate(yesterday.getDate() - 1);

     const year = yesterday.getFullYear();
     const month = (yesterday.getMonth() + 1).toString().padStart(2, '0');
     const day = yesterday.getDate().toString().padStart(2, '0');

     const searchQuery = `<Your Email ID> after:${year}/${month}/${day}`;

     return [
       {
         json: {
           searchQuery,
         },
       },
     ];
     ```
   - Replace `<Your Email ID>` with your actual Gmail address.
   - Connect output to "Fetch Email Which is Unread".

3. **Create Gmail Node to Fetch Emails**
   - Type: Gmail
   - Operation: `getAll`
   - Filters: Set `q` parameter to expression `={{ $json.searchQuery }}`
   - Return all: enabled
   - OAuth2 credentials: Configure with Gmail OAuth2 with read scope.
   - Connect output to "Aggregate".

4. **Create Aggregate Node**
   - Type: Aggregate
   - Aggregate: Aggregate all item data into one object.
   - Fields to include: `id, From, To, Subject, snippet, CC`
   - Include binaries: false
   - Connect output to "Summary" node.

5. **Create LangChain OpenRouter Chat Model Node**
   - Type: LangChain Chat Model (OpenRouter)
   - Model: `openai/gpt-3.5-turbo`
   - Credentials: Configure OpenRouter API key with access to OpenAI GPT-3.5.
   - Connect as AI language model input to "Summary" node.

6. **Create LangChain Agent Node ("Summary")**
   - Type: LangChain Agent
   - Text input: `={{ $json.data }}`
   - Prompt type: Define prompt with system message containing instructions:
     ```
     Email Processing System

     Step 1: Extract Key Details
     Read the email thoroughly and identify:

     Main topics discussed
     Critical data points (dates, numbers, names)
     Explicit requests or requirements
     Problems or concerns raised

     Step 2: Organize Output
     Summary of Email
     Bullet-point list of key takeaways

     Example:

     Project deadline extended to March 15
     New compliance rules apply to all vendors

     Issues Identified
     List problems with context:

     Issue: Vendor delay impacting timeline
     Impact: Risk to Q2 launch

     Action Items
     Clear tasks with owners:

     Task: Approve revised budget
     Owner: Finance Team
     Deadline: EOD Friday

     Follow-Up Needed
     Open questions or missing info:

     "Confirm if the client approved the scope change?"

     Rules for Clarity
     ✔ Be concise – 1 line per point
     ✔ Prioritize – Flag urgent items with [!]
     ✔ Ownership – Always note who needs to act
     ✔ Use plain language – Avoid jargon

     Example Output:

     Summary

     Marketing campaign paused due to budget review
     New analytics tool rollout delayed by 2 weeks

     Issues

     [!] Budget approval missing – blocking all spend
     Low engagement on recent social posts

     Actions

     Send revised budget to CFO (Owner: Alex)
     Audit social content (Owner: Marketing, Due: Nov 30)

     Follow-Up

     Is the budget review meeting scheduled?
     ```
   - Connect AI language model input to the OpenRouter Chat Model node.
   - Connect output to "Send A email of Summary".

7. **Create Gmail Node to Send Email**
   - Type: Gmail
   - Operation: Send
   - Send to: Expression `={{ $('Aggregate').item.json.data[1].To }}`
   - Message: Expression `={{ $json.output }}`
   - Subject: `Summary Of Emails Last 24 Hours`
   - Email type: text
   - Disable attribution (appendAttribution = false)
   - Credentials: Gmail OAuth2 with send email scope.
   - Connect input from "Summary" node.

8. **Add Documentation Node (Optional)**
   - Sticky Note node with overview and instructions as per your needs.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Context or Link                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| This workflow provides a scalable method to automate daily email summaries using AI for enhanced productivity. Be sure to configure Gmail OAuth2 credentials with proper scopes (`https://mail.google.com/`) and OpenRouter API keys for GPT-3.5 access. Customize the AI prompt to tailor summary styles or focus areas.                                                                                                                                                                                                         | Workflow setup and AI prompt customization                                                        |
| Replace the placeholder `<Your Email ID>` in the Code node with the actual email address to target your inbox correctly. Without this, Gmail queries will not return relevant emails.                                                                                                                                                                                                                                                                                                                                             | Important configuration note                                                                      |
| Gmail API quotas and rate limits apply; monitor to avoid throttling. Ensure n8n instance has reliable internet access and time synchronization for accurate scheduling.                                                                                                                                                                                                                                                                                                                                                           | Operational considerations                                                                       |
| LangChain nodes require valid OpenRouter API keys configured in n8n credentials; check API key validity regularly.                                                                                                                                                                                                                                                                                                                                                                                                                  | API credential management                                                                          |
| For more about LangChain AI agent integration in n8n, refer to: https://n8n.io/integrations/n8n-nodes-langchain-agent                                                                                                                                                                                                                                                                                                                                                                                                              | Official LangChain n8n integration documentation                                                  |
| To learn more about Gmail node usage and OAuth2 setup, visit: https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.gmail/                                                                                                                                                                                                                                                                                                                                                                                              | Official Gmail node documentation                                                                 |

---

This detailed reference document covers the entire workflow structure, node configurations, dependencies, and reproduction steps for both human developers and automation agents. It also highlights potential failure points and integration considerations to ensure smooth operation.