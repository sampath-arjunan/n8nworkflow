Web Search Assistant with Citations using SearchAPI and OpenRouter LLM

https://n8nworkflows.xyz/workflows/web-search-assistant-with-citations-using-searchapi-and-openrouter-llm-3829


# Web Search Assistant with Citations using SearchAPI and OpenRouter LLM

### 1. Workflow Overview

This workflow, titled **"Web Search Assistant with Citations using SearchAPI and OpenRouter LLM"**, is designed to automate real-time web searches within an AI chat interface. It targets users such as students, researchers, content creators, and professionals who require accurate, up-to-date, and verifiable information sourced from the internet. The workflow integrates an AI agent with SearchAPI.io and an OpenRouter language model to dynamically perform searches, summarize results, and provide source citations.

The workflow is logically divided into the following blocks:

- **1.1 Input Reception:** Captures user chat messages as triggers for the workflow.
- **1.2 Context Memory Management:** Maintains conversational context to improve AI responses.
- **1.3 AI Agent Processing:** Core logic where the AI agent interprets input, decides when to perform web searches, and generates responses.
- **1.4 Language Model Integration:** Uses OpenRouter’s chat model to generate natural language responses.
- **1.5 Web Search Integration:** Calls SearchAPI to perform live web searches based on AI agent instructions.
- **1.6 User Guidance and Documentation:** Sticky notes providing usage tips and setup instructions.

---

### 2. Block-by-Block Analysis

#### 2.1 Input Reception

- **Overview:**  
  This block receives incoming chat messages from users, serving as the entry point for the workflow.

- **Nodes Involved:**  
  - When chat message received

- **Node Details:**

  - **When chat message received**  
    - *Type:* `@n8n/n8n-nodes-langchain.chatTrigger`  
    - *Role:* Webhook trigger node that listens for incoming chat messages to start the workflow.  
    - *Configuration:* Default options; webhook ID assigned for external integration.  
    - *Expressions/Variables:* None explicitly configured; captures raw user input.  
    - *Input:* External chat message via webhook.  
    - *Output:* Passes message data to the AI Agent node.  
    - *Version:* 1.1  
    - *Potential Failures:* Webhook connectivity issues, malformed input data, or missing required parameters.  
    - *Sub-workflow:* None.

#### 2.2 Context Memory Management

- **Overview:**  
  Maintains a sliding window of recent conversation history to provide context for AI responses, improving continuity and relevance.

- **Nodes Involved:**  
  - Simple Memory

- **Node Details:**

  - **Simple Memory**  
    - *Type:* `@n8n/n8n-nodes-langchain.memoryBufferWindow`  
    - *Role:* Stores a buffer of recent chat messages (context window) for the AI agent to reference.  
    - *Configuration:* Context window length set to 20 messages, meaning it retains the last 20 conversational entries.  
    - *Expressions/Variables:* None explicitly; manages internal memory buffer.  
    - *Input:* Receives AI agent’s memory input.  
    - *Output:* Provides context data back to the AI Agent node.  
    - *Version:* 1.3  
    - *Potential Failures:* Memory overflow if context window is too large; possible data loss if node fails.  
    - *Sub-workflow:* None.

#### 2.3 AI Agent Processing

- **Overview:**  
  The AI Agent node orchestrates the conversation flow, decides when to invoke web searches, and composes responses including citations.

- **Nodes Involved:**  
  - AI Agent

- **Node Details:**

  - **AI Agent**  
    - *Type:* `@n8n/n8n-nodes-langchain.agent`  
    - *Role:* Central decision-making node that processes user input, integrates memory and language model, and calls external tools like SearchAPI.  
    - *Configuration:* Default options; configured to use linked AI language model, memory, and AI tool nodes.  
    - *Expressions/Variables:* Uses AI tool input override expression `{{$fromAI('Value', '', 'string')}}` in SearchAPI parameters to dynamically pass search queries generated by the AI.  
    - *Input:* Receives chat messages from trigger and context from memory node.  
    - *Output:* Sends requests to SearchAPI tool and language model nodes; outputs final AI-generated response.  
    - *Version:* 1.8  
    - *Potential Failures:* Expression evaluation errors, API rate limits, tool invocation errors, or unexpected AI output formats.  
    - *Sub-workflow:* None.

#### 2.4 Language Model Integration

- **Overview:**  
  Provides natural language generation capabilities to the AI Agent using OpenRouter’s chat model.

- **Nodes Involved:**  
  - OpenRouter Chat Model

- **Node Details:**

  - **OpenRouter Chat Model**  
    - *Type:* `@n8n/n8n-nodes-langchain.lmChatOpenRouter`  
    - *Role:* Language model node that generates conversational responses based on input prompts.  
    - *Configuration:* Uses model `"deepseek/deepseek-chat:free"` with default options.  
    - *Credentials:* OpenRouter API credentials configured under `openRouterApi`.  
    - *Expressions/Variables:* None specific; receives prompts from AI Agent.  
    - *Input:* Receives prompt data from AI Agent.  
    - *Output:* Returns generated text to AI Agent.  
    - *Version:* 1  
    - *Potential Failures:* Authentication errors, model unavailability, network timeouts.  
    - *Sub-workflow:* None.

#### 2.5 Web Search Integration

- **Overview:**  
  Executes real-time web searches via SearchAPI based on queries formulated by the AI Agent, ensuring responses are supported by external sources.

- **Nodes Involved:**  
  - SearchAPI

- **Node Details:**

  - **SearchAPI**  
    - *Type:* `CUSTOM.searchApiTool` (custom tool node)  
    - *Role:* Performs web searches using SearchAPI.io endpoints, retrieving fresh and verifiable information.  
    - *Configuration:*  
      - Parameter `q` (query) dynamically set via AI Agent override expression: `={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Value', ``, 'string') }}`  
      - Tool description instructs to always cite sources in replies.  
    - *Credentials:* SearchAPI credentials configured under `searchApi`.  
    - *Expressions/Variables:* Dynamic query parameter from AI Agent.  
    - *Input:* Receives search query from AI Agent.  
    - *Output:* Returns search results to AI Agent for summarization and citation.  
    - *Version:* 1  
    - *Potential Failures:* API key invalid or expired, rate limiting, malformed queries, network errors.  
    - *Sub-workflow:* None.

#### 2.6 User Guidance and Documentation

- **Overview:**  
  Provides visual notes within the workflow editor to assist users in understanding setup requirements and usage tips.

- **Nodes Involved:**  
  - Sticky Note  
  - Sticky Note1

- **Node Details:**

  - **Sticky Note**  
    - *Type:* `n8n-nodes-base.stickyNote`  
    - *Role:* Displays setup instructions emphasizing the need for SearchAPI.io and LLM credentials.  
    - *Configuration:* Colored note (color code 5), width 340, content explains the AI Agent’s use of SearchAPI.  
    - *Input/Output:* None (informational only).  
    - *Version:* 1  

  - **Sticky Note1**  
    - *Type:* `n8n-nodes-base.stickyNote`  
    - *Role:* Provides a tip about changing search engines on SearchAPI.io.  
    - *Configuration:* Width 260, height 120, content includes a hyperlink to [SearchAPI.io](https://www.searchapi.io/).  
    - *Input/Output:* None (informational only).  
    - *Version:* 1  

---

### 3. Summary Table

| Node Name               | Node Type                               | Functional Role                      | Input Node(s)               | Output Node(s)             | Sticky Note                                                                                  |
|-------------------------|---------------------------------------|------------------------------------|-----------------------------|----------------------------|----------------------------------------------------------------------------------------------|
| When chat message received | @n8n/n8n-nodes-langchain.chatTrigger | Entry point for user chat messages | External webhook             | AI Agent                   | ## SearchAPI AI Agent Whenever you ask a question that should be searched on the web, the AI Agent will use SearchAPI to do it. To run this workflow, you need to have the credentials for Searchapi.io and some LLM provider. |
| AI Agent                | @n8n/n8n-nodes-langchain.agent        | Core AI logic, decision making     | When chat message received, Simple Memory, OpenRouter Chat Model, SearchAPI | SearchAPI, OpenRouter Chat Model, Simple Memory | ## SearchAPI AI Agent Whenever you ask a question that should be searched on the web, the AI Agent will use SearchAPI to do it. To run this workflow, you need to have the credentials for Searchapi.io and some LLM provider. |
| Simple Memory           | @n8n/n8n-nodes-langchain.memoryBufferWindow | Maintains conversation context     | AI Agent                    | AI Agent                   | ## SearchAPI AI Agent Whenever you ask a question that should be searched on the web, the AI Agent will use SearchAPI to do it. To run this workflow, you need to have the credentials for Searchapi.io and some LLM provider. |
| OpenRouter Chat Model   | @n8n/n8n-nodes-langchain.lmChatOpenRouter | Generates AI natural language text | AI Agent                    | AI Agent                   | ## SearchAPI AI Agent Whenever you ask a question that should be searched on the web, the AI Agent will use SearchAPI to do it. To run this workflow, you need to have the credentials for Searchapi.io and some LLM provider. |
| SearchAPI               | CUSTOM.searchApiTool                  | Performs live web searches         | AI Agent                    | AI Agent                   | ## Tip You can change the node to use any of the engines available on [SearchAPI.io](https://www.searchapi.io/) |
| Sticky Note             | n8n-nodes-base.stickyNote             | Setup instructions and notes       | None                       | None                      | ## SearchAPI AI Agent Whenever you ask a question that should be searched on the web, the AI Agent will use SearchAPI to do it. To run this workflow, you need to have the credentials for Searchapi.io and some LLM provider. |
| Sticky Note1            | n8n-nodes-base.stickyNote             | Usage tip                         | None                       | None                      | ## Tip You can change the node to use any of the engines available on [SearchAPI.io](https://www.searchapi.io/) |

---

### 4. Reproducing the Workflow from Scratch

1. **Create the Trigger Node:**
   - Add a node of type `@n8n/n8n-nodes-langchain.chatTrigger` named **"When chat message received"**.
   - Configure it with default options.
   - Note the webhook URL generated for external chat integration.

2. **Add the Memory Node:**
   - Add a node of type `@n8n/n8n-nodes-langchain.memoryBufferWindow` named **"Simple Memory"**.
   - Set **Context Window Length** to `20`.
   - This node will store recent conversation history.

3. **Add the AI Agent Node:**
   - Add a node of type `@n8n/n8n-nodes-langchain.agent` named **"AI Agent"**.
   - Leave options at default.
   - Connect the **"When chat message received"** node’s main output to the AI Agent’s main input.
   - Connect **"Simple Memory"** node’s output (ai_memory) to the AI Agent’s memory input.
   - Connect the AI Agent’s ai_tool output to the SearchAPI node (to be created).
   - Connect the AI Agent’s ai_languageModel input/output to the OpenRouter Chat Model node (to be created).

4. **Add the OpenRouter Chat Model Node:**
   - Add a node of type `@n8n/n8n-nodes-langchain.lmChatOpenRouter` named **"OpenRouter Chat Model"**.
   - Set the **Model** parameter to `"deepseek/deepseek-chat:free"`.
   - Configure credentials with your OpenRouter API key under `openRouterApi`.
   - Connect this node’s output to the AI Agent’s ai_languageModel input.
   - Connect the AI Agent’s ai_languageModel output to this node’s input.

5. **Add the SearchAPI Node:**
   - Add a custom tool node named **"SearchAPI"** of type `CUSTOM.searchApiTool`.
   - Configure the tool description:  
     `"Call this tool whenever the answer might require fresh, niche, or externally-verifiable information. Make sure to always cite the sources in the final reply."`
   - Under parameters, add a parameter named `q` with the value expression:  
     `={{ $fromAI('Value', '', 'string') }}`  
     This dynamically receives the search query from the AI Agent.
   - Configure SearchAPI credentials with your SearchAPI.io API key under `searchApi`.
   - Connect the AI Agent’s ai_tool output to this node’s input.
   - Connect this node’s output back to the AI Agent’s ai_tool input.

6. **Connect Memory Node:**
   - Connect the AI Agent’s ai_memory output to the Simple Memory node’s input.
   - Connect the Simple Memory node’s output back to the AI Agent’s ai_memory input.

7. **Add Sticky Notes (Optional but Recommended):**
   - Add a **Sticky Note** near the input nodes with content:  
     ```
     ## SearchAPI AI Agent
     Whenever you ask a question that should be searched on the web, the AI Agent will use SearchAPI to do it. To run this workflow, you need to have the credentials for Searchapi.io and some LLM provider.
     ```
     Set color to 5 and width to 340.
   - Add a **Sticky Note1** near the SearchAPI node with content:  
     ```
     ## Tip
     You can change the node to use any of the engines available on [SearchAPI.io](https://www.searchapi.io/)
     ```
     Set width to 260 and height to 120.

8. **Final Checks:**
   - Ensure all credentials are correctly set for OpenRouter and SearchAPI.
   - Validate all node connections follow the described input/output flows.
   - Activate the workflow and test by sending chat messages to the webhook URL.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                       | Context or Link                          |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
| This workflow uses SearchAPI.io as the integrated web search provider, enabling real-time, verifiable information retrieval.                                     | https://www.searchapi.io/                |
| The AI Agent node dynamically decides when to invoke web searches and ensures responses include source citations for transparency and validation.               | Workflow description                     |
| OpenRouter’s `"deepseek/deepseek-chat:free"` model is used for conversational AI generation, requiring valid OpenRouter API credentials.                      | https://openrouter.ai/                   |
| The workflow is designed for extensibility, allowing integration with databases, messaging platforms, or notification systems for enhanced functionality.       | Workflow description                     |
| For best results, ensure API keys have sufficient quota and permissions to avoid rate limiting or authentication errors during execution.                       | General best practice                     |

---

This documentation provides a comprehensive understanding of the workflow’s architecture, node configurations, and operational logic, enabling users and automation agents to reproduce, customize, and troubleshoot the workflow effectively.