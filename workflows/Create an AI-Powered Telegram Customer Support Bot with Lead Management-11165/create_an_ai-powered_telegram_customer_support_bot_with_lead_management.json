{"id":"m7f6djin9Wz95S8C","meta":{"instanceId":"45034184a194eda18f06d4c753376d7a8f48cc5f8172c69307abb02d7a82ff4c"},"name":"AI Telegram Customer Support Assistant with Lead Management","tags":[],"nodes":[{"id":"71b9a677-06e0-42e3-aa8f-578e6247a382","name":"OpenRouter Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","position":[2208,656],"parameters":{"options":{"topP":1,"maxTokens":400,"maxRetries":2,"temperature":0.2,"responseFormat":"text","presencePenalty":0.2,"frequencyPenalty":0.2}},"credentials":{"openRouterApi":{"id":"UcCnUQaCQk5JIlfm","name":"UmrahAssistantBot"}},"typeVersion":1},{"id":"5136fc3a-6577-4441-ad57-fcc5b0cea2d1","name":"Simple Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[2432,656],"parameters":{"sessionKey":"={{ $('Telegram - Incoming Message').item.json.message.chat.id }}","sessionIdType":"customKey","contextWindowLength":25},"typeVersion":1.3},{"id":"189a1715-dc89-4d39-ae62-d6f80d9ee11d","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-1104,-224],"parameters":{"width":1040,"height":464,"content":"ğŸ“Œ Main Overview â€” Telegram AI Support Assistant\n\nThis workflow creates a simple AI-powered customer support assistant for Telegram.  \nIt receives user messages, logs them, checks whether the user already has a lead record, and either creates or updates that lead. \nThe workflow then prepares a clean context object and sends it to the AI Agent, which handles questions, collects missing data, and returns a reply.\n\nMain Logic:\n1. Telegram Trigger receives the user message.\n2. The message is stored in the chat_logs table.\n3. The workflow checks if a lead exists for this chat_id.\n4. If not found, a new lead entry is created.\n5. A clean context object (telegram_user + lead_data + user_message) is built.\n6. The AI Agent receives the context, decides if it should update the lead or answer a question.\n7. If needed, the AI triggers tools (services, FAQ, settings).\n8. The final reply is saved and sent back to Telegram.\n\nThis template is easy to adapt for any business by editing the prompt or replacing the data tables.\n\n"},"typeVersion":1},{"id":"3b6dd5eb-8837-4f95-89c8-549743f8def0","name":"Telegram - Incoming Message","type":"n8n-nodes-base.telegramTrigger","position":[176,32],"webhookId":"2b1e5383-3d3f-407f-9ff2-5fd606097167","parameters":{"updates":["message"],"additionalFields":{}},"credentials":{"telegramApi":{"id":"OmFwn3zHigKeJ32Z","name":"UmrahAssistantDemo_bot"}},"typeVersion":1.2},{"id":"daf6ca06-da61-4ace-a33c-706453e1e0eb","name":"Log - User Message","type":"n8n-nodes-base.dataTable","position":[576,32],"parameters":{"columns":{"value":{"chat_id":"={{ $json.message.chat.id }}","direction":"user","message_text":"={{ $json.message.text }}"},"schema":[{"id":"chat_id","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"chat_id","defaultMatch":false},{"id":"direction","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"direction","defaultMatch":false},{"id":"message_text","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"message_text","defaultMatch":false},{"id":"related_faq_key","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"related_faq_key","defaultMatch":false},{"id":"related_service_key","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"related_service_key","defaultMatch":false}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"dataTableId":{"__rl":true,"mode":"list","value":"9zRylhKYjPC3BDB2","cachedResultUrl":"/projects/LgF39ftKYOZWwXsd/datatables/9zRylhKYjPC3BDB2","cachedResultName":"umrah_chat_logs"}},"typeVersion":1},{"id":"37a85b98-ad4d-4d64-9836-217313851e48","name":"Log - Bot Message","type":"n8n-nodes-base.dataTable","position":[3536,48],"parameters":{"columns":{"value":{"chat_id":"={{ $('Telegram - Incoming Message').item.json.message.chat.id }}","direction":"bot","message_text":"={{ $json.output }}"},"schema":[{"id":"chat_id","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"chat_id","defaultMatch":false},{"id":"direction","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"direction","defaultMatch":false},{"id":"message_text","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"message_text","defaultMatch":false},{"id":"related_faq_key","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"related_faq_key","defaultMatch":false},{"id":"related_service_key","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"related_service_key","defaultMatch":false}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"dataTableId":{"__rl":true,"mode":"list","value":"9zRylhKYjPC3BDB2","cachedResultUrl":"/projects/LgF39ftKYOZWwXsd/datatables/9zRylhKYjPC3BDB2","cachedResultName":"umrah_chat_logs"}},"typeVersion":1},{"id":"8c821185-dd04-4282-aa6d-7867dad10925","name":"DB - Get Lead by User ID","type":"n8n-nodes-base.dataTable","position":[912,32],"parameters":{"limit":1,"filters":{"conditions":[{"keyName":"chat_id","keyValue":"={{ $('Telegram - Incoming Message').item.json.message.chat.id }}"}]},"operation":"get","dataTableId":{"__rl":true,"mode":"list","value":"zaotykuYGJ0D2vt3","cachedResultUrl":"/projects/LgF39ftKYOZWwXsd/datatables/zaotykuYGJ0D2vt3","cachedResultName":"umrah_leads"}},"typeVersion":1,"alwaysOutputData":true},{"id":"c340ee82-44f7-4e05-a16f-8b48a1601144","name":"DB - Create Lead","type":"n8n-nodes-base.dataTable","position":[1504,176],"parameters":{"columns":{"value":{"status":"new","chat_id":"={{ $('Telegram - Incoming Message').item.json.message.chat.id }}","telegram_last_name":"={{ $('Telegram - Incoming Message').item.json.message.chat.last_name }}","telegram_first_name":"={{ $('Telegram - Incoming Message').item.json.message.chat.first_name }}"},"schema":[{"id":"chat_id","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"chat_id","defaultMatch":false},{"id":"telegram_first_name","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"telegram_first_name","defaultMatch":false},{"id":"telegram_last_name","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"telegram_last_name","defaultMatch":false},{"id":"full_name","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"full_name","defaultMatch":false},{"id":"phone","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"phone","defaultMatch":false},{"id":"email","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"email","defaultMatch":false},{"id":"country","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"country","defaultMatch":false},{"id":"interested_service_key","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"interested_service_key","defaultMatch":false},{"id":"preferred_contact_channel","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"preferred_contact_channel","defaultMatch":false},{"id":"notes","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"notes","defaultMatch":false},{"id":"status","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"status","defaultMatch":false}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"dataTableId":{"__rl":true,"mode":"list","value":"zaotykuYGJ0D2vt3","cachedResultUrl":"/projects/LgF39ftKYOZWwXsd/datatables/zaotykuYGJ0D2vt3","cachedResultName":"umrah_leads"}},"typeVersion":1},{"id":"c8c81aea-6385-4389-ac8c-1a934d7dcef1","name":"DB - Update Lead","type":"n8n-nodes-base.dataTableTool","position":[2624,656],"parameters":{"columns":{"value":{"email":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email', ``, 'string') }}","notes":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('notes', ``, 'string') }}","phone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('phone', ``, 'string') }}","status":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('status', ``, 'string') }}","country":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('country', ``, 'string') }}","full_name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('full_name', ``, 'string') }}","interested_service_key":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('interested_service_key', ``, 'string') }}","preferred_contact_channel":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('preferred_contact_channel', ``, 'string') }}"},"schema":[{"id":"chat_id","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"chat_id","defaultMatch":false},{"id":"telegram_first_name","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"telegram_first_name","defaultMatch":false},{"id":"telegram_last_name","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"telegram_last_name","defaultMatch":false},{"id":"full_name","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"full_name","defaultMatch":false},{"id":"phone","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"phone","defaultMatch":false},{"id":"email","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"email","defaultMatch":false},{"id":"country","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"country","defaultMatch":false},{"id":"interested_service_key","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"interested_service_key","defaultMatch":false},{"id":"preferred_contact_channel","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"preferred_contact_channel","defaultMatch":false},{"id":"notes","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"notes","defaultMatch":false},{"id":"status","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"status","defaultMatch":false}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"filters":{"conditions":[{"keyName":"chat_id","keyValue":"={{ $('Telegram - Incoming Message').item.json.message.chat.id }}"}]},"options":{},"operation":"update","dataTableId":{"__rl":true,"mode":"list","value":"zaotykuYGJ0D2vt3","cachedResultUrl":"/projects/LgF39ftKYOZWwXsd/datatables/zaotykuYGJ0D2vt3","cachedResultName":"umrah_leads"}},"typeVersion":1},{"id":"6c98a92e-1cfb-4505-ac62-8046a37e0961","name":"AI - Smart Support Assistant","type":"@n8n/n8n-nodes-langchain.agent","position":[2512,32],"parameters":{"text":"={{$json[\"user_message\"]}}","options":{"systemMessage":"=ğŸ§  System Prompt â€” Smart Telegram Customer Support Assistant (Generic Version)\n\nYou are an AI Customer Support Assistant connected to a Telegram bot.\nYour job is to assist users, answer questions, and update lead records when needed.\n\nğŸ§© Context Provided to You\n\nYou will always receive a JSON object containing:\n\ntelegram_user\n\nid\n\nfirst_name\n\nlast_name\n\nlead_data (may be null)\n\nfull_name\n\nphone\n\nemail\n\ncountry\n\ninterested_service_key\n\npreferred_contact_channel\n\nnotes\n\nstatus\n\nuser_message\n\nPlain text from the userâ€™s latest Telegram message.\n\nYou must not invent or assume values that are not explicitly present.\n\nğŸ¯ Your Responsibilities\n\nGreet the user warmly using their Telegram first name.\n\nOnly on the first message from the user.\n\nNever ask for personal data in the first message.\n\nWhen the user asks for help or services:\n\nCheck if lead_data exists.\n\nEvaluate whether required fields are missing.\n\nRequired fields for a complete lead:\n\nfull_name\n\nphone\n\nAND ( email OR notes = \"no_email\" )\n\nIf all required fields are present â†’ respond normally.\nIf something is missing â†’ request only the missing fields.\n\nğŸ“ Lead Completion Logic\n1ï¸âƒ£ Full Name\n\nIf missing:\nAsk politely:\nâ€œCould you please share your full name?â€\n\nWhen user replies:\n\nRemove phrases like â€œmy name isâ€\n\nUse the exact text they provide\n\nMulti-line messages must be merged\nUpdate using the tool: update_lead\n\n2ï¸âƒ£ Phone Number\n\nIf missing:\nâ€œMay I have your phone number so we can contact you?â€\n\nExtract the phone number from the message\n\nUse the exact formatting\nUpdate the lead.\n\n3ï¸âƒ£ Email (Optional)\n\nIf missing:\nâ€œWould you like to share your email? If not, just say â€˜no emailâ€™.â€\n\nIf user says:\n\nan email â†’ save it\n\nâ€œno emailâ€ â†’ store inside notes = \"no_email\"\n\nğŸ§° Available Tools\n\nYou may ONLY use the following tools:\n\ndb_get_services â†’ List available services/programs\n\ndb_get_faq â†’ Get FAQ responses\n\ndb_get_settings â†’ Get company info\n\ndb_update_lead â†’ Update lead fields\n\nYou must decide when to call each tool:\n\nServices â†’ when the message mentions prices, programs, offers, plans, booking\n\nFAQ â†’ when the inquiry matches known FAQ topics\n\nSettings â†’ when user asks for office info, contact details, working hours\n\nUpdate Lead â†’ only when updating personal user data\n\nğŸ’¬ Answering User Questions\n\nWhen the lead is complete:\n\nInfer intent from the user message.\n\nUse the appropriate tool.\n\nProvide clear, concise responses.\n\nInclude:\n\nService title\n\nDuration\n\nPrice\n\nShort description\n\nAlways end with:\nâ€œIs there anything else I can help you with?â€\n\nğŸ”’ Strict Rules\n\nNever mention nodes, workflows, tools, or Data Tables.\n\nNever reveal that you are an AI system with internal tools.\n\nNever assume personal data.\n\nOnly use data from:\n\ntelegram_user\n\nlead_data\n\nuser messages\n\ntool results\n\nIf the user asks about internal system details:\nReply:\nâ€œIâ€™m here to help with customer support only.â€\n\nğŸŸ¢ End of Prompt\n\nFully optimized for n8n AI Smart Support Assistant."},"promptType":"define"},"typeVersion":3},{"id":"4d0d1528-2c4f-45de-ac2e-f699a3a75abd","name":"DB - Get FAQ","type":"n8n-nodes-base.dataTableTool","position":[2816,656],"parameters":{"filters":{"conditions":[{"keyName":"is_active","condition":"isTrue"}]},"operation":"get","returnAll":true,"dataTableId":{"__rl":true,"mode":"list","value":"6EK6ksNhlVNCvyxt","cachedResultUrl":"/projects/LgF39ftKYOZWwXsd/datatables/6EK6ksNhlVNCvyxt","cachedResultName":"umrah_faq"}},"typeVersion":1},{"id":"c757970a-3e13-4f4f-b8b2-325b2aa45d16","name":"DB - Get Services","type":"n8n-nodes-base.dataTableTool","position":[3008,656],"parameters":{"filters":{"conditions":[{"keyName":"is_active","condition":"isTrue"}]},"operation":"get","returnAll":true,"dataTableId":{"__rl":true,"mode":"list","value":"DcBLjNb0sXLVv549","cachedResultUrl":"/projects/LgF39ftKYOZWwXsd/datatables/DcBLjNb0sXLVv549","cachedResultName":"umrah_services"}},"typeVersion":1},{"id":"3076d9aa-0a6c-40dc-9334-f622ed3b2a5e","name":"DB - Get Settings","type":"n8n-nodes-base.dataTableTool","position":[3216,656],"parameters":{"operation":"get","returnAll":true,"dataTableId":{"__rl":true,"mode":"list","value":"7AbFLi5kyxfx88bu","cachedResultUrl":"/projects/LgF39ftKYOZWwXsd/datatables/7AbFLi5kyxfx88bu","cachedResultName":"umrah_settings"}},"typeVersion":1},{"id":"54170bbc-6047-4939-bd57-9afae970e3ac","name":"Telegram - Send Response","type":"n8n-nodes-base.telegram","position":[3936,48],"webhookId":"93130015-dde9-418f-8c08-aa0660280b0c","parameters":{"text":"={{ $('AI - Smart Support Assistant').item.json.output }}","chatId":"={{ $('Telegram - Incoming Message').item.json.message.chat.id }}","additionalFields":{"appendAttribution":false}},"credentials":{"telegramApi":{"id":"OmFwn3zHigKeJ32Z","name":"UmrahAssistantDemo_bot"}},"typeVersion":1.2},{"id":"88ed32c8-977f-4cd5-a2f8-11d6aca1c264","name":"Build Assistant Context","type":"n8n-nodes-base.code","position":[1856,32],"parameters":{"jsCode":"// Ù†Ø¬ÙŠØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ù† Ø§Ù„Ù†ÙˆØ¯ Telegram Trigger\nconst telegramJson = $('Telegram - Incoming Message').first().json;\nconst msg = telegramJson.message || {};\nconst chat = msg.chat || {};\n\n// Ù†Ø¬ÙŠØ¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† umrah_get_user_lead_data (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©)\nlet leadRaw = null;\ntry {\n  leadRaw = $('DB - Get Lead by User ID').first().json;\n} catch (error) {\n  leadRaw = null;\n}\n\n// Ù†Ø¨Ù†ÙŠ ÙƒØ§Ø¦Ù† telegram_user Ø²ÙŠ Ù…Ø§ Ø§Ù„Ø³ÙŠØ³ØªÙ… Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…ØªÙˆÙ‚Ø¹\nconst telegram_user = {\n  id: chat.id ?? null,\n  first_name: chat.first_name ?? null,\n  last_name: chat.last_name ?? null,\n};\n\n// Ù†Ø¨Ù†ÙŠ ÙƒØ§Ø¦Ù† lead_data Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø£Ùˆ null Ù„Ùˆ Ù…ÙÙŠØ´)\nlet lead_data = null;\n\nif (leadRaw) {\n  lead_data = {\n    full_name: leadRaw.full_name ?? null,\n    phone: leadRaw.phone ?? null,\n    email: leadRaw.email ?? null,\n    status: leadRaw.status ?? null,\n    notes: leadRaw.notes ?? null,\n  };\n}\n\n// Ù†Ø¬ÙŠØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙŠÙˆØ²Ø± Ù†ÙØ³Ù‡Ø§\nconst user_message = msg.text ?? null;\n\n// Ù†Ø±Ø¬Ù‘Ø¹ Ø¢ÙŠØªÙ… ÙˆØ§Ø­Ø¯ Ø¨Ø§Ù„Ù€ context Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ¯Ø®Ù„ Ù„Ù„Ù€ AI Agent\nreturn [\n  {\n    json: {\n      telegram_user,\n      lead_data,\n      user_message,\n    },\n  },\n];\n"},"typeVersion":2},{"id":"07268ffc-f684-439c-9a93-bc67358a25bf","name":"Check â€“ Lead Record","type":"n8n-nodes-base.if","position":[1168,32],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"6d4d4a9c-9525-4db5-99c0-1ccdd4b829a9","operator":{"type":"string","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.chat_id }}","rightValue":""}]}},"typeVersion":2.2},{"id":"5103c661-3efa-4f1f-af92-6d8c77353406","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[48,-176],"parameters":{"color":7,"width":384,"height":432,"content":"## Telegram Input\nHandles incoming Telegram messages and forwards them to the workflow. Also stores each user message in chat_logs for tracking.\n"},"typeVersion":1},{"id":"c94e776e-463f-431c-8aaf-f38a082413c8","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[848,-112],"parameters":{"color":7,"width":832,"height":464,"content":"## Lead Management\nChecks if the user has an existing lead record. Creates a new lead if missing or updates it using AI-extracted data.\n"},"typeVersion":1},{"id":"f148c107-9abd-4b44-853b-bf285bf31caa","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[2128,-144],"parameters":{"color":7,"width":1200,"height":992,"content":"## AI Agent\nReceives context, determines intent, updates leads if needed, retrieves services/FAQ/settings, and prepares the final reply.\n"},"typeVersion":1},{"id":"0f98316e-2b53-4d2e-9e9b-7af3c5c235c1","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[3472,-112],"parameters":{"color":7,"width":208,"height":400,"content":"## Logging\nStores all bot replies in chat_logs for auditing and history.\n"},"typeVersion":1},{"id":"b049cb8c-13b3-452a-a775-5aeebdbcc72d","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[496,-128],"parameters":{"color":7,"width":256,"height":384,"content":"## Logging\nStores all bot replies in chat_logs for auditing and history.\n"},"typeVersion":1},{"id":"5dc04310-c03e-4a47-a6f5-a236c8e64833","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[1776,-144],"parameters":{"color":7,"height":432,"content":"## Context Builder\nBuilds the assistant context object (lead data, telegram user, message) before sending it to the AI.\n"},"typeVersion":1},{"id":"4119ca42-0805-4120-b665-4757174a2d11","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[3856,-112],"parameters":{"color":7,"width":272,"height":384,"content":"## Telegram Output\nSends the assistantâ€™s final reply back to the user through Telegram.\n"},"typeVersion":1}],"active":false,"pinData":{},"settings":{"executionOrder":"v1"},"versionId":"f837f879-f201-4405-affe-dfd1aa6b81e1","connections":{"DB - Get FAQ":{"ai_tool":[[{"node":"AI - Smart Support Assistant","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI - Smart Support Assistant","type":"ai_memory","index":0}]]},"DB - Create Lead":{"main":[[{"node":"Build Assistant Context","type":"main","index":0}]]},"DB - Update Lead":{"ai_tool":[[{"node":"AI - Smart Support Assistant","type":"ai_tool","index":0}]]},"DB - Get Services":{"ai_tool":[[{"node":"AI - Smart Support Assistant","type":"ai_tool","index":0}]]},"DB - Get Settings":{"ai_tool":[[{"node":"AI - Smart Support Assistant","type":"ai_tool","index":0}]]},"Log - Bot Message":{"main":[[{"node":"Telegram - Send Response","type":"main","index":0}]]},"Log - User Message":{"main":[[{"node":"DB - Get Lead by User ID","type":"main","index":0}]]},"Check â€“ Lead Record":{"main":[[{"node":"Build Assistant Context","type":"main","index":0}],[{"node":"DB - Create Lead","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI - Smart Support Assistant","type":"ai_languageModel","index":0}]]},"Build Assistant Context":{"main":[[{"node":"AI - Smart Support Assistant","type":"main","index":0}]]},"DB - Get Lead by User ID":{"main":[[{"node":"Check â€“ Lead Record","type":"main","index":0}]]},"Telegram - Incoming Message":{"main":[[{"node":"Log - User Message","type":"main","index":0}]]},"AI - Smart Support Assistant":{"main":[[{"node":"Log - Bot Message","type":"main","index":0}]]}}}