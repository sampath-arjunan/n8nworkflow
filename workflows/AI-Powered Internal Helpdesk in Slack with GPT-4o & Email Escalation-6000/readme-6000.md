AI-Powered Internal Helpdesk in Slack with GPT-4o & Email Escalation

https://n8nworkflows.xyz/workflows/ai-powered-internal-helpdesk-in-slack-with-gpt-4o---email-escalation-6000


# AI-Powered Internal Helpdesk in Slack with GPT-4o & Email Escalation

### 1. Workflow Overview

This workflow implements an **AI-powered internal helpdesk system integrated with Slack**, utilizing GPT-4o for conversational AI and automated email escalation for unanswered queries. It is designed to handle employee questions via Slack messages, provide AI-generated answers based on a company handbook, maintain conversation context, and escalate unresolved issues to relevant departments (HR or IT) by email.

**Target Use Cases:**  
- Internal employee support for HR and IT-related queries.  
- Automated, context-aware conversational assistance via Slack.  
- Seamless transition from AI response to human intervention via email escalation.  

**Logical Blocks:**  
- **1.1 Input Reception and Validation:** Receive Slack messages, filter out bot messages.  
- **1.2 User Identification and Acknowledgement:** Retrieve user profile, send acknowledgment message.  
- **1.3 Conversation Context Management:** Store and recall recent messages per user/channel.  
- **1.4 AI Processing:** Query GPT-4o with company handbook and headers data, generate responses.  
- **1.5 Slack Response Management:** Delete initial acknowledgment, send final AI response.  
- **1.6 Escalation via Email:** Manage user confirmation for escalation, retrieve department contacts, send professional emails.  
- **1.7 Data Retrieval Tools:** Access Google Sheets and Google Docs for handbook, headers, and department emails.

---

### 2. Block-by-Block Analysis

---

#### 2.1 Input Reception and Validation

- **Overview:**  
  This block triggers on Slack messages received via webhook, discards messages from bots to prevent loops or irrelevant processing.

- **Nodes Involved:**  
  - Webhook3  
  - Bot?

- **Node Details:**  
  - **Webhook3**  
    - Type: Webhook (HTTP POST)  
    - Role: Entry point receiving Slack event data via Slack Events API subscription.  
    - Config: No response body returned; listens on default path with POST method.  
    - Inputs: External Slack event payload.  
    - Outputs: Passed to Bot? node.  
    - Edge Cases: Slack challenge verification; malformed events; unauthorized requests if Slack tokens not validated externally.

  - **Bot?**  
    - Type: If node (conditional)  
    - Role: Filters out messages generated by bots based on event JSON properties (`bot_profile`, `previous_message.bot_profile`, `bot_id`).  
    - Config: Checks non-existence of bot-related fields to confirm messages from real users.  
    - Inputs: Webhook3 output.  
    - Outputs:  
      - True path (message from user) → Slack4 node  
      - False path (from bot) → No Operation node  
    - Edge Cases: Missing or unexpected payload structure could cause false positives/negatives.

---

#### 2.2 User Identification and Acknowledgement

- **Overview:**  
  Retrieves full user profile info from Slack and sends an initial acknowledgment message to the user channel confirming message receipt.

- **Nodes Involved:**  
  - Slack4  
  - Send Initial Message  

- **Node Details:**  
  - **Slack4**  
    - Type: Slack API (user profile get)  
    - Role: Fetch user profile details (e.g., real_name) for personalized responses.  
    - Config: Uses user ID from webhook event JSON.  
    - Inputs: True output from Bot?.  
    - Outputs: Send Initial Message node.  
    - Edge Cases: Slack API rate limits; invalid user IDs; missing credentials.

  - **Send Initial Message**  
    - Type: Slack message send node  
    - Role: Sends immediate reply in channel confirming processing has started, includes user’s real name dynamically.  
    - Config: Message text uses expression injecting `real_name` from Slack4; targets the same Slack channel as original message.  
    - Inputs: Slack4 output.  
    - Outputs: AI Agent2 node (starts AI processing).  
    - Edge Cases: Slack API errors; channel permissions; message formatting issues.

---

#### 2.3 Conversation Context Management

- **Overview:**  
  Maintains a rolling memory of the last 5 messages per Slack channel to provide context for AI responses, ensuring coherent conversations per user.

- **Nodes Involved:**  
  - Simple Memory2  

- **Node Details:**  
  - **Simple Memory2**  
    - Type: LangChain memory buffer window  
    - Role: Stores conversation history keyed by Slack channel ID to maintain session context.  
    - Config: Session key set dynamically to Slack channel ID from webhook event JSON.  
    - Inputs: Indirectly linked via AI Agent2 (ai_memory input).  
    - Outputs: Feeds AI Agent2 with conversation history.  
    - Edge Cases: Memory overflow if many channels; data loss if node or workflow restarted; latency in updating memory.

---

#### 2.4 AI Processing

- **Overview:**  
  Uses GPT-4o model via LangChain integration to generate context-aware responses based on company handbook, headers list, and department emails. Handles logic to detect if answer exists, and manages escalation prompts.

- **Nodes Involved:**  
  - AI Agent2  
  - OpenAI Chat Model3  
  - Handbook  
  - HeadersList  
  - departmentsEmails2  
  - Send Email  

- **Node Details:**  
  - **AI Agent2**  
    - Type: LangChain Agent  
    - Role: Central AI processing node, receives user question, references handbook and headers, decides on answer or escalation, composes emails if needed.  
    - Config:  
      - Input text extracted from Slack message blocks JSON.  
      - System prompt enforces strict use of handbook data only; includes rules for escalation and email composition.  
      - Uses multiple tools: Handbook (Google Docs), HeadersList (Google Sheets), departmentsEmails2 (Google Sheets), Send Email (Gmail).  
    - Inputs:  
      - Text from Send Initial Message output.  
      - AI Language Model (OpenAI Chat Model3) output.  
      - Handbook, HeadersList, departmentsEmails2 data via ai_tool inputs.  
      - Conversation memory via Simple Memory2.  
    - Outputs:  
      - Message to Delete Initial Message node (to clear acknowledgment).  
      - May trigger Send Email node conditionally based on escalation logic.  
    - Edge Cases:  
      - API failures (OpenAI, Google Docs/Sheets).  
      - Unexpected user input format.  
      - Email sending errors.  
      - Model timeouts or rate limits.  
    - Version Specific: Requires LangChain nodes compatible with current n8n version.

  - **OpenAI Chat Model3**  
    - Type: LangChain OpenAI Chat LLM  
    - Role: Provides GPT-4o language model capabilities to AI Agent2.  
    - Config: GPT-4o model selected for advanced reasoning.  
    - Inputs: AI Agent2 queries.  
    - Outputs: Responses to AI Agent2.  
    - Credentials: OpenAI API key required.  
    - Edge Cases: API limits, invalid credentials.

  - **Handbook**  
    - Type: Google Docs Tool  
    - Role: Provides company handbook content as the authoritative knowledge base.  
    - Config: Retrieves full document content from a specified Google Docs URL.  
    - Inputs: AI Agent2 (ai_tool).  
    - Credentials: Google Docs OAuth2.  
    - Edge Cases: Access permission errors, document changes during session.

  - **HeadersList**  
    - Type: Google Sheets Tool  
    - Role: Provides a list of valid header topics to scope questions for AI validation.  
    - Config: Reads from a specific Google Sheet document and sheet.  
    - Credentials: Google Sheets OAuth2.  
    - Edge Cases: Sheet access errors, invalid or changed header list.

  - **departmentsEmails2**  
    - Type: Google Sheets Tool  
    - Role: Supplies contact information (name, emails) for HR and IT departments for escalation emails.  
    - Config: Reads from a Google Sheet containing department contacts.  
    - Credentials: Google Sheets OAuth2.  
    - Edge Cases: Missing or outdated contacts, permission errors.

  - **Send Email**  
    - Type: Gmail Tool  
    - Role: Sends HTML emails to departments when user confirms escalation.  
    - Config:  
      - Recipient email, subject, and message content dynamically filled based on AI Agent2 outputs.  
      - Attribution disabled to keep message clean.  
    - Credentials: Gmail OAuth2 account.  
    - Edge Cases: Email sending failures, quota limits, invalid addresses.

---

#### 2.5 Slack Response Management

- **Overview:**  
  Deletes the initial "I'm on it..." message to reduce clutter after AI response is ready, then sends the final answer back to the Slack channel.

- **Nodes Involved:**  
  - Delete Initial Message  
  - Send Message  

- **Node Details:**  
  - **Delete Initial Message**  
    - Type: Slack API message delete  
    - Role: Removes the acknowledgment message sent earlier to keep channel tidy.  
    - Config: Uses channel ID and message timestamp from Send Initial Message node response.  
    - Inputs: AI Agent2 output triggers this node.  
    - Outputs: Send Message node.  
    - Edge Cases: Message already deleted; permission issues.

  - **Send Message**  
    - Type: Slack API message send  
    - Role: Sends final AI-generated response to the user’s Slack channel.  
    - Config: Message text derived from AI Agent2 output; uses bot emoji icon for identification.  
    - Inputs: Delete Initial Message output.  
    - Edge Cases: Slack API errors, message formatting.

---

#### 2.6 No-Op and Ignored Messages

- **Overview:**  
  Ensures that messages from bots or irrelevant sources do not trigger further processing.

- **Nodes Involved:**  
  - No Operation, do nothing  

- **Node Details:**  
  - **No Operation, do nothing**  
    - Type: NoOp  
    - Role: Terminates workflow branch safely when message is from a bot or undesired source.  
    - Inputs: False path from Bot? node.  
    - Edge Cases: None; acts as a sink.

---

#### 2.7 Sticky Notes and Documentation Nodes

- **Overview:**  
  Provide visual documentation within the workflow for maintenance and clarity.

- **Nodes Involved:**  
  - Sticky Note (multiple: Sticky Note1 through Sticky Note10)  

- **Node Details:**  
  - These nodes contain images, explanations, and links relevant to the workflow parts, including Slack setup, AI agent customization, memory handling, handbook usage, and escalation procedures.  
  - No inputs or outputs; purely for user reference.

---

### 3. Summary Table

| Node Name             | Node Type                                | Functional Role                                | Input Node(s)       | Output Node(s)        | Sticky Note                                                                                                        |
|-----------------------|-----------------------------------------|------------------------------------------------|---------------------|-----------------------|--------------------------------------------------------------------------------------------------------------------|
| Webhook3              | Webhook                                 | Receives Slack events                           | External Slack       | Bot?                  | See Sticky Note9 for Slack webhook trigger details and subscription setup link: https://api.slack.com/apis/connections/events-api |
| Bot?                  | If                                      | Filters out bot messages                         | Webhook3            | Slack4, No Operation   | See Sticky Note8: ignores bot messages                                                                             |
| Slack4                | Slack API (Get user profile)             | Retrieves Slack user profile                     | Bot? (true)         | Send Initial Message   | See Sticky Note4: message acknowledgment with user full name                                                       |
| Send Initial Message   | Slack API (Send message)                  | Sends initial "processing" message               | Slack4               | AI Agent2             | See Sticky Note4                                                                                                    |
| Simple Memory2         | LangChain memory buffer window            | Stores last 5 messages per channel               | AI Agent2 (ai_memory) | AI Agent2             | See Sticky Note6: conversation context memory                                                                      |
| AI Agent2              | LangChain Agent                           | Core AI processing, response generation          | Send Initial Message, Handbook, HeadersList, departmentsEmails2, Simple Memory2, OpenAI Chat Model3, Send Email | Delete Initial Message | See Sticky Note3: AI agent powered by OpenAI; See Sticky Note7: how to change AI model                             |
| OpenAI Chat Model3     | LangChain OpenAI Chat LLM                 | Language model GPT-4o                            | AI Agent2 (ai_languageModel) | AI Agent2         | See Sticky Note3                                                                                                    |
| Handbook               | Google Docs Tool                          | Retrieves company handbook content               | AI Agent2 (ai_tool)  | AI Agent2              | See Sticky Note25: handbook contains HR related info                                                               |
| HeadersList            | Google Sheets Tool                        | Retrieves list of valid header topics            | AI Agent2 (ai_tool)  | AI Agent2              |                                                                                                                    |
| departmentsEmails2     | Google Sheets Tool                        | Retrieves department contact emails               | AI Agent2 (ai_tool)  | AI Agent2              | See Sticky Note5: department contact info in Google Sheets                                                         |
| Send Email             | Gmail Tool                               | Sends escalation emails                           | AI Agent2 (ai_tool)  | AI Agent2              | See Sticky Note1: notifies HR when no answer found                                                                 |
| Delete Initial Message | Slack API (Delete message)                | Deletes initial acknowledgment message           | AI Agent2             | Send Message           | See Sticky Note2: deletes receipt to reduce clutter                                                                |
| Send Message           | Slack API (Send message)                  | Sends final AI response message                   | Delete Initial Message|                       |                                                                                                                    |
| No Operation, do nothing | NoOp                                    | Terminates flow for bot messages                  | Bot? (false)          |                       |                                                                                                                    |
| Sticky Note1 to 10     | Sticky Note                              | Visual documentation and instructions             | None                 | None                  | Various sticky notes provide explanations and useful links                                                         |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Webhook Node (Webhook3)**  
   - Type: Webhook (POST method)  
   - Path: (empty or desired)  
   - Options: Set "No Response Body" to true to avoid Slack timeout errors  
   - Purpose: Receive Slack event payloads from Slack Events API subscription.

2. **Add If Node (Bot?)**  
   - Type: If  
   - Condition: Check if the Slack event JSON contains any bot-related fields (`body.event.bot_profile`, `body.event.previous_message.bot_profile`, `body.event.bot_id`)  
   - Logic: True if none of these exist (i.e., message from a user)  
   - Connect Webhook3 output to this node.

3. **Add No Operation Node (No Operation, do nothing)**  
   - Type: NoOp  
   - Connect Bot? false output (bot messages) to NoOp node to terminate workflow branch.

4. **Add Slack Node (Slack4)**  
   - Type: Slack API - User Get Profile  
   - Credentials: Configure Slack API credential with OAuth2 token.  
   - Parameters: Set user ID dynamically to `={{ $json.body.event.user }}` from webhook.  
   - Connect Bot? true output to this node.

5. **Add Slack Node (Send Initial Message)**  
   - Type: Slack API - Send Message  
   - Credentials: Use same Slack API credential.  
   - Parameters:  
     - Channel ID: `={{ $('Webhook3').item.json.body.event.channel }}` (from webhook)  
     - Text: `=:alert: I'm on it {{ $json.real_name }}! checking my data...one second please.....` (use expression to insert real_name from Slack4).  
   - Connect Slack4 output to this node.

6. **Add LangChain Memory Node (Simple Memory2)**  
   - Type: LangChain memory buffer window  
   - Parameters:  
     - Session key: `={{ $('Webhook3').item.json.body.event.channel }}` (use Slack channel to maintain separate sessions)  
   - Connect AI Agent2’s ai_memory input to this node.

7. **Add Google Docs Node (Handbook)**  
   - Type: Google Docs Tool - Get Document content  
   - Credentials: Google Docs OAuth2  
   - Parameters: Provide company handbook Google Docs URL.  
   - Connect AI Agent2’s ai_tool input to this node.

8. **Add Google Sheets Node (HeadersList)**  
   - Type: Google Sheets Tool - Read Sheet  
   - Credentials: Google Sheets OAuth2  
   - Parameters: Provide spreadsheet ID and sheet name containing header list.  
   - Connect AI Agent2’s ai_tool input.

9. **Add Google Sheets Node (departmentsEmails2)**  
   - Type: Google Sheets Tool - Read Sheet  
   - Credentials: Google Sheets OAuth2  
   - Parameters: Provide spreadsheet ID and sheet name with department emails (HR and IT).  
   - Connect AI Agent2’s ai_tool input.

10. **Add OpenAI Chat Model Node (OpenAI Chat Model3)**  
    - Type: LangChain OpenAI Chat LLM  
    - Credentials: OpenAI API key with access to GPT-4o.  
    - Parameters: Select model "gpt-4o"  
    - Connect AI Agent2’s ai_languageModel input to this node.

11. **Add LangChain Agent Node (AI Agent2)**  
    - Type: LangChain Agent  
    - Parameters:  
      - Text input: `={{ $('Webhook3').item.json.body.event.blocks[0].elements[0].elements[0].text }}` (extract user message from Slack event JSON)  
      - System message: Define instructions to strictly use Handbook and HeadersList, handle escalation logic, and compose emails only with user confirmation.  
      - Tools: Connect Handbook, HeadersList, departmentsEmails2, Send Email as ai_tools.  
      - Language model input connected to OpenAI Chat Model3.  
      - Memory input connected to Simple Memory2.  
    - Connect Send Initial Message main output to AI Agent2 main input.

12. **Add Slack Node (Delete Initial Message)**  
    - Type: Slack API - Delete Message  
    - Credentials: Slack API  
    - Parameters:  
      - Channel ID: `={{ $('Send Initial Message').item.json.channel }}`  
      - Timestamp: `={{ $('Send Initial Message').item.json["message_timestamp"] }}`  
    - Connect AI Agent2 main output to this node.

13. **Add Slack Node (Send Message)**  
    - Type: Slack API - Send Message  
    - Credentials: Slack API  
    - Parameters:  
      - Channel ID: `={{ $('Webhook3').item.json.body.event.channel }}`  
      - Text: `={{ $('AI Agent2').item.json.output }}` (final AI answer)  
      - Bot profile: Icon emoji `:robot_face:`  
    - Connect Delete Initial Message main output to this node.

14. **Add Gmail Node (Send Email)**  
    - Type: Gmail Tool - Send Email  
    - Credentials: Gmail OAuth2 account with send permission  
    - Parameters:  
      - Send To: dynamic, from AI Agent2 output (user confirmed escalation)  
      - Subject: dynamic, e.g., “Question regarding Company Policy/ IT”  
      - Message: professional HTML email generated by AI Agent2  
    - Connect AI Agent2 ai_tool output for email sending.

15. **Add No Operation Node (No Operation, do nothing)**  
    - Use to handle false branch of Bot? node to safely stop processing bot messages.

16. **Configure Slack Event Subscription:**  
    - In Slack App Dashboard, subscribe to message events and point event callback URL to Webhook3 URL.

17. **Set Up Credentials:**  
    - Slack API OAuth2 with correct scopes (chat:write, users:read, channels:read, chat:write.public, im:write, im:history).  
    - OpenAI API key with GPT-4o access.  
    - Google OAuth2 credentials for Docs and Sheets access, with read permissions.  
    - Gmail OAuth2 credentials for sending emails.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                 | Context or Link                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| Slack Events API subscription setup is required to forward Slack message events to this workflow’s webhook. See Slack documentation for details: https://api.slack.com/apis/connections/events-api                             | Slack webhook trigger setup (Sticky Note9)                                                                         |
| The AI Agent is powered by OpenAI GPT-4o, but can be configured to use other supported LLMs via LangChain node options.                                                                                                     | AI Agent customization (Sticky Note3, Sticky Note7)                                                                |
| The conversation memory stores the last 5 messages per Slack channel to maintain context and avoid confusion between users. Increasing storage can be done by changing memory medium or window size.                         | Memory buffer explanation (Sticky Note6)                                                                            |
| The company handbook and headers list are stored in Google Docs and Google Sheets respectively, providing the authoritative knowledge base for AI responses.                                                                | Handbook and HeadersList usage (Sticky Note25, Sticky Note10)                                                       |
| Department emails for HR and IT are maintained in a Google Sheet to facilitate escalation and notification emails.                                                                                                          | Department contacts info (Sticky Note5)                                                                              |
| Upon receiving a Slack message, an immediate “I’m on it” message is sent to acknowledge receipt, which is later deleted to avoid clutter after the AI response is sent.                                                     | Slack response flow (Sticky Note4, Sticky Note2)                                                                     |
| Escalation emails are only sent after user confirmation, following strict rules to keep the AI responses accurate and limited to handbook content.                                                                         | Escalation email logic described in AI Agent2 system message                                                        |
| The workflow requires proper credential configuration for Slack, Google Docs, Google Sheets, OpenAI, and Gmail to function correctly.                                                                                       | Credential setup mandatory for all integrations                                                                     |

---

**Disclaimer:** The text provided is exclusively generated from an n8n workflow automation. It complies strictly with content policies and contains no illegal, offensive, or protected elements. All processed data is legal and public.