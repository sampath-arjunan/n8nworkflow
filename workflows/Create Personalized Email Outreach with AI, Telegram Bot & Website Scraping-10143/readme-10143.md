Create Personalized Email Outreach with AI, Telegram Bot & Website Scraping

https://n8nworkflows.xyz/workflows/create-personalized-email-outreach-with-ai--telegram-bot---website-scraping-10143


# Create Personalized Email Outreach with AI, Telegram Bot & Website Scraping

### 1. Workflow Overview

This n8n workflow automates the creation and sending of personalized cold email outreach campaigns using AI, Telegram interaction, and website scraping. It is designed primarily as a demo tool for AI and automation agencies to showcase personalized email generation capabilities interactively.

The workflow logically divides into the following blocks:

- **1.1 User Interaction & Input Validation via Telegram:** Receives user input through Telegram, validates and formats it, enforcing usage limits.
- **1.2 Website Crawling & Link Extraction:** Uses HTTP requests and intelligent crawling (Crawl4AI) to extract sub-links from the provided website.
- **1.3 Content Extraction & Summarization:** Fetches content from sub-links, processes and summarizes webpage content with AI.
- **1.4 Email Content Crafting:** Generates personalized email subject and body using AI based on the scraped and summarized data.
- **1.5 Email Dispatch & Logging:** Sends the crafted email via SparkPost SMTP, notifies the user on Telegram, and logs interactions in a database.
- **1.6 RAG Agent & Guided Demo Interaction:** Incorporates a Retrieval-Augmented Generation (RAG) AI agent to guide the user through the demo, including form templates and instructions.

---

### 2. Block-by-Block Analysis

#### 1.1 User Interaction & Input Validation via Telegram

- **Overview:**  
  Handles incoming messages from Telegram users, ensures the input is correctly formatted, enforces usage limits, and prepares the user data for further processing.

- **Nodes Involved:**  
  - Telegram Trigger  
  - If1  
  - Check how many email created by id  
  - calculate how many session  
  - set maximum email per id  
  - apologize message  
  - Code in JavaScript  
  - If2  
  - notif email creating  
  - missing input notif  
  - Edit Fields5  
  - answer query  
  - Sticky Note (name: Instructor+RAG Agent)  

- **Node Details:**

  - **Telegram Trigger**  
    - Type: Telegram Trigger node  
    - Role: Entry point triggered by any new Telegram message  
    - Config: Listens for "message" updates; uses Telegram API credentials  
    - Inputs: Telegram messages  
    - Outputs: Raw Telegram message objects  
    - Failures: Telegram API connectivity or webhook issues  
    - Notes: The primary user entry to the workflow.

  - **If1**  
    - Type: If node  
    - Role: Checks if Telegram message starts with "!" to filter commands  
    - Config: Checks if message text starts with "!"  
    - Inputs: Telegram Trigger output  
    - Outputs:  
      - True: Proceed to check email count  
      - False: Send input to RAG AI Agent for interactive guidance  
    - Failures: Expression evaluation errors if message text missing

  - **Check how many email created by id**  
    - Type: Data Table node (get operation)  
    - Role: Retrieves count of emails generated by the Telegram user's ID from log table  
    - Config: Filters by Telegram_id matching user ID  
    - Inputs: If1 True branch  
    - Outputs: Existing email logs data  
    - Failures: Database connectivity or query errors

  - **calculate how many session**  
    - Type: Aggregate node  
    - Role: Counts total Telegram_id entries (emails sent) for the user  
    - Config: Aggregates by Telegram_id field  
    - Inputs: Data from "Check how many email created by id"  
    - Outputs: Count of sent emails  
    - Failures: Aggregation errors or empty results

  - **set maximum email per id**  
    - Type: Switch node  
    - Role: Enforces a maximum of 3 emails per user  
    - Config: Routes flow based on whether userâ€™s email count > 2 or â‰¤ 2  
    - Inputs: Count from "calculate how many session"  
    - Outputs:  
      - >2: Apologize message node  
      - â‰¤2: Process user input further  
    - Failures: Logic misconfiguration or missing count

  - **apologize message**  
    - Type: Telegram node (send message)  
    - Role: Sends a polite message to user when their demo usage limit is exceeded  
    - Config: Static text "Thank you, but the demo can only be used up to 3 times. ðŸ˜”"  
    - Inputs: Switch node output (>2)  
    - Outputs: None  
    - Failures: Telegram API send failures

  - **Code in JavaScript** (Input Parsing)  
    - Type: Code node  
    - Role: Parses user input form from Telegram message text into JSON fields (name, email, website)  
    - Logic: Splits input text by lines, trims, and extracts lines 2-4 as fields  
    - Inputs: Telegram message text  
    - Outputs: JSON object with keys: name, email, website  
    - Failures: Malformed input or missing lines

  - **If2**  
    - Type: If node  
    - Role: Validates that name, email, and website fields are non-empty  
    - Config: Checks all three fields for not empty  
    - Inputs: Output from code node  
    - Outputs:  
      - True: Proceed to notify email creation  
      - False: Send missing input notification  
    - Failures: Expression evaluation issues

  - **notif email creating**  
    - Type: Telegram node  
    - Role: Notifies user that email creation is in progress  
    - Config: Sends "Creating email..." with notification disabled  
    - Inputs: If2 True branch  
    - Outputs: Passes data forward  
    - Failures: Telegram send errors

  - **missing input notif**  
    - Type: Telegram node  
    - Role: Sends user instructions if input is invalid or incomplete  
    - Config: Sends template reminder message with "!FORM" instructions  
    - Inputs: If2 False branch  
    - Outputs: None  
    - Failures: Telegram send errors

  - **Edit Fields5**  
    - Type: Set node  
    - Role: Prepares chat input and sessionId fields for RAG AI Agent  
    - Config: Sets variables: chatInput = message text, sessionId = Telegram chat id  
    - Inputs: If1 False branch (non-command messages)  
    - Outputs: Structured data for RAG AI Agent

  - **answer query**  
    - Type: Telegram node  
    - Role: Sends RAG AI Agent's response back to Telegram user  
    - Config: Sends text stored in json.output to user chat id  
    - Inputs: RAG AI Agent output  
    - Outputs: None

  - **Sticky Note â€” Instructor+RAG Agent**  
    - Purpose: Indicates this block contains instructor and RAG Agent nodes guiding the user through demo interaction.

---

#### 1.2 Website Crawling & Link Extraction

- **Overview:**  
  Extracts sitemap and other sub-links from the user-provided website URL using HTTP requests and fallback to Crawl4AI crawling service to gather relevant URLs for content scraping.

- **Nodes Involved:**  
  - Edit Fields  
  - sitemap.xml request  
  - sitemap_index.xml request  
  - XML  
  - make link array to string  
  - HTTP Request  
  - crawl4ai  
  - extract link  
  - Links ranking  
  - Split Out  
  - HTTP Request1  
  - Markdown1  
  - crawl4ai1  
  - broken links notif  
  - Sticky Note3  
  - Sticky Note4  

- **Node Details:**

  - **Edit Fields**  
    - Type: Set node  
    - Role: Formats and sets Name, Website (with https prefix), and Receive_Email from parsed input  
    - Inputs: notif email creating  
    - Outputs: Passes formatted fields forward

  - **sitemap.xml request**  
    - Type: HTTP Request  
    - Role: Attempts to fetch the websiteâ€™s sitemap.xml file for links  
    - Inputs: Edit Fields output (Website)  
    - Outputs: XML sitemap data or error  
    - Failures: 404 or connection errors  

  - **sitemap_index.xml request**  
    - Type: HTTP Request  
    - Role: Attempts alternate sitemap_index.xml in case sitemap.xml is unavailable  
    - Inputs: sitemap.xml request output  
    - Outputs: XML sitemap index data or error

  - **XML**  
    - Type: XML node  
    - Role: Parses sitemap XML data into JSON for processing  
    - Inputs: sitemap.xml or sitemap_index.xml request outputs  
    - Outputs: Parsed JSON with URLs

  - **make link array to string**  
    - Type: Code node  
    - Role: Extracts all URLs from parsed XML into a newline-separated string  
    - Inputs: XML node output  
    - Outputs: JSON containing concatenated URL list

  - **HTTP Request**  
    - Type: HTTP Request  
    - Role: Fetches the raw HTML content of the main website URL  
    - Inputs: Edit Fields output (Website)  
    - Outputs: Website page HTML or error  
    - On error: Continues with fallback options

  - **crawl4ai**  
    - Type: HTTP Request (POST)  
    - Role: Calls an intelligent crawl service to extract URLs if basic sitemap or HTTP request fails or is insufficient  
    - Inputs: HTTP Request output (Website URL)  
    - Outputs: Crawled data with links in markdown format  
    - Retry on fail: Yes

  - **extract link**  
    - Type: Code node  
    - Role: Extracts unique HTTP/HTTPS links from Crawl4AI markdown raw data  
    - Inputs: crawl4ai output  
    - Outputs: String of unique links, one per line

  - **Links ranking**  
    - Type: OpenAI node  
    - Role: Uses AI to analyze and select up to 5 most useful links for personalized email  
    - Inputs: Concatenated links from sitemap, crawl, and HTTP requests  
    - Outputs: JSON with "BestLinks" array of URLs

  - **Split Out**  
    - Type: Split Out node  
    - Role: Splits BestLinks array into individual messages for separate processing  
    - Inputs: Links ranking output  
    - Outputs: Individual URLs for further requests

  - **HTTP Request1**  
    - Type: HTTP Request  
    - Role: Fetches content from each selected sub-link URL  
    - Inputs: Split Out output (single URL)  
    - Outputs: HTML content of sub-pages  
    - On error: Continues without failing entire flow

  - **Markdown1**  
    - Type: Markdown node  
    - Role: Converts fetched HTML content into markdown format for AI analysis  
    - Inputs: HTTP Request1 output  
    - Outputs: Markdown content

  - **crawl4ai1**  
    - Type: HTTP Request (POST)  
    - Role: Alternative Crawl4AI crawl for sub-links if HTTP Request1 fails or as supplementary method  
    - Inputs: Output from HTTP Request1 or Links ranking  
    - Outputs: Crawl4AI markdown data for sub-links  
    - Retry on fail: Yes

  - **broken links notif**  
    - Type: Telegram node  
    - Role: Informs user that some links might be broken if crawl or requests are incomplete  
    - Inputs: crawl4ai1 output  
    - Outputs: Notification message to Telegram user

  - **Sticky Note3 & Sticky Note4**  
    - Content: Visual documentation markers titled "Extract sublinks from a website" and "Extract content from sublinks" respectively.

---

#### 1.3 Content Extraction & Summarization

- **Overview:**  
  Processes the gathered sub-link content, normalizes markdown, trims to token limits, and uses AI to generate concise page summaries for email personalization.

- **Nodes Involved:**  
  - Merge  
  - trim markdown to less token  
  - flattext  
  - Page Sumarize  
  - Aggregate  

- **Node Details:**

  - **Merge**  
    - Type: Merge node  
    - Role: Consolidates multiple markdown content items into a single stream for processing  
    - Inputs: Markdown1 and crawl4ai1 outputs  
    - Outputs: Merged content stream

  - **trim markdown to less token**  
    - Type: Code node  
    - Role: Cleans markdown by removing extraneous formatting, links, and normalizes text; splits content into sections with minimized tokens  
    - Inputs: Merge output  
    - Outputs: Structured markdown sections and flattened text

  - **flattext**  
    - Type: Set node  
    - Role: Sets the preprocessed flattened text for AI summarization  
    - Inputs: trim markdown to less token output  
    - Outputs: JSON with flattext field

  - **Page Sumarize**  
    - Type: OpenAI node  
    - Role: Generates a detailed abstract summary of the page content, focusing on company products, market condition, and implied beliefs, returning JSON with abstract  
    - Inputs: flattext output  
    - Outputs: JSON abstract  
    - Model: GPT-4o-mini  
    - Failures: OpenAI API errors, token limit exceedance

  - **Aggregate**  
    - Type: Aggregate node  
    - Role: Aggregates multiple page abstracts into a list for the next AI processing step  
    - Inputs: Page Sumarize output  
    - Outputs: JSON array of abstracts

---

#### 1.4 Email Content Crafting

- **Overview:**  
  Uses AI to craft a personalized cold email subject and body based on the aggregated page summaries and user details. Prepares email parameters for sending.

- **Nodes Involved:**  
  - Email Craft  
  - sender + signature  

- **Node Details:**

  - **Email Craft**  
    - Type: OpenAI node  
    - Role: Generates catchy, personalized email openers (subject and body) using a detailed prompt that includes scraped summaries and user name  
    - Inputs: Aggregated abstracts and user data (Name)  
    - Outputs: JSON with "Subject" and "Body" fields  
    - Model: GPT-5-mini  
    - Failures: API errors, prompt data formatting issues

  - **sender + signature**  
    - Type: Set node  
    - Role: Sets email sending parameters including sender email, recipient email, subject line, email body, and signature  
    - Inputs: Email Craft output and Edit Fields output (for recipient email)  
    - Outputs: Fully prepared email data for dispatch  
    - Failures: Missing or invalid email fields

---

#### 1.5 Email Dispatch & Logging

- **Overview:**  
  Sends the personalized email to the recipient using SparkPost SMTP and logs the user interaction in a data table. Also notifies the user on Telegram about completion.

- **Nodes Involved:**  
  - Send email  
  - Finish notif  
  - insert log  

- **Node Details:**

  - **Send email**  
    - Type: Email Send node  
    - Role: Sends the personalized email via SMTP (SparkPost) using configured credentials  
    - Inputs: sender + signature output  
    - Outputs: Confirmation of sent email or error  
    - Failures: SMTP authentication errors, network issues

  - **Finish notif**  
    - Type: Telegram node  
    - Role: Notifies Telegram user that the email was sent successfully and to check their inbox  
    - Inputs: Send email success output  
    - Outputs: Telegram notification message

  - **insert log**  
    - Type: Data Table node (insert operation)  
    - Role: Inserts user data (name and Telegram ID) into log table to track demo usage  
    - Inputs: Finish notif output  
    - Outputs: Log record confirmation  
    - Failures: Database insert errors

---

#### 1.6 RAG Agent & Guided Demo Interaction

- **Overview:**  
  Implements a Retrieval-Augmented Generation AI agent that guides users through the demo, provides form templates, answers questions, and manages user interaction dynamically.

- **Nodes Involved:**  
  - Edit Fields5  
  - RAG AI Agent  
  - List Documents  
  - Get File Contents  
  - Query Document Rows  
  - Postgres PGVector Store  
  - Postgres Chat Memory  
  - OpenAI Chat Model  

- **Node Details:**

  - **Edit Fields5**  
    - Type: Set node  
    - Role: Prepares chatInput and sessionId from Telegram message text and chat id for RAG processing  
    - Inputs: If1 False branch (non-command messages)  
    - Outputs: Prepared input for RAG AI Agent

  - **RAG AI Agent**  
    - Type: Langchain Agent node  
    - Role: Processes user queries with RAG logic combining document retrieval and language model generation  
    - Inputs: chatInput, sessionId, and tool outputs (documents, database)  
    - Outputs: Generated responses to user queries  
    - Features: Uses system prompt for demo guidance and form handling; refuses to invent answers  
    - Failures: AI model or database query errors

  - **List Documents, Get File Contents, Query Document Rows, Postgres PGVector Store, Postgres Chat Memory, OpenAI Chat Model**  
    - Types: Various Langchain nodes for document retrieval, embedding, vector store querying, and memory management  
    - Roles: Support the RAG AI Agent by providing document data, embeddings, chat memory, and language model responses  
    - Inputs/Outputs: Interconnected to support RAG queries  
    - Failures: Database or API errors

---

### 3. Summary Table

| Node Name                    | Node Type                              | Functional Role                              | Input Node(s)                     | Output Node(s)                 | Sticky Note                                                                                                   |
|------------------------------|--------------------------------------|----------------------------------------------|----------------------------------|-------------------------------|--------------------------------------------------------------------------------------------------------------|
| Telegram Trigger             | Telegram Trigger                     | Entry point for Telegram messages             | -                                | If1                           |                                                                                                              |
| If1                         | If                                  | Checks if message starts with "!" command     | Telegram Trigger                 | Check how many email created by id, Edit Fields5 |                                                                                                              |
| Check how many email created by id | Data Table (get)                   | Retrieves count of emails per user             | If1                             | calculate how many session     |                                                                                                              |
| calculate how many session   | Aggregate                           | Counts total emails sent by user               | Check how many email created by id | set maximum email per id       |                                                                                                              |
| set maximum email per id     | Switch                             | Limits demo usage to 3 emails per Telegram ID | calculate how many session       | apologize message, Code in JavaScript |                                                                                                              |
| apologize message            | Telegram (send)                    | Sends usage limit exceeded message             | set maximum email per id         | -                             |                                                                                                              |
| Code in JavaScript           | Code                               | Parses Telegram message into form JSON         | set maximum email per id         | If2                           |                                                                                                              |
| If2                         | If                                  | Validates presence of name, email, website    | Code in JavaScript               | notif email creating, missing input notif |                                                                                                              |
| notif email creating         | Telegram (send)                    | Notifies user email creation started          | If2                            | Edit Fields                   |                                                                                                              |
| missing input notif          | Telegram (send)                    | Sends form usage instructions                  | If2                            | -                             |                                                                                                              |
| Edit Fields5                | Set                                | Prepares chat input & sessionId for RAG agent | If1                            | RAG AI Agent                  | ## Instructor+RAG Agent                                                                                      |
| answer query                | Telegram (send)                    | Sends RAG AI Agent responses back to user    | RAG AI Agent                   | -                             |                                                                                                              |
| Edit Fields                 | Set                                | Prepares Name, Website (with https), Receive_Email | notif email creating            | sitemap.xml request           | ## Extract sublinks from a website                                                                           |
| sitemap.xml request         | HTTP Request                      | Fetches sitemap.xml from website               | Edit Fields                    | XML, sitemap_index.xml request |                                                                                                              |
| sitemap_index.xml request   | HTTP Request                      | Fetches sitemap_index.xml as fallback          | sitemap.xml request            | XML, HTTP Request             |                                                                                                              |
| XML                        | XML                                | Parses sitemap XML                              | sitemap.xml request, sitemap_index.xml request | make link array to string      |                                                                                                              |
| make link array to string   | Code                               | Extracts URLs list from sitemap XML             | XML                            | Links ranking                 |                                                                                                              |
| HTTP Request               | HTTP Request                      | Fetches main website HTML content               | sitemap_index.xml request       | Markdown, crawl4ai            |                                                                                                              |
| crawl4ai                   | HTTP Request                      | Intelligent crawl fallback for website URLs    | HTTP Request                   | extract link                 |                                                                                                              |
| extract link               | Code                               | Extracts unique links from Crawl4AI markdown   | crawl4ai                      | Links ranking                 |                                                                                                              |
| Links ranking              | OpenAI                            | Selects up to 5 most relevant links             | make link array to string, extract link, HTTP Request | Split Out                    |                                                                                                              |
| Split Out                  | Split Out                         | Splits BestLinks array into individual URLs    | Links ranking                 | HTTP Request1                 |                                                                                                              |
| HTTP Request1              | HTTP Request                      | Fetches content of each sub-link URL            | Split Out                    | Markdown1, crawl4ai1          |                                                                                                              |
| Markdown1                  | Markdown                          | Converts sub-link HTML to markdown              | HTTP Request1                | Merge                        |                                                                                                              |
| crawl4ai1                  | HTTP Request                      | Crawl4AI fallback for sub-links content         | HTTP Request1                | Edit Fields3, broken links notif |                                                                                                              |
| broken links notif         | Telegram (send)                   | Notifies user of potentially broken links       | crawl4ai1                   | -                           |                                                                                                              |
| Merge                      | Merge                             | Merges markdown inputs for summarization       | Markdown1, crawl4ai1          | trim markdown to less token  |                                                                                                              |
| trim markdown to less token | Code                               | Cleans and normalizes markdown for token limits | Merge                        | flattext                    |                                                                                                              |
| flattext                   | Set                                | Sets flattened text for AI summarization        | trim markdown to less token    | Page Sumarize                |                                                                                                              |
| Page Sumarize              | OpenAI                            | Creates page abstracts summarizing content      | flattext                     | Aggregate                   |                                                                                                              |
| Aggregate                  | Aggregate                         | Aggregates multiple abstracts into list          | Page Sumarize                | Email Craft                 |                                                                                                              |
| Email Craft                | OpenAI                            | Crafts personalized email subject and body      | Aggregate                   | sender + signature           | ## Crafting and sending email                                                                                 |
| sender + signature         | Set                                | Prepares email sending fields including signature | Email Craft                 | Send email                  |                                                                                                              |
| Send email                 | Email Send                       | Sends personalized email via SMTP (SparkPost)   | sender + signature           | Finish notif                |                                                                                                              |
| Finish notif               | Telegram (send)                  | Notifies user email was sent                      | Send email                  | insert log                  |                                                                                                              |
| insert log                 | Data Table (insert)              | Logs user interaction (name, Telegram ID)       | Finish notif                | -                           |                                                                                                              |
| List Documents             | Postgres Tool                   | Retrieves documents metadata for RAG             | -                            | RAG AI Agent (ai_tool)       |                                                                                                              |
| Get File Contents          | Postgres Tool                   | Fetches document text by file ID                  | -                            | RAG AI Agent (ai_tool)       |                                                                                                              |
| Query Document Rows        | Postgres Tool                   | Executes SQL queries on document rows             | -                            | RAG AI Agent (ai_tool)       |                                                                                                              |
| Postgres PGVector Store    | Vector Store                    | Retrieves embeddings for RAG knowledge retrieval  | Embeddings OpenAI2           | RAG AI Agent (ai_embedding) |                                                                                                              |
| Embeddings OpenAI2         | Embeddings                      | Generates vector embeddings from text             | -                            | Postgres PGVector Store (ai_embedding) |                                                                                                              |
| Postgres Chat Memory       | Memory                         | Stores chat session memory for RAG agent          | -                            | RAG AI Agent (ai_memory)    |                                                                                                              |
| OpenAI Chat Model          | Language Model                 | Provides conversational AI model for RAG           | -                            | RAG AI Agent (ai_languageModel) |                                                                                                              |
| RAG AI Agent              | Langchain Agent                | Guides user with retrieval-augmented generation    | Edit Fields5, List Documents, Get File Contents, Query Document Rows, Postgres PGVector Store, Postgres Chat Memory, OpenAI Chat Model | answer query             | ## Instructor+RAG Agent                                                                                      |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Telegram Bot & Setup Trigger**  
   - Create Telegram bot via BotFather and obtain API token.  
   - Add a "Telegram Trigger" node: Configure with Telegram API credentials, listen for "message" updates.

2. **Add Input Validation and Usage Limits**  
   - Add an "If" node (If1) to detect if message starts with "!" (commands).  
   - Add a Data Table node (get operation) to query existing logs for Telegram user ID.  
   - Add an Aggregate node to count emails sent by this ID.  
   - Add a Switch node to enforce max 3 emails per user: route accordingly.  
   - Add Telegram nodes for:  
     - Apology message if limit exceeded.  
     - Notification message "Creating email..." if within limit.  
   - Add a "Code" node to parse Telegram message into JSON form with fields: name, email, website.  
   - Add an "If" node to check that all fields are present.  
   - Add Telegram node to send missing input notification if validation fails.

3. **Set Formatted User Fields**  
   - Use a "Set" node to assign Name, Website (prefix with https), and Receive_Email from parsed form.

4. **Extract Sitemap and Sub-Links**  
   - Add HTTP Request nodes to fetch `/sitemap.xml` and `/sitemap_index.xml` from user's website.  
   - Use an XML node to parse sitemap XML responses.  
   - Add a Code node to extract all URLs from XML into newline-separated string.  
   - Add an HTTP Request node to fetch main website content.  
   - Add a fallback HTTP Request node invoking Crawl4AI API with JSON body containing the website URL for crawling.  
   - Use a Code node to extract links from Crawl4AI markdown output.  
   - Combine all links, then use an OpenAI node to rank and select up to 5 best links for email personalization.

5. **Fetch Content from Selected Links**  
   - Use a Split Out node to process each selected link individually.  
   - For each, add an HTTP Request node to fetch page content.  
   - Convert page HTML to markdown using a Markdown node.  
   - Add a fallback Crawl4AI call for sub-links if HTTP request fails.  
   - Notify user via Telegram if broken links are detected.

6. **Content Normalization and Summarization**  
   - Merge all markdown content streams.  
   - Use a Code node to clean and normalize markdown, removing formatting and links, trimming token count.  
   - Store flattened text in a Set node.  
   - Use an OpenAI node to generate a detailed page abstract in JSON format.  
   - Aggregate all page abstracts into an array.

7. **Generate Personalized Email Content**  
   - Use an OpenAI node with a prompt to create catchy, personalized email subject and body based on page summaries and user data.  
   - Use a Set node to prepare email parameters: sender email, recipient email, subject, body, and signature.

8. **Send Email and Notify User**  
   - Add an Email Send node configured with SparkPost SMTP credentials to send the email.  
   - Notify user on Telegram that email has been sent.  
   - Insert a log record with user name and Telegram ID in Data Table to track usage.

9. **Setup RAG Agent for Guided Interaction**  
   - Add Set node to prepare chatInput and sessionId from Telegram message.  
   - Add Langchain nodes for:  
     - Document metadata retrieval  
     - Document content retrieval  
     - SQL query execution on document rows  
     - Postgres PGVector vector store for embeddings  
     - OpenAI embeddings node  
     - Postgres chat memory node  
     - OpenAI Chat model node  
   - Configure RAG AI Agent node with system prompt to guide user, validate input form, and provide instructions dynamically.  
   - Connect RAG AI Agent output to Telegram node to send replies.

10. **Add Sticky Notes for Documentation**  
    - Add Sticky Note nodes with content explaining each logical block for documentation and clarity.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Context or Link                                                                                           |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| This n8n workflow is designed as an interactive demo for AI and automation agencies to showcase personalized email outreach capabilities. It uses Telegram as an interface, Crawl4AI for website scraping, OpenAI models for summarization and email crafting, and SparkPost for sending emails. The workflow includes usage limits per user to prevent abuse and rich RAG AI guidance for user assistance.                                                                                                                                                                               | Workflow description                                                                                      |
| Requires setting up a Telegram bot via BotFather to obtain API credentials.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | [Telegram BotFather](https://t.me/BotFather)                                                             |
| Requires Crawl4AI running in Docker for advanced crawling capabilities.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | [Crawl4AI GitHub](https://github.com/unclecode/crawl4ai)                                                  |
| Uses SparkPost SMTP for sending emails; requires SparkPost account and SMTP credentials setup.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | [SparkPost](https://www.sparkpost.com/)                                                                  |
| Workflow limits demo use to 3 emails per Telegram ID to avoid spam or misuse.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Workflow limit logic                                                                                       |
| RAG AI Agent uses PostgreSQL database with PGVector vector store for document retrieval and chat memory storage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | PostgreSQL with PGVector setup                                                                              |
| Live demo Telegram bot is accessible at [@email_demo_bot](https://t.me/email_demo_bot)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Live demo link                                                                                             |
| The workflow gracefully escalates scraping efforts from sitemap.xml to Crawl4AI if initial methods fail or return incomplete data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Scraping logic escalation                                                                                   |
| The email content generation AI uses a detailed prompt specifying tone, personalization rules, and format ensuring consistent output.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Email crafting prompt details                                                                               |

---

This complete analysis enables understanding, reproduction, and modification of the workflow while anticipating potential issues like API failures, invalid input, and scraping errors.