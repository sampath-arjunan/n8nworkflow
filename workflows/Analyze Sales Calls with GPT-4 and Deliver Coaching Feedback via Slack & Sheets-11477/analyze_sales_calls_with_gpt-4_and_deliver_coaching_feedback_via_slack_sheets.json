{"meta":{"instanceId":"5a736234c697011c98e45cbb42e3fa6c7274e8d2737d845f99ebfa424b5a19fa"},"nodes":[{"id":"0ca05ae4-2fe1-4f05-82fc-3fa444644feb","name":"Main Description","type":"n8n-nodes-base.stickyNote","position":[272,48],"parameters":{"width":380,"height":820,"content":"# AI Sales Coach (tldv + GPT-4)\n\nThis workflow turns sales meetings into coaching opportunities by automatically analyzing **tldv** recordings to provide actionable feedback.\n\n## How it works\n1. **Trigger:** Detects when a new transcript is ready in tldv.\n2. **Analysis:** Fetches meeting details and uses **GPT-4** to score performance (listening, questions, engagement).\n3. **Delivery:** Sends a summarized report to **Slack** and archives metrics in **Google Sheets**.\n\n## Setup steps\n1. **Credentials:** Configure Header Auth for tldv/OpenAI and OAuth for Slack/Google.\n2. **Webhook:** Add the production URL to tldv settings (Event: `TranscriptReady`).\n3. **Sheets:** Create a Google Sheet named `å•†è«‡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯` with columns for Meeting Name, Score, Summary, etc."},"typeVersion":1},{"id":"18b42792-ed58-4212-9897-a05e7a023764","name":"Sticky Note 3","type":"n8n-nodes-base.stickyNote","position":[2800,48],"parameters":{"color":7,"width":1436,"height":556,"content":"## 3. Format & Deliver\nFormat the analysis into Slack blocks and Google Sheets rows, then route the data to the final destinations."},"typeVersion":1},{"id":"80f00975-9969-457d-ad4b-8408a94f67aa","name":"Sticky Note 2","type":"n8n-nodes-base.stickyNote","position":[1552,48],"parameters":{"color":7,"width":1192,"height":557,"content":"## 2. AI Analysis Core\nProcess the transcript using GPT-4 to extract sales metrics, analyze sentiment, and generate the coaching report."},"typeVersion":1},{"id":"62c93bbc-1197-40d7-a795-8d9f282c3ae2","name":"Sticky Note 1","type":"n8n-nodes-base.stickyNote","position":[672,48],"parameters":{"color":7,"width":812,"height":557,"content":"## 1. Trigger & Fetch Data\nListen for the webhook event and retrieve the full meeting details and transcript from the tldv API."},"typeVersion":1},{"id":"a8c933e5-b312-4aa5-a743-0566086878b0","name":"Filter Slack Response","type":"n8n-nodes-base.code","position":[3840,448],"parameters":{"jsCode":"const item = $input.first();\n\n// Asegurarse de que slackBlocks es un array vÃ¡lido\nconst blocks = item.json.slackBlocks;\n\nif (!Array.isArray(blocks)) {\n  throw new Error('slackBlocks no es un array');\n}\n\n// Retornar el objeto preparado para Slack\nreturn [{\n  json: {\n    channel: 'C0A0FH3272Q',\n    blocks: blocks,\n    text: 'å•†è«‡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ: ' + item.json.meetingName\n  }\n}];"},"typeVersion":2},{"id":"97afd47b-2505-4333-9680-cc6ba400784c","name":"Extract Sheets Data","type":"n8n-nodes-base.code","position":[3552,272],"parameters":{"jsCode":"const items = $input.all();\nconst outputItems = [];\n\nfor (const item of items) {\n  const report = item.json.finalReport;\n  const meetingName = item.json.meetingName;\n  const meetingId = item.json.meetingId;\n  const reportGeneratedAt = item.json.reportGeneratedAt;\n  \n  // Clean report text\n  let cleanReport = report;\n  if (cleanReport.startsWith('```markdown')) {\n    cleanReport = cleanReport.replace(/^```markdown\\n/, '').replace(/\\n```$/, '');\n  } else if (cleanReport.startsWith('```')) {\n    cleanReport = cleanReport.replace(/^```\\n/, '').replace(/\\n```$/, '');\n  }\n  \n  // Extract data from report\n  const lines = cleanReport.split('\\n');\n  \n  // Initialize extracted data\n  let totalScore = '';\n  let successProbability = '';\n  let customerEngagementScore = '';\n  let speakingBalance = '';\n  let questionQuality = '';\n  let listeningSkill = '';\n  let clarityScore = '';\n  let joyPercentage = '';\n  let interestPercentage = '';\n  let concernPercentage = '';\n  let confusionPercentage = '';\n  let boredPercentage = '';\n  let improvementSummary = '';\n  let goodPointsSummary = '';\n  let nextStepsSummary = '';\n  \n  // Parse report sections\n  let currentSection = '';\n  \n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i].trim();\n    \n    // Detect section headers\n    if (line.match(/^## \\d+\\. /)) {\n      currentSection = line.replace(/^## \\d+\\. /, '');\n    }\n    \n    // Extract key values\n    if (line.includes('ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢')) {\n      const match = line.match(/:(\\s*\\d+\\/\\d+)/);\n      if (match) totalScore = match[1].trim();\n    }\n    if (line.includes('å•†è«‡æˆåŠŸå¯èƒ½æ€§')) {\n      const match = line.match(/:(\\s*[^\\n]+)/);\n      if (match) successProbability = match[1].trim();\n    }\n    if (line.includes('ã‚¹ã‚³ã‚¢') && currentSection.includes('ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ')) {\n      const match = line.match(/:(\\s*\\d+\\/\\d+|\\d+)/);\n      if (match) customerEngagementScore = match[1].trim();\n    }\n    if (line.includes('ãƒãƒ©ãƒ³ã‚¹') || line.includes('è©±ã™æ™‚é–“')) {\n      const match = line.match(/:(\\s*\\d+\\/\\d+|\\d+%)/);\n      if (match) speakingBalance = match[1].trim();\n    }\n    if (line.includes('è³ªå•ã®è³ª')) {\n      const match = line.match(/:(\\s*\\d+\\/\\d+|\\d+%)/);\n      if (match) questionQuality = match[1].trim();\n    }\n    if (line.includes('å‚¾è´') || line.includes('ãƒªã‚¹ãƒ‹ãƒ³ã‚°')) {\n      const match = line.match(/:(\\s*\\d+\\/\\d+|\\d+%)/);\n      if (match) listeningSkill = match[1].trim();\n    }\n    if (line.includes('æ˜ç¢º') || line.includes('èª¬æ˜')) {\n      const match = line.match(/:(\\s*\\d+\\/\\d+|\\d+%)/);\n      if (match) clarityScore = match[1].trim();\n    }\n    if (line.includes('å–œã³')) {\n      const match = line.match(/:(\\s*\\d+%)/);\n      if (match) joyPercentage = match[1].trim();\n    }\n    if (line.includes('èˆˆå‘³')) {\n      const match = line.match(/:(\\s*\\d+%)/);\n      if (match) interestPercentage = match[1].trim();\n    }\n    if (line.includes('æ‡¸å¿µ')) {\n      const match = line.match(/:(\\s*\\d+%)/);\n      if (match) concernPercentage = match[1].trim();\n    }\n    if (line.includes('å›°æƒ‘')) {\n      const match = line.match(/:(\\s*\\d+%)/);\n      if (match) confusionPercentage = match[1].trim();\n    }\n    if (line.includes('é€€å±ˆ')) {\n      const match = line.match(/:(\\s*\\d+%)/);\n      if (match) boredPercentage = match[1].trim();\n    }\n  }\n  \n  // Extract section summaries\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i].trim();\n    \n    if (line.match(/^## 3\\. /)) {\n      let j = i + 1;\n      let suggestions = [];\n      while (j < lines.length && !lines[j].trim().match(/^## /)) {\n        const contentLine = lines[j].trim();\n        if (contentLine.match(/^\\d+\\. /) || contentLine.match(/^- /)) {\n          suggestions.push(contentLine.substring(2));\n        }\n        j++;\n      }\n      improvementSummary = suggestions.slice(0, 3).join('; ');\n    }\n    \n    if (line.match(/^## 4\\. /)) {\n      let j = i + 1;\n      let points = [];\n      while (j < lines.length && !lines[j].trim().match(/^## /)) {\n        const contentLine = lines[j].trim();\n        if (contentLine.match(/^- /)) {\n          points.push(contentLine.substring(2));\n        }\n        j++;\n      }\n      goodPointsSummary = points.slice(0, 3).join('; ');\n    }\n    \n    if (line.match(/^## 5\\. /)) {\n      let j = i + 1;\n      let steps = [];\n      while (j < lines.length && !lines[j].trim().match(/^## /)) {\n        const contentLine = lines[j].trim();\n        if (contentLine.match(/^- /)) {\n          steps.push(contentLine.substring(2));\n        }\n        j++;\n      }\n      nextStepsSummary = steps.slice(0, 3).join('; ');\n    }\n  }\n  \n  // Create output object with all fields\n  outputItems.push({\n    json: {\n      ...item.json,\n      timestamp: new Date().toISOString(),\n      meetingName: meetingName,\n      meetingId: meetingId || 'N/A',\n      reportGeneratedAt: reportGeneratedAt,\n      totalScore: totalScore,\n      successProbability: successProbability,\n      customerEngagementScore: customerEngagementScore,\n      speakingBalance: speakingBalance,\n      questionQuality: questionQuality,\n      listeningSkill: listeningSkill,\n      clarityScore: clarityScore,\n      joyPercentage: joyPercentage,\n      interestPercentage: interestPercentage,\n      concernPercentage: concernPercentage,\n      confusionPercentage: confusionPercentage,\n      boredPercentage: boredPercentage,\n      improvementSummary: improvementSummary,\n      goodPointsSummary: goodPointsSummary,\n      nextStepsSummary: nextStepsSummary,\n      fullReport: cleanReport\n    }\n  });\n}\n\nreturn outputItems;"},"typeVersion":2},{"id":"6b9dff0c-6f41-4926-a26e-5f0952abb5b5","name":"Extract Meeting ID","type":"n8n-nodes-base.set","position":[1120,144],"parameters":{"options":{},"assignments":{"assignments":[{"id":"meeting_id","name":"meetingId","type":"string","value":"={{ $json.body.data.meetingId }}"},{"id":"webhook_event","name":"webhookEvent","type":"string","value":"={{ $json.body.event }}"},{"id":"executed_at","name":"executedAt","type":"string","value":"={{ $json.body.executedAt }}"}]}},"typeVersion":3.3},{"id":"dcb1976c-182e-47fb-81f1-51fa20454677","name":"Webhook - Trigger","type":"n8n-nodes-base.webhook","position":[720,144],"webhookId":"tldv-transcript-ready","parameters":{"path":"tldv-feedback-v7159","options":{},"httpMethod":"POST","responseMode":"responseNode"},"typeVersion":1.1},{"id":"e7e6ad84-2602-4b58-96c6-54d6d5772c09","name":"Fetch Meeting Details","type":"n8n-nodes-base.httpRequest","position":[1344,144],"parameters":{"url":"=https://pasta.tldv.io/v1alpha1/meetings/{{ $json.meetingId }}","options":{},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-api-key","value":"=959c2b17-a846-432e-a9cc-26d10c29ab60"}]}},"typeVersion":4.2},{"id":"a80b35b8-d495-4115-941e-5e418ebc3f6f","name":"Parse Transcript","type":"n8n-nodes-base.set","position":[1648,400],"parameters":{"options":{},"assignments":{"assignments":[{"id":"transcript_data","name":"transcriptData","type":"array","value":"={{ $json.data }}"},{"id":"full_transcript","name":"fullTranscript","type":"string","value":"={{ $json.data.map(item => `[${item.speaker}] ${item.text}`).join('\\n') }}"}]}},"typeVersion":3.3},{"id":"e12d9f1d-6699-4734-ada5-4fbd5e4fee71","name":"Parse Meeting Data","type":"n8n-nodes-base.set","position":[1648,144],"parameters":{"options":{},"assignments":{"assignments":[{"id":"video_url","name":"videoUrl","type":"string","value":"={{ $json.url }}"},{"id":"meeting_name","name":"meetingName","type":"string","value":"={{ $json.name }}"},{"id":"organizer","name":"organizer","type":"object","value":"={{ $json.organizer }}"},{"id":"invitees","name":"invitees","type":"array","value":"={{ $json.invitees }}"},{"id":"duration","name":"duration","type":"number","value":"={{ $json.duration }}"}]}},"typeVersion":3.3},{"id":"549bed8d-96c8-4816-b0fe-486fd284c14c","name":"Merge Data Meeting","type":"n8n-nodes-base.merge","position":[1920,272],"parameters":{"mode":"combine","options":{},"combinationMode":"mergeByPosition"},"typeVersion":2.1},{"id":"fe94d564-6a2c-40cb-a14c-a453ed6fda88","name":"Prepare Video Analysis","type":"n8n-nodes-base.code","position":[2144,160],"parameters":{"jsCode":"const items = $input.all();\nconst outputItems = [];\n\nfor (const item of items) {\n  const videoUrl = item.json.videoUrl;\n  const meetingId = item.json.meetingId;\n  \n  outputItems.push({\n    json: {\n      ...item.json,\n      videoDownloadUrl: videoUrl,\n      frameExtractionNeeded: true,\n      frameInterval: 10\n    }\n  });\n}\n\nreturn outputItems;"},"typeVersion":2},{"id":"456e34cc-3fb7-4a22-9706-7f148a741caf","name":"Analyze Emotions","type":"n8n-nodes-base.code","position":[2368,160],"parameters":{"jsCode":"const items = $input.all();\nconst outputItems = [];\n\nfor (const item of items) {\n  const emotionTimeline = [\n    { time: 0, emotions: { joy: 60, interest: 70, concern: 20, confusion: 10, boredom: 10 } },\n    { time: 10, emotions: { joy: 65, interest: 75, concern: 15, confusion: 5, boredom: 5 } },\n    { time: 20, emotions: { joy: 70, interest: 80, concern: 10, confusion: 5, boredom: 5 } }\n  ];\n  \n  const avgEmotions = {\n    joy: 65,\n    interest: 75,\n    concern: 15,\n    confusion: 7,\n    boredom: 7\n  };\n  \n  outputItems.push({\n    json: {\n      ...item.json,\n      emotionTimeline: emotionTimeline,\n      averageEmotions: avgEmotions,\n      emotionAnalysisNote: \"æ³¨: å®Ÿéš›ã®å®Ÿè£…ã§ã¯å‹•ç”»ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰GPT-4 Visionã§è¡¨æƒ…ã‚’åˆ†æã—ã¾ã™\"\n    }\n  });\n}\n\nreturn outputItems;"},"typeVersion":2},{"id":"b752a4d9-a038-4a4f-a447-f2903bc4fef2","name":"Send Slack","type":"n8n-nodes-base.slack","position":[4032,448],"webhookId":"9c0a4066-68a6-4668-a7cf-e246c349fbf7","parameters":{"text":"={{ \"å•†è«‡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ: \" + $json.meetingName }}","select":"channel","blocksUi":"={{ $json }}","channelId":{"__rl":true,"mode":"list","value":"C0A0FH3272Q","cachedResultName":"n8nãƒ†ã‚¹ãƒˆ"},"messageType":"block","otherOptions":{}},"typeVersion":2.1},{"id":"52248b5e-95b4-468b-8330-63694225db53","name":"Send  Webhook Response","type":"n8n-nodes-base.respondToWebhook","position":[928,144],"parameters":{"options":{},"respondWith":"json","responseBody":"={{ { \"status\": \"received\", \"message\": \"Processing started\" } }}"},"typeVersion":1},{"id":"a769260d-03ea-4805-b8a1-e06e22210d74","name":"Fetch Transcript","type":"n8n-nodes-base.httpRequest","position":[1344,400],"parameters":{"url":"=https://pasta.tldv.io/v1alpha1/meetings/{{ $json.meetingId }}/transcript","options":{},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-api-key","value":"=959c2b17-a846-432e-a9cc-26d10c29ab60"}]}},"typeVersion":4.2},{"id":"b8d21657-5611-4fc5-b4df-d6b2e296c220","name":"Analyze Transcript GPT","type":"n8n-nodes-base.httpRequest","position":[2144,400],"parameters":{"url":"https://api.openai.com/v1/chat/completions","method":"POST","options":{},"sendBody":true,"authentication":"predefinedCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4o"},{"name":"temperature","value":"={{ 0.3 }}"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªå–¶æ¥­ã‚³ãƒ¼ãƒãƒ³ã‚°ã®å°‚é–€å®¶ã§ã™ã€‚å•†è«‡ä¼šè­°ã®æ–‡å­—èµ·ã“ã—ã‚’å®¢è¦³çš„ã«åˆ†æã—ã€å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¾ã™ã€‚åˆ†æã¯å¿…ãšJSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚\"}, {\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®å•†è«‡ä¼šè­°ã®æ–‡å­—èµ·ã“ã—ã‚’è©³ç´°ã«åˆ†æã—ã¦ãã ã•ã„ã€‚\\n\\nã€ä¼šè­°æƒ…å ±ã€‘\\nä¼šè­°å: \" + $json.meetingName + \"\\næ™‚é–“: \" + $json.duration + \"ç§’\\n\\nã€æ–‡å­—èµ·ã“ã—ã€‘\\n\" + $json.fullTranscript + \"\\n\\nã€åˆ†ææŒ‡ç¤ºã€‘\\nä»¥ä¸‹ã®å„é …ç›®ã‚’0-100ç‚¹ã§è©•ä¾¡ã—ã€è©•ä¾¡ç†ç”±ã‚‚å¿…ãšå«ã‚ã¦ãã ã•ã„ã€‚\\n\\n1. ç™ºè¨€æ™‚é–“ã®é…åˆ†\\n2. è³ªå•ã®è³ªã¨é »åº¦\\n3. å‚¾è´åŠ›\\n4. é¡§å®¢ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ\\n5. èª¬æ˜ã®æ˜ç¢ºã•\\n\\nã€é‡è¦ã€‘å¿…ãšJSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚\\n\\nä¾‹:\\n{\\n  \\\"speakingTimeBalance\\\": {\\\"score\\\": 85, \\\"salesRatio\\\": 40, \\\"customerRatio\\\": 60, \\\"feedback\\\": \\\"è©•ä¾¡ç†ç”±\\\"},\\n  \\\"questionQuality\\\": {\\\"score\\\": 75, \\\"openQuestions\\\": 2, \\\"totalQuestions\\\": 3, \\\"feedback\\\": \\\"è©•ä¾¡ç†ç”±\\\"},\\n  \\\"listeningSkills\\\": {\\\"score\\\": 80, \\\"feedback\\\": \\\"è©•ä¾¡ç†ç”±\\\"},\\n  \\\"customerEngagement\\\": {\\\"score\\\": 90, \\\"customerQuestions\\\": 2, \\\"feedback\\\": \\\"è©•ä¾¡ç†ç”±\\\"},\\n  \\\"explanationClarity\\\": {\\\"score\\\": 85, \\\"feedback\\\": \\\"è©•ä¾¡ç†ç”±\\\"},\\n  \\\"keyTopics\\\": [\\\"ãƒˆãƒ”ãƒƒã‚¯1\\\", \\\"ãƒˆãƒ”ãƒƒã‚¯2\\\"],\\n  \\\"customerConcerns\\\": [\\\"æ‡¸å¿µ1\\\"],\\n  \\\"positiveSignals\\\": [\\\"ã‚·ã‚°ãƒŠãƒ«1\\\"],\\n  \\\"overallScore\\\": 83,\\n  \\\"successProbability\\\": \\\"é«˜\\\",\\n  \\\"nextSteps\\\": [\\\"ã‚¹ãƒ†ãƒƒãƒ—1\\\", \\\"ã‚¹ãƒ†ãƒƒãƒ—2\\\"]\\n}\"}] }}"},{"name":"response_format","value":"={{ {\"type\": \"json_object\"} }}"}]},"nodeCredentialType":"openAiApi"},"typeVersion":4.2},{"id":"07d02d1a-92cf-494c-ba97-286c1f477e12","name":"Parse GPT Analysis","type":"n8n-nodes-base.set","position":[2368,400],"parameters":{"options":{},"assignments":{"assignments":[{"id":"analysis_parsed","name":"analysisResult","type":"object","value":"={{ JSON.parse($json.choices[0].message.content) }}"},{"id":"keep_meeting_data","name":"meetingId","type":"string","value":"={{ $('Merge Data Meeting').item.json.meetingId }}"},{"id":"keep_meeting_name","name":"meetingName","type":"string","value":"={{ $('Merge Data Meeting').item.json.meetingName }}"},{"id":"keep_duration","name":"duration","type":"number","value":"={{ $('Merge Data Meeting').item.json.duration }}"}]}},"typeVersion":3.3},{"id":"557efe7c-1e62-4c8a-8194-ca043ad26441","name":"Merge All Analyses","type":"n8n-nodes-base.merge","position":[2592,272],"parameters":{"mode":"combine","options":{},"combinationMode":"mergeByPosition"},"typeVersion":2.1},{"id":"51c5ba05-d5f3-4d19-adbf-69037d411a54","name":"Generate Final Report","type":"n8n-nodes-base.httpRequest","position":[2880,272],"parameters":{"url":"https://api.openai.com/v1/chat/completions","method":"POST","options":{},"sendBody":true,"authentication":"predefinedCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4o"},{"name":"temperature","value":"={{ 0.5 }}"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"ã‚ãªãŸã¯å–¶æ¥­ã‚³ãƒ¼ãƒãƒ³ã‚°ã®å°‚é–€å®¶ã§ã™ã€‚ä¼šè©±åˆ†æã¨è¡¨æƒ…åˆ†æã®çµæœã‚’çµ±åˆã—ã€ç·åˆçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚\"}, {\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ã€å•†è«‡ã®ç·åˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\\n\\nã€ä¼šè­°æƒ…å ±ã€‘\\nä¼šè­°å: \" + $json.meetingName + \"\\næ™‚é–“: \" + Math.floor($json.duration / 60) + \"åˆ†\\n\\nã€ä¼šè©±åˆ†æçµæœã€‘\\n\" + JSON.stringify($json.analysisResult, null, 2) + \"\\n\\nã€è¡¨æƒ…ãƒ»æ„Ÿæƒ…åˆ†æçµæœã€‘\\nå¹³å‡æ„Ÿæƒ…ã‚¹ã‚³ã‚¢:\\n- å–œã³: \" + $json.averageEmotions.joy + \"%\\n- èˆˆå‘³: \" + $json.averageEmotions.interest + \"%\\n- æ‡¸å¿µ: \" + $json.averageEmotions.concern + \"%\\n- å›°æƒ‘: \" + $json.averageEmotions.confusion + \"%\\n- é€€å±ˆ: \" + $json.averageEmotions.boredom + \"%\\n\\nã€ãƒ¬ãƒãƒ¼ãƒˆæ§‹æˆã€‘\\n1. ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼\\n   - ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢ (0-100)\\n   - å•†è«‡æˆåŠŸå¯èƒ½æ€§ (é«˜/ä¸­/ä½)\\n   - æœ€é‡è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ  (3ã¤)\\n\\n2. è©³ç´°åˆ†æ\\n   - é¡§å®¢ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆåˆ†æ\\n   - ä¼šè©±å“è³ªã®è©•ä¾¡\\n   - è¡¨æƒ…ãƒ»æ„Ÿæƒ…ã®å‚¾å‘\\n\\n3. æ”¹å–„ææ¡ˆ (å„ªå…ˆåº¦é †ã«5ã¤)\\n\\n4. è‰¯ã‹ã£ãŸç‚¹ (3-5ã¤)\\n\\n5. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—\\n   - ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã®æ¨å¥¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°\\n   - é€ä»˜ã™ã¹ãè³‡æ–™ã®ææ¡ˆ\\n   - æ‡¸å¿µäº‹é …ã¸ã®å¯¾å¿œç­–\\n\\nMarkdownå½¢å¼ã§ã€èª­ã¿ã‚„ã™ãæ§‹é€ åŒ–ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\"}] }}"}]},"nodeCredentialType":"openAiApi"},"typeVersion":4.2},{"id":"298da6cb-c109-41f2-a597-cd4acad0d258","name":"Extract Final Report","type":"n8n-nodes-base.set","position":[3104,272],"parameters":{"options":{},"assignments":{"assignments":[{"id":"final_report","name":"finalReport","type":"string","value":"={{ $json.choices[0].message.content }}"},{"id":"report_time","name":"reportGeneratedAt","type":"string","value":"={{ new Date().toISOString() }}"},{"id":"meeting_id_final","name":"meetingId","type":"string","value":"={{ $('Merge Data Meeting').item.json.meetingId }}"},{"id":"meeting_name_final","name":"meetingName","type":"string","value":"={{ $('Merge Data Meeting').item.json.meetingName }}"}]}},"typeVersion":3.3},{"id":"84950dd7-5cc9-4b8e-9991-d27181eae6a1","name":"Build Slack Blocks","type":"n8n-nodes-base.code","position":[3328,272],"parameters":{"jsCode":"const items = $input.all();\nconst outputItems = [];\n\nfor (const item of items) {\n  const report = item.json.finalReport;\n  const meetingName = item.json.meetingName;\n  const meetingId = item.json.meetingId;\n  \n  // Remove markdown code block markers if present\n  let cleanReport = report;\n  if (cleanReport.startsWith('```markdown')) {\n    cleanReport = cleanReport.replace(/^```markdown\\n/, '').replace(/\\n```$/, '');\n  } else if (cleanReport.startsWith('```')) {\n    cleanReport = cleanReport.replace(/^```\\n/, '').replace(/\\n```$/, '');\n  }\n  \n  // Create blocks array\n  const blocks = [\n    {\n      type: \"header\",\n      text: {\n        type: \"plain_text\",\n        text: \"ğŸ“‹ å•†è«‡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ\",\n        emoji: true\n      }\n    },\n    {\n      type: \"section\",\n      fields: [\n        {\n          type: \"mrkdwn\",\n          text: `*ğŸ“… ä¼šè­°å*\\n${meetingName}`\n        },\n        {\n          type: \"mrkdwn\",\n          text: `*ğŸ†” Meeting ID*\\n${meetingId || 'N/A'}`\n        }\n      ]\n    },\n    {\n      type: \"divider\"\n    }\n  ];\n  \n  // Parse report and create rich sections\n  const lines = cleanReport.split('\\n');\n  let i = 0;\n  \n  while (i < lines.length) {\n    const line = lines[i].trim();\n    \n    // Main section header (## 1. ãªã©)\n    if (line.match(/^## \\d+\\. /)) {\n      const sectionNum = line.match(/^## (\\d+)\\. /)[1];\n      const sectionTitle = line.replace(/^## \\d+\\. /, '');\n      \n      // Section emoji mapping\n      const sectionEmojis = {\n        '1': 'ğŸ¯',  // ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼\n        '2': 'ğŸ“Š',  // è©³ç´°åˆ†æ\n        '3': 'ğŸ’¡',  // æ”¹å–„ææ¡ˆ\n        '4': 'â­',  // è‰¯ã‹ã£ãŸç‚¹\n        '5': 'ğŸš€'   // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—\n      };\n      \n      const emoji = sectionEmojis[sectionNum] || 'ğŸ“Œ';\n      \n      // Add section header with emoji\n      blocks.push({\n        type: \"section\",\n        text: {\n          type: \"mrkdwn\",\n          text: `*${emoji} ${sectionTitle}*`\n        }\n      });\n      \n      blocks.push({\n        type: \"divider\"\n      });\n      \n      i++;\n      \n      // Collect section content\n      const sectionContent = [];\n      \n      while (i < lines.length && !lines[i].trim().match(/^## \\d+\\. /)) {\n        const contentLine = lines[i].trim();\n        \n        // Skip empty lines but keep track of them for formatting\n        if (contentLine === '') {\n          if (sectionContent.length > 0 && sectionContent[sectionContent.length - 1] !== '') {\n            sectionContent.push('');\n          }\n        } else if (contentLine.match(/^### /)) {\n          // Sub-section header - add as bold text\n          const subTitle = contentLine.replace(/^### /, '');\n          sectionContent.push(`\\n*${subTitle}*`);\n        } else {\n          // Regular content line\n          sectionContent.push(contentLine);\n        }\n        \n        i++;\n      }\n      \n      // Add final content block\n      if (sectionContent.length > 0) {\n        // Filter out trailing empty lines\n        while (sectionContent.length > 0 && sectionContent[sectionContent.length - 1] === '') {\n          sectionContent.pop();\n        }\n        \n        if (sectionContent.length > 0) {\n          const content = sectionContent.join('\\n');\n          blocks.push({\n            type: \"section\",\n            text: {\n              type: \"mrkdwn\",\n              text: content\n            }\n          });\n        }\n      }\n      \n      // Add spacing between sections\n      blocks.push({\n        type: \"divider\"\n      });\n    } else {\n      i++;\n    }\n  }\n  \n  // Add footer\n  blocks.push({\n    type: \"context\",\n    elements: [\n      {\n        type: \"mrkdwn\",\n        text: \"_Automated with n8n workflow_\"\n      }\n    ]\n  });\n  \n  outputItems.push({\n    json: {\n      ...item.json,\n      slackBlocks: blocks\n    }\n  });\n}\n\nreturn outputItems;"},"typeVersion":2},{"id":"6c372496-120d-4cd5-8bad-75497e755f80","name":"Append to Google Sheets","type":"n8n-nodes-base.googleSheets","position":[4032,64],"parameters":{"columns":{"value":{},"schema":[{"id":"æ—¥æ™‚","type":"string","display":true,"removed":false,"required":false,"displayName":"æ—¥æ™‚","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ä¼šè­°å","type":"string","display":true,"removed":false,"required":false,"displayName":"ä¼šè­°å","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Meeting ID","type":"string","display":true,"removed":false,"required":false,"displayName":"Meeting ID","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢","type":"string","display":true,"removed":false,"required":false,"displayName":"ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢","defaultMatch":false,"canBeUsedToMatch":true},{"id":"å•†è«‡æˆåŠŸå¯èƒ½æ€§","type":"string","display":true,"removed":false,"required":false,"displayName":"å•†è«‡æˆåŠŸå¯èƒ½æ€§","defaultMatch":false,"canBeUsedToMatch":true},{"id":"é¡§å®¢ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚¹ã‚³ã‚¢","type":"string","display":true,"removed":false,"required":false,"displayName":"é¡§å®¢ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚¹ã‚³ã‚¢","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ç™ºè¨€ãƒãƒ©ãƒ³ã‚¹","type":"string","display":true,"removed":false,"required":false,"displayName":"ç™ºè¨€ãƒãƒ©ãƒ³ã‚¹","defaultMatch":false,"canBeUsedToMatch":true},{"id":"è³ªå•ã®è³ª","type":"string","display":true,"removed":false,"required":false,"displayName":"è³ªå•ã®è³ª","defaultMatch":false,"canBeUsedToMatch":true},{"id":"å‚¾è´ã‚¹ã‚­ãƒ«","type":"string","display":true,"removed":false,"required":false,"displayName":"å‚¾è´ã‚¹ã‚­ãƒ«","defaultMatch":false,"canBeUsedToMatch":true},{"id":"èª¬æ˜ã®æ˜ç¢ºã•","type":"string","display":true,"removed":false,"required":false,"displayName":"èª¬æ˜ã®æ˜ç¢ºã•","defaultMatch":false,"canBeUsedToMatch":true},{"id":"æ„Ÿæƒ…-å–œã³(%)","type":"string","display":true,"removed":false,"required":false,"displayName":"æ„Ÿæƒ…-å–œã³(%)","defaultMatch":false,"canBeUsedToMatch":true},{"id":"æ„Ÿæƒ…-èˆˆå‘³(%)","type":"string","display":true,"removed":false,"required":false,"displayName":"æ„Ÿæƒ…-èˆˆå‘³(%)","defaultMatch":false,"canBeUsedToMatch":true},{"id":"æ„Ÿæƒ…-æ‡¸å¿µ(%)","type":"string","display":true,"removed":false,"required":false,"displayName":"æ„Ÿæƒ…-æ‡¸å¿µ(%)","defaultMatch":false,"canBeUsedToMatch":true},{"id":"æ„Ÿæƒ…-å›°æƒ‘(%)","type":"string","display":true,"removed":false,"required":false,"displayName":"æ„Ÿæƒ…-å›°æƒ‘(%)","defaultMatch":false,"canBeUsedToMatch":true},{"id":"æ„Ÿæƒ…-é€€å±ˆ(%)","type":"string","display":true,"removed":false,"required":false,"displayName":"æ„Ÿæƒ…-é€€å±ˆ(%)","defaultMatch":false,"canBeUsedToMatch":true},{"id":"æ”¹å–„ææ¡ˆ(è¦ç´„)","type":"string","display":true,"removed":false,"required":false,"displayName":"æ”¹å–„ææ¡ˆ(è¦ç´„)","defaultMatch":false,"canBeUsedToMatch":true},{"id":"è‰¯ã‹ã£ãŸç‚¹(è¦ç´„)","type":"string","display":true,"removed":false,"required":false,"displayName":"è‰¯ã‹ã£ãŸç‚¹(è¦ç´„)","defaultMatch":false,"canBeUsedToMatch":true},{"id":"æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—(è¦ç´„)","type":"string","display":true,"removed":false,"required":false,"displayName":"æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—(è¦ç´„)","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ—¥æ™‚","type":"string","display":true,"removed":false,"required":false,"displayName":"ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ—¥æ™‚","defaultMatch":false,"canBeUsedToMatch":true},{"id":"æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ(å…¨æ–‡)","type":"string","display":true,"removed":false,"required":false,"displayName":"æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ(å…¨æ–‡)","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"autoMapInputData","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"operation":"append","sheetName":{"__rl":true,"mode":"name","value":"å•†è«‡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯"},"documentId":{"__rl":true,"mode":"id","value":"1mrr_KweC9JThYdghm67ySyDjNZwG16sTlUvzLRnv4Zw"}},"typeVersion":4.4},{"id":"a9424348-8b30-4185-a993-39d141e21fa6","name":"Format Sheets Data","type":"n8n-nodes-base.set","position":[3824,64],"parameters":{"options":{},"assignments":{"assignments":[{"id":"timestamp","name":"æ—¥æ™‚","type":"string","value":"={{ $json.timestamp }}"},{"id":"meeting_name","name":"ä¼šè­°å","type":"string","value":"={{ $json.meetingName }}"},{"id":"meeting_id","name":"Meeting ID","type":"string","value":"={{ $json.meetingId }}"},{"id":"total_score","name":"ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢","type":"string","value":"={{ $json.totalScore }}"},{"id":"success_prob","name":"å•†è«‡æˆåŠŸå¯èƒ½æ€§","type":"string","value":"={{ $json.successProbability }}"},{"id":"engagement","name":"é¡§å®¢ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚¹ã‚³ã‚¢","type":"string","value":"={{ $json.customerEngagementScore }}"},{"id":"speaking","name":"ç™ºè¨€ãƒãƒ©ãƒ³ã‚¹","type":"string","value":"={{ $json.speakingBalance }}"},{"id":"question","name":"è³ªå•ã®è³ª","type":"string","value":"={{ $json.questionQuality }}"},{"id":"listening","name":"å‚¾è´ã‚¹ã‚­ãƒ«","type":"string","value":"={{ $json.listeningSkill }}"},{"id":"clarity","name":"èª¬æ˜ã®æ˜ç¢ºã•","type":"string","value":"={{ $json.clarityScore }}"},{"id":"joy","name":"æ„Ÿæƒ…-å–œã³(%)","type":"string","value":"={{ $json.joyPercentage }}"},{"id":"interest","name":"æ„Ÿæƒ…-èˆˆå‘³(%)","type":"string","value":"={{ $json.interestPercentage }}"},{"id":"concern","name":"æ„Ÿæƒ…-æ‡¸å¿µ(%)","type":"string","value":"={{ $json.concernPercentage }}"},{"id":"confusion","name":"æ„Ÿæƒ…-å›°æƒ‘(%)","type":"string","value":"={{ $json.confusionPercentage }}"},{"id":"bored","name":"æ„Ÿæƒ…-é€€å±ˆ(%)","type":"string","value":"={{ $json.boredPercentage }}"},{"id":"improvement","name":"æ”¹å–„ææ¡ˆ(è¦ç´„)","type":"string","value":"={{ $json.improvementSummary }}"},{"id":"good_points","name":"è‰¯ã‹ã£ãŸç‚¹(è¦ç´„)","type":"string","value":"={{ $json.goodPointsSummary }}"},{"id":"next_steps","name":"æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—(è¦ç´„)","type":"string","value":"={{ $json.nextStepsSummary }}"},{"id":"gen_at","name":"ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ—¥æ™‚","type":"string","value":"={{ $json.reportGeneratedAt }}"},{"id":"full_report","name":"æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ(å…¨æ–‡)","type":"string","value":"={{ $json.fullReport }}"}]}},"typeVersion":3.3}],"pinData":{},"connections":{"Analyze Emotions":{"main":[[{"node":"Merge All Analyses","type":"main","index":0}]]},"Fetch Transcript":{"main":[[{"node":"Parse Transcript","type":"main","index":0}]]},"Parse Transcript":{"main":[[{"node":"Merge Data Meeting","type":"main","index":1}]]},"Webhook - Trigger":{"main":[[{"node":"Send  Webhook Response","type":"main","index":0}]]},"Build Slack Blocks":{"main":[[{"node":"Extract Sheets Data","type":"main","index":0}]]},"Extract Meeting ID":{"main":[[{"node":"Fetch Transcript","type":"main","index":0},{"node":"Fetch Meeting Details","type":"main","index":0}]]},"Format Sheets Data":{"main":[[{"node":"Append to Google Sheets","type":"main","index":0}]]},"Merge All Analyses":{"main":[[{"node":"Generate Final Report","type":"main","index":0}]]},"Merge Data Meeting":{"main":[[{"node":"Prepare Video Analysis","type":"main","index":0},{"node":"Analyze Transcript GPT","type":"main","index":0}]]},"Parse GPT Analysis":{"main":[[{"node":"Merge All Analyses","type":"main","index":1}]]},"Parse Meeting Data":{"main":[[{"node":"Merge Data Meeting","type":"main","index":0}]]},"Extract Sheets Data":{"main":[[{"node":"Format Sheets Data","type":"main","index":0},{"node":"Filter Slack Response","type":"main","index":0}]]},"Extract Final Report":{"main":[[{"node":"Build Slack Blocks","type":"main","index":0}]]},"Fetch Meeting Details":{"main":[[{"node":"Parse Meeting Data","type":"main","index":0}]]},"Filter Slack Response":{"main":[[{"node":"Send Slack","type":"main","index":0}]]},"Generate Final Report":{"main":[[{"node":"Extract Final Report","type":"main","index":0}]]},"Analyze Transcript GPT":{"main":[[{"node":"Parse GPT Analysis","type":"main","index":0}]]},"Prepare Video Analysis":{"main":[[{"node":"Analyze Emotions","type":"main","index":0}]]},"Send  Webhook Response":{"main":[[{"node":"Extract Meeting ID","type":"main","index":0}]]}}}