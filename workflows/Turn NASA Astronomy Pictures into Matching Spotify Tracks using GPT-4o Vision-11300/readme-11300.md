Turn NASA Astronomy Pictures into Matching Spotify Tracks using GPT-4o Vision

https://n8nworkflows.xyz/workflows/turn-nasa-astronomy-pictures-into-matching-spotify-tracks-using-gpt-4o-vision-11300


# Turn NASA Astronomy Pictures into Matching Spotify Tracks using GPT-4o Vision

### 1. Workflow Overview

This workflow automates the creation of a daily Spotify playlist track inspired by NASA‚Äôs Astronomy Picture of the Day (APOD). Each day at 10 PM, it fetches the daily NASA image, uses AI vision (GPT-4o) to analyze the image and generate music parameters, applies a mood bias based on the day of the week, finds a matching Spotify track, generates a poetic caption linking the image and music, posts the results to Slack, and archives the track in a dedicated Spotify playlist.

The workflow is structured into these logical blocks:

- **1.1 Schedule & Mood Determination:** Triggers the workflow daily and sets the mood bias based on the weekday.
- **1.2 NASA Image Retrieval:** Fetches the Astronomy Picture of the Day.
- **1.3 AI Visual & Mood Analysis:** Uses GPT-4o Vision to analyze the image and produce Spotify music parameters.
- **1.4 Spotify Track Curation:** Finds a Spotify track matching the AI-generated parameters.
- **1.5 Creative Caption Generation:** Creates a poetic caption relating the image and the track.
- **1.6 Notification & Archiving:** Posts the results to a Slack channel and saves the track to a Spotify playlist.

---

### 2. Block-by-Block Analysis

#### 2.1 Schedule & Mood Determination

- **Overview:**  
  This block triggers the workflow daily at 10 PM and determines the mood bias for music selection, adapting the energy level depending on the day of the week (e.g., energetic Fridays, calm Mondays).

- **Nodes Involved:**  
  - Daily Schedule  
  - Determine Mood Bias

- **Node Details:**

  - **Daily Schedule**  
    - Type: Schedule Trigger  
    - Role: Initiates the workflow at 22:00 (10 PM) every day.  
    - Configuration: Set to trigger at hour 22, daily.  
    - Input: None (trigger node)  
    - Output: Triggers "Determine Mood Bias" node on schedule.  
    - Edge Cases: Timezone misconfiguration may cause triggering at unexpected hours.

  - **Determine Mood Bias**  
    - Type: Code  
    - Role: Sets a string describing mood bias based on the current weekday.  
    - Configuration: JavaScript code checks current day; applies special conditions for Monday and Friday, default otherwise.  
    - Key Expression: `new Date().getDay()` to fetch day of week; outputs `mood_bias` string.  
    - Input: Trigger from "Daily Schedule"  
    - Output: Passes mood bias info to "Get NASA Picture" node.  
    - Edge Cases: Server time mismatch to local time could affect mood logic.

---

#### 2.2 NASA Image Retrieval

- **Overview:**  
  Retrieves the NASA Astronomy Picture of the Day, providing its URL and metadata as input for AI analysis.

- **Nodes Involved:**  
  - Get NASA Picture

- **Node Details:**

  - **Get NASA Picture**  
    - Type: NASA (n8n native integration)  
    - Role: Fetches the current day‚Äôs APOD image and metadata.  
    - Configuration: Uses default NASA node settings; requires NASA API key configured in n8n credentials.  
    - Input: From "Determine Mood Bias"  
    - Output: JSON containing image URL, title, explanation, etc.  
    - Edge Cases: NASA API downtime, rate limits, or invalid API key leading to failed image retrieval.

---

#### 2.3 AI Visual & Mood Analysis

- **Overview:**  
  Applies GPT-4o Vision to analyze the NASA image, combining it with mood bias to generate Spotify music parameters (e.g., energy, valence) for track recommendation.

- **Nodes Involved:**  
  - Analyze Image for Music

- **Node Details:**

  - **Analyze Image for Music**  
    - Type: OpenAI (LangChain)  
    - Role: Uses GPT-4o Vision model to interpret the image URL and produce music parameters based on visual elements and mood.  
    - Configuration:  
      - Model: GPT-4o  
      - Operation: Analyze resource type "image"  
      - Input: Image URL from "Get NASA Picture" node  
      - Text prompt: "Analyze this cosmic image and generate Spotify parameters based on the mood and visual elements."  
    - Input: Image JSON from NASA node  
    - Output: Structured data with music parameters for Spotify recommendations  
    - Edge Cases: API key limits, image URL invalid, or model timeout/failures.

---

#### 2.4 Spotify Track Curation

- **Overview:**  
  Finds a Spotify track matching the parameters generated by AI, leveraging Spotify‚Äôs recommendation API.

- **Nodes Involved:**  
  - Find Matching Track

- **Node Details:**

  - **Find Matching Track**  
    - Type: Spotify  
    - Role: Queries Spotify‚Äôs recommendation endpoint to find tracks matching AI-generated parameters.  
    - Configuration:  
      - Resource: Track recommendations  
      - Operation: getRecommendations  
      - Input Parameters: Expected to be set dynamically from AI output (energy, valence, etc.), although exact parameter mapping not explicitly shown in JSON.  
    - Input: From "Analyze Image for Music"  
    - Output: Spotify track object(s) including name, artist, URI, external URLs.  
    - Credentials: Spotify OAuth2 app credentials required.  
    - Edge Cases: API rate limits, invalid or incomplete recommendation parameters, missing Spotify credentials.

---

#### 2.5 Creative Caption Generation

- **Overview:**  
  Generates a poetic or lyrical caption connecting the NASA image with the selected Spotify track using OpenAI.

- **Nodes Involved:**  
  - Generate Caption

- **Node Details:**

  - **Generate Caption**  
    - Type: OpenAI (LangChain)  
    - Role: Creates a short poem or caption linking the image and the song.  
    - Configuration:  
      - Operation: message (chat completion)  
      - Model: GPT-4o (implicitly same as previous OpenAI node)  
      - Input: Likely uses context from the track and image, though exact prompt details are not explicitly set in JSON.  
    - Input: From "Find Matching Track" node  
    - Output: Message content containing the generated caption or poem.  
    - Edge Cases: API key limits, prompt failures, or empty output.

---

#### 2.6 Notification & Archiving

- **Overview:**  
  Posts the composite message (image, song, caption) to Slack and archives the track into a designated Spotify playlist.

- **Nodes Involved:**  
  - Post to Slack  
  - Save to Playlist

- **Node Details:**

  - **Post to Slack**  
    - Type: Slack  
    - Role: Sends a formatted message to a specified Slack channel including image title, URL, track info, lyrics/poem, and Spotify track link.  
    - Configuration:  
      - Uses Slack webhook ID  
      - Channel ID placeholder to be replaced by user  
      - Message text uses expressions referencing previous nodes for dynamic content insertion.  
    - Input: From "Generate Caption" node  
    - Output: Triggers "Save to Playlist" node on success  
    - Credentials: Slack Bot Token required  
    - Edge Cases: Invalid Slack token, wrong channel ID, rate limits, message formatting errors.

  - **Save to Playlist**  
    - Type: Spotify  
    - Role: Adds the selected track to a designated Spotify playlist (user‚Äôs ‚ÄúCosmic Archive‚Äù).  
    - Configuration:  
      - Playlist ID placeholder to be replaced by user  
      - Track URI dynamically from "Find Matching Track" node  
    - Input: From "Post to Slack" node  
    - Output: None (terminal node)  
    - Credentials: Spotify OAuth2 app credentials required  
    - Edge Cases: Invalid playlist ID, missing permissions, API errors.

---

### 3. Summary Table

| Node Name            | Node Type                   | Functional Role                  | Input Node(s)          | Output Node(s)          | Sticky Note                                                                                          |
|----------------------|-----------------------------|---------------------------------|-----------------------|------------------------|----------------------------------------------------------------------------------------------------|
| Daily Schedule       | Schedule Trigger            | Triggers workflow daily at 10PM | None                  | Determine Mood Bias     | ### 1. Schedule & Mood<br>Determine if the music should be energetic (Friday) or chill (Monday).   |
| Determine Mood Bias  | Code                       | Sets mood bias string per weekday| Daily Schedule        | Get NASA Picture        | ### 1. Schedule & Mood<br>Determine if the music should be energetic (Friday) or chill (Monday).   |
| Get NASA Picture     | NASA API                   | Retrieves daily NASA APOD image  | Determine Mood Bias    | Analyze Image for Music | ### 2. Visual Analysis<br>Fetch the daily image and use AI to interpret it as musical parameters.  |
| Analyze Image for Music | OpenAI (LangChain)         | Analyzes image & mood for music params | Get NASA Picture      | Find Matching Track     | ### 2. Visual Analysis<br>Fetch the daily image and use AI to interpret it as musical parameters.  |
| Find Matching Track  | Spotify                    | Finds Spotify track recommendations | Analyze Image for Music | Generate Caption        | ### 3. Curation & Creativity<br>Find the best track on Spotify and generate a poetic description.  |
| Generate Caption     | OpenAI (LangChain)         | Creates poetic caption linking image & track | Find Matching Track | Post to Slack           | ### 3. Curation & Creativity<br>Find the best track on Spotify and generate a poetic description.  |
| Post to Slack        | Slack                      | Posts message to Slack channel   | Generate Caption       | Save to Playlist        | ### 4. Notify & Save<br>Send the result to Slack and archive the track to your playlist.           |
| Save to Playlist     | Spotify                    | Saves matched track to playlist  | Post to Slack          | None                   | ### 4. Notify & Save<br>Send the result to Slack and archive the track to your playlist.           |
| Template Description | Sticky Note                | Explains workflow purpose & setup| None                  | None                   |                                                                                                |
| Step 1 Note          | Sticky Note                | Notes on scheduling & mood logic | None                  | None                   | ### 1. Schedule & Mood<br>Determine if the music should be energetic (Friday) or chill (Monday).   |
| Step 2 Note          | Sticky Note                | Notes on visual analysis         | None                  | None                   | ### 2. Visual Analysis<br>Fetch the daily image and use AI to interpret it as musical parameters.  |
| Step 3 Note          | Sticky Note                | Notes on curation & captioning   | None                  | None                   | ### 3. Curation & Creativity<br>Find the best track on Spotify and generate a poetic description.  |
| Step 4 Note          | Sticky Note                | Notes on notification & saving   | None                  | None                   | ### 4. Notify & Save<br>Send the result to Slack and archive the track to your playlist.           |

---

### 4. Reproducing the Workflow from Scratch

1. **Create a Schedule Trigger node**  
   - Type: Schedule Trigger  
   - Set to run every day at 22:00 (10 PM)  
   - No credentials needed

2. **Add a Code node named "Determine Mood Bias"**  
   - Use JavaScript code to get current day of week  
   - Logic:  
     - If Friday (day 5), mood bias = "It's Friday night! Prefer higher tempo and energy. (min_energy: 0.6)"  
     - If Monday (day 1), mood bias = "It's Monday. Need healing and calm vibes. (max_energy: 0.5)"  
     - Else, mood bias = "Standard mode. Just match the image."  
   - Output: `{ mood_bias: moodBias }`  
   - Connect Schedule Trigger output to this node.

3. **Add NASA node "Get NASA Picture"**  
   - Use built-in NASA node to fetch Astronomy Picture of the Day  
   - Configure with NASA API credentials (free API key)  
   - Connect output of "Determine Mood Bias" to this node.

4. **Add OpenAI node "Analyze Image for Music"**  
   - Integration: OpenAI via LangChain or native OpenAI node with GPT-4o Vision support  
   - Operation: Analyze resource type "image"  
   - Parameters:  
     - Text prompt: "Analyze this cosmic image and generate Spotify parameters based on the mood and visual elements."  
     - Image URL: Use expression referencing NASA node output (e.g., `{{$node["Get NASA Picture"].json.url}}`)  
     - Model: GPT-4o  
   - Connect output of NASA node to this.

5. **Add Spotify node "Find Matching Track"**  
   - Resource: Track  
   - Operation: Get Recommendations  
   - Parameters: Map AI-generated parameters such as energy and valence from previous node output to Spotify API parameters  
   - Configure Spotify OAuth2 credentials (Client ID, Secret)  
   - Connect output from OpenAI "Analyze Image for Music" node.

6. **Add OpenAI node "Generate Caption"**  
   - Operation: Chat Completion / message  
   - Model: GPT-4o  
   - Input prompt: Compose a poetic caption linking the image and selected Spotify track (build prompt using data from previous nodes)  
   - Connect from "Find Matching Track" node.

7. **Add Slack node "Post to Slack"**  
   - Configure Slack credentials (Bot Token)  
   - Channel: Set Slack channel ID or name where messages will be posted  
   - Message text: Compose message using expressions from NASA picture, Spotify track, and generated caption, e.g.:  
     ```
     üéµ *Cosmic Synesthesia DJ* üéµ

     üñºÔ∏è *Visual:* {{$node["Get NASA Picture"].json.title}}
     ({{$node["Get NASA Picture"].json.url}})

     üéº *Track:*
     *{{$node["Find Matching Track"].json.tracks[0].name}}*
     by {{$node["Find Matching Track"].json.tracks[0].artists[0].name}}

     üí¨ *Lyrics / Poem:*
     >>> {{$node["Generate Caption"].json.message.content}}

     üéß <{{$node["Find Matching Track"].json.tracks[0].external_urls.spotify}}|Listen on Spotify>
     ```
   - Connect from "Generate Caption" node.

8. **Add Spotify node "Save to Playlist"**  
   - Resource: Playlist  
   - Operation: Add Track  
   - Playlist ID: Paste your Spotify playlist ID to archive the daily track  
   - Track URI: Use expression `{{$node["Find Matching Track"].json.tracks[0].uri}}`  
   - Connect from "Post to Slack" node.

9. **Add sticky notes for documentation** (optional but recommended)  
   - Add descriptive sticky notes explaining each block for clarity.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                                                | Context or Link                                                                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| Transform the universe into music by linking NASA‚Äôs Astronomy Picture of the Day with Spotify tracks using AI Vision and GPT-4o.                                                                                                                                                                            | Workflow purpose and concept.                                                                                                |
| Required credentials include NASA API key (free), OpenAI API key with GPT-4o support, Spotify OAuth2 app credentials, and Slack Bot token.                                                                                                                                                                  | Setup prerequisites.                                                                                                          |
| Create a Spotify playlist for archiving daily tracks and paste the playlist ID in the "Save to Playlist" node.                                                                                                                                                                                               | User action required before execution.                                                                                       |
| Add your Slack channel ID or name to the "Post to Slack" node to enable notifications.                                                                                                                                                                                                                       | User action required before execution.                                                                                       |
| For more about GPT-4o vision capabilities: https://openai.com/research/gpt-4o-vision                                                                                                                                                                                                                        | OpenAI model reference.                                                                                                      |
| Slack message formatting uses Slack‚Äôs block and markdown syntax for rich display.                                                                                                                                                                                                                            | Slack API message formatting best practices.                                                                                 |

---

**Disclaimer:** The text provided is exclusively derived from an automated n8n workflow. It complies strictly with content policies and contains no illegal or offensive elements. All data processed is legal and public.