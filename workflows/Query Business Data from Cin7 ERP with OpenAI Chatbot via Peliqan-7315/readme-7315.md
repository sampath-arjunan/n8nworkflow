Query Business Data from Cin7 ERP with OpenAI Chatbot via Peliqan

https://n8nworkflows.xyz/workflows/query-business-data-from-cin7-erp-with-openai-chatbot-via-peliqan-7315


# Query Business Data from Cin7 ERP with OpenAI Chatbot via Peliqan

---

## 1. Workflow Overview

This n8n workflow implements an AI-powered chatbot designed to answer complex business queries regarding Cin7 ERP data by leveraging a Peliqan data warehouse as a backend data source. It enables users to interact naturally (via chat messages) and receive data-driven responses based on real-time SQL queries executed on synchronized Cin7 data.

### Use Cases:
- Business users querying inventory, sales, purchases, products, contacts, or accounting data from Cin7 ERP.
- Automating data retrieval and reporting without manual SQL writing.
- Enabling natural language to SQL translation and execution for ERP analytics.

### Logical Blocks:

- **1.1 Input Reception:** Listens for incoming chat messages from users.
- **1.2 AI Processing (Chatbot Brain):** Processes the chat input using an AI Agent incorporating a language model and memory, enriched with a detailed Cin7 ERP data model for context.
- **1.3 SQL Execution via Peliqan:** Executes SQL queries generated by the AI Agent on the Peliqan data warehouse containing Cin7 data.
- **1.4 Memory and Context Handling:** Maintains conversation context with a memory buffer to improve multi-turn interactions.

---

## 2. Block-by-Block Analysis

### 2.1 Input Reception

**Overview:**  
Receives chat messages from users to trigger the workflow.

**Nodes Involved:**  
- When chat message received

**Node Details:**

- **Node Name:** When chat message received  
- **Type:** Langchain Chat Trigger  
- **Role:** Entry point, webhook listening for chat input  
- **Configuration:**  
  - Public webhook enabled to receive messages externally  
  - Default options, no special filters  
- **Expressions/Variables:** N/A (trigger node)  
- **Connections:** Output connected to AI Agent node main input  
- **Version Requirements:** Langchain node version 1.1+ recommended  
- **Failure Modes:**  
  - Network or webhook connectivity issues  
  - Unauthorized access if webhook is misconfigured  
- **Sub-workflow:** None

---

### 2.2 AI Processing (Chatbot Brain)

**Overview:**  
Acts as the core AI engine that interprets user queries, converts natural language to SQL, invokes SQL execution, and formulates responses. It uses OpenAI GPT model with embedded Cin7 ERP data model and supports conversation memory.

**Nodes Involved:**  
- AI Agent  
- OpenAI Chat Model  
- Simple Memory

**Node Details:**

- **Node Name:** AI Agent  
- **Type:** Langchain Agent  
- **Role:** Natural language understanding and orchestration of tools  
- **Configuration:**  
  - System message sets assistant role as Cin7 business data assistant  
  - Embedded detailed Cin7 ERP data schema (tables and columns) for SQL generation  
  - Configured to use Peliqan SQL execution tool with key "Execute SQL"  
  - Always output data enabled for debugging and tracing  
- **Expressions/Variables:**  
  - Uses `SQL_Query__View_` for SQL queries  
  - Receives chat messages from "When chat message received" node  
  - Sends SQL queries to Peliqan node as a tool  
- **Connections:**  
  - Input: From chat trigger  
  - Outputs:  
    - AI memory to Simple Memory node  
    - AI language model to OpenAI Chat Model node  
    - AI tool calls to Peliqan SQL execution node  
- **Version Requirements:** Langchain agent node version 1.6+ recommended  
- **Failure Modes:**  
  - Model API rate limits or connectivity issues  
  - Expression or variable resolution errors  
  - SQL generation errors leading to invalid queries  
- **Sub-workflow:** None

---

- **Node Name:** OpenAI Chat Model  
- **Type:** Langchain LM Chat OpenAI  
- **Role:** Provides the underlying language model (GPT) for the AI Agent  
- **Configuration:**  
  - Default OpenAI Chat options without customization  
  - Credentials: OpenAI API key (configured with developer account)  
- **Expressions/Variables:** N/A  
- **Connections:**  
  - Input: AI language model input from AI Agent  
  - Output: Returns AI text completions to AI Agent  
- **Version Requirements:** Langchain LM Chat OpenAI node version 1+  
- **Failure Modes:**  
  - Authentication failures due to invalid API keys  
  - Network or API rate limiting errors  
  - Model response timeouts  
- **Sub-workflow:** None

---

- **Node Name:** Simple Memory  
- **Type:** Langchain Memory Buffer Window  
- **Role:** Maintains conversational context for multi-turn dialogue  
- **Configuration:**  
  - Default buffer window size (number of previous interactions to remember)  
- **Expressions/Variables:** N/A  
- **Connections:**  
  - Input: AI memory output from AI Agent  
  - Output: Feeds back to AI Agent for context-aware processing  
- **Version Requirements:** Langchain memory node version 1.3+  
- **Failure Modes:**  
  - Memory overflow or truncation if context too long  
  - Potential loss of context on workflow restart  
- **Sub-workflow:** None

---

### 2.3 SQL Execution via Peliqan

**Overview:**  
Executes SQL queries generated by the AI Agent on the Peliqan data warehouse, which mirrors Cin7 ERP data.

**Nodes Involved:**  
- Execute an SQL query via Peliqan

**Node Details:**

- **Node Name:** Execute an SQL query via Peliqan  
- **Type:** Peliqan Tool (Custom node)  
- **Role:** Runs SQL queries on Peliqan warehouse and returns results  
- **Configuration:**  
  - Operation: Execute SQL query  
  - Query SQL expression: Dynamic input from AI Agent’s SQL_Query variable  
  - Resource: Query execution  
  - Connection: Uses configured Peliqan API credential  
- **Expressions/Variables:**  
  - `={{ $fromAI('SQL_Query', '', 'string') }}` dynamically retrieves SQL query text from AI Agent output  
- **Connections:**  
  - Input: ai_tool input from AI Agent node  
  - Output: Returns query results to AI Agent node’s tool output  
- **Version Requirements:** Peliqan node version 1+ with community packages tool usage enabled  
- **Failure Modes:**  
  - SQL syntax errors if AI generates invalid queries  
  - API authentication failures with Peliqan  
  - Query timeouts or warehouse access issues  
- **Sub-workflow:** None

---

### 2.4 Sticky Notes (Documentation & Setup Guidance)

**Overview:**  
Provide informational content, instructions, and warnings to users and maintainers of the workflow.

**Nodes Involved:**  
- Sticky Note5 (Introduction & Setup)  
- Sticky Note4 (Environment Variable Warning)  
- Sticky Note (Tools for AI Agent SQL)  
- Sticky Note1 (AI Chatbot)  
- Sticky Note2 (Brain)

**Node Details:**

- These nodes do not participate in workflow logic but provide vital documentation embedded in the workflow editor for user guidance.

---

## 3. Summary Table

| Node Name                      | Node Type                          | Functional Role                         | Input Node(s)                 | Output Node(s)                 | Sticky Note                                                                                      |
|--------------------------------|----------------------------------|---------------------------------------|------------------------------|-------------------------------|-------------------------------------------------------------------------------------------------|
| When chat message received      | @n8n/n8n-nodes-langchain.chatTrigger | Receives user chat messages (trigger) | None                         | AI Agent                      | ## AI Chatbot                                                                                   |
| AI Agent                       | @n8n/n8n-nodes-langchain.agent   | Processes input, generates SQL, handles tools and memory | When chat message received    | OpenAI Chat Model, Simple Memory, Execute SQL via Peliqan | ## Brain                                                                                      |
| OpenAI Chat Model              | @n8n/n8n-nodes-langchain.lmChatOpenAi | Provides language model (GPT)          | AI Agent                     | AI Agent                      |                                                                                                |
| Simple Memory                 | @n8n/n8n-nodes-langchain.memoryBufferWindow | Maintains conversation context        | AI Agent                     | AI Agent                      |                                                                                                |
| Execute an SQL query via Peliqan | n8n-nodes-peliqan.peliqanTool     | Executes SQL queries on Peliqan data warehouse | AI Agent                     | AI Agent                      | ⚠️ To use the Peliqan as tool with Operation "Execute SQL query": set env variable `N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=True` |
| Sticky Note5                  | n8n-nodes-base.stickyNote         | Documentation and introduction        | None                         | None                         | ## ℹ️ Introduction ... (full intro and setup instructions)                                    |
| Sticky Note4                  | n8n-nodes-base.stickyNote         | Warning about environment variable    | None                         | None                         | ⚠️ To use the Peliqan as tool with Operation "Execute SQL query": set env variable as below    |
| Sticky Note                   | n8n-nodes-base.stickyNote         | Documentation: Tools for AI Agent SQL | None                         | None                         | ## Tools for AI Agent: SQL                                                                     |
| Sticky Note1                  | n8n-nodes-base.stickyNote         | Documentation: AI Chatbot              | None                         | None                         | ## AI Chatbot                                                                                   |
| Sticky Note2                  | n8n-nodes-base.stickyNote         | Documentation: Brain (AI Agent core)   | None                         | None                         | ## Brain                                                                                      |

---

## 4. Reproducing the Workflow from Scratch

1. **Create Chat Trigger Node:**  
   - Type: `@n8n/n8n-nodes-langchain.chatTrigger`  
   - Name: `When chat message received`  
   - Set webhook to public (for external access)  
   - Position: e.g., [464, 96]  
   - No special options needed  
   - This node serves as the entry point for chat messages.

2. **Create AI Agent Node:**  
   - Type: `@n8n/n8n-nodes-langchain.agent`  
   - Name: `AI Agent`  
   - Position: e.g., [640, 96]  
   - Configure the System Message with detailed Cin7 ERP data model tables and columns (copy from the original workflow or your own Peliqan datamodel)  
   - Configure the Agent to use a tool named “Execute SQL” linked to the Peliqan node (to be created later)  
   - Enable “Always Output Data” for easier debugging  
   - Connect `When chat message received` output to this node’s main input.

3. **Create OpenAI Chat Model Node:**  
   - Type: `@n8n/n8n-nodes-langchain.lmChatOpenAi`  
   - Name: `OpenAI Chat Model`  
   - Position: e.g., [592, 384]  
   - Use default options; no special parameters needed  
   - Credentials: Add and select OpenAI API key credential (requires a valid OpenAI API key)  
   - Connect AI Agent’s `ai_languageModel` output to this node’s input  
   - Connect this node’s output back to AI Agent’s language model input.

4. **Create Simple Memory Node:**  
   - Type: `@n8n/n8n-nodes-langchain.memoryBufferWindow`  
   - Name: `Simple Memory`  
   - Position: e.g., [768, 384]  
   - Use default settings (buffer window size default)  
   - Connect AI Agent’s `ai_memory` output to this node’s input  
   - Connect this node’s output back to AI Agent’s memory input.

5. **Create Peliqan SQL Execution Node:**  
   - Type: `n8n-nodes-peliqan.peliqanTool`  
   - Name: `Execute an SQL query via Peliqan`  
   - Position: e.g., [1184, 320]  
   - Parameters:  
     - Resource: `query`  
     - Operation: `exec` (execute SQL query)  
     - Query SQL: Use expression `={{ $fromAI('SQL_Query', '', 'string') }}` to receive the SQL query from AI Agent  
     - Connection: Select or create Peliqan API credential with your Peliqan API key  
     - Select your target data warehouse in the node dropdown  
   - Connect AI Agent’s `ai_tool` output to this node’s input  
   - Connect this node’s output back to AI Agent’s tool output.

6. **Set Environment Variable:**  
   - To enable tool usage with Peliqan node, set environment variable:  
     `N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=True`  
   - This can be set in your n8n environment config or terminal before launching n8n.

7. **Add Sticky Notes (Optional but Recommended):**  
   - Add notes explaining the workflow purpose, setup instructions, and warnings about environment variables. This improves maintainability.

---

## 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                                                                                                                               | Context or Link                                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| End-to-end demo of an in-house AI agent that can answer a wide range of questions by retrieving information from the **Cin7 ERP** system. Uses Peliqan.io as a data warehouse cache with ELT sync for fast queries. AI Agent uses Text-to-SQL to convert natural language questions into SQL executed on Peliqan.                                                                                   | Full introduction and setup instructions in Sticky Note5 within the workflow                                   |
| Sign up for free trial at https://peliqan.io and connect Cin7 Omni or Cin7 Core using API key. Use your Peliqan API key in n8n credentials for the Peliqan node. Optional: Run the [template script](https://help.peliqan.io/build-ai-agents-with-n8n-and-peliqan#block-2401aa9b387980cf8b2ff069588dd3dc) in Peliqan to get your specific Cin7 datamodel for better AI accuracy.                                                  | Peliqan.io official documentation and help page                                                                 |
| ⚠️ To use the Peliqan SQL execution tool in n8n, set the environment variable: `N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=True` before starting n8n.                                                                                                                                                                                                                                       | Environment setup warning (Sticky Note4)                                                                          |
| Contact Peliqan support for help: support@peliqan.io                                                                                                                                                                                                                                                                                                                                       | Support contact                                                                                                  |
| Visit peliqan.io/n8n for more information and community resources.                                                                                                                                                                                                                                                                                                                         | Official resource page                                                                                            |

---

**Disclaimer:**  
The text above is extracted and analyzed exclusively from an automated workflow created with n8n, an integration and automation tool. This processing strictly adheres to content policies and contains no illegal, offensive, or protected material. All data handled are legal and public.

---