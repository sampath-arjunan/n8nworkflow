Query MySQL Database with Natural Language using GPT AI

https://n8nworkflows.xyz/workflows/query-mysql-database-with-natural-language-using-gpt-ai-6291


# Query MySQL Database with Natural Language using GPT AI

### 1. Workflow Overview

This workflow enables users to query a MySQL database using natural language inputs, leveraging GPT-based AI to interpret questions and automatically generate and execute SQL queries. It is designed for internal company use cases where non-technical users want to retrieve data insights without writing SQL manually.

The workflow is logically divided into the following blocks:

- **1.1 Input Reception:** Receives user chat messages via a LangChain chat trigger node.
- **1.2 AI Processing and Memory:** Uses an AI Agent with GPT-4 to interpret natural language queries, maintain conversational context with memory, and produce SQL queries.
- **1.3 Database Schema Retrieval:** Dynamically fetches the current database schema (tables and columns) to inform the AI agent about available data structures.
- **1.4 SQL Query Execution:** Executes the SQL query generated by the AI agent against the MySQL database.
- **1.5 Response Generation:** The AI agent formulates a final user-friendly response based on query results.
- **1.6 Documentation and Configuration Notes:** Sticky Notes provide setup instructions and usage tips.

---

### 2. Block-by-Block Analysis

#### 2.1 Input Reception

- **Overview:**  
  This block captures incoming chat messages from users, serving as the workflow trigger point.

- **Nodes Involved:**  
  - `When chat message received`

- **Node Details:**

  - **When chat message received**  
    - *Type:* `@n8n/n8n-nodes-langchain.chatTrigger`  
    - *Role:* Listens for incoming user messages via LangChain chat interface.  
    - *Configuration:* Uses default options, identified by a webhook ID for inbound messages.  
    - *Expressions/Variables:* None explicitly configured; receives raw user input.  
    - *Connections:* Outputs to `AI Agent` node.  
    - *Version Requirements:* v1.1 of this node type.  
    - *Potential Failures:* Network/webhook issues, malformed messages, or message format incompatibilities.

#### 2.2 AI Processing and Memory

- **Overview:**  
  Interprets natural language input, maintains conversation context, and orchestrates database query generation and execution.

- **Nodes Involved:**  
  - `AI Agent`  
  - `Simple Memory`  
  - `OpenAI Chat Model`

- **Node Details:**

  - **AI Agent**  
    - *Type:* `@n8n/n8n-nodes-langchain.agent`  
    - *Role:* Core logic node that acts as an AI assistant to parse user input, decide when and how to use tools (like database schema or SQL execution), and generate final answers.  
    - *Configuration:*  
      - Prompt defines role as an internal AI assistant with knowledge of database schema tools and SQL execution tools.  
      - Instructions enforce querying the schema first before database queries, handling time periods, response style, and markdown formatting.  
      - Date variable `{{ $now }}` dynamically inserts the current date.  
    - *Expressions:* Uses a detailed multi-line prompt with embedded dynamic date.  
    - *Connections:*  
      - Receives input from `When chat message received`.  
      - Outputs to `SQL DB - List Tables and Schema` and `Execute a SQL query in MySQL` nodes as tools.  
      - Connects to `Simple Memory` (for context storage).  
      - Uses `OpenAI Chat Model` as underlying language model.  
    - *Version:* 2.1  
    - *Failure Modes:* API key or rate limit issues with OpenAI, prompt parsing errors, invalid SQL generation, unexpected database response formats.

  - **Simple Memory**  
    - *Type:* `@n8n/n8n-nodes-langchain.memoryBufferWindow`  
    - *Role:* Stores limited recent conversation context to maintain dialogue continuity (default last 5 messages).  
    - *Configuration:* Defaults, no custom parameters set.  
    - *Connections:* Takes input from and sends output to `AI Agent`.  
    - *Version:* 1.3  
    - *Failure Modes:* Memory overflow if too large, loss of context on node failure.

  - **OpenAI Chat Model**  
    - *Type:* `@n8n/n8n-nodes-langchain.lmChatOpenAi`  
    - *Role:* Provides GPT-4.1-mini model for natural language understanding and generation.  
    - *Configuration:*  
      - Model set to `gpt-4.1-mini`.  
      - Uses authenticated OpenAI API credentials.  
    - *Connections:* Serves as the language model for `AI Agent`.  
    - *Version:* 1.2  
    - *Failure Modes:* Authentication errors, API timeouts, model unavailability.

#### 2.3 Database Schema Retrieval

- **Overview:**  
  Queries MySQL information schema to retrieve the current list of tables and columns, essential for the AI agent to generate valid SQL queries.

- **Nodes Involved:**  
  - `SQL DB - List Tables and Schema`

- **Node Details:**

  - **SQL DB - List Tables and Schema**  
    - *Type:* `n8n-nodes-base.mySqlTool`  
    - *Role:* Executes a SQL statement that fetches all table and column names from the specified database schema.  
    - *Configuration:*  
      - Query:  
        ```sql
        SELECT TABLE_NAME, COLUMN_NAME
        FROM INFORMATION_SCHEMA.COLUMNS
        WHERE TABLE_SCHEMA = 'your_database_name'
        ORDER BY TABLE_NAME, ORDINAL_POSITION;
        ```  
      - User must replace `'your_database_name'` with their actual database name.  
      - Uses MySQL credentials configured separately.  
    - *Connections:* Invoked as a tool by `AI Agent`.  
    - *Version:* 2.4  
    - *Failure Modes:* Incorrect database name, permission errors, connectivity issues.

#### 2.4 SQL Query Execution

- **Overview:**  
  Executes the SQL query generated by the AI agent against the MySQL database and returns results.

- **Nodes Involved:**  
  - `Execute a SQL query in MySQL`

- **Node Details:**

  - **Execute a SQL query in MySQL**  
    - *Type:* `n8n-nodes-base.mySqlTool`  
    - *Role:* Runs arbitrary SQL queries provided by the AI agent on the configured MySQL instance.  
    - *Configuration:*  
      - Operation set to execute query.  
      - Query string is dynamically provided by the AI agent.  
      - Uses MySQL credentials configured separately.  
    - *Connections:* Invoked as a tool by `AI Agent`.  
    - *Version:* 2.4  
    - *Failure Modes:* SQL syntax errors, invalid queries, permission or connection errors.

#### 2.5 Response Generation and Output

- **Overview:**  
  The AI agent uses the output of the SQL query and schema query to produce a final human-readable answer, formatted using markdown if appropriate, and returns it to the chat interface.

- **Nodes Involved:**  
  - `AI Agent` (final output role)

- **Node Details:**  
  - No additional nodes—response generation is internal to the `AI Agent`.  
  - Potential risks include incomplete or ambiguous data returned from the database, or AI hallucination if data is missing.

#### 2.6 Documentation and Configuration Notes

- **Overview:**  
  Provides setup instructions and usage guidance within the workflow editor.

- **Nodes Involved:**  
  - `Sticky Note`  
  - `Sticky Note1`

- **Node Details:**

  - **Sticky Note**  
    - *Type:* `n8n-nodes-base.stickyNote`  
    - *Content:* "Ask agent a question in plain English. AI Agent will execute a SQL query on your database for the answer"  
    - *Positioned visibly near the entry nodes.**

  - **Sticky Note1**  
    - *Type:* `n8n-nodes-base.stickyNote`  
    - *Content:*  
      ```
      1. Add your OpenAI API Key in "OpenAI Chat Model" node
      2. Add your MySQL credentials in the "SQL DB - List Tables and Schema" and "Execute a SQL Query in MySQL" nodes
      3. Update the database name in "SQL DB - List Tables and Schema" node. Replace "your_query_name" under the Query field with your actual database name

      Note: This agent can remember the previous 5 messages by default but can be adjusted in the "Session Memory" node
      ```
    - *Positioned centrally for easy reference.*

---

### 3. Summary Table

| Node Name                     | Node Type                                | Functional Role                   | Input Node(s)               | Output Node(s)                 | Sticky Note                                                                                  |
|-------------------------------|-----------------------------------------|---------------------------------|-----------------------------|-------------------------------|----------------------------------------------------------------------------------------------|
| When chat message received     | @n8n/n8n-nodes-langchain.chatTrigger    | Input Reception (chat trigger)  | —                           | AI Agent                      | Ask agent a question in plain English. AI Agent will execute a SQL query on your database for the answer |
| AI Agent                      | @n8n/n8n-nodes-langchain.agent           | AI Processing, Orchestration     | When chat message received, Simple Memory, OpenAI Chat Model | SQL DB - List Tables and Schema, Execute a SQL query in MySQL, Simple Memory | Ask agent a question in plain English. AI Agent will execute a SQL query on your database for the answer |
| OpenAI Chat Model             | @n8n/n8n-nodes-langchain.lmChatOpenAi    | Language Model for AI Agent      | —                           | AI Agent                      | 1. Add your OpenAI API Key in "OpenAI Chat Model" node                                       |
| Simple Memory                 | @n8n/n8n-nodes-langchain.memoryBufferWindow | Session Memory for conversation  | AI Agent                    | AI Agent                      |  Note: This agent can remember the previous 5 messages by default but can be adjusted in the "Session Memory" node |
| SQL DB - List Tables and Schema | n8n-nodes-base.mySqlTool                 | Retrieve DB schema info           | AI Agent                    | AI Agent                      | 2. Add your MySQL credentials in the "SQL DB - List Tables and Schema" and "Execute a SQL Query in MySQL" nodes; 3. Update DB name in query |
| Execute a SQL query in MySQL  | n8n-nodes-base.mySqlTool                  | Execute SQL query on DB          | AI Agent                    | AI Agent                      | 2. Add your MySQL credentials in the "SQL DB - List Tables and Schema" and "Execute a SQL Query in MySQL" nodes |
| Sticky Note                  | n8n-nodes-base.stickyNote                  | Instructional note               | —                           | —                             | Ask agent a question in plain English. AI Agent will execute a SQL query on your database for the answer |
| Sticky Note1                 | n8n-nodes-base.stickyNote                  | Instructional note               | —                           | —                             | 1. Add your OpenAI API Key in "OpenAI Chat Model" node; 2. Add MySQL credentials; 3. Update DB name; Note on memory |

---

### 4. Reproducing the Workflow from Scratch

1. **Create a new workflow in n8n.**

2. **Add the `When chat message received` node:**  
   - Type: `@n8n/n8n-nodes-langchain.chatTrigger`  
   - Set up the webhook to receive chat messages.  
   - No special parameters needed; defaults are sufficient.  

3. **Add the `AI Agent` node:**  
   - Type: `@n8n/n8n-nodes-langchain.agent`  
   - Connect input from `When chat message received` node.  
   - Configure the prompt with the detailed instructions as given: role definition, tools available, guidelines on querying schema first, date insertion, markdown formatting, and tone.  
   - Set `promptType` to `define`.  
   - Version: 2.1 or later.  

4. **Add the `Simple Memory` node:**  
   - Type: `@n8n/n8n-nodes-langchain.memoryBufferWindow`  
   - Connect input and output to/from `AI Agent` via the `ai_memory` connection.  
   - Use default parameters (stores last 5 messages). Adjust if desired.  
   - Version: 1.3 or later.  

5. **Add the `OpenAI Chat Model` node:**  
   - Type: `@n8n/n8n-nodes-langchain.lmChatOpenAi`  
   - Connect output to the `AI Agent` node (`ai_languageModel`).  
   - Set model to `gpt-4.1-mini` or preferred GPT-4 variant.  
   - Configure OpenAI credentials with your API key.  
   - Version: 1.2 or later.  

6. **Add the `SQL DB - List Tables and Schema` node:**  
   - Type: `n8n-nodes-base.mySqlTool`  
   - Connect output as an AI tool input to `AI Agent`.  
   - Configure MySQL credentials for read access.  
   - Set operation to `executeQuery`.  
   - Set query to:  
     ```sql
     SELECT TABLE_NAME, COLUMN_NAME
     FROM INFORMATION_SCHEMA.COLUMNS
     WHERE TABLE_SCHEMA = 'your_database_name'
     ORDER BY TABLE_NAME, ORDINAL_POSITION;
     ```  
   - Replace `'your_database_name'` with your actual DB name.  
   - Version: 2.4 or later.  

7. **Add the `Execute a SQL query in MySQL` node:**  
   - Type: `n8n-nodes-base.mySqlTool`  
   - Connect output as an AI tool input to `AI Agent`.  
   - Configure MySQL credentials with query execution permissions.  
   - Set operation to `executeQuery`.  
   - Query input is dynamic (provided by AI Agent).  
   - Version: 2.4 or later.  

8. **Connect nodes properly:**  
   - `When chat message received` → `AI Agent` (main input)  
   - `Simple Memory` ↔ `AI Agent` (ai_memory in both directions)  
   - `OpenAI Chat Model` → `AI Agent` (ai_languageModel)  
   - `SQL DB - List Tables and Schema` → `AI Agent` (ai_tool)  
   - `Execute a SQL query in MySQL` → `AI Agent` (ai_tool)  

9. **Add Sticky Notes for clarity (optional):**  
   - One near the trigger with the note:  
     *"Ask agent a question in plain English. AI Agent will execute a SQL query on your database for the answer"*  
   - Another with setup instructions:  
     ```
     1. Add your OpenAI API Key in "OpenAI Chat Model" node
     2. Add your MySQL credentials in the "SQL DB - List Tables and Schema" and "Execute a SQL Query in MySQL" nodes
     3. Update the database name in "SQL DB - List Tables and Schema" node. Replace "your_query_name" under the Query field with your actual database name

     Note: This agent can remember the previous 5 messages by default but can be adjusted in the "Session Memory" node
     ```

10. **Save and activate the workflow.**

---

### 5. General Notes & Resources

| Note Content                                                                                                            | Context or Link                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|
| The AI Agent enforces querying the schema before executing any SQL to avoid invalid queries and ensure data accuracy.   | Internal logic best practice for database querying with AI tools.                              |
| The system interprets "last month" as the most recent full calendar month, providing consistent time frame queries.      | Defined in AI Agent prompt to standardize date interpretation.                                 |
| The workflow uses GPT-4.1-mini model; consider API costs and performance trade-offs when selecting model variants.       | Model choice affects cost, speed, and accuracy.                                                |
| Ensure your OpenAI API key and MySQL credentials have appropriate permissions and are secured within n8n credentials.   | Security best practices for API and database access.                                          |
| For extended conversational memory beyond 5 messages, adjust settings in the Simple Memory node ("Session Memory").     | Allows maintaining longer context but may increase resource usage.                            |
| Workflow inspired by LangChain integration patterns combining AI with databases for natural language querying.          | Useful for internal knowledge bases, customer support, reporting, and data exploration tools. |

---

**Disclaimer:**  
The text provided is exclusively derived from an automated workflow created with n8n, an integration and automation tool. This processing strictly adheres to applicable content policies and contains no illegal, offensive, or protected elements. All data handled is legal and publicly accessible.