Get your website indexed by Google automatically

https://n8nworkflows.xyz/workflows/get-your-website-indexed-by-google-automatically-2210


# Get your website indexed by Google automatically

### 1. Workflow Overview

This workflow automates the process of submitting website pages to Google for indexing using the Google Indexing API by leveraging the website’s sitemap.xml structure. It is designed primarily for websites with multiple nested sitemaps, such as those generated by Ghost CMS or WordPress, but can be adapted for other CMS-generated sitemaps.

The workflow is organized into the following logical blocks:

- **1.1 Triggering Mechanism**: Initiates the workflow either on a schedule or manually via a test trigger.
- **1.2 Sitemap Retrieval and Parsing**: Fetches the main sitemap.xml, extracts nested content-specific sitemaps, and parses each to retrieve individual page URLs and their last modified dates.
- **1.3 Data Normalization and Sorting**: Converts XML sitemap data to JSON, ensures URL arrays are properly formatted, assigns mandatory sitemap fields (`loc` and `lastmod`), and sorts pages by last modification date (newest first).
- **1.4 Indexing Status Check and Update Loop**: Iterates through each page entry, queries the Google Indexing API to check indexing metadata, compares last indexing time with the page’s last modification date, and conditionally submits URLs for re-indexing if new or updated.
- **1.5 Rate Limiting and Throttling**: Includes wait times between requests to avoid exceeding Google API quotas and manages batch processing.

---

### 2. Block-by-Block Analysis

#### 2.1 Triggering Mechanism

- **Overview:** This block starts the workflow execution either on a fixed daily schedule at 02:05 or manually when the user clicks "Test workflow" in n8n.
- **Nodes Involved:**  
  - `Schedule Trigger`  
  - `When clicking "Test workflow"`

- **Node Details:**

  - **Schedule Trigger**  
    - Type: Schedule Trigger  
    - Role: Automatically triggers workflow daily at 2:05 AM  
    - Configuration: Interval set to trigger at hour 2 and minute 5  
    - Input: None  
    - Output: Triggers next node `Get sitemap.xml`  
    - Edge cases: Scheduled time zone differences may affect execution; ensure server time matches desired timezone.

  - **When clicking "Test workflow"**  
    - Type: Manual Trigger  
    - Role: Allows manual execution for testing or on-demand runs  
    - Configuration: Default manual trigger settings  
    - Input: None  
    - Output: Triggers `Get sitemap.xml` node  
    - Edge cases: Manual trigger bypasses schedule, useful for testing.

---

#### 2.2 Sitemap Retrieval and Parsing

- **Overview:** Fetches the main sitemap.xml URL, converts XML to JSON, extracts nested content-specific sitemaps, fetches each sitemap’s content, converts each to JSON, and prepares URLs for further processing.
- **Nodes Involved:**  
  - `Get sitemap.xml`  
  - `Convert sitemap to JSON`  
  - `Get content-specific sitemaps`  
  - `Get content of each sitemap`  
  - `convert page data to JSON`  
  - `Force urlset.url to array`  
  - `Split Out`

- **Node Details:**

  - **Get sitemap.xml**  
    - Type: HTTP Request  
    - Role: Downloads the main sitemap.xml file  
    - Configuration: URL parameter set to the website’s sitemap.xml (default example: https://wordpress.org/sitemap.xml)  
    - Input: Trigger from previous block  
    - Output: XML content of sitemap.xml  
    - Edge cases: HTTP errors, invalid sitemap URL, network issues.

  - **Convert sitemap to JSON**  
    - Type: XML Node  
    - Role: Converts the raw XML sitemap into JSON for easier manipulation  
    - Configuration: Default XML parsing options  
    - Input: XML data from `Get sitemap.xml`  
    - Output: JSON representation of sitemapindex object  
    - Edge cases: Malformed XML, empty response.

  - **Get content-specific sitemaps**  
    - Type: Split Out  
    - Role: Extracts individual sitemap entries from the sitemapindex object (`sitemapindex.sitemap`)  
    - Configuration: Splitting by field `sitemapindex.sitemap`  
    - Input: JSON from previous node  
    - Output: Individual sitemap objects for each content-specific sitemap  
    - Edge cases: Missing or unexpected XML structure.

  - **Get content of each sitemap**  
    - Type: HTTP Request  
    - Role: Downloads each content-specific sitemap.xml using URL from previous step  
    - Configuration: URL set dynamically to each sitemap’s `loc` field; batch size of 1 with 150ms interval to avoid overload  
    - Input: Each sitemap URL from `Get content-specific sitemaps`  
    - Output: XML content of each content-specific sitemap  
    - Edge cases: HTTP failures, rate limiting, invalid URLs.

  - **convert page data to JSON**  
    - Type: XML Node  
    - Role: Converts each content-specific sitemap XML to JSON  
    - Configuration: Option `explicitArray` set to false to simplify structure  
    - Input: XML data from `Get content of each sitemap`  
    - Output: JSON of `urlset` containing individual URLs and metadata  
    - Edge cases: Malformed XML, missing fields.

  - **Force urlset.url to array**  
    - Type: Set Node  
    - Role: Ensures `urlset.url` is always an array, even if only one URL is present (normalizes data structure)  
    - Configuration: If first element of `urlset.url` exists, keep as is; else wrap in array  
    - Input: JSON from previous node  
    - Output: JSON where `urlset.url` is guaranteed to be an array  
    - Edge cases: Unexpected sitemap formats where `urlset.url` is missing.

  - **Split Out**  
    - Type: Split Out  
    - Role: Splits the array of URLs (`urlset.url`) into individual items for processing  
    - Configuration: Splitting by `urlset.url`  
    - Input: JSON with array from previous node  
    - Output: Individual page URL objects  
    - Edge cases: Empty array causes no outputs.

---

#### 2.3 Data Normalization and Sorting

- **Overview:** Assigns mandatory sitemap protocol fields `loc` (URL) and `lastmod` (last modified date) to each page, then sorts all pages by `lastmod` descending (newest pages first).
- **Nodes Involved:**  
  - `Sort`  
  - `Assign mandatiry sitemap fields`

- **Node Details:**

  - **Assign mandatiry sitemap fields**  
    - Type: Set Node  
    - Role: Ensures each page object explicitly contains `loc` and `lastmod` fields as strings  
    - Configuration: Sets `lastmod` to `$json.lastmod` and `loc` to `$json.loc` from incoming data  
    - Input: Individual URL JSON objects from `Split Out`  
    - Output: JSON objects with normalized fields  
    - Edge cases: Missing `loc` or `lastmod` fields in source data.

  - **Sort**  
    - Type: Sort Node  
    - Role: Sorts all page entries by `lastmod` field in descending order  
    - Configuration: Sort field `lastmod`, order descending  
    - Input: Multiple page JSON objects  
    - Output: Sorted list of pages  
    - Edge cases: Non-standard date formats in `lastmod` may cause sorting errors.

---

#### 2.4 Indexing Status Check and Update Loop

- **Overview:** Iterates over each page URL, checks Google Indexing API metadata, compares dates to detect if re-indexing is needed, submits URL update requests if necessary, and waits briefly to avoid quota issues.
- **Nodes Involved:**  
  - `Loop Over Items`  
  - `Check status`  
  - `is new?` (If node)  
  - `URL Updated`  
  - `Wait`

- **Node Details:**

  - **Loop Over Items**  
    - Type: Split In Batches  
    - Role: Processes individual page entries in batches (default batch size, no specific limit set)  
    - Configuration: Default options  
    - Input: Sorted pages from previous block  
    - Output: One page item per iteration to downstream nodes  
    - Edge cases: Large number of pages may cause long processing times.

  - **Check status**  
    - Type: HTTP Request  
    - Role: Calls Google Indexing API metadata endpoint to check if URL is indexed and last update time  
    - Configuration:  
      - URL: `https://indexing.googleapis.com/v3/urlNotifications/metadata?url={{ encodeURIComponent($json.loc) }}`  
      - Authentication: Google OAuth2 Credential with Indexing API scope  
      - On error: Continue execution (important for handling 404s when URL not indexed)  
      - Full HTTP response requested to access status codes  
    - Input: Single page JSON object with `loc`  
    - Output: Metadata response JSON including last notify time or error  
    - Edge cases: 404 means URL not indexed; quota errors; auth failures; API downtime.

  - **is new?** (If node)  
    - Type: If Node  
    - Role: Decides whether to send indexing update request based on date comparison  
    - Configuration: Checks if page `lastmod` is after Google’s `latestUpdate.notifyTime`  
    - Input: Output of `Check status` node (metadata) and page data  
    - Output:  
      - True: Page is new or updated since last indexing → triggers `URL Updated`  
      - False: Skip to `Wait` node (no update needed)  
    - Edge cases: Missing `notifyTime` interpreted as URL new; date format mismatches.

  - **URL Updated**  
    - Type: HTTP Request  
    - Role: Sends POST request to Google Indexing API to notify update of URL  
    - Configuration:  
      - URL: `https://indexing.googleapis.com/v3/urlNotifications:publish`  
      - Method: POST  
      - Body includes `url` and `type` (fixed as `URL_UPDATED`)  
      - Authentication: Google OAuth2  
    - Input: Page JSON from `Loop Over Items`  
    - Output: API response confirming submission  
    - Edge cases: API quota exceeded; invalid URL errors; auth errors.

  - **Wait**  
    - Type: Wait Node  
    - Role: Pauses execution briefly (randomized between 0.3 and 1.5 seconds) to avoid API rate limits and quota issues  
    - Configuration: Wait time calculated as `Math.min(1.5, 0.3 + 3 * Math.random()).toFixed(2)` seconds  
    - Input: Results from `URL Updated` or from `is new?` false path  
    - Output: Loops back to `Loop Over Items` to process next page  
    - Edge cases: Too short wait risks hitting quota; too long wait slows workflow.

---

### 3. Summary Table

| Node Name                      | Node Type            | Functional Role                                               | Input Node(s)                 | Output Node(s)                  | Sticky Note                                                                                                  |
|-------------------------------|----------------------|---------------------------------------------------------------|------------------------------|-------------------------------|--------------------------------------------------------------------------------------------------------------|
| Schedule Trigger               | Schedule Trigger     | Triggers workflow daily at 02:05                              | None                         | Get sitemap.xml                |                                                                                                              |
| When clicking "Test workflow" | Manual Trigger       | Manual trigger for testing or on-demand runs                  | None                         | Get sitemap.xml                |                                                                                                              |
| Get sitemap.xml               | HTTP Request         | Fetches main sitemap.xml from website                         | Schedule Trigger, Manual Trigger | Convert sitemap to JSON        | ## Get sitemap.xml<br>Various CMS systems often have multiple sitemaps for different content (posts, tags, pages etc). Need to fetch all sitemaps first and then extract all pages from all sitemaps.<br>### Remember to update the real sitemap URL! |
| Convert sitemap to JSON       | XML Node             | Converts main sitemap XML to JSON                              | Get sitemap.xml               | Get content-specific sitemaps  |                                                                                                              |
| Get content-specific sitemaps | Split Out            | Extracts nested sitemaps from sitemapindex                    | Convert sitemap to JSON       | Get content of each sitemap    |                                                                                                              |
| Get content of each sitemap    | HTTP Request         | Fetches each nested content-specific sitemap.xml              | Get content-specific sitemaps | convert page data to JSON      |                                                                                                              |
| convert page data to JSON      | XML Node             | Converts content-specific sitemap XML to JSON                 | Get content of each sitemap   | Force urlset.url to array      |                                                                                                              |
| Force urlset.url to array      | Set Node             | Ensures URL list is always an array                            | convert page data to JSON     | Split Out                     |                                                                                                              |
| Split Out                     | Split Out            | Splits array of URLs into individual items                     | Force urlset.url to array     | Sort                         | ## Collect list of URLs<br>This part extracts all pages from all sitemaps and sorts by the last modified date `lastmod` (from newest to oldest) |
| Sort                         | Sort Node            | Sorts pages by `lastmod` descending                            | Split Out                    | Assign mandatiry sitemap fields |                                                                                                              |
| Assign mandatiry sitemap fields | Set Node             | Assigns mandatory sitemap fields `loc` and `lastmod`          | Sort                         | Loop Over Items               | ## Update the `lastmod` and `loc` fields<br>These are pre-defined fields according to [the XML schema for the Sitemap protocol](https://www.sitemaps.org/protocol.html).<br><br>If your CMS system has different field names, please rename them here:<br>* the last modified field `lastmod`<br>* URL of the page in `loc` field |
| Loop Over Items              | Split In Batches      | Processes pages one by one to check and update indexing       | Assign mandatiry sitemap fields | Check status                 |                                                                                                              |
| Check status                 | HTTP Request         | Queries Google Indexing API for current URL indexing metadata | Loop Over Items              | is new?; URL Updated           | ## Check URL metadata and update, if:<br>* Google returns error (404 error means that this URL was not previously added)<br>* Date of article update is after the date of last request to re-index |
| is new?                      | If Node              | Compares page lastmod date with Google last notify time       | Check status                 | URL Updated (true); Wait (false) |                                                                                                              |
| URL Updated                  | HTTP Request         | Sends update notification to Google Indexing API              | is new? (true)               | Wait                         |                                                                                                              |
| Wait                         | Wait Node            | Waits 0.3–1.5 seconds before next iteration to avoid quota issues | URL Updated; is new? (false) | Loop Over Items               |                                                                                                              |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Trigger Nodes**  
   - Add a **Schedule Trigger** node:  
     - Set to trigger daily at hour 2, minute 5.  
   - Add a **Manual Trigger** node (optional):  
     - For manual test runs.

2. **Fetch Main Sitemap**  
   - Add an **HTTP Request** node named `Get sitemap.xml`:  
     - Set method to GET (default).  
     - Set URL to your website’s main sitemap.xml URL (e.g., https://yourwebsite.com/sitemap.xml).  
     - No authentication required.

3. **Convert Main Sitemap XML to JSON**  
   - Add an **XML** node named `Convert sitemap to JSON`:  
     - Connect input from `Get sitemap.xml`.  
     - Default XML parsing settings.

4. **Extract Content-Specific Sitemaps**  
   - Add a **Split Out** node named `Get content-specific sitemaps`:  
     - Set `fieldToSplitOut` to `sitemapindex.sitemap`.  
     - Connect input from `Convert sitemap to JSON`.

5. **Fetch Each Content-Specific Sitemap**  
   - Add an **HTTP Request** node named `Get content of each sitemap`:  
     - Set method GET.  
     - Set URL to `={{ $json.loc }}` (dynamic based on each sitemap URL).  
     - Enable batching with batch size 1 and interval 150ms to avoid overload.  
     - Connect input from `Get content-specific sitemaps`.

6. **Convert Content-Specific Sitemap XML to JSON**  
   - Add an **XML** node named `convert page data to JSON`:  
     - Connect input from `Get content of each sitemap`.  
     - Set option `explicitArray` to false.

7. **Normalize URL Array**  
   - Add a **Set** node named `Force urlset.url to array`:  
     - Set field `urlset.url` to expression:  
       `={{ $json.urlset.url[0] ? $json.urlset.url : [$json.urlset.url] }}`  
     - Connect input from `convert page data to JSON`.

8. **Split Out Individual URLs**  
   - Add a **Split Out** node named `Split Out`:  
     - Set `fieldToSplitOut` to `urlset.url`.  
     - Connect input from `Force urlset.url to array`.

9. **Sort Pages by Last Modified Date**  
   - Add a **Sort** node named `Sort`:  
     - Sort by field `lastmod` descending.  
     - Connect input from `Split Out`.

10. **Assign Mandatory Sitemap Fields**  
    - Add a **Set** node named `Assign mandatiry sitemap fields`:  
      - Map `lastmod` to `={{ $json.lastmod }}` (string).  
      - Map `loc` to `={{ $json.loc }}` (string).  
      - Connect input from `Sort`.

11. **Process Pages in Batches**  
    - Add a **Split In Batches** node named `Loop Over Items`:  
      - Default batch options.  
      - Connect input from `Assign mandatiry sitemap fields`.

12. **Check URL Indexing Status in Google**  
    - Add an **HTTP Request** node named `Check status`:  
      - Method: GET  
      - URL: `https://indexing.googleapis.com/v3/urlNotifications/metadata?url={{ encodeURIComponent($json.loc) }}`  
      - Authentication: Google OAuth2 credentials with `https://www.googleapis.com/auth/indexing` scope  
      - On error: Continue execution (to handle 404s gracefully)  
      - Connect input from `Loop Over Items`.  
      - Note: Configure Google OAuth2 credentials properly.

13. **Determine If URL is New or Updated**  
    - Add an **If** node named `is new?`:  
      - Condition: Check if page `lastmod` date is after Google’s `latestUpdate.notifyTime` date.  
      - Expression for comparison:  
        Left: `={{ $('Loop Over Items').item.json.lastmod }}`  
        Right: `={{ $json.body.latestUpdate.notifyTime }}`  
      - Connect input from `Check status`.

14. **Trigger URL Update**  
    - Add an **HTTP Request** node named `URL Updated`:  
      - Method: POST  
      - URL: `https://indexing.googleapis.com/v3/urlNotifications:publish`  
      - Body parameters:  
        - `url`: `={{ $('Loop Over Items').item.json.loc }}`  
        - `type`: `URL_UPDATED`  
      - Authentication: Same Google OAuth2 credentials  
      - Connect input from `is new?` true output.

15. **Wait Node for Rate Limiting**  
    - Add a **Wait** node named `Wait`:  
      - Duration: seconds  
      - Expression: `={{ Math.min(1.5, 0.3 + 3 * Math.random()).toFixed(2) }}`  
      - Connect input from both `URL Updated` and `is new?` false output.

16. **Loop Back to Process Next URL**  
    - Connect the output of `Wait` node back to `Loop Over Items` to continue processing until all pages are handled.

17. **Connect Triggers to Start the Workflow**  
    - Connect `Schedule Trigger` and `When clicking "Test workflow"` nodes to `Get sitemap.xml` to start the process.

18. **Set Credentials**  
    - Configure Google OAuth2 credentials in n8n with correct client ID, secret, and enable the Google Indexing API.  
    - Ensure the OAuth2 scope includes: `https://www.googleapis.com/auth/indexing`.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                                                                                                                                                              | Context or Link                                                                                         |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| This workflow was tested with sitemap.xml generated by Ghost CMS and WordPress. For adaptations to other CMS, field names for `lastmod` and `loc` may need adjustment.                                                                                                                                                                                                                                                   | Workflow description                                                                                   |
| To connect Google Cloud Platform to n8n for this workflow, follow the same approach as for Google Sheets with a service account. Enable `Web Search Indexing API` in GCP. Add the scope `https://www.googleapis.com/auth/indexing` in n8n credentials settings.                                                                                                                     | [Google Sheets to n8n article](https://blog.n8n.io/google-sheets-as-database/#step-1-obtain-google-service-account-credentials) |
| Free Google Cloud Platform accounts have a quota of 200 indexing requests per day. If your website has more pages, the workflow handles quota errors by skipping already processed pages and continuing the next day.                                                                                                                                                                                                     | Important note in description                                                                           |
| Sitemap protocol specification reference: https://www.sitemaps.org/protocol.html                                                                                                                                                                                                                                                                                                                                         | Sitemap protocol link                                                                                   |
| Author / Support contact: Eduard (https://www.linkedin.com/in/parsadanyan/)                                                                                                                                                                                                                                                                                                                                              | Workflow description                                                                                   |
| See Yulia's n8n workflows for inspiration: https://n8n.io/creators/yulia/                                                                                                                                                                                                                                                                                                                                               | Workflow description                                                                                   |

---

This structured documentation provides a complete technical understanding of the workflow, enabling users or agents to comprehend, reproduce, customize, and troubleshoot the Google site indexing automation efficiently.